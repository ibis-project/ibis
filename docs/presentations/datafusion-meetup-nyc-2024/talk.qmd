---
title: "Dataframe Interfaces are a nightmare"
author: Gil Forsyth
date: "2024-09-14"
execute:
  echo: true
format:
  revealjs:
    theme: [default, custom.scss]
    footer: <https://ibis-project.org/presentations/datafusion-meetup-nyc-2024/talk>
---

## Who?

:::: {.columns}

::: {.column width="40%"}
### Me

- Gil Forsyth
- Ibis project
- Xonsh
- Voltron Data
- Recovering academic
:::

::: {.column width="60%"}
### Where

- {{< fa brands github >}} [`@gforsyth`](https://github.com/gforsyth)
- {{< fa brands mastodon >}} [`@gforsyth@fosstodon.org`](https://fosstodon.org/@gforsyth)
:::

::::

# Show of hands

## Who here is a...

::: {.incremental}
- Data analyst / Data scientist?
- Data engineer?
- Software engineer?
- ML something-something?
:::

## Who here uses...

::: {.incremental}
- Rust?
- Python?
- SQL?
- R?
- KDB+ Q?
:::

# Don't design a Python Dataframe API

## Python/pandas terminology or SQL terminology?

::: {.incremental}
- `order_by` or `orderby` or `sort` or `sort_by` or `sortby`?
- `group_by` or `groupby` or `partition` or `partition_by` or `partitionby`?
:::

::: {.fragment}
::: {.r-fit-text}
_please_ only choose one
:::
:::

## Python/pandas semantics or SQL semantics?


::: {.incremental}
- 0-indexing or 1-indexing?
- Do `rpad` and `lpad` also `trim`?
- Is _implicit ordering_ guaranteed everywhere?
- Are multi-indexes a good idea? (No)
:::

# Don't design a SQL dialect

## (SQL) Questions with no (single) answer

::: {.incremental}
- Does a week start on Sunday or Monday?
- Are the days of a week 0-indexed or 1-indexed?
- Do nulls sort ascending, or descending, or always first, or always last?
- Given a function to compute $log_b(x)$, is the function signature:
  - `log(b, x)`?
  - `log(x, b)`?
:::

## SQL ain't standard

#### Which is (a small part of) why you end up with:
::: {.fragment}
::: {.r-fit-text}
```sql
SELECT SUM(CAST(CONTAINS(LOWER("t0"."name"), 'darth') AS INT)) FROM "starwars"
```

<br>

```sql
SELECT SUM(CAST(strpos(LOWER(`t0`.`name`), 'darth') > 0 AS INT64)) FROM `starwars`
```

<br>

```sql
SELECT SUM(IIF(CONTAINS(LOWER([t0].[name]), 'darth'), 1, 0)) FROM [starwars]
```

<br>

```sql
SELECT SUM(CAST(STRPOS(LOWER("t0"."name"), 'darth') > 0 AS INT)) FROM "starwars"
```
:::
:::

## SQL ain't standard

<br>

![](./images/sql_is_really_difficult_at_first.png){fig-align="center"}


## (Some) Answers to the DataFrame questions


::: {.r-stack}
![](images/orderby_sortby.png){.fragment}

![](images/deprecate_sortby.png){.fragment}

![](images/deprecate_groupby.png){.fragment}

![](images/python_padding.png){.fragment}
:::

## Obligatory XKCD
