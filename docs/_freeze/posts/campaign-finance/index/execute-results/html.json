{
  "hash": "31e6e880f6a810c176c6170c323cbe6d",
  "result": {
    "markdown": "---\ntitle: \"Exploring campaign finance data\"\nauthor: \"Nick Crews\"\ndate: \"2023-03-24\"\ncategories:\n    - blog\n---\n\nHi! My name is [Nick Crews](https://www.linkedin.com/in/nicholas-b-crews/),\nand I'm a data engineer that looks at public campaign finance data.\n\nIn this post, I'll walk through how I use Ibis to explore public campaign contribution\ndata from the Federal Election Commission (FEC). We'll do some loading,\ncleaning, featurizing, and visualization. There will be filtering, sorting, grouping,\nand aggregation.\n\n## Downloading The Data\n\n::: {#283e71e5 .cell execution_count=1}\n``` {.python .cell-code}\nfrom pathlib import Path\nfrom zipfile import ZipFile\nfrom urllib.request import urlretrieve\n\n# Download and unzip the 2018 individual contributions data\nurl = \"https://cg-519a459a-0ea3-42c2-b7bc-fa1143481f74.s3-us-gov-west-1.amazonaws.com/bulk-downloads/2018/indiv18.zip\"\nzip_path = Path(\"indiv18.zip\")\ncsv_path = Path(\"indiv18.csv\")\n\nif not zip_path.exists():\n    urlretrieve(url, zip_path)\n\nif not csv_path.exists():\n    with ZipFile(zip_path) as zip_file, csv_path.open(\"w\") as csv_file:\n        for line in zip_file.open(\"itcont.txt\"):\n            csv_file.write(line.decode())\n```\n:::\n\n\n## Loading the data\n\nNow that we have our raw data in a .csv format, let's load it into Ibis,\nusing the duckdb backend.\n\nNote that a 4.3 GB .csv would be near the limit of what pandas could\nhandle on my laptop with 16GB of RAM. In pandas, typically every time\nyou perform a transformation on the data, a copy of the data is made.\nI could only do a few transformations before I ran out of memory.\n\nWith Ibis, this problem is solved in two different ways.\n\nFirst, because they are designed to work with very large datasets,\nmany (all?) SQL backends support out of core operations.\nThe data lives on disk, and are only loaded in a streaming fashion\nwhen needed, and then written back to disk as the operation is performed.\n\nSecond, unless you explicitly ask for it, Ibis makes use of lazy\nevaluation. This means that when you ask for a result, the\nresult is not persisted in memory. Only the original source\ndata is persisted. Everything else is derived from this on the fly.\n\n::: {#f280a2ba .cell execution_count=2}\n``` {.python .cell-code}\nimport ibis\nfrom ibis import _\n\nibis.options.interactive = True\n\n# The raw .csv file doesn't have column names, so we will add them in the next step.\nraw = ibis.read_csv(csv_path)\nraw\n```\n\n::: {.cell-output .cell-output-display execution_count=2}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> C00401224 </span>┃<span style=\"font-weight: bold\"> A      </span>┃<span style=\"font-weight: bold\"> M6     </span>┃<span style=\"font-weight: bold\"> P      </span>┃<span style=\"font-weight: bold\"> 201804059101866001 </span>┃<span style=\"font-weight: bold\"> 24T    </span>┃<span style=\"font-weight: bold\"> IND    </span>┃<span style=\"font-weight: bold\"> STOUFFER, LEIGH   </span>┃<span style=\"font-weight: bold\"> AMSTELVEEN   </span>┃<span style=\"font-weight: bold\"> ZZ     </span>┃<span style=\"font-weight: bold\"> 1187RC    </span>┃<span style=\"font-weight: bold\"> MYSELF            </span>┃<span style=\"font-weight: bold\"> SELF EMPLOYED           </span>┃<span style=\"font-weight: bold\"> 05172017 </span>┃<span style=\"font-weight: bold\"> 10    </span>┃<span style=\"font-weight: bold\"> C00458000 </span>┃<span style=\"font-weight: bold\"> SA11AI_81445687 </span>┃<span style=\"font-weight: bold\"> 1217152 </span>┃<span style=\"font-weight: bold\"> column18 </span>┃<span style=\"font-weight: bold\"> EARMARKED FOR PROGRESSIVE CHANGE CAMPAIGN COMMITTEE (C00458000) </span>┃<span style=\"font-weight: bold\"> 4050820181544765358 </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>              │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>            │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>            │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>   │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>   │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>   │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                                                          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>               │\n├───────────┼────────┼────────┼────────┼────────────────────┼────────┼────────┼───────────────────┼──────────────┼────────┼───────────┼───────────────────┼─────────────────────────┼──────────┼───────┼───────────┼─────────────────┼─────────┼──────────┼─────────────────────────────────────────────────────────────────┼─────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00401224</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">A     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">M6    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">P     </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">201804059101867748</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">24T   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">STRAWS, JOYCE    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">OCOEE       </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">FL    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">34761    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">SILVERSEA CRUISES</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">RESERVATIONS SUPERVISOR</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">05182017</span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">10</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">C00000935</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">SA11AI_81592336</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1217152</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │ <span style=\"color: #008000; text-decoration-color: #008000\">EARMARKED FOR DCCC (C00000935)                                 </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4050820181544770597</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00401224</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">A     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">M6    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">P     </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">201804059101867748</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">24T   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">STRAWS, JOYCE    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">OCOEE       </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">FL    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">34761    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">SILVERSEA CRUISES</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">RESERVATIONS SUPERVISOR</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">05192017</span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">15</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">C00000935</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">SA11AI_81627562</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1217152</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │ <span style=\"color: #008000; text-decoration-color: #008000\">EARMARKED FOR DCCC (C00000935)                                 </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4050820181544770598</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00401224</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">A     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">M6    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">P     </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">201804059101865942</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">24T   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">STOTT, JIM       </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">CAPE NEDDICK</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">039020760</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">NONE             </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">NONE                   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">05132017</span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">35</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">C00000935</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">SA11AI_81047921</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1217152</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │ <span style=\"color: #008000; text-decoration-color: #008000\">EARMARKED FOR DCCC (C00000935)                                 </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4050820181544765179</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00401224</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">A     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">M6    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">P     </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">201804059101865942</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">24T   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">STOTT, JIM       </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">CAPE NEDDICK</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">039020760</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">NONE             </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">NONE                   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">05152017</span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">35</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">C00000935</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">SA11AI_81209209</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1217152</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │ <span style=\"color: #008000; text-decoration-color: #008000\">EARMARKED FOR DCCC (C00000935)                                 </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4050820181544765180</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00401224</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">A     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">M6    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">P     </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">201804059101865942</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">24T   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">STOTT, JIM       </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">CAPE NEDDICK</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">039020760</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">NONE             </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">NONE                   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">05192017</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">C00000935</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">SA11AI_81605223</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1217152</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │ <span style=\"color: #008000; text-decoration-color: #008000\">EARMARKED FOR DCCC (C00000935)                                 </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4050820181544765181</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00401224</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">A     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">M6    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">P     </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">201804059101865943</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">24T   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">STOTT, JIM       </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">CAPE NEDDICK</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">039020760</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">NONE             </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">NONE                   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">05242017</span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">15</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">C00000935</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">SA11AI_82200022</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1217152</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │ <span style=\"color: #008000; text-decoration-color: #008000\">EARMARKED FOR DCCC (C00000935)                                 </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4050820181544765182</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00401224</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">A     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">M6    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">P     </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">201804059101865943</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">24T   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">STOTT, JIM       </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">CAPE NEDDICK</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">03902    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">NOT EMPLOYED     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">NOT EMPLOYED           </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">05292017</span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">100</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">C00213512</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">SA11AI_82589834</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1217152</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │ <span style=\"color: #008000; text-decoration-color: #008000\">EARMARKED FOR NANCY PELOSI FOR CONGRESS (C00213512)            </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4050820181544765184</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00401224</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">A     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">M6    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">P     </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">201804059101865944</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">24T   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">STOTT, JIM       </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">CAPE NEDDICK</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">039020760</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">NONE             </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">NONE                   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">05302017</span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">35</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">C00000935</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">SA11AI_82643727</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1217152</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │ <span style=\"color: #008000; text-decoration-color: #008000\">EARMARKED FOR DCCC (C00000935)                                 </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4050820181544765185</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00401224</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">A     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">M6    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">P     </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">201804059101867050</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">24T   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">STRANGE, WINIFRED</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ANNA MSRIA  </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">FL    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">34216    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">NOT EMPLOYED     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">NOT EMPLOYED           </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">05162017</span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">25</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">C00000935</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">SA11AI_81325918</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1217152</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │ <span style=\"color: #008000; text-decoration-color: #008000\">EARMARKED FOR DCCC (C00000935)                                 </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4050820181544768505</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00401224</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">A     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">M6    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">P     </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">201804059101867051</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">24T   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">STRANGE, WINIFRED</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ANNA MSRIA  </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">FL    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">34216    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">NOT EMPLOYED     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">NOT EMPLOYED           </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">05232017</span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">25</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">C00000935</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">SA11AI_81991189</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1217152</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │ <span style=\"color: #008000; text-decoration-color: #008000\">EARMARKED FOR DCCC (C00000935)                                 </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4050820181544768506</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>      │                  <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                 │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>            │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                 │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>        │     <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>               │       <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>        │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                                               │                   <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │\n└───────────┴────────┴────────┴────────┴────────────────────┴────────┴────────┴───────────────────┴──────────────┴────────┴───────────┴───────────────────┴─────────────────────────┴──────────┴───────┴───────────┴─────────────────┴─────────┴──────────┴─────────────────────────────────────────────────────────────────┴─────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n::: {#67e41cda .cell execution_count=3}\n``` {.python .cell-code}\n# For a more comprehesive description of the columns and their meaning, see\n# https://www.fec.gov/campaign-finance-data/contributions-individuals-file-description/\ncolumns = {\n    \"CMTE_ID\": \"keep\",  # Committee ID\n    \"AMNDT_IND\": \"drop\",  # Amendment indicator. A = amendment, N = new, T = termination\n    \"RPT_TP\": \"drop\",  # Report type (monthly, quarterly, etc)\n    \"TRANSACTION_PGI\": \"keep\",  # Primary/general indicator\n    \"IMAGE_NUM\": \"drop\",  # Image number\n    \"TRANSACTION_TP\": \"drop\",  # Transaction type\n    \"ENTITY_TP\": \"keep\",  # Entity type\n    \"NAME\": \"drop\",  # Contributor name\n    \"CITY\": \"keep\",  # Contributor city\n    \"STATE\": \"keep\",  # Contributor state\n    \"ZIP_CODE\": \"drop\",  # Contributor zip code\n    \"EMPLOYER\": \"drop\",  # Contributor employer\n    \"OCCUPATION\": \"drop\",  # Contributor occupation\n    \"TRANSACTION_DT\": \"keep\",  # Transaction date\n    \"TRANSACTION_AMT\": \"keep\",  # Transaction amount\n    # Other ID. For individual contributions will be null. For contributions from\n    # other FEC committees, will be the committee ID of the other committee.\n    \"OTHER_ID\": \"drop\",\n    \"TRAN_ID\": \"drop\",  # Transaction ID\n    \"FILE_NUM\": \"drop\",  # File number, unique number assigned to each report filed with the FEC\n    \"MEMO_CD\": \"drop\",  # Memo code\n    \"MEMO_TEXT\": \"drop\",  # Memo text\n    \"SUB_ID\": \"drop\",  # Submission ID. Unique number assigned to each transaction.\n}\n\nrenaming = {old: new for old, new in zip(raw.columns, columns.keys())}\nto_keep = [k for k, v in columns.items() if v == \"keep\"]\nkept = raw.relabel(renaming)[to_keep]\nkept\n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> CMTE_ID   </span>┃<span style=\"font-weight: bold\"> TRANSACTION_PGI </span>┃<span style=\"font-weight: bold\"> ENTITY_TP </span>┃<span style=\"font-weight: bold\"> CITY         </span>┃<span style=\"font-weight: bold\"> STATE  </span>┃<span style=\"font-weight: bold\"> TRANSACTION_DT </span>┃<span style=\"font-weight: bold\"> TRANSACTION_AMT </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>           │\n├───────────┼─────────────────┼───────────┼──────────────┼────────┼────────────────┼─────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00401224</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">OCOEE       </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">FL    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">05182017      </span> │              <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">10</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00401224</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">OCOEE       </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">FL    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">05192017      </span> │              <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">15</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00401224</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">CAPE NEDDICK</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">05132017      </span> │              <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">35</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00401224</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">CAPE NEDDICK</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">05152017      </span> │              <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">35</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00401224</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">CAPE NEDDICK</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">05192017      </span> │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00401224</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">CAPE NEDDICK</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">05242017      </span> │              <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">15</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00401224</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">CAPE NEDDICK</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">05292017      </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">100</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00401224</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">CAPE NEDDICK</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">05302017      </span> │              <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">35</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00401224</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ANNA MSRIA  </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">FL    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">05162017      </span> │              <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">25</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00401224</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ANNA MSRIA  </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">FL    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">05232017      </span> │              <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">25</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>            │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>              │               <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │\n└───────────┴─────────────────┴───────────┴──────────────┴────────┴────────────────┴─────────────────┘\n</pre>\n```\n:::\n:::\n\n\n::: {#cdaf0b28 .cell execution_count=4}\n``` {.python .cell-code}\n# 21 million rows\nkept.count()\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"></pre>\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=4}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-cyan-fg ansi-bold\">4269618</span></pre>\n```\n:::\n\n:::\n:::\n\n\nHuh, what's up with those timings? Previewing the head only took a fraction of a second,\nbut finding the number of rows took 10 seconds.\n\nThat's because duckdb is scanning the .csv file on the fly every time we access it.\nSo we only have to read the first few lines to get that preview,\nbut we have to read the whole file to get the number of rows.\n\nNote that this isn't a feature of Ibis, but a feature of Duckdb. This what I think is\none of the strengths of Ibis: Ibis itself doesn't have to implement any of the\noptimimizations or features of the backends. Those backends can focus on what they do\nbest, and Ibis can get those things for free.\n\nSo, let's tell duckdb to actually read in the file to its native format so later accesses\nwill be faster. This will be a ~20 seconds that we'll only have to pay once.\n\n::: {#95bbd908 .cell execution_count=5}\n``` {.python .cell-code}\nkept = kept.cache()\nkept\n```\n\n::: {.cell-output .cell-output-display execution_count=5}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> CMTE_ID   </span>┃<span style=\"font-weight: bold\"> TRANSACTION_PGI </span>┃<span style=\"font-weight: bold\"> ENTITY_TP </span>┃<span style=\"font-weight: bold\"> CITY         </span>┃<span style=\"font-weight: bold\"> STATE  </span>┃<span style=\"font-weight: bold\"> TRANSACTION_DT </span>┃<span style=\"font-weight: bold\"> TRANSACTION_AMT </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>           │\n├───────────┼─────────────────┼───────────┼──────────────┼────────┼────────────────┼─────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00401224</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">OCOEE       </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">FL    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">05182017      </span> │              <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">10</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00401224</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">OCOEE       </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">FL    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">05192017      </span> │              <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">15</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00401224</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">CAPE NEDDICK</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">05132017      </span> │              <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">35</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00401224</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">CAPE NEDDICK</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">05152017      </span> │              <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">35</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00401224</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">CAPE NEDDICK</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">05192017      </span> │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00401224</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">CAPE NEDDICK</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">05242017      </span> │              <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">15</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00401224</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">CAPE NEDDICK</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">05292017      </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">100</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00401224</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">CAPE NEDDICK</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">05302017      </span> │              <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">35</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00401224</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ANNA MSRIA  </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">FL    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">05162017      </span> │              <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">25</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00401224</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ANNA MSRIA  </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">FL    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">05232017      </span> │              <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">25</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>            │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>              │               <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │\n└───────────┴─────────────────┴───────────┴──────────────┴────────┴────────────────┴─────────────────┘\n</pre>\n```\n:::\n:::\n\n\nLook, now accessing it only takes a fraction of a second!\n\n::: {#77989209 .cell execution_count=6}\n``` {.python .cell-code}\nkept.count()\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"></pre>\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=6}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-cyan-fg ansi-bold\">4269618</span></pre>\n```\n:::\n\n:::\n:::\n\n\n### Committees Data\n\nThe contributions only list an opaque `CMTE_ID` column. We want to know which actual\ncommittee this is. Let's load the committees table so we can lookup from\ncommittee ID to committee name.\n\n::: {#a1fbd001 .cell execution_count=7}\n``` {.python .cell-code}\ndef read_committees():\n    committees_url = \"https://cg-519a459a-0ea3-42c2-b7bc-fa1143481f74.s3-us-gov-west-1.amazonaws.com/bulk-downloads/2018/committee_summary_2018.csv\"\n    # This just creates a view, it doesn't actually fetch the data yet\n    tmp = ibis.read_csv(committees_url)\n    tmp = tmp[\"CMTE_ID\", \"CMTE_NM\"]\n    # The raw table contains multiple rows for each committee id, so lets pick\n    # an arbitrary row for each committee id as the representative name.\n    deduped = tmp.group_by(\"CMTE_ID\").agg(CMTE_NM=_.CMTE_NM.arbitrary())\n    return deduped\n\n\ncomms = read_committees().cache()\ncomms\n```\n\n::: {.cell-output .cell-output-display execution_count=7}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> CMTE_ID   </span>┃<span style=\"font-weight: bold\"> CMTE_NM                                                                       </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                                                                        │\n├───────────┼───────────────────────────────────────────────────────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00161570</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">AMERICAN PUBLIC POWER ASSOCIATION, PUBLIC OWNERSHIP OF ELECTRIC RESOURCES PAC</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00640219</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">PAULA SWEARENGIN 2018                                                        </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00640888</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">GFORCE                                                                       </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00561647</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">WORLDPAY, INC. GOOD GOVERNMENT FUND                                          </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00622431</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">MOVE MARYLAND FORWARD                                                        </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00620773</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">LAWHORN FOR CONGRESS COMMITTEE                                               </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00622167</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">SOC DEMOCRATIC CAMPAIGN OFFICE PAC                                           </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00465054</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">FRANK SCATURRO FOR CONGRESS                                                  </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00466110</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">FREELANCERS UNION POLITICAL ACTION FUND                                      </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C00480681</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">STAND AMERICA PAC                                                            </span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                                                             │\n└───────────┴───────────────────────────────────────────────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\nNow add the committee name to the contributions table:\n\n::: {#7a49323c .cell execution_count=8}\n``` {.python .cell-code}\ntogether = kept.left_join(comms, \"CMTE_ID\").drop(\"CMTE_ID\", \"CMTE_ID_right\")\ntogether\n```\n\n::: {.cell-output .cell-output-display execution_count=8}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> TRANSACTION_PGI </span>┃<span style=\"font-weight: bold\"> ENTITY_TP </span>┃<span style=\"font-weight: bold\"> CITY             </span>┃<span style=\"font-weight: bold\"> STATE  </span>┃<span style=\"font-weight: bold\"> TRANSACTION_DT </span>┃<span style=\"font-weight: bold\"> TRANSACTION_AMT </span>┃<span style=\"font-weight: bold\"> CMTE_NM                                         </span>┃\n┡━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                                          │\n├─────────────────┼───────────┼──────────────────┼────────┼────────────────┼─────────────────┼─────────────────────────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">COHASSET        </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">MA    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">01312017      </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">230</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">KEY LARGO       </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">FL    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">01042017      </span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5000</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">LOOKOUT MOUNTAIN</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">GA    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">01312017      </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">230</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">NORTH YARMOUTH  </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">01312017      </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">384</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ALPHARETTA      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">GA    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">01312017      </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">384</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">FALMOUTH        </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">01312017      </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">384</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">FALMOUTH        </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">01312017      </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">384</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">HOLLIS CENTER   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">01312017      </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">384</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">FALMOUTH        </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">01312017      </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">384</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">IND      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ALEXANDRIA      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">VA    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">01312017      </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">384</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>              │               <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                               │\n└─────────────────┴───────────┴──────────────────┴────────┴────────────────┴─────────────────┴─────────────────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n## Cleaning\n\nFirst, let's drop any contributions that don't have a committee name. There are only 6 of them.\n\n::: {#aedb068b .cell execution_count=9}\n``` {.python .cell-code}\n# We can do this fearlessly, no .copy() needed, because\n# everything in Ibis is immutable. If we did this in pandas,\n# we might start modifying the original DataFrame accidentally!\ncleaned = together\n\nhas_name = cleaned.CMTE_NM.notnull()\ncleaned = cleaned[has_name]\nhas_name.value_counts()\n```\n\n::: {.cell-output .cell-output-display execution_count=9}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> NotNull(CMTE_NM) </span>┃<span style=\"font-weight: bold\"> NotNull(CMTE_NM)_count </span>┃\n┡━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">boolean</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>                  │\n├──────────────────┼────────────────────────┤\n│ True             │                <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4269617</span> │\n│ False            │                      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │\n└──────────────────┴────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\nLet's look at the `ENTITY_TP` column. This represents the type of entity that\nmade the contribution:\n\n::: {#ff110922 .cell execution_count=10}\n``` {.python .cell-code}\ntogether.ENTITY_TP.value_counts()\n```\n\n::: {.cell-output .cell-output-display execution_count=10}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> ENTITY_TP </span>┃<span style=\"font-weight: bold\"> ENTITY_TP_count </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>           │\n├───────────┼─────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">IND      </span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4255693</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">ORG      </span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">6970</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>      │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2389</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">CAN      </span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3532</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">PAC      </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">847</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">COM      </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">130</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">CCM      </span> │              <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">50</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">PTY      </span> │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">7</span> │\n└───────────┴─────────────────┘\n</pre>\n```\n:::\n:::\n\n\nWe only care about contributions from individuals.\n\nOnce we filter on this column, the contents of it are irrelevant, so let's drop it.\n\n::: {#3764856c .cell execution_count=11}\n``` {.python .cell-code}\ncleaned = together[_.ENTITY_TP == \"IND\"].drop(\"ENTITY_TP\")\n```\n:::\n\n\nIt looks like the `TRANSACTION_DT` column was a raw string like \"MMDDYYYY\",\nso let's convert that to a proper date type.\n\n::: {#4e82ea63 .cell execution_count=12}\n``` {.python .cell-code}\nfrom ibis.expr.types import StringValue, DateValue\n\n\ndef mmddyyyy_to_date(val: StringValue) -> DateValue:\n    return val.cast(str).lpad(8, \"0\").to_timestamp(\"%m%d%Y\").date()\n\n\ncleaned = cleaned.mutate(date=mmddyyyy_to_date(_.TRANSACTION_DT)).drop(\"TRANSACTION_DT\")\ncleaned\n```\n\n::: {.cell-output .cell-output-display execution_count=12}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> TRANSACTION_PGI </span>┃<span style=\"font-weight: bold\"> CITY             </span>┃<span style=\"font-weight: bold\"> STATE  </span>┃<span style=\"font-weight: bold\"> TRANSACTION_AMT </span>┃<span style=\"font-weight: bold\"> CMTE_NM                                         </span>┃<span style=\"font-weight: bold\"> date       </span>┃\n┡━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                                          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">date</span>       │\n├─────────────────┼──────────────────┼────────┼─────────────────┼─────────────────────────────────────────────────┼────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">COHASSET        </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">MA    </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">230</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2017-01-31</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">KEY LARGO       </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">FL    </span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5000</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2017-01-04</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">LOOKOUT MOUNTAIN</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">GA    </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">230</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2017-01-31</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">NORTH YARMOUTH  </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">384</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2017-01-31</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ALPHARETTA      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">GA    </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">384</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2017-01-31</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">FALMOUTH        </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">384</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2017-01-31</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">FALMOUTH        </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">384</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2017-01-31</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">HOLLIS CENTER   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">384</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2017-01-31</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">FALMOUTH        </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">384</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2017-01-31</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ALEXANDRIA      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">VA    </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">384</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2017-01-31</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>      │               <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>          │\n└─────────────────┴──────────────────┴────────┴─────────────────┴─────────────────────────────────────────────────┴────────────┘\n</pre>\n```\n:::\n:::\n\n\nThe `TRANSACTION_PGI` column represents the type (primary, general, etc) of election,\nand the year. But it seems to be not very consistent:\n\n::: {#d6595a5d .cell execution_count=13}\n``` {.python .cell-code}\ncleaned.TRANSACTION_PGI.topk(10)\n```\n\n::: {.cell-output .cell-output-display execution_count=13}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> TRANSACTION_PGI </span>┃<span style=\"font-weight: bold\"> Count(TRANSACTION_PGI) </span>┃\n┡━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>                  │\n├─────────────────┼────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">P              </span> │                <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3509302</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">P2018          </span> │                 <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">436526</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">S2017          </span> │                  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">95817</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">R2017          </span> │                  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">50849</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">P2020          </span> │                  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">50248</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">G2017          </span> │                  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">30384</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">G2018          </span> │                  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">22811</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">P2017          </span> │                  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">18217</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">P2022          </span> │                  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">14752</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">C2018          </span> │                  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">14431</span> │\n└─────────────────┴────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n::: {#9b331b5f .cell execution_count=14}\n``` {.python .cell-code}\ndef get_election_type(pgi: StringValue) -> StringValue:\n    \"\"\"Use the first letter of the TRANSACTION_PGI column to determine the election type\n\n    If the first letter is not one of the known election stage, then return null.\n    \"\"\"\n    election_types = {\n        \"P\": \"primary\",\n        \"G\": \"general\",\n        \"O\": \"other\",\n        \"C\": \"convention\",\n        \"R\": \"runoff\",\n        \"S\": \"special\",\n        \"E\": \"recount\",\n    }\n    first_letter = pgi[0]\n    return first_letter.substitute(election_types, else_=ibis.NA)\n\n\ncleaned = cleaned.mutate(election_type=get_election_type(_.TRANSACTION_PGI)).drop(\n    \"TRANSACTION_PGI\"\n)\ncleaned\n```\n\n::: {.cell-output .cell-output-display execution_count=14}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> CITY             </span>┃<span style=\"font-weight: bold\"> STATE  </span>┃<span style=\"font-weight: bold\"> TRANSACTION_AMT </span>┃<span style=\"font-weight: bold\"> CMTE_NM                                         </span>┃<span style=\"font-weight: bold\"> date       </span>┃<span style=\"font-weight: bold\"> election_type </span>┃\n┡━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                                          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">date</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>        │\n├──────────────────┼────────┼─────────────────┼─────────────────────────────────────────────────┼────────────┼───────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">COHASSET        </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">MA    </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">230</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2017-01-31</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">KEY LARGO       </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">FL    </span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5000</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2017-01-04</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">LOOKOUT MOUNTAIN</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">GA    </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">230</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2017-01-31</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">NORTH YARMOUTH  </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">384</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2017-01-31</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">ALPHARETTA      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">GA    </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">384</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2017-01-31</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">FALMOUTH        </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">384</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2017-01-31</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">FALMOUTH        </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">384</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2017-01-31</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">HOLLIS CENTER   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">384</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2017-01-31</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">FALMOUTH        </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">384</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2017-01-31</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">ALEXANDRIA      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">VA    </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">384</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2017-01-31</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>      │               <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>             │\n└──────────────────┴────────┴─────────────────┴─────────────────────────────────────────────────┴────────────┴───────────────┘\n</pre>\n```\n:::\n:::\n\n\nThat worked well! There are 0 nulls in the resulting column, so we always were\nable to determine the election type.\n\n::: {#be8ee6cd .cell execution_count=15}\n``` {.python .cell-code}\ncleaned.election_type.topk(10)\n```\n\n::: {.cell-output .cell-output-display execution_count=15}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> election_type </span>┃<span style=\"font-weight: bold\"> Count(election_type) </span>┃\n┡━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>        │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>                │\n├───────────────┼──────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │              <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4031271</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">special      </span> │                <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">95892</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">general      </span> │                <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">62282</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">runoff       </span> │                <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">51163</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">convention   </span> │                <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">14868</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">recount      </span> │                   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">11</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">other        </span> │                    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">7</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>          │                    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │\n└───────────────┴──────────────────────┘\n</pre>\n```\n:::\n:::\n\n\nAbout 1/20 of transactions are negative. These could represent refunds, or they could be data\nentry errors. Let's simply drop them to keep it simple.\n\n::: {#fe0c9134 .cell execution_count=16}\n``` {.python .cell-code}\nabove_zero = cleaned.TRANSACTION_AMT > 0\ncleaned = cleaned[above_zero]\nabove_zero.value_counts()\n```\n\n::: {.cell-output .cell-output-display execution_count=16}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> Greater(TRANSACTION_AMT, 0) </span>┃<span style=\"font-weight: bold\"> Greater(TRANSACTION_AMT, 0)_count </span>┃\n┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">boolean</span>                     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>                             │\n├─────────────────────────────┼───────────────────────────────────┤\n│ True                        │                           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4186027</span> │\n│ False                       │                             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">69666</span> │\n└─────────────────────────────┴───────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n## Adding Features\n\nNow that the data is cleaned up to a usable format, let's add some features.\n\nFirst, it's useful to categorize donations by size, placing them into buckets\nof small, medium, large, etc.\n\n::: {#63ebfc0b .cell execution_count=17}\n``` {.python .cell-code}\nedges = [\n    10,\n    50,\n    100,\n    500,\n    1000,\n    5000,\n]\nlabels = [\n    \"<10\",\n    \"10-50\",\n    \"50-100\",\n    \"100-500\",\n    \"500-1000\",\n    \"1000-5000\",\n    \"5000+\",\n]\n\n\ndef bucketize(vals, edges, str_labels):\n    # Uses Ibis's .bucket() method to create a categorical column\n    int_labels = vals.bucket(edges, include_under=True, include_over=True)\n    # Map the integer labels to the string labels\n    int_to_str = {str(i): s for i, s in enumerate(str_labels)}\n    return int_labels.cast(str).substitute(int_to_str)\n\n\nfeatured = cleaned.mutate(amount_bucket=bucketize(_.TRANSACTION_AMT, edges, labels))\nfeatured\n```\n\n::: {.cell-output .cell-output-display execution_count=17}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> CITY             </span>┃<span style=\"font-weight: bold\"> STATE  </span>┃<span style=\"font-weight: bold\"> TRANSACTION_AMT </span>┃<span style=\"font-weight: bold\"> CMTE_NM                                         </span>┃<span style=\"font-weight: bold\"> date       </span>┃<span style=\"font-weight: bold\"> election_type </span>┃<span style=\"font-weight: bold\"> amount_bucket </span>┃\n┡━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                                          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">date</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>        │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>        │\n├──────────────────┼────────┼─────────────────┼─────────────────────────────────────────────────┼────────────┼───────────────┼───────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">COHASSET        </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">MA    </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">230</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2017-01-31</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">100-500      </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">KEY LARGO       </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">FL    </span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5000</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2017-01-04</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">1000-5000    </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">LOOKOUT MOUNTAIN</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">GA    </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">230</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2017-01-31</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">100-500      </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">NORTH YARMOUTH  </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">384</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2017-01-31</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">100-500      </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">ALPHARETTA      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">GA    </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">384</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2017-01-31</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">100-500      </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">FALMOUTH        </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">384</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2017-01-31</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">100-500      </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">FALMOUTH        </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">384</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2017-01-31</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">100-500      </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">HOLLIS CENTER   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">384</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2017-01-31</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">100-500      </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">FALMOUTH        </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ME    </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">384</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2017-01-31</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">100-500      </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">ALEXANDRIA      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">VA    </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">384</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2017-01-31</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">100-500      </span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>      │               <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>             │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>             │\n└──────────────────┴────────┴─────────────────┴─────────────────────────────────────────────────┴────────────┴───────────────┴───────────────┘\n</pre>\n```\n:::\n:::\n\n\n## Analysis\n\n### By donation size\n\nOne thing we can look at is the donation breakdown by size:\n- Are most donations small or large?\n- Where do politicians/committees get most of their money from? Large or small donations?\n\nWe also will compare performance of Ibis vs pandas during this groupby.\n\n::: {#303a6cb8 .cell execution_count=18}\n``` {.python .cell-code}\ndef summary_by(table, by):\n    return table.group_by(by).agg(\n        n_donations=_.count(),\n        total_amount=_.TRANSACTION_AMT.sum(),\n        mean_amount=_.TRANSACTION_AMT.mean(),\n        median_amount=_.TRANSACTION_AMT.approx_median(),\n    )\n\n\ndef summary_by_pandas(df, by):\n    return df.groupby(by, as_index=False).agg(\n        n_donations=(\"election_type\", \"count\"),\n        total_amount=(\"TRANSACTION_AMT\", \"sum\"),\n        mean_amount=(\"TRANSACTION_AMT\", \"mean\"),\n        median_amount=(\"TRANSACTION_AMT\", \"median\"),\n    )\n\n\n# persist the input data so the following timings of the group_by are accurate.\nsubset = featured[\"election_type\", \"amount_bucket\", \"TRANSACTION_AMT\"]\nsubset = subset.cache()\npandas_subset = subset.execute()\n```\n:::\n\n\nLet's take a look at what we are actually computing:\n\n::: {#636a90d1 .cell execution_count=19}\n``` {.python .cell-code}\nby_type_and_bucket = summary_by(subset, [\"election_type\", \"amount_bucket\"])\nby_type_and_bucket\n```\n\n::: {.cell-output .cell-output-display execution_count=19}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> election_type </span>┃<span style=\"font-weight: bold\"> amount_bucket </span>┃<span style=\"font-weight: bold\"> n_donations </span>┃<span style=\"font-weight: bold\"> total_amount </span>┃<span style=\"font-weight: bold\"> mean_amount  </span>┃<span style=\"font-weight: bold\"> median_amount </span>┃\n┡━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>        │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>        │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>        │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>         │\n├───────────────┼───────────────┼─────────────┼──────────────┼──────────────┼───────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">50-100       </span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">665697</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">40323598</span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">60.573501</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">50</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">100-500      </span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">857720</span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">156039582</span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">181.923684</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">159</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">10-50        </span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1754970</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">42727814</span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">24.346749</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">25</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">&lt;10          </span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">357322</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1601941</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4.483186</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">500-1000     </span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">149771</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">79968824</span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">533.940643</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">500</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">1000-5000    </span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">169099</span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">309568543</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1830.694108</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1146</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">5000+        </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">9471</span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">216070696</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">22813.926301</span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">10000</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">general      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">100-500      </span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">14664</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2672763</span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">182.266980</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">166</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">general      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">50-100       </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">7692</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">400638</span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">52.085023</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">50</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">general      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">10-50        </span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">16450</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">318340</span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">19.351976</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">25</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>             │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>             │           <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │            <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │            <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │             <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │\n└───────────────┴───────────────┴─────────────┴──────────────┴──────────────┴───────────────┘\n</pre>\n```\n:::\n:::\n\n\nOK, now let's do our timings.\n\nOne interesting thing to pay attention to here is the execution time for the following\ngroupby. Before, we could get away with lazy execution: because we only wanted to preview\nthe first few rows, we only had to compute the first few rows, so all our previews were\nvery fast.\n\nBut now, as soon as we do a groupby, we have to actually go through the whole dataset\nin order to compute the aggregate per group. So this is going to be slower. BUT,\nduckdb is still quite fast. It only takes milliseconds to groupby-agg all 20 million rows!\n\n::: {#6666411e .cell execution_count=20}\n``` {.python .cell-code}\n%timeit summary_by(subset, [\"election_type\", \"amount_bucket\"]).execute()  # .execute() so we actually fetch the data\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n54.6 ms ± 750 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)\n```\n:::\n:::\n\n\nNow let's try the same thing in pandas:\n\n::: {#6d9a6351 .cell execution_count=21}\n``` {.python .cell-code}\n%timeit summary_by_pandas(pandas_subset, [\"election_type\", \"amount_bucket\"])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n727 ms ± 5.36 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)\n```\n:::\n:::\n\n\nIt takes about 4 seconds, which is about 10 times slower than duckdb.\nAt this scale, it again doesn't matter,\nbut you could imagine with a dataset much larger than this, it would matter.\n\nLet's also think about memory usage:\n\n::: {#9e5ae401 .cell execution_count=22}\n``` {.python .cell-code}\npandas_subset.memory_usage(deep=True).sum() / 1e9  # GB\n```\n\n::: {.cell-output .cell-output-display execution_count=22}\n```\n0.56390549\n```\n:::\n:::\n\n\nThe source dataframe is couple gigabytes, so probably during the groupby,\nthe peak memory usage is going to be a bit higher than this. You could use a profiler\nsuch as [FIL](https://github.com/pythonspeed/filprofiler) if you wanted an exact number,\nI was too lazy to use that here.\n\nAgain, this works on my laptop at this dataset size, but much larger than this and I'd\nstart having problems. Duckdb on the other hand is designed around working out of core\nso it should scale to datasets into the hundreds of gigabytes, much larger than your\ncomputer's RAM.\n\n### Back to analysis\n\nOK, let's plot the result of that groupby.\n\nSurprise! (Or maybe not...) Most donations are small. But most of the money comes\nfrom donations larger than $1000.\n\nWell if that's the case, why do politicians spend so much time soliciting small\ndonations? One explanation is that they can use the number of donations\nas a marketing pitch, to show how popular they are, and thus how viable of a\ncandidate they are.\n\nThis also might explain whose interests are being served by our politicians.\n\n::: {#635eec4a .cell execution_count=23}\n``` {.python .cell-code}\nimport altair as alt\n\n# Do some bookkeeping so the buckets are displayed smallest to largest on the charts\nbucket_col = alt.Column(\"amount_bucket:N\", sort=labels)\n\nn_by_bucket = (\n    alt.Chart(by_type_and_bucket.execute())\n    .mark_bar()\n    .encode(\n        x=bucket_col,\n        y=\"n_donations:Q\",\n        color=\"election_type:N\",\n    )\n)\ntotal_by_bucket = (\n    alt.Chart(by_type_and_bucket.execute())\n    .mark_bar()\n    .encode(\n        x=bucket_col,\n        y=\"total_amount:Q\",\n        color=\"election_type:N\",\n    )\n)\nn_by_bucket | total_by_bucket\n```\n\n::: {.cell-output .cell-output-display execution_count=23}\n```{=html}\n\n<style>\n  #altair-viz-d4bb2ba9b53b4deaa273baa18d33b457.vega-embed {\n    width: 100%;\n    display: flex;\n  }\n\n  #altair-viz-d4bb2ba9b53b4deaa273baa18d33b457.vega-embed details,\n  #altair-viz-d4bb2ba9b53b4deaa273baa18d33b457.vega-embed details summary {\n    position: relative;\n  }\n</style>\n<div id=\"altair-viz-d4bb2ba9b53b4deaa273baa18d33b457\"></div>\n<script type=\"text/javascript\">\n  var VEGA_DEBUG = (typeof VEGA_DEBUG == \"undefined\") ? {} : VEGA_DEBUG;\n  (function(spec, embedOpt){\n    let outputDiv = document.currentScript.previousElementSibling;\n    if (outputDiv.id !== \"altair-viz-d4bb2ba9b53b4deaa273baa18d33b457\") {\n      outputDiv = document.getElementById(\"altair-viz-d4bb2ba9b53b4deaa273baa18d33b457\");\n    }\n    const paths = {\n      \"vega\": \"https://cdn.jsdelivr.net/npm/vega@5?noext\",\n      \"vega-lib\": \"https://cdn.jsdelivr.net/npm/vega-lib?noext\",\n      \"vega-lite\": \"https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext\",\n      \"vega-embed\": \"https://cdn.jsdelivr.net/npm/vega-embed@6?noext\",\n    };\n\n    function maybeLoadScript(lib, version) {\n      var key = `${lib.replace(\"-\", \"\")}_version`;\n      return (VEGA_DEBUG[key] == version) ?\n        Promise.resolve(paths[lib]) :\n        new Promise(function(resolve, reject) {\n          var s = document.createElement('script');\n          document.getElementsByTagName(\"head\")[0].appendChild(s);\n          s.async = true;\n          s.onload = () => {\n            VEGA_DEBUG[key] = version;\n            return resolve(paths[lib]);\n          };\n          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);\n          s.src = paths[lib];\n        });\n    }\n\n    function showError(err) {\n      outputDiv.innerHTML = `<div class=\"error\" style=\"color:red;\">${err}</div>`;\n      throw err;\n    }\n\n    function displayChart(vegaEmbed) {\n      vegaEmbed(outputDiv, spec, embedOpt)\n        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));\n    }\n\n    if(typeof define === \"function\" && define.amd) {\n      requirejs.config({paths});\n      require([\"vega-embed\"], displayChart, err => showError(`Error loading script: ${err.message}`));\n    } else {\n      maybeLoadScript(\"vega\", \"5\")\n        .then(() => maybeLoadScript(\"vega-lite\", \"5.8.0\"))\n        .then(() => maybeLoadScript(\"vega-embed\", \"6\"))\n        .catch(showError)\n        .then(() => displayChart(vegaEmbed));\n    }\n  })({\"config\": {\"view\": {\"continuousWidth\": 300, \"continuousHeight\": 300}}, \"hconcat\": [{\"data\": {\"name\": \"data-b79d898e4e55fe7a63e757093318b8d9\"}, \"mark\": {\"type\": \"bar\"}, \"encoding\": {\"color\": {\"field\": \"election_type\", \"type\": \"nominal\"}, \"x\": {\"field\": \"amount_bucket\", \"sort\": [\"<10\", \"10-50\", \"50-100\", \"100-500\", \"500-1000\", \"1000-5000\", \"5000+\"], \"type\": \"nominal\"}, \"y\": {\"field\": \"n_donations\", \"type\": \"quantitative\"}}}, {\"data\": {\"name\": \"data-1f791e8ff281f2b35ab1b746db76651c\"}, \"mark\": {\"type\": \"bar\"}, \"encoding\": {\"color\": {\"field\": \"election_type\", \"type\": \"nominal\"}, \"x\": {\"field\": \"amount_bucket\", \"sort\": [\"<10\", \"10-50\", \"50-100\", \"100-500\", \"500-1000\", \"1000-5000\", \"5000+\"], \"type\": \"nominal\"}, \"y\": {\"field\": \"total_amount\", \"type\": \"quantitative\"}}}], \"$schema\": \"https://vega.github.io/schema/vega-lite/v5.8.0.json\", \"datasets\": {\"data-b79d898e4e55fe7a63e757093318b8d9\": [{\"election_type\": \"primary\", \"amount_bucket\": \"10-50\", \"n_donations\": 1754970, \"total_amount\": 42727814, \"mean_amount\": 24.34674894727545, \"median_amount\": 25}, {\"election_type\": \"primary\", \"amount_bucket\": \"<10\", \"n_donations\": 357322, \"total_amount\": 1601941, \"mean_amount\": 4.483186033885403, \"median_amount\": 5}, {\"election_type\": \"primary\", \"amount_bucket\": \"100-500\", \"n_donations\": 857720, \"total_amount\": 156039582, \"mean_amount\": 181.92368371962877, \"median_amount\": 158}, {\"election_type\": \"primary\", \"amount_bucket\": \"50-100\", \"n_donations\": 665697, \"total_amount\": 40323598, \"mean_amount\": 60.57350115743349, \"median_amount\": 50}, {\"election_type\": \"primary\", \"amount_bucket\": \"1000-5000\", \"n_donations\": 169099, \"total_amount\": 309568543, \"mean_amount\": 1830.694108185146, \"median_amount\": 1152}, {\"election_type\": \"primary\", \"amount_bucket\": \"500-1000\", \"n_donations\": 149771, \"total_amount\": 79968824, \"mean_amount\": 533.9406427145442, \"median_amount\": 500}, {\"election_type\": \"primary\", \"amount_bucket\": \"5000+\", \"n_donations\": 9471, \"total_amount\": 216070696, \"mean_amount\": 22813.926301340936, \"median_amount\": 10000}, {\"election_type\": \"runoff\", \"amount_bucket\": \"100-500\", \"n_donations\": 11240, \"total_amount\": 1777430, \"mean_amount\": 158.13434163701066, \"median_amount\": 100}, {\"election_type\": \"general\", \"amount_bucket\": \"500-1000\", \"n_donations\": 3221, \"total_amount\": 1850035, \"mean_amount\": 574.3666563179137, \"median_amount\": 500}, {\"election_type\": \"general\", \"amount_bucket\": \"50-100\", \"n_donations\": 7692, \"total_amount\": 400638, \"mean_amount\": 52.08502340093604, \"median_amount\": 50}, {\"election_type\": \"general\", \"amount_bucket\": \"100-500\", \"n_donations\": 14664, \"total_amount\": 2672763, \"mean_amount\": 182.26698036006547, \"median_amount\": 168}, {\"election_type\": \"general\", \"amount_bucket\": \"1000-5000\", \"n_donations\": 16953, \"total_amount\": 40403514, \"mean_amount\": 2383.2663245443287, \"median_amount\": 2700}, {\"election_type\": \"special\", \"amount_bucket\": \"100-500\", \"n_donations\": 17491, \"total_amount\": 2812182, \"mean_amount\": 160.7788005259848, \"median_amount\": 100}, {\"election_type\": \"special\", \"amount_bucket\": \"1000-5000\", \"n_donations\": 3720, \"total_amount\": 6302153, \"mean_amount\": 1694.1271505376344, \"median_amount\": 1000}, {\"election_type\": \"special\", \"amount_bucket\": \"10-50\", \"n_donations\": 37264, \"total_amount\": 821563, \"mean_amount\": 22.047096393301846, \"median_amount\": 25}, {\"election_type\": \"convention\", \"amount_bucket\": \"1000-5000\", \"n_donations\": 1624, \"total_amount\": 2789670, \"mean_amount\": 1717.777093596059, \"median_amount\": 1248}, {\"election_type\": \"convention\", \"amount_bucket\": \"500-1000\", \"n_donations\": 1147, \"total_amount\": 596870, \"mean_amount\": 520.3748910200524, \"median_amount\": 500}, {\"election_type\": \"convention\", \"amount_bucket\": \"100-500\", \"n_donations\": 4338, \"total_amount\": 721415, \"mean_amount\": 166.3012909174735, \"median_amount\": 100}, {\"election_type\": \"general\", \"amount_bucket\": \"5000+\", \"n_donations\": 194, \"total_amount\": 3258720, \"mean_amount\": 16797.525773195877, \"median_amount\": 10000}, {\"election_type\": \"recount\", \"amount_bucket\": \"5000+\", \"n_donations\": 11, \"total_amount\": 1022100, \"mean_amount\": 92918.18181818182, \"median_amount\": 101700}, {\"election_type\": \"special\", \"amount_bucket\": \"5000+\", \"n_donations\": 56, \"total_amount\": 325112, \"mean_amount\": 5805.571428571428, \"median_amount\": 5400}, {\"election_type\": \"special\", \"amount_bucket\": \"50-100\", \"n_donations\": 15716, \"total_amount\": 795161, \"mean_amount\": 50.595635021634, \"median_amount\": 50}, {\"election_type\": \"special\", \"amount_bucket\": \"500-1000\", \"n_donations\": 3611, \"total_amount\": 1850802, \"mean_amount\": 512.5455552478538, \"median_amount\": 500}, {\"election_type\": \"general\", \"amount_bucket\": \"<10\", \"n_donations\": 833, \"total_amount\": 3955, \"mean_amount\": 4.7478991596638656, \"median_amount\": 5}, {\"election_type\": \"general\", \"amount_bucket\": \"10-50\", \"n_donations\": 16450, \"total_amount\": 318340, \"mean_amount\": 19.35197568389058, \"median_amount\": 25}, {\"election_type\": \"special\", \"amount_bucket\": \"<10\", \"n_donations\": 17993, \"total_amount\": 89546, \"mean_amount\": 4.976713166231312, \"median_amount\": 5}, {\"election_type\": \"runoff\", \"amount_bucket\": \"1000-5000\", \"n_donations\": 2182, \"total_amount\": 3906157, \"mean_amount\": 1790.172777268561, \"median_amount\": 1476}, {\"election_type\": \"runoff\", \"amount_bucket\": \"10-50\", \"n_donations\": 16946, \"total_amount\": 388764, \"mean_amount\": 22.941343089814705, \"median_amount\": 25}, {\"election_type\": \"runoff\", \"amount_bucket\": \"50-100\", \"n_donations\": 9348, \"total_amount\": 471446, \"mean_amount\": 50.432819854514335, \"median_amount\": 50}, {\"election_type\": \"runoff\", \"amount_bucket\": \"<10\", \"n_donations\": 9486, \"total_amount\": 46207, \"mean_amount\": 4.871073160446975, \"median_amount\": 5}, {\"election_type\": \"runoff\", \"amount_bucket\": \"500-1000\", \"n_donations\": 1905, \"total_amount\": 978651, \"mean_amount\": 513.7275590551181, \"median_amount\": 500}, {\"election_type\": null, \"amount_bucket\": \"1000-5000\", \"n_donations\": 11, \"total_amount\": 18950, \"mean_amount\": 1722.7272727272727, \"median_amount\": 1350}, {\"election_type\": \"convention\", \"amount_bucket\": \"10-50\", \"n_donations\": 4826, \"total_amount\": 96298, \"mean_amount\": 19.953999171156237, \"median_amount\": 25}, {\"election_type\": \"convention\", \"amount_bucket\": \"50-100\", \"n_donations\": 2173, \"total_amount\": 111479, \"mean_amount\": 51.301886792452834, \"median_amount\": 50}, {\"election_type\": \"convention\", \"amount_bucket\": \"<10\", \"n_donations\": 657, \"total_amount\": 3286, \"mean_amount\": 5.001522070015221, \"median_amount\": 5}, {\"election_type\": \"convention\", \"amount_bucket\": \"5000+\", \"n_donations\": 15, \"total_amount\": 86400, \"mean_amount\": 5760.0, \"median_amount\": 5400}, {\"election_type\": \"runoff\", \"amount_bucket\": \"5000+\", \"n_donations\": 19, \"total_amount\": 114200, \"mean_amount\": 6010.526315789473, \"median_amount\": 5400}, {\"election_type\": null, \"amount_bucket\": \"5000+\", \"n_donations\": 6, \"total_amount\": 123498, \"mean_amount\": 20583.0, \"median_amount\": 20000}, {\"election_type\": null, \"amount_bucket\": \"100-500\", \"n_donations\": 26, \"total_amount\": 4934, \"mean_amount\": 189.76923076923077, \"median_amount\": 200}, {\"election_type\": null, \"amount_bucket\": \"500-1000\", \"n_donations\": 9, \"total_amount\": 5212, \"mean_amount\": 579.1111111111111, \"median_amount\": 600}, {\"election_type\": null, \"amount_bucket\": \"10-50\", \"n_donations\": 103, \"total_amount\": 2210, \"mean_amount\": 21.45631067961165, \"median_amount\": 25}, {\"election_type\": null, \"amount_bucket\": \"50-100\", \"n_donations\": 24, \"total_amount\": 1255, \"mean_amount\": 52.291666666666664, \"median_amount\": 50}, {\"election_type\": null, \"amount_bucket\": \"<10\", \"n_donations\": 16, \"total_amount\": 73, \"mean_amount\": 4.5625, \"median_amount\": 5}, {\"election_type\": \"other\", \"amount_bucket\": \"<10\", \"n_donations\": 2, \"total_amount\": 7, \"mean_amount\": 3.5, \"median_amount\": 4}, {\"election_type\": \"other\", \"amount_bucket\": \"5000+\", \"n_donations\": 1, \"total_amount\": 10000, \"mean_amount\": 10000.0, \"median_amount\": 10000}, {\"election_type\": \"other\", \"amount_bucket\": \"100-500\", \"n_donations\": 3, \"total_amount\": 500, \"mean_amount\": 166.66666666666666, \"median_amount\": 200}, {\"election_type\": \"other\", \"amount_bucket\": \"10-50\", \"n_donations\": 1, \"total_amount\": 27, \"mean_amount\": 27.0, \"median_amount\": 27}], \"data-1f791e8ff281f2b35ab1b746db76651c\": [{\"election_type\": \"primary\", \"amount_bucket\": \"50-100\", \"n_donations\": 665697, \"total_amount\": 40323598, \"mean_amount\": 60.57350115743349, \"median_amount\": 50}, {\"election_type\": \"primary\", \"amount_bucket\": \"100-500\", \"n_donations\": 857720, \"total_amount\": 156039582, \"mean_amount\": 181.92368371962877, \"median_amount\": 158}, {\"election_type\": \"primary\", \"amount_bucket\": \"10-50\", \"n_donations\": 1754970, \"total_amount\": 42727814, \"mean_amount\": 24.34674894727545, \"median_amount\": 25}, {\"election_type\": \"special\", \"amount_bucket\": \"500-1000\", \"n_donations\": 3611, \"total_amount\": 1850802, \"mean_amount\": 512.5455552478538, \"median_amount\": 500}, {\"election_type\": \"special\", \"amount_bucket\": \"100-500\", \"n_donations\": 17491, \"total_amount\": 2812182, \"mean_amount\": 160.7788005259848, \"median_amount\": 100}, {\"election_type\": \"special\", \"amount_bucket\": \"50-100\", \"n_donations\": 15716, \"total_amount\": 795161, \"mean_amount\": 50.595635021634, \"median_amount\": 50}, {\"election_type\": \"primary\", \"amount_bucket\": \"1000-5000\", \"n_donations\": 169099, \"total_amount\": 309568543, \"mean_amount\": 1830.694108185146, \"median_amount\": 1148}, {\"election_type\": \"primary\", \"amount_bucket\": \"<10\", \"n_donations\": 357322, \"total_amount\": 1601941, \"mean_amount\": 4.483186033885403, \"median_amount\": 5}, {\"election_type\": \"primary\", \"amount_bucket\": \"500-1000\", \"n_donations\": 149771, \"total_amount\": 79968824, \"mean_amount\": 533.9406427145442, \"median_amount\": 500}, {\"election_type\": \"primary\", \"amount_bucket\": \"5000+\", \"n_donations\": 9471, \"total_amount\": 216070696, \"mean_amount\": 22813.926301340936, \"median_amount\": 10000}, {\"election_type\": \"special\", \"amount_bucket\": \"<10\", \"n_donations\": 17993, \"total_amount\": 89546, \"mean_amount\": 4.976713166231312, \"median_amount\": 5}, {\"election_type\": \"special\", \"amount_bucket\": \"10-50\", \"n_donations\": 37264, \"total_amount\": 821563, \"mean_amount\": 22.047096393301846, \"median_amount\": 25}, {\"election_type\": \"special\", \"amount_bucket\": \"1000-5000\", \"n_donations\": 3720, \"total_amount\": 6302153, \"mean_amount\": 1694.1271505376344, \"median_amount\": 1000}, {\"election_type\": \"general\", \"amount_bucket\": \"100-500\", \"n_donations\": 14664, \"total_amount\": 2672763, \"mean_amount\": 182.26698036006547, \"median_amount\": 167}, {\"election_type\": \"general\", \"amount_bucket\": \"1000-5000\", \"n_donations\": 16953, \"total_amount\": 40403514, \"mean_amount\": 2383.2663245443287, \"median_amount\": 2700}, {\"election_type\": \"general\", \"amount_bucket\": \"500-1000\", \"n_donations\": 3221, \"total_amount\": 1850035, \"mean_amount\": 574.3666563179137, \"median_amount\": 500}, {\"election_type\": \"general\", \"amount_bucket\": \"5000+\", \"n_donations\": 194, \"total_amount\": 3258720, \"mean_amount\": 16797.525773195877, \"median_amount\": 10000}, {\"election_type\": \"runoff\", \"amount_bucket\": \"1000-5000\", \"n_donations\": 2182, \"total_amount\": 3906157, \"mean_amount\": 1790.172777268561, \"median_amount\": 1501}, {\"election_type\": \"general\", \"amount_bucket\": \"50-100\", \"n_donations\": 7692, \"total_amount\": 400638, \"mean_amount\": 52.08502340093604, \"median_amount\": 50}, {\"election_type\": \"general\", \"amount_bucket\": \"10-50\", \"n_donations\": 16450, \"total_amount\": 318340, \"mean_amount\": 19.35197568389058, \"median_amount\": 25}, {\"election_type\": \"runoff\", \"amount_bucket\": \"10-50\", \"n_donations\": 16946, \"total_amount\": 388764, \"mean_amount\": 22.941343089814705, \"median_amount\": 25}, {\"election_type\": \"runoff\", \"amount_bucket\": \"100-500\", \"n_donations\": 11240, \"total_amount\": 1777430, \"mean_amount\": 158.13434163701066, \"median_amount\": 100}, {\"election_type\": \"runoff\", \"amount_bucket\": \"50-100\", \"n_donations\": 9348, \"total_amount\": 471446, \"mean_amount\": 50.432819854514335, \"median_amount\": 50}, {\"election_type\": \"runoff\", \"amount_bucket\": \"<10\", \"n_donations\": 9486, \"total_amount\": 46207, \"mean_amount\": 4.871073160446975, \"median_amount\": 5}, {\"election_type\": \"runoff\", \"amount_bucket\": \"500-1000\", \"n_donations\": 1905, \"total_amount\": 978651, \"mean_amount\": 513.7275590551181, \"median_amount\": 500}, {\"election_type\": \"general\", \"amount_bucket\": \"<10\", \"n_donations\": 833, \"total_amount\": 3955, \"mean_amount\": 4.7478991596638656, \"median_amount\": 5}, {\"election_type\": \"convention\", \"amount_bucket\": \"100-500\", \"n_donations\": 4338, \"total_amount\": 721415, \"mean_amount\": 166.3012909174735, \"median_amount\": 100}, {\"election_type\": \"convention\", \"amount_bucket\": \"1000-5000\", \"n_donations\": 1624, \"total_amount\": 2789670, \"mean_amount\": 1717.777093596059, \"median_amount\": 1248}, {\"election_type\": \"convention\", \"amount_bucket\": \"500-1000\", \"n_donations\": 1147, \"total_amount\": 596870, \"mean_amount\": 520.3748910200524, \"median_amount\": 500}, {\"election_type\": \"special\", \"amount_bucket\": \"5000+\", \"n_donations\": 56, \"total_amount\": 325112, \"mean_amount\": 5805.571428571428, \"median_amount\": 5400}, {\"election_type\": null, \"amount_bucket\": \"500-1000\", \"n_donations\": 9, \"total_amount\": 5212, \"mean_amount\": 579.1111111111111, \"median_amount\": 600}, {\"election_type\": null, \"amount_bucket\": \"100-500\", \"n_donations\": 26, \"total_amount\": 4934, \"mean_amount\": 189.76923076923077, \"median_amount\": 200}, {\"election_type\": null, \"amount_bucket\": \"1000-5000\", \"n_donations\": 11, \"total_amount\": 18950, \"mean_amount\": 1722.7272727272727, \"median_amount\": 1350}, {\"election_type\": \"convention\", \"amount_bucket\": \"10-50\", \"n_donations\": 4826, \"total_amount\": 96298, \"mean_amount\": 19.953999171156237, \"median_amount\": 25}, {\"election_type\": \"convention\", \"amount_bucket\": \"50-100\", \"n_donations\": 2173, \"total_amount\": 111479, \"mean_amount\": 51.301886792452834, \"median_amount\": 50}, {\"election_type\": \"convention\", \"amount_bucket\": \"<10\", \"n_donations\": 657, \"total_amount\": 3286, \"mean_amount\": 5.001522070015221, \"median_amount\": 5}, {\"election_type\": \"convention\", \"amount_bucket\": \"5000+\", \"n_donations\": 15, \"total_amount\": 86400, \"mean_amount\": 5760.0, \"median_amount\": 5400}, {\"election_type\": null, \"amount_bucket\": \"5000+\", \"n_donations\": 6, \"total_amount\": 123498, \"mean_amount\": 20583.0, \"median_amount\": 20000}, {\"election_type\": \"recount\", \"amount_bucket\": \"5000+\", \"n_donations\": 11, \"total_amount\": 1022100, \"mean_amount\": 92918.18181818182, \"median_amount\": 101700}, {\"election_type\": \"runoff\", \"amount_bucket\": \"5000+\", \"n_donations\": 19, \"total_amount\": 114200, \"mean_amount\": 6010.526315789473, \"median_amount\": 5400}, {\"election_type\": null, \"amount_bucket\": \"10-50\", \"n_donations\": 103, \"total_amount\": 2210, \"mean_amount\": 21.45631067961165, \"median_amount\": 25}, {\"election_type\": null, \"amount_bucket\": \"<10\", \"n_donations\": 16, \"total_amount\": 73, \"mean_amount\": 4.5625, \"median_amount\": 5}, {\"election_type\": \"other\", \"amount_bucket\": \"100-500\", \"n_donations\": 3, \"total_amount\": 500, \"mean_amount\": 166.66666666666666, \"median_amount\": 200}, {\"election_type\": \"other\", \"amount_bucket\": \"<10\", \"n_donations\": 2, \"total_amount\": 7, \"mean_amount\": 3.5, \"median_amount\": 4}, {\"election_type\": \"other\", \"amount_bucket\": \"10-50\", \"n_donations\": 1, \"total_amount\": 27, \"mean_amount\": 27.0, \"median_amount\": 27}, {\"election_type\": null, \"amount_bucket\": \"50-100\", \"n_donations\": 24, \"total_amount\": 1255, \"mean_amount\": 52.291666666666664, \"median_amount\": 50}, {\"election_type\": \"other\", \"amount_bucket\": \"5000+\", \"n_donations\": 1, \"total_amount\": 10000, \"mean_amount\": 10000.0, \"median_amount\": 10000}]}}, {\"mode\": \"vega-lite\"});\n</script>\n```\n:::\n:::\n\n\n### By election stage\n\nLet's look at how donations break down by election stage. Do people donate\ndifferently for primary elections vs general elections?\n\nLet's ignore everything but primary and general elections, since they are the\nmost common, and arguably the most important.\n\n::: {#11a5e1b0 .cell execution_count=24}\n``` {.python .cell-code}\ngb2 = by_type_and_bucket[_.election_type.isin((\"primary\", \"general\"))]\nn_donations_per_election_type = _.n_donations.sum().over(group_by=\"election_type\")\nfrac = _.n_donations / n_donations_per_election_type\ngb2 = gb2.mutate(frac_n_donations_per_election_type=frac)\ngb2\n```\n\n::: {.cell-output .cell-output-display execution_count=24}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> election_type </span>┃<span style=\"font-weight: bold\"> amount_bucket </span>┃<span style=\"font-weight: bold\"> n_donations </span>┃<span style=\"font-weight: bold\"> total_amount </span>┃<span style=\"font-weight: bold\"> mean_amount  </span>┃<span style=\"font-weight: bold\"> median_amount </span>┃<span style=\"font-weight: bold\"> frac_n_donations_per_election_type </span>┃\n┡━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>        │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>        │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>        │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>                            │\n├───────────────┼───────────────┼─────────────┼──────────────┼──────────────┼───────────────┼────────────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">10-50        </span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1754970</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">42727814</span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">24.346749</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">25</span> │                           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.442721</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">&lt;10          </span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">357322</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1601941</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4.483186</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span> │                           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.090141</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">50-100       </span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">665697</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">40323598</span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">60.573501</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">50</span> │                           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.167934</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">100-500      </span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">857720</span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">156039582</span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">181.923684</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">158</span> │                           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.216375</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">500-1000     </span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">149771</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">79968824</span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">533.940643</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">500</span> │                           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.037782</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">1000-5000    </span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">169099</span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">309568543</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1830.694108</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1150</span> │                           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.042658</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">primary      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">5000+        </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">9471</span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">216070696</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">22813.926301</span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">10000</span> │                           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.002389</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">general      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">1000-5000    </span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">16953</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">40403514</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2383.266325</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2700</span> │                           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.282517</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">general      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">500-1000     </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3221</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1850035</span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">574.366656</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">500</span> │                           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.053677</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">general      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">100-500      </span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">14664</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2672763</span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">182.266980</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">165</span> │                           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.244371</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>             │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>             │           <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │            <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │            <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │             <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │                                  <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │\n└───────────────┴───────────────┴─────────────┴──────────────┴──────────────┴───────────────┴────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\nIt looks like primary elections get a larger proportion of small donations.\n\n::: {#8b4aa3db .cell execution_count=25}\n``` {.python .cell-code}\nalt.Chart(gb2.execute()).mark_bar().encode(\n    x=\"election_type:O\",\n    y=\"frac_n_donations_per_election_type:Q\",\n    color=bucket_col,\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=25}\n```{=html}\n\n<style>\n  #altair-viz-c93a97c3388a4b6f9d1218f1a4fbbd51.vega-embed {\n    width: 100%;\n    display: flex;\n  }\n\n  #altair-viz-c93a97c3388a4b6f9d1218f1a4fbbd51.vega-embed details,\n  #altair-viz-c93a97c3388a4b6f9d1218f1a4fbbd51.vega-embed details summary {\n    position: relative;\n  }\n</style>\n<div id=\"altair-viz-c93a97c3388a4b6f9d1218f1a4fbbd51\"></div>\n<script type=\"text/javascript\">\n  var VEGA_DEBUG = (typeof VEGA_DEBUG == \"undefined\") ? {} : VEGA_DEBUG;\n  (function(spec, embedOpt){\n    let outputDiv = document.currentScript.previousElementSibling;\n    if (outputDiv.id !== \"altair-viz-c93a97c3388a4b6f9d1218f1a4fbbd51\") {\n      outputDiv = document.getElementById(\"altair-viz-c93a97c3388a4b6f9d1218f1a4fbbd51\");\n    }\n    const paths = {\n      \"vega\": \"https://cdn.jsdelivr.net/npm/vega@5?noext\",\n      \"vega-lib\": \"https://cdn.jsdelivr.net/npm/vega-lib?noext\",\n      \"vega-lite\": \"https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext\",\n      \"vega-embed\": \"https://cdn.jsdelivr.net/npm/vega-embed@6?noext\",\n    };\n\n    function maybeLoadScript(lib, version) {\n      var key = `${lib.replace(\"-\", \"\")}_version`;\n      return (VEGA_DEBUG[key] == version) ?\n        Promise.resolve(paths[lib]) :\n        new Promise(function(resolve, reject) {\n          var s = document.createElement('script');\n          document.getElementsByTagName(\"head\")[0].appendChild(s);\n          s.async = true;\n          s.onload = () => {\n            VEGA_DEBUG[key] = version;\n            return resolve(paths[lib]);\n          };\n          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);\n          s.src = paths[lib];\n        });\n    }\n\n    function showError(err) {\n      outputDiv.innerHTML = `<div class=\"error\" style=\"color:red;\">${err}</div>`;\n      throw err;\n    }\n\n    function displayChart(vegaEmbed) {\n      vegaEmbed(outputDiv, spec, embedOpt)\n        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));\n    }\n\n    if(typeof define === \"function\" && define.amd) {\n      requirejs.config({paths});\n      require([\"vega-embed\"], displayChart, err => showError(`Error loading script: ${err.message}`));\n    } else {\n      maybeLoadScript(\"vega\", \"5\")\n        .then(() => maybeLoadScript(\"vega-lite\", \"5.8.0\"))\n        .then(() => maybeLoadScript(\"vega-embed\", \"6\"))\n        .catch(showError)\n        .then(() => displayChart(vegaEmbed));\n    }\n  })({\"config\": {\"view\": {\"continuousWidth\": 300, \"continuousHeight\": 300}}, \"data\": {\"name\": \"data-7290dbeb8e9272d61e7129cd52cd8f48\"}, \"mark\": {\"type\": \"bar\"}, \"encoding\": {\"color\": {\"field\": \"amount_bucket\", \"sort\": [\"<10\", \"10-50\", \"50-100\", \"100-500\", \"500-1000\", \"1000-5000\", \"5000+\"], \"type\": \"nominal\"}, \"x\": {\"field\": \"election_type\", \"type\": \"ordinal\"}, \"y\": {\"field\": \"frac_n_donations_per_election_type\", \"type\": \"quantitative\"}}, \"$schema\": \"https://vega.github.io/schema/vega-lite/v5.8.0.json\", \"datasets\": {\"data-7290dbeb8e9272d61e7129cd52cd8f48\": [{\"election_type\": \"primary\", \"amount_bucket\": \"<10\", \"n_donations\": 357322, \"total_amount\": 1601941, \"mean_amount\": 4.483186033885403, \"median_amount\": 5, \"frac_n_donations_per_election_type\": 0.09014063899294913}, {\"election_type\": \"primary\", \"amount_bucket\": \"10-50\", \"n_donations\": 1754970, \"total_amount\": 42727814, \"mean_amount\": 24.34674894727545, \"median_amount\": 25, \"frac_n_donations_per_election_type\": 0.44272145911378513}, {\"election_type\": \"primary\", \"amount_bucket\": \"100-500\", \"n_donations\": 857720, \"total_amount\": 156039582, \"mean_amount\": 181.92368371962877, \"median_amount\": 158, \"frac_n_donations_per_election_type\": 0.21637466732256153}, {\"election_type\": \"primary\", \"amount_bucket\": \"50-100\", \"n_donations\": 665697, \"total_amount\": 40323598, \"mean_amount\": 60.57350115743349, \"median_amount\": 50, \"frac_n_donations_per_election_type\": 0.16793355280584252}, {\"election_type\": \"primary\", \"amount_bucket\": \"1000-5000\", \"n_donations\": 169099, \"total_amount\": 309568543, \"mean_amount\": 1830.694108185146, \"median_amount\": 1151, \"frac_n_donations_per_election_type\": 0.04265814003355155}, {\"election_type\": \"primary\", \"amount_bucket\": \"500-1000\", \"n_donations\": 149771, \"total_amount\": 79968824, \"mean_amount\": 533.9406427145442, \"median_amount\": 500, \"frac_n_donations_per_election_type\": 0.03778231858831246}, {\"election_type\": \"primary\", \"amount_bucket\": \"5000+\", \"n_donations\": 9471, \"total_amount\": 216070696, \"mean_amount\": 22813.926301340936, \"median_amount\": 10000, \"frac_n_donations_per_election_type\": 0.0023892231429976916}, {\"election_type\": \"general\", \"amount_bucket\": \"1000-5000\", \"n_donations\": 16953, \"total_amount\": 40403514, \"mean_amount\": 2383.2663245443287, \"median_amount\": 2700, \"frac_n_donations_per_election_type\": 0.2825170396787042}, {\"election_type\": \"general\", \"amount_bucket\": \"100-500\", \"n_donations\": 14664, \"total_amount\": 2672763, \"mean_amount\": 182.26698036006547, \"median_amount\": 168, \"frac_n_donations_per_election_type\": 0.24437148999283417}, {\"election_type\": \"general\", \"amount_bucket\": \"500-1000\", \"n_donations\": 3221, \"total_amount\": 1850035, \"mean_amount\": 574.3666563179137, \"median_amount\": 500, \"frac_n_donations_per_election_type\": 0.05367707100838236}, {\"election_type\": \"general\", \"amount_bucket\": \"50-100\", \"n_donations\": 7692, \"total_amount\": 400638, \"mean_amount\": 52.08502340093604, \"median_amount\": 50, \"frac_n_donations_per_election_type\": 0.1281850450780742}, {\"election_type\": \"general\", \"amount_bucket\": \"10-50\", \"n_donations\": 16450, \"total_amount\": 318340, \"mean_amount\": 19.35197568389058, \"median_amount\": 25, \"frac_n_donations_per_election_type\": 0.2741346842868332}, {\"election_type\": \"general\", \"amount_bucket\": \"<10\", \"n_donations\": 833, \"total_amount\": 3955, \"mean_amount\": 4.7478991596638656, \"median_amount\": 5, \"frac_n_donations_per_election_type\": 0.01388171380005666}, {\"election_type\": \"general\", \"amount_bucket\": \"5000+\", \"n_donations\": 194, \"total_amount\": 3258720, \"mean_amount\": 16797.525773195877, \"median_amount\": 10000, \"frac_n_donations_per_election_type\": 0.0032329561551152366}]}}, {\"mode\": \"vega-lite\"});\n</script>\n```\n:::\n:::\n\n\n### By recipient\n\nLet's look at the top players. Who gets the most donations?\n\nFar and away it is ActBlue, which acts as a conduit for donations to Democratic\ninterests.\n\nBeto O'Rourke is the top individual politician, hats off to him!\n\n::: {#264169c7 .cell execution_count=26}\n``` {.python .cell-code}\nby_recip = summary_by(featured, \"CMTE_NM\")\nby_recip\n```\n\n::: {.cell-output .cell-output-display execution_count=26}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> CMTE_NM                                                              </span>┃<span style=\"font-weight: bold\"> n_donations </span>┃<span style=\"font-weight: bold\"> total_amount </span>┃<span style=\"font-weight: bold\"> mean_amount  </span>┃<span style=\"font-weight: bold\"> median_amount </span>┃\n┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                                                               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>        │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>         │\n├──────────────────────────────────────────────────────────────────────┼─────────────┼──────────────┼──────────────┼───────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">JON OSSOFF FOR CONGRESS                                             </span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">112166</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">8341553</span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">74.367928</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">25</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">BLACKROCK FUNDS SERVICES GROUP LLC POLITICAL ACTION COMMITTEE       </span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">805</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">134826</span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">167.485714</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">104</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">HOUSE FREEDOM FUND                                                  </span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">314</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">683689</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2177.353503</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1000</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">ACTBLUE                                                             </span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">469686</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">44526219</span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">94.799971</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">25</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">FORGING INDUSTRY ASSOCIATION POLITICAL ACTION COMMITTEE (FORGINGPAC)</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1000</span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">500.000000</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">500</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">INDEPENDENT REFORM PARTY                                            </span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">225</span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">225.000000</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">225</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">TEXAS ASSOCIATION OF HEALTH UNDERWRITERS POLITICAL ACTION COMMITTEE </span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">6</span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">7900</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1316.666667</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">350</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">TEXAS ASSOCIATION OF BENEFIT ADMINISTRATORS PAC                     </span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">600</span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">600.000000</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">600</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">GROOM LAW GROUP, CHARTERED POLITICAL ACTION COMMITTEE               </span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">20</span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">11760</span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">588.000000</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">600</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">MICHIGAN SENATE VICTORY 2018                                        </span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">35</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">356700</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">10191.428571</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5000</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                                                    │           <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │            <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │            <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │             <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │\n└──────────────────────────────────────────────────────────────────────┴─────────────┴──────────────┴──────────────┴───────────────┘\n</pre>\n```\n:::\n:::\n\n\n::: {#82b74965 .cell execution_count=27}\n``` {.python .cell-code}\ntop_recip = by_recip.order_by(ibis.desc(\"n_donations\")).head(10)\nalt.Chart(top_recip.execute()).mark_bar().encode(\n    x=alt.X(\"CMTE_NM:O\", sort=\"-y\"),\n    y=\"n_donations:Q\",\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=27}\n```{=html}\n\n<style>\n  #altair-viz-8a68bd651a5945dfb75058c9fbc352da.vega-embed {\n    width: 100%;\n    display: flex;\n  }\n\n  #altair-viz-8a68bd651a5945dfb75058c9fbc352da.vega-embed details,\n  #altair-viz-8a68bd651a5945dfb75058c9fbc352da.vega-embed details summary {\n    position: relative;\n  }\n</style>\n<div id=\"altair-viz-8a68bd651a5945dfb75058c9fbc352da\"></div>\n<script type=\"text/javascript\">\n  var VEGA_DEBUG = (typeof VEGA_DEBUG == \"undefined\") ? {} : VEGA_DEBUG;\n  (function(spec, embedOpt){\n    let outputDiv = document.currentScript.previousElementSibling;\n    if (outputDiv.id !== \"altair-viz-8a68bd651a5945dfb75058c9fbc352da\") {\n      outputDiv = document.getElementById(\"altair-viz-8a68bd651a5945dfb75058c9fbc352da\");\n    }\n    const paths = {\n      \"vega\": \"https://cdn.jsdelivr.net/npm/vega@5?noext\",\n      \"vega-lib\": \"https://cdn.jsdelivr.net/npm/vega-lib?noext\",\n      \"vega-lite\": \"https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext\",\n      \"vega-embed\": \"https://cdn.jsdelivr.net/npm/vega-embed@6?noext\",\n    };\n\n    function maybeLoadScript(lib, version) {\n      var key = `${lib.replace(\"-\", \"\")}_version`;\n      return (VEGA_DEBUG[key] == version) ?\n        Promise.resolve(paths[lib]) :\n        new Promise(function(resolve, reject) {\n          var s = document.createElement('script');\n          document.getElementsByTagName(\"head\")[0].appendChild(s);\n          s.async = true;\n          s.onload = () => {\n            VEGA_DEBUG[key] = version;\n            return resolve(paths[lib]);\n          };\n          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);\n          s.src = paths[lib];\n        });\n    }\n\n    function showError(err) {\n      outputDiv.innerHTML = `<div class=\"error\" style=\"color:red;\">${err}</div>`;\n      throw err;\n    }\n\n    function displayChart(vegaEmbed) {\n      vegaEmbed(outputDiv, spec, embedOpt)\n        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));\n    }\n\n    if(typeof define === \"function\" && define.amd) {\n      requirejs.config({paths});\n      require([\"vega-embed\"], displayChart, err => showError(`Error loading script: ${err.message}`));\n    } else {\n      maybeLoadScript(\"vega\", \"5\")\n        .then(() => maybeLoadScript(\"vega-lite\", \"5.8.0\"))\n        .then(() => maybeLoadScript(\"vega-embed\", \"6\"))\n        .catch(showError)\n        .then(() => displayChart(vegaEmbed));\n    }\n  })({\"config\": {\"view\": {\"continuousWidth\": 300, \"continuousHeight\": 300}}, \"data\": {\"name\": \"data-dea537ff505814d5d7f6e09a5528107c\"}, \"mark\": {\"type\": \"bar\"}, \"encoding\": {\"x\": {\"field\": \"CMTE_NM\", \"sort\": \"-y\", \"type\": \"ordinal\"}, \"y\": {\"field\": \"n_donations\", \"type\": \"quantitative\"}}, \"$schema\": \"https://vega.github.io/schema/vega-lite/v5.8.0.json\", \"datasets\": {\"data-dea537ff505814d5d7f6e09a5528107c\": [{\"CMTE_NM\": \"ACTBLUE\", \"n_donations\": 469686, \"total_amount\": 44526219, \"mean_amount\": 94.79997061866864, \"median_amount\": 25}, {\"CMTE_NM\": \"DCCC\", \"n_donations\": 228320, \"total_amount\": 22707360, \"mean_amount\": 99.4540995094604, \"median_amount\": 25}, {\"CMTE_NM\": \"END CITIZENS UNITED\", \"n_donations\": 153388, \"total_amount\": 4059824, \"mean_amount\": 26.467676741335698, \"median_amount\": 15}, {\"CMTE_NM\": \"JON OSSOFF FOR CONGRESS\", \"n_donations\": 112166, \"total_amount\": 8341553, \"mean_amount\": 74.36792789258777, \"median_amount\": 25}, {\"CMTE_NM\": \"DSCC\", \"n_donations\": 111618, \"total_amount\": 19905693, \"mean_amount\": 178.33766059237757, \"median_amount\": 31}, {\"CMTE_NM\": \"PROGRESSIVE TURNOUT PROJECT\", \"n_donations\": 86267, \"total_amount\": 2648667, \"mean_amount\": 30.70313097708278, \"median_amount\": 15}, {\"CMTE_NM\": \"CHC BOLD PAC\", \"n_donations\": 85990, \"total_amount\": 2162662, \"mean_amount\": 25.150156994999417, \"median_amount\": 15}, {\"CMTE_NM\": \"REPUBLICAN NATIONAL COMMITTEE\", \"n_donations\": 80912, \"total_amount\": 29200068, \"mean_amount\": 360.88674115087997, \"median_amount\": 100}, {\"CMTE_NM\": \"EMILY'S LIST\", \"n_donations\": 63288, \"total_amount\": 10162308, \"mean_amount\": 160.5724307925673, \"median_amount\": 50}, {\"CMTE_NM\": \"NJ STATE LABORERS PAC/ LABORERS' INTERNATIONAL UNION OF NORTH AMERICA (LIUNA) PAC\", \"n_donations\": 56728, \"total_amount\": 1300858, \"mean_amount\": 22.931497673106755, \"median_amount\": 22}]}}, {\"mode\": \"vega-lite\"});\n</script>\n```\n:::\n:::\n\n\n### By Location\n\nWhere are the largest donations coming from?\n\n::: {#59d2cb6f .cell execution_count=28}\n``` {.python .cell-code}\nf2 = featured.mutate(loc=_.CITY + \", \" + _.STATE).drop(\"CITY\", \"STATE\")\nby_loc = summary_by(f2, \"loc\")\n# Drop the places with a small number of donations so we're\n# resistant to outliers for the mean\nby_loc = by_loc[_.n_donations > 1000]\nby_loc\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<script type=\"application/vnd.jupyter.widget-view+json\">\n{\"model_id\":\"91e9832ebbb34a0e8bd6b90c70459f22\",\"version_major\":2,\"version_minor\":0,\"quarto_mimetype\":\"application/vnd.jupyter.widget-view+json\"}\n</script>\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=28}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> loc               </span>┃<span style=\"font-weight: bold\"> n_donations </span>┃<span style=\"font-weight: bold\"> total_amount </span>┃<span style=\"font-weight: bold\"> mean_amount </span>┃<span style=\"font-weight: bold\"> median_amount </span>┃\n┡━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>            │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>        │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>         │\n├───────────────────┼─────────────┼──────────────┼─────────────┼───────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">ST PETERSBURG, FL</span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1238</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">127070</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">102.641357</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">25</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">FORT WORTH, TX   </span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">19875</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3555584</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">178.897308</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">40</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">TROY, NY         </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1300</span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">54073</span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">41.594615</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">BETHESDA, MD     </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">9680</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3598101</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">371.704649</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">100</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">THE WOODLANDS, TX</span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3485</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">910137</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">261.158393</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">50</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">GREENWICH, CT    </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2706</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4518917</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1669.961936</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">100</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">WORCESTER, MA    </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1347</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">120176</span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">89.217520</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">MALIBU, CA       </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2248</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">850885</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">378.507562</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">50</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">PENSACOLA, FL    </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1383</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">227230</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">164.302242</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">50</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">COLLEYVILLE, TX  </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1427</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">255767</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">179.234057</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">90</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                 │           <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │            <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │           <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │             <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │\n└───────────────────┴─────────────┴──────────────┴─────────────┴───────────────┘\n</pre>\n```\n:::\n:::\n\n\n::: {#4e227de4 .cell execution_count=29}\n``` {.python .cell-code}\ndef top_by(col):\n    top = by_loc.order_by(ibis.desc(col)).head(10)\n    return (\n        alt.Chart(top.execute())\n        .mark_bar()\n        .encode(\n            x=alt.X('loc:O', sort=\"-y\"),\n            y=col,\n        )\n    )\n\n\ntop_by(\"n_donations\") | top_by(\"total_amount\") | top_by(\"mean_amount\") | top_by(\n    \"median_amount\"\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=29}\n```{=html}\n\n<style>\n  #altair-viz-25e7da4d6fae42748e31a5843248ab9e.vega-embed {\n    width: 100%;\n    display: flex;\n  }\n\n  #altair-viz-25e7da4d6fae42748e31a5843248ab9e.vega-embed details,\n  #altair-viz-25e7da4d6fae42748e31a5843248ab9e.vega-embed details summary {\n    position: relative;\n  }\n</style>\n<div id=\"altair-viz-25e7da4d6fae42748e31a5843248ab9e\"></div>\n<script type=\"text/javascript\">\n  var VEGA_DEBUG = (typeof VEGA_DEBUG == \"undefined\") ? {} : VEGA_DEBUG;\n  (function(spec, embedOpt){\n    let outputDiv = document.currentScript.previousElementSibling;\n    if (outputDiv.id !== \"altair-viz-25e7da4d6fae42748e31a5843248ab9e\") {\n      outputDiv = document.getElementById(\"altair-viz-25e7da4d6fae42748e31a5843248ab9e\");\n    }\n    const paths = {\n      \"vega\": \"https://cdn.jsdelivr.net/npm/vega@5?noext\",\n      \"vega-lib\": \"https://cdn.jsdelivr.net/npm/vega-lib?noext\",\n      \"vega-lite\": \"https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext\",\n      \"vega-embed\": \"https://cdn.jsdelivr.net/npm/vega-embed@6?noext\",\n    };\n\n    function maybeLoadScript(lib, version) {\n      var key = `${lib.replace(\"-\", \"\")}_version`;\n      return (VEGA_DEBUG[key] == version) ?\n        Promise.resolve(paths[lib]) :\n        new Promise(function(resolve, reject) {\n          var s = document.createElement('script');\n          document.getElementsByTagName(\"head\")[0].appendChild(s);\n          s.async = true;\n          s.onload = () => {\n            VEGA_DEBUG[key] = version;\n            return resolve(paths[lib]);\n          };\n          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);\n          s.src = paths[lib];\n        });\n    }\n\n    function showError(err) {\n      outputDiv.innerHTML = `<div class=\"error\" style=\"color:red;\">${err}</div>`;\n      throw err;\n    }\n\n    function displayChart(vegaEmbed) {\n      vegaEmbed(outputDiv, spec, embedOpt)\n        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));\n    }\n\n    if(typeof define === \"function\" && define.amd) {\n      requirejs.config({paths});\n      require([\"vega-embed\"], displayChart, err => showError(`Error loading script: ${err.message}`));\n    } else {\n      maybeLoadScript(\"vega\", \"5\")\n        .then(() => maybeLoadScript(\"vega-lite\", \"5.8.0\"))\n        .then(() => maybeLoadScript(\"vega-embed\", \"6\"))\n        .catch(showError)\n        .then(() => displayChart(vegaEmbed));\n    }\n  })({\"config\": {\"view\": {\"continuousWidth\": 300, \"continuousHeight\": 300}}, \"hconcat\": [{\"data\": {\"name\": \"data-6861cca4c2e445023cd6704e7bc8056a\"}, \"mark\": {\"type\": \"bar\"}, \"encoding\": {\"x\": {\"field\": \"loc\", \"sort\": \"-y\", \"type\": \"ordinal\"}, \"y\": {\"field\": \"n_donations\", \"type\": \"quantitative\"}}}, {\"data\": {\"name\": \"data-35e0072051ea232c0418d643fa8b7656\"}, \"mark\": {\"type\": \"bar\"}, \"encoding\": {\"x\": {\"field\": \"loc\", \"sort\": \"-y\", \"type\": \"ordinal\"}, \"y\": {\"field\": \"total_amount\", \"type\": \"quantitative\"}}}, {\"data\": {\"name\": \"data-c93890d59abb6da136098a131dbd0267\"}, \"mark\": {\"type\": \"bar\"}, \"encoding\": {\"x\": {\"field\": \"loc\", \"sort\": \"-y\", \"type\": \"ordinal\"}, \"y\": {\"field\": \"mean_amount\", \"type\": \"quantitative\"}}}, {\"data\": {\"name\": \"data-437e45fd842fa1df7426a7ff054d9e43\"}, \"mark\": {\"type\": \"bar\"}, \"encoding\": {\"x\": {\"field\": \"loc\", \"sort\": \"-y\", \"type\": \"ordinal\"}, \"y\": {\"field\": \"median_amount\", \"type\": \"quantitative\"}}}], \"$schema\": \"https://vega.github.io/schema/vega-lite/v5.8.0.json\", \"datasets\": {\"data-6861cca4c2e445023cd6704e7bc8056a\": [{\"loc\": \"NEW YORK, NY\", \"n_donations\": 143582, \"total_amount\": 59736745, \"mean_amount\": 416.0461965984594, \"median_amount\": 50}, {\"loc\": \"WASHINGTON, DC\", \"n_donations\": 113921, \"total_amount\": 26873514, \"mean_amount\": 235.89605077202623, \"median_amount\": 53}, {\"loc\": \"ARLINGTON, VA\", \"n_donations\": 53556, \"total_amount\": 6718010, \"mean_amount\": 125.43897975950406, \"median_amount\": 50}, {\"loc\": \"HOUSTON, TX\", \"n_donations\": 52735, \"total_amount\": 17012740, \"mean_amount\": 322.60813501469613, \"median_amount\": 50}, {\"loc\": \"CHICAGO, IL\", \"n_donations\": 43836, \"total_amount\": 13886444, \"mean_amount\": 316.7817319098458, \"median_amount\": 50}, {\"loc\": \"PHILADELPHIA, PA\", \"n_donations\": 41154, \"total_amount\": 8594879, \"mean_amount\": 208.8467463673033, \"median_amount\": 100}, {\"loc\": \"LOS ANGELES, CA\", \"n_donations\": 40765, \"total_amount\": 13971276, \"mean_amount\": 342.72724150619405, \"median_amount\": 48}, {\"loc\": \"SAN ANTONIO, TX\", \"n_donations\": 40743, \"total_amount\": 4712516, \"mean_amount\": 115.66443315416146, \"median_amount\": 35}, {\"loc\": \"SAN FRANCISCO, CA\", \"n_donations\": 39023, \"total_amount\": 24017415, \"mean_amount\": 615.4681854291059, \"median_amount\": 50}, {\"loc\": \"ATLANTA, GA\", \"n_donations\": 36154, \"total_amount\": 11293938, \"mean_amount\": 312.38418985451125, \"median_amount\": 51}], \"data-35e0072051ea232c0418d643fa8b7656\": [{\"loc\": \"NEW YORK, NY\", \"n_donations\": 143582, \"total_amount\": 59736745, \"mean_amount\": 416.0461965984594, \"median_amount\": 50}, {\"loc\": \"WASHINGTON, DC\", \"n_donations\": 113921, \"total_amount\": 26873514, \"mean_amount\": 235.89605077202623, \"median_amount\": 53}, {\"loc\": \"SAN FRANCISCO, CA\", \"n_donations\": 39023, \"total_amount\": 24017415, \"mean_amount\": 615.4681854291059, \"median_amount\": 50}, {\"loc\": \"HOUSTON, TX\", \"n_donations\": 52735, \"total_amount\": 17012740, \"mean_amount\": 322.60813501469613, \"median_amount\": 50}, {\"loc\": \"DALLAS, TX\", \"n_donations\": 30419, \"total_amount\": 14744056, \"mean_amount\": 484.69890528945723, \"median_amount\": 82}, {\"loc\": \"LOS ANGELES, CA\", \"n_donations\": 40765, \"total_amount\": 13971276, \"mean_amount\": 342.72724150619405, \"median_amount\": 48}, {\"loc\": \"CHICAGO, IL\", \"n_donations\": 43836, \"total_amount\": 13886444, \"mean_amount\": 316.7817319098458, \"median_amount\": 50}, {\"loc\": \"ATLANTA, GA\", \"n_donations\": 36154, \"total_amount\": 11293938, \"mean_amount\": 312.38418985451125, \"median_amount\": 51}, {\"loc\": \"PHILADELPHIA, PA\", \"n_donations\": 41154, \"total_amount\": 8594879, \"mean_amount\": 208.8467463673033, \"median_amount\": 100}, {\"loc\": \"ARLINGTON, VA\", \"n_donations\": 53556, \"total_amount\": 6718010, \"mean_amount\": 125.43897975950406, \"median_amount\": 50}], \"data-c93890d59abb6da136098a131dbd0267\": [{\"loc\": \"LAKE FOREST, IL\", \"n_donations\": 1488, \"total_amount\": 4866679, \"mean_amount\": 3270.617607526882, \"median_amount\": 82}, {\"loc\": \"PALM BEACH, FL\", \"n_donations\": 1155, \"total_amount\": 3382972, \"mean_amount\": 2928.9800865800867, \"median_amount\": 500}, {\"loc\": \"GREENWICH, CT\", \"n_donations\": 2706, \"total_amount\": 4518917, \"mean_amount\": 1669.9619364375462, \"median_amount\": 100}, {\"loc\": \"BEVERLY HILLS, CA\", \"n_donations\": 3921, \"total_amount\": 5563845, \"mean_amount\": 1418.9862280030604, \"median_amount\": 105}, {\"loc\": \"CARMEL, IN\", \"n_donations\": 2143, \"total_amount\": 2830133, \"mean_amount\": 1320.6406906206253, \"median_amount\": 50}, {\"loc\": \"NORTHRIDGE, CA\", \"n_donations\": 1107, \"total_amount\": 1233766, \"mean_amount\": 1114.5130984643179, \"median_amount\": 49}, {\"loc\": \"WESTON, MA\", \"n_donations\": 1232, \"total_amount\": 1311794, \"mean_amount\": 1064.767857142857, \"median_amount\": 50}, {\"loc\": \"EL PASO, TX\", \"n_donations\": 3779, \"total_amount\": 3672749, \"mean_amount\": 971.8838317015084, \"median_amount\": 100}, {\"loc\": \"PARADISE VALLEY, AZ\", \"n_donations\": 1240, \"total_amount\": 1160106, \"mean_amount\": 935.5693548387097, \"median_amount\": 250}, {\"loc\": \"MC LEAN, VA\", \"n_donations\": 1146, \"total_amount\": 1043157, \"mean_amount\": 910.2591623036649, \"median_amount\": 500}], \"data-437e45fd842fa1df7426a7ff054d9e43\": [{\"loc\": \"PALM BEACH, FL\", \"n_donations\": 1155, \"total_amount\": 3382972, \"mean_amount\": 2928.9800865800867, \"median_amount\": 500}, {\"loc\": \"MC LEAN, VA\", \"n_donations\": 1146, \"total_amount\": 1043157, \"mean_amount\": 910.2591623036649, \"median_amount\": 500}, {\"loc\": \"MOUNTAIN BRK, AL\", \"n_donations\": 1159, \"total_amount\": 893354, \"mean_amount\": 770.7972389991372, \"median_amount\": 269}, {\"loc\": \"PARADISE VALLEY, AZ\", \"n_donations\": 1240, \"total_amount\": 1160106, \"mean_amount\": 935.5693548387097, \"median_amount\": 250}, {\"loc\": \"MIAMI BEACH, FL\", \"n_donations\": 1829, \"total_amount\": 1423757, \"mean_amount\": 778.4346637506834, \"median_amount\": 232}, {\"loc\": \"NEW CANAAN, CT\", \"n_donations\": 1194, \"total_amount\": 899882, \"mean_amount\": 753.6700167504188, \"median_amount\": 192}, {\"loc\": \"WAYZATA, MN\", \"n_donations\": 1075, \"total_amount\": 590341, \"mean_amount\": 549.1544186046511, \"median_amount\": 185}, {\"loc\": \"WINNETKA, IL\", \"n_donations\": 1501, \"total_amount\": 1090185, \"mean_amount\": 726.3057961359094, \"median_amount\": 167}, {\"loc\": \"MCLEAN, VA\", \"n_donations\": 6596, \"total_amount\": 3402770, \"mean_amount\": 515.8838690115222, \"median_amount\": 164}, {\"loc\": \"POTOMAC, MD\", \"n_donations\": 2996, \"total_amount\": 1899566, \"mean_amount\": 634.0340453938585, \"median_amount\": 127}]}}, {\"mode\": \"vega-lite\"});\n</script>\n```\n:::\n:::\n\n\n### By month\n\nWhen do the donations come in?\n\n::: {#6a9bee79 .cell execution_count=30}\n``` {.python .cell-code}\nby_month = summary_by(featured, _.date.month().name(\"month_int\"))\n# Sorta hacky, .substritute doesn't work to change dtypes (yet?)\n# so we cast to string and then do our mapping\nmonth_map = {\n    \"1\": \"Jan\",\n    \"2\": \"Feb\",\n    \"3\": \"Mar\",\n    \"4\": \"Apr\",\n    \"5\": \"May\",\n    \"6\": \"Jun\",\n    \"7\": \"Jul\",\n    \"8\": \"Aug\",\n    \"9\": \"Sep\",\n    \"10\": \"Oct\",\n    \"11\": \"Nov\",\n    \"12\": \"Dec\",\n}\nby_month = by_month.mutate(month_str=_.month_int.cast(str).substitute(month_map))\nby_month\n```\n\n::: {.cell-output .cell-output-display execution_count=30}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> month_int </span>┃<span style=\"font-weight: bold\"> n_donations </span>┃<span style=\"font-weight: bold\"> total_amount </span>┃<span style=\"font-weight: bold\"> mean_amount </span>┃<span style=\"font-weight: bold\"> median_amount </span>┃<span style=\"font-weight: bold\"> month_str </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int32</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>        │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │\n├───────────┼─────────────┼──────────────┼─────────────┼───────────────┼───────────┤\n│      <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">397</span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">73425</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">184.949622</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">100</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>      │\n│         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">116134</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">55499264</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">477.889886</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">195</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Jan      </span> │\n│         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">156323</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">71606579</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">458.068096</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">102</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Feb      </span> │\n│         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">289859</span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">119255680</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">411.426521</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">98</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Mar      </span> │\n│         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">332517</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">83190490</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">250.184171</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">50</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Apr      </span> │\n│         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">569521</span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">109882337</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">192.938166</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">40</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">May      </span> │\n│         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">6</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">613703</span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">141483461</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">230.540605</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">38</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Jun      </span> │\n│         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">7</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">366282</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">55598512</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">151.791549</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">39</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Jul      </span> │\n│         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">8</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">378725</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">69550071</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">183.642672</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">37</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Aug      </span> │\n│         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">9</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">459318</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">99244444</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">216.069137</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">39</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Sep      </span> │\n│         <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │           <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │            <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │           <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │             <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │\n└───────────┴─────────────┴──────────────┴─────────────┴───────────────┴───────────┘\n</pre>\n```\n:::\n:::\n\n\n::: {#cc0caa77 .cell execution_count=31}\n``` {.python .cell-code}\nmonths_in_order = list(month_map.values())\nalt.Chart(by_month.execute()).mark_bar().encode(\n    x=alt.X(\"month_str:O\", sort=months_in_order),\n    y=\"n_donations:Q\",\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=31}\n```{=html}\n\n<style>\n  #altair-viz-e480bb036347476a882005d4e9d3df86.vega-embed {\n    width: 100%;\n    display: flex;\n  }\n\n  #altair-viz-e480bb036347476a882005d4e9d3df86.vega-embed details,\n  #altair-viz-e480bb036347476a882005d4e9d3df86.vega-embed details summary {\n    position: relative;\n  }\n</style>\n<div id=\"altair-viz-e480bb036347476a882005d4e9d3df86\"></div>\n<script type=\"text/javascript\">\n  var VEGA_DEBUG = (typeof VEGA_DEBUG == \"undefined\") ? {} : VEGA_DEBUG;\n  (function(spec, embedOpt){\n    let outputDiv = document.currentScript.previousElementSibling;\n    if (outputDiv.id !== \"altair-viz-e480bb036347476a882005d4e9d3df86\") {\n      outputDiv = document.getElementById(\"altair-viz-e480bb036347476a882005d4e9d3df86\");\n    }\n    const paths = {\n      \"vega\": \"https://cdn.jsdelivr.net/npm/vega@5?noext\",\n      \"vega-lib\": \"https://cdn.jsdelivr.net/npm/vega-lib?noext\",\n      \"vega-lite\": \"https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext\",\n      \"vega-embed\": \"https://cdn.jsdelivr.net/npm/vega-embed@6?noext\",\n    };\n\n    function maybeLoadScript(lib, version) {\n      var key = `${lib.replace(\"-\", \"\")}_version`;\n      return (VEGA_DEBUG[key] == version) ?\n        Promise.resolve(paths[lib]) :\n        new Promise(function(resolve, reject) {\n          var s = document.createElement('script');\n          document.getElementsByTagName(\"head\")[0].appendChild(s);\n          s.async = true;\n          s.onload = () => {\n            VEGA_DEBUG[key] = version;\n            return resolve(paths[lib]);\n          };\n          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);\n          s.src = paths[lib];\n        });\n    }\n\n    function showError(err) {\n      outputDiv.innerHTML = `<div class=\"error\" style=\"color:red;\">${err}</div>`;\n      throw err;\n    }\n\n    function displayChart(vegaEmbed) {\n      vegaEmbed(outputDiv, spec, embedOpt)\n        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));\n    }\n\n    if(typeof define === \"function\" && define.amd) {\n      requirejs.config({paths});\n      require([\"vega-embed\"], displayChart, err => showError(`Error loading script: ${err.message}`));\n    } else {\n      maybeLoadScript(\"vega\", \"5\")\n        .then(() => maybeLoadScript(\"vega-lite\", \"5.8.0\"))\n        .then(() => maybeLoadScript(\"vega-embed\", \"6\"))\n        .catch(showError)\n        .then(() => displayChart(vegaEmbed));\n    }\n  })({\"config\": {\"view\": {\"continuousWidth\": 300, \"continuousHeight\": 300}}, \"data\": {\"name\": \"data-f4ff9e58bbdc9d044b58f69ddbfeab3e\"}, \"mark\": {\"type\": \"bar\"}, \"encoding\": {\"x\": {\"field\": \"month_str\", \"sort\": [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"], \"type\": \"ordinal\"}, \"y\": {\"field\": \"n_donations\", \"type\": \"quantitative\"}}, \"$schema\": \"https://vega.github.io/schema/vega-lite/v5.8.0.json\", \"datasets\": {\"data-f4ff9e58bbdc9d044b58f69ddbfeab3e\": [{\"month_int\": null, \"n_donations\": 397, \"total_amount\": 73425, \"mean_amount\": 184.94962216624685, \"median_amount\": 100, \"month_str\": null}, {\"month_int\": 1.0, \"n_donations\": 116134, \"total_amount\": 55499264, \"mean_amount\": 477.889885821551, \"median_amount\": 194, \"month_str\": \"Jan\"}, {\"month_int\": 2.0, \"n_donations\": 156323, \"total_amount\": 71606579, \"mean_amount\": 458.06809618546214, \"median_amount\": 102, \"month_str\": \"Feb\"}, {\"month_int\": 3.0, \"n_donations\": 289859, \"total_amount\": 119255680, \"mean_amount\": 411.4265211706381, \"median_amount\": 97, \"month_str\": \"Mar\"}, {\"month_int\": 4.0, \"n_donations\": 332517, \"total_amount\": 83190490, \"mean_amount\": 250.1841710348644, \"median_amount\": 50, \"month_str\": \"Apr\"}, {\"month_int\": 5.0, \"n_donations\": 569521, \"total_amount\": 109882337, \"mean_amount\": 192.9381655812516, \"median_amount\": 40, \"month_str\": \"May\"}, {\"month_int\": 6.0, \"n_donations\": 613703, \"total_amount\": 141483461, \"mean_amount\": 230.54060514613747, \"median_amount\": 38, \"month_str\": \"Jun\"}, {\"month_int\": 7.0, \"n_donations\": 366282, \"total_amount\": 55598512, \"mean_amount\": 151.7915485882462, \"median_amount\": 39, \"month_str\": \"Jul\"}, {\"month_int\": 8.0, \"n_donations\": 378725, \"total_amount\": 69550071, \"mean_amount\": 183.6426721235725, \"median_amount\": 37, \"month_str\": \"Aug\"}, {\"month_int\": 9.0, \"n_donations\": 459318, \"total_amount\": 99244444, \"mean_amount\": 216.06913728615032, \"median_amount\": 39, \"month_str\": \"Sep\"}, {\"month_int\": 10.0, \"n_donations\": 367271, \"total_amount\": 45488527, \"mean_amount\": 123.85548273618119, \"median_amount\": 28, \"month_str\": \"Oct\"}, {\"month_int\": 11.0, \"n_donations\": 330341, \"total_amount\": 37432335, \"mean_amount\": 113.31422681411027, \"median_amount\": 25, \"month_str\": \"Nov\"}, {\"month_int\": 12.0, \"n_donations\": 205636, \"total_amount\": 33177396, \"mean_amount\": 161.3404073216752, \"median_amount\": 26, \"month_str\": \"Dec\"}]}}, {\"mode\": \"vega-lite\"});\n</script>\n```\n:::\n:::\n\n\n## Conclusion\n\nThanks for following along! I hope you've learned something about Ibis, and\nmaybe even about campaign finance.\n\nIbis is a great tool for exploring data. I now find myself reaching for it\nwhen in the past I would have reached for pandas.\n\nSome of the highlights for me:\n\n- Fast, lazy execution, a great display format, and good type hinting/editor support for a great REPL experience.\n- Very well thought-out API and semantics (e.g. `isinstance(val, NumericValue)`?? That's beautiful!)\n- Fast and fairly complete string support, since I work with a lot of text data.\n- Extremely responsive maintainers. Sometimes I've submitted multiple feature requests and bug reports in a single day, and a PR has been merged by the next day.\n- Escape hatch to SQL. I didn't have to use that here, but if something isn't supported, you can always fall back to SQL.\n\nCheck out [The Ibis Website](https://ibis-project.org/) for more information.\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n<script src=\"https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js\" crossorigin=\"anonymous\"></script>\n"
      ],
      "include-after-body": [
        "<script type=application/vnd.jupyter.widget-state+json>\n{\"state\":{\"66cffb091da149d19e19df184fd7145c\":{\"model_module\":\"@jupyter-widgets/base\",\"model_module_version\":\"2.0.0\",\"model_name\":\"LayoutModel\",\"state\":{\"_model_module\":\"@jupyter-widgets/base\",\"_model_module_version\":\"2.0.0\",\"_model_name\":\"LayoutModel\",\"_view_count\":null,\"_view_module\":\"@jupyter-widgets/base\",\"_view_module_version\":\"2.0.0\",\"_view_name\":\"LayoutView\",\"align_content\":null,\"align_items\":null,\"align_self\":null,\"border_bottom\":null,\"border_left\":null,\"border_right\":null,\"border_top\":null,\"bottom\":null,\"display\":null,\"flex\":null,\"flex_flow\":null,\"grid_area\":null,\"grid_auto_columns\":null,\"grid_auto_flow\":null,\"grid_auto_rows\":null,\"grid_column\":null,\"grid_gap\":null,\"grid_row\":null,\"grid_template_areas\":null,\"grid_template_columns\":null,\"grid_template_rows\":null,\"height\":null,\"justify_content\":null,\"justify_items\":null,\"left\":null,\"margin\":null,\"max_height\":null,\"max_width\":null,\"min_height\":null,\"min_width\":null,\"object_fit\":null,\"object_position\":null,\"order\":null,\"overflow\":null,\"padding\":null,\"right\":null,\"top\":null,\"visibility\":null,\"width\":\"auto\"}},\"91e9832ebbb34a0e8bd6b90c70459f22\":{\"model_module\":\"@jupyter-widgets/controls\",\"model_module_version\":\"2.0.0\",\"model_name\":\"FloatProgressModel\",\"state\":{\"_dom_classes\":[],\"_model_module\":\"@jupyter-widgets/controls\",\"_model_module_version\":\"2.0.0\",\"_model_name\":\"FloatProgressModel\",\"_view_count\":null,\"_view_module\":\"@jupyter-widgets/controls\",\"_view_module_version\":\"2.0.0\",\"_view_name\":\"ProgressView\",\"bar_style\":\"\",\"description\":\"\",\"description_allow_html\":false,\"layout\":\"IPY_MODEL_66cffb091da149d19e19df184fd7145c\",\"max\":100,\"min\":0,\"orientation\":\"horizontal\",\"style\":\"IPY_MODEL_d9327137c6164366913a31d8a92cda8d\",\"tabbable\":null,\"tooltip\":null,\"value\":100}},\"d9327137c6164366913a31d8a92cda8d\":{\"model_module\":\"@jupyter-widgets/controls\",\"model_module_version\":\"2.0.0\",\"model_name\":\"ProgressStyleModel\",\"state\":{\"_model_module\":\"@jupyter-widgets/controls\",\"_model_module_version\":\"2.0.0\",\"_model_name\":\"ProgressStyleModel\",\"_view_count\":null,\"_view_module\":\"@jupyter-widgets/base\",\"_view_module_version\":\"2.0.0\",\"_view_name\":\"StyleView\",\"bar_color\":\"black\",\"description_width\":\"\"}}},\"version_major\":2,\"version_minor\":0}\n</script>\n"
      ]
    }
  }
}
