{
  "hash": "01dfd143b9a173aa5325737aa228bd82",
  "result": {
    "markdown": "---\ntitle: Working with arrays in Google BigQuery\nauthor: \"Phillip Cloud\"\ndate: \"2023-09-12\"\ncategories:\n    - blog\n    - bigquery\n    - arrays\n    - cloud\n---\n\n## Introduction\n\nIbis and BigQuery have [worked well together for years](https://cloud.google.com/blog/products/data-analytics/ibis-and-bigquery-scalable-analytics-comfort-python).\n\nIn Ibis 7.0.0, they work even better together with the addition of array\nfunctionality for BigQuery.\n\nLet's look at some examples using BigQuery's [IMDB sample\ndata](https://developer.imdb.com/non-commercial-datasets/).\n\n## Basics\n\nFirst we'll connect to BigQuery and pluck out a table to work with.\n\nWe'll start with `from ibis.interactive import *` for maximum convenience.\n\n::: {#b789e16f .cell execution_count=1}\n``` {.python .cell-code}\nfrom ibis.interactive import *  # <1>\n\ncon = ibis.connect(\"bigquery://ibis-gbq\")  # <2>\ncon.set_database(\"bigquery-public-data.imdb\")  # <3>\n```\n:::\n\n\n1. `from ibis.interactive import *` imports Ibis APIs into the global namespace\n   and enables [interactive mode](../../how-to/configure/basics.qmd#interactive-mode).\n2. Connect to Google BigQuery. Compute (but not storage) is billed to the\n   project you connect to--`ibis-gbq` in this case.\n3. Set the database to the project and dataset that we will use for analysis.\n\nLet's look at the tables in this dataset:\n\n::: {#df3b7c1a .cell execution_count=2}\n``` {.python .cell-code}\ncon.tables\n```\n\n::: {.cell-output .cell-output-display execution_count=157}\n```\nTables\n------\n- name_basics\n- reviews\n- title_akas\n- title_basics\n- title_crew\n- title_episode\n- title_principals\n- title_ratings\n```\n:::\n:::\n\n\nLet's pull out the `name_basics` table, which contains names and metadata about\npeople listed on IMDB. We'll call this `ents` (short for `entities`), and remove some\ncolumns we won't need:\n\n::: {#52171a11 .cell execution_count=3}\n``` {.python .cell-code}\nents = con.tables.name_basics.drop(\"birth_year\", \"death_year\")\nents\n```\n\n::: {.cell-output .cell-output-display execution_count=158}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst    </span>┃<span style=\"font-weight: bold\"> primary_name      </span>┃<span style=\"font-weight: bold\"> primary_profession </span>┃<span style=\"font-weight: bold\"> known_for_titles    </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>            │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>             │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>              │\n├───────────┼───────────────────┼────────────────────┼─────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7195872</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Amanda Goetz     </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"color: #008000; text-decoration-color: #008000\">tt4529508          </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7204100</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Overload         </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"color: #008000; text-decoration-color: #008000\">tt4828308,tt4538296</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7206569</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Carl Winter      </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>                │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7208626</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Doug Goodin      </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>                │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7222505</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Rickard Finndahl </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"color: #008000; text-decoration-color: #008000\">tt4519546          </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7226759</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Kenneth Bell     </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"color: #008000; text-decoration-color: #008000\">tt3545908          </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7227158</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Savannah Gardner </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"color: #008000; text-decoration-color: #008000\">tt4028790          </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7246216</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Elisabeth Hofmann</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"color: #008000; text-decoration-color: #008000\">tt4586074          </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7253303</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Wisda Febriyanti </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"color: #008000; text-decoration-color: #008000\">tt4594232          </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7255948</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Charles Myers    </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"color: #008000; text-decoration-color: #008000\">tt2396758          </span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                 │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                   │\n└───────────┴───────────────────┴────────────────────┴─────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n### Splitting strings into arrays\n\nWe can see that `known_for_titles` looks sort of like an array, so let's call\nthe\n[`split`](../../reference/expression-strings.qmd#ibis.expr.types.strings.StringValue.split)\nmethod on that column and replace the existing column:\n\n::: {#269b9de2 .cell execution_count=4}\n``` {.python .cell-code}\nents = ents.mutate(known_for_titles=_.known_for_titles.split(\",\"))\nents\n```\n\n::: {.cell-output .cell-output-display execution_count=159}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst    </span>┃<span style=\"font-weight: bold\"> primary_name      </span>┃<span style=\"font-weight: bold\"> primary_profession </span>┃<span style=\"font-weight: bold\"> known_for_titles           </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>            │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>             │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>              │\n├───────────┼───────────────────┼────────────────────┼────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7195872</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Amanda Goetz     </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4529508'</span><span style=\"font-weight: bold\">]</span>              │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7204100</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Overload         </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4828308'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt4538296'</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7206569</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Carl Winter      </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"font-weight: bold\">[]</span>                         │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7208626</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Doug Goodin      </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"font-weight: bold\">[]</span>                         │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7222505</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Rickard Finndahl </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4519546'</span><span style=\"font-weight: bold\">]</span>              │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7226759</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Kenneth Bell     </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt3545908'</span><span style=\"font-weight: bold\">]</span>              │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7227158</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Savannah Gardner </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4028790'</span><span style=\"font-weight: bold\">]</span>              │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7246216</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Elisabeth Hofmann</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4586074'</span><span style=\"font-weight: bold\">]</span>              │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7253303</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Wisda Febriyanti </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4594232'</span><span style=\"font-weight: bold\">]</span>              │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7255948</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Charles Myers    </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt2396758'</span><span style=\"font-weight: bold\">]</span>              │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                 │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                          │\n└───────────┴───────────────────┴────────────────────┴────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\nSimilarly for `primary_profession`, since people involved in show business often\nhave more than one responsibility on a project:\n\n::: {#4afaa049 .cell execution_count=5}\n``` {.python .cell-code}\nents = ents.mutate(primary_profession=_.primary_profession.split(\",\"))\n```\n:::\n\n\n### Array length\n\nLet's see how many titles each entity is known for, and then show the five\npeople with the largest number of titles they're known for:\n\nThis is computed using the\n[`length`](../../reference/expression-collections.qmd#ibis.expr.types.arrays.ArrayValue.length)\nAPI on array expressions:\n\n::: {#045dab82 .cell execution_count=6}\n``` {.python .cell-code}\n(\n    ents.select(\"primary_name\", num_titles=_.known_for_titles.length())\n    .order_by(_.num_titles.desc())\n    .limit(5)\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=161}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> primary_name     </span>┃<span style=\"font-weight: bold\"> num_titles </span>┃\n┡━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>      │\n├──────────────────┼────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Sally Sun       </span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Matthew Kavuma  </span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Henry Townsend  </span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Alex Koenigsmark</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Carrie Schnelker</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span> │\n└──────────────────┴────────────┘\n</pre>\n```\n:::\n:::\n\n\nIt seems like the length of the `known_for_titles` might be capped at five!\n\n### Index\n\nWe can see the position of `\"actor\"` in `primary_profession`s:\n\n::: {#e33090eb .cell execution_count=7}\n``` {.python .cell-code}\nents.primary_profession.index(\"actor\")\n```\n\n::: {.cell-output .cell-output-display execution_count=162}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> ArrayPosition(primary_profession, 'actor') </span>┃\n┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>                                      │\n├────────────────────────────────────────────┤\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                          <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │\n└────────────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\nA return value of `-1` indicates that `\"actor\"` is not present in the value:\n\nLet's look for entities that are not primarily actors:\n\nWe can do this using the\n[`index`](../../reference/expression-collections.qmd#ibis.expr.types.arrays.ArrayValue.index)\nmethod by checking whether the position of the string `\"actor\"` is greater than\nzero:\n\n::: {#d1804a34 .cell execution_count=8}\n``` {.python .cell-code}\nactor_index = ents.primary_profession.index(\"actor\")\nnot_primarily_actors = actor_index > 0\nnot_primarily_actors.mean()  # <1>\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"></pre>\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=163}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-cyan-fg ansi-bold\">0.019474437073314168</span></pre>\n```\n:::\n\n:::\n:::\n\n\n1. The average of a `bool` column gives the percentage of `True` values\n\nWho are they?\n\n::: {#4d48ad50 .cell execution_count=9}\n``` {.python .cell-code}\nents[not_primarily_actors]\n```\n\n::: {.cell-output .cell-output-display execution_count=164}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst     </span>┃<span style=\"font-weight: bold\"> primary_name       </span>┃<span style=\"font-weight: bold\"> primary_profession  </span>┃<span style=\"font-weight: bold\"> known_for_titles                    </span>┃\n┡━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>             │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                       │\n├────────────┼────────────────────┼─────────────────────┼─────────────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm2231782 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Rene Tovar        </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'legal'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span>  │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt21996928'</span><span style=\"font-weight: bold\">]</span>                      │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm2250015 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Stephen Clark     </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'legal'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span>  │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt1452628'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt14372154'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0352162 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Brett Haber       </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'legal'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span>  │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt1720280'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt10928526'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm12169237</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Endi Ndini        </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'editor'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4557810'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt14137514'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm14475156</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Colby White       </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'editor'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt26313337'</span><span style=\"font-weight: bold\">]</span>                      │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm8979480 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Bartosz Strusewicz</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'editor'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt6685946'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt7334964'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span>  │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm3116354 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Robert Marquis    </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'editor'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt8376014'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt1283513'</span><span style=\"font-weight: bold\">]</span>          │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm9962305 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Vino Domi         </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'editor'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt8680966'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt8669176'</span><span style=\"font-weight: bold\">]</span>          │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm10346617</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Lucas Oliveira    </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'editor'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt9483226'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt7216954'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>  │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7206820 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Prince Sethi      </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'editor'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt14396686'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt4219300'</span><span style=\"font-weight: bold\">]</span>         │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                   │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                   │\n└────────────┴────────────────────┴─────────────────────┴─────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\nIt's not 100% clear whether the order of elements in `primary_profession` matters here.\n\n### Containment\n\nWe can get people who are **not** actors using `contains`:\n\n::: {#327da073 .cell execution_count=10}\n``` {.python .cell-code}\nnon_actors = ents[~ents.primary_profession.contains(\"actor\")]\nnon_actors\n```\n\n::: {.cell-output .cell-output-display execution_count=165}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst     </span>┃<span style=\"font-weight: bold\"> primary_name          </span>┃<span style=\"font-weight: bold\"> primary_profession </span>┃<span style=\"font-weight: bold\"> known_for_titles </span>┃\n┡━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>    │\n├────────────┼───────────────────────┼────────────────────┼──────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm13613518</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Silvia Vannini       </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'legal'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[]</span>               │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm11482673</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Umit Yildirim        </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'legal'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[]</span>               │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm14796117</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Kendall Jackson      </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'legal'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[]</span>               │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm3922637 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Michael J. Douglas   </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'legal'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[]</span>               │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm5249145 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Christopher Addy     </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'legal'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[]</span>               │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm9235293 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Baolu Lan            </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'legal'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[]</span>               │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm14560328</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Jean Paul S Voilleque</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'legal'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[]</span>               │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm11250663</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Kelly D. Shapiro     </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'legal'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[]</span>               │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm11355058</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Sameer Oberoi        </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'legal'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[]</span>               │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm8655635 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">James Madison        </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'legal'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[]</span>               │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                │\n└────────────┴───────────────────────┴────────────────────┴──────────────────┘\n</pre>\n```\n:::\n:::\n\n\n### Element removal\n\nWe can remove elements from arrays too.\n\n::: {.callout-note}\n## [`remove()`](../../reference/expression-collections.qmd#ibis.expr.types.arrays.ArrayValue.remove) does not mutate the underlying data\n:::\n\nLet's see who only has \"actor\" in the list of their primary professions:\n\n::: {#11189ac7 .cell execution_count=11}\n``` {.python .cell-code}\nents.filter(\n    [\n        _.primary_profession.length() > 0,\n        _.primary_profession.remove(\"actor\").length() == 0,\n    ]\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=166}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst    </span>┃<span style=\"font-weight: bold\"> primary_name       </span>┃<span style=\"font-weight: bold\"> primary_profession </span>┃<span style=\"font-weight: bold\"> known_for_titles                    </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>             │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                       │\n├───────────┼────────────────────┼────────────────────┼─────────────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7217990</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Jay Isbell        </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4450682'</span><span style=\"font-weight: bold\">]</span>                       │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7218053</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Eric Crowell      </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4500196'</span><span style=\"font-weight: bold\">]</span>                       │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7218081</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">John Wyman        </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4500196'</span><span style=\"font-weight: bold\">]</span>                       │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7223556</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Daniel Hope       </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4558584'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt9089514'</span><span style=\"font-weight: bold\">]</span>          │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7223623</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Marcus Troy       </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0120660'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt10914400'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7241836</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Havár Csongor     </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4580414'</span><span style=\"font-weight: bold\">]</span>                       │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7242608</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Seigô Uetaki      </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4581192'</span><span style=\"font-weight: bold\">]</span>                       │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7245253</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Mahmoud El Faituri</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt2849138'</span><span style=\"font-weight: bold\">]</span>                       │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7254729</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Tom Keesey        </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0924155'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0924156'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span>  │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7280985</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Gabriel Garcia    </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4629714'</span><span style=\"font-weight: bold\">]</span>                       │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                   │\n└───────────┴────────────────────┴────────────────────┴─────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n### Slicing with square-bracket syntax\n\nLet's remove everyone's first profession from the list, but only if they have\nmore than one profession listed:\n\n::: {#363b1821 .cell execution_count=12}\n``` {.python .cell-code}\nents[_.primary_profession.length() > 1].mutate(\n    primary_profession=_.primary_profession[1:],\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=167}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst     </span>┃<span style=\"font-weight: bold\"> primary_name           </span>┃<span style=\"font-weight: bold\"> primary_profession </span>┃<span style=\"font-weight: bold\"> known_for_titles           </span>┃\n┡━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                 │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>              │\n├────────────┼────────────────────────┼────────────────────┼────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm3146692 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Keith Sutton          </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'legal'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0472984'</span><span style=\"font-weight: bold\">]</span>              │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm2974992 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Dávid Farkas          </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'legal'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0114301'</span><span style=\"font-weight: bold\">]</span>              │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm6819046 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Walter Batt           </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'legal'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt8592196'</span><span style=\"font-weight: bold\">]</span>              │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm2231544 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Don Steele            </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0818746'</span><span style=\"font-weight: bold\">]</span>              │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7267327 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Navarro Gray          </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt1718437'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt7945012'</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7783929 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Christopher T. Connell</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'editor'</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt7510258'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt5262988'</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm6894982 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Jason Robert Moore    </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'editor'</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4177962'</span><span style=\"font-weight: bold\">]</span>              │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm10526935</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Damien Mota           </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'editor'</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt9889740'</span><span style=\"font-weight: bold\">]</span>              │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7151380 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Chris Villa           </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'editor'</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4479468'</span><span style=\"font-weight: bold\">]</span>              │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7641135 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Curt Champagne        </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'editor'</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt5097098'</span><span style=\"font-weight: bold\">]</span>              │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                          │\n└────────────┴────────────────────────┴────────────────────┴────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n## Set operations and sorting\n\nTreating arrays as sets is possible with the\n[`union`](../../reference/expression-collections.qmd#ibis.expr.types.arrays.ArrayValue.union)\nand\n[`intersect`](../../reference/expression-collections.qmd#ibis.expr.types.arrays.ArrayValue.intersect)\nAPIs.\n\nLet's take a look at `intersect`:\n\n### Intersection\n\nLet's see if we can use array intersection to figure which actors share\nknown-for titles and sort the result:\n\n::: {#11583fdc .cell execution_count=13}\n``` {.python .cell-code}\nleft = ents.filter(_.known_for_titles.length() > 0).limit(10_000)\nright = left.view()\nshared_titles = (\n    left\n    .join(right, left.nconst != right.nconst)\n    .select(\n        s.startswith(\"known_for_titles\"),\n        left_name=\"primary_name\",\n        right_name=\"primary_name_right\",\n    )\n    .filter(_.known_for_titles.intersect(_.known_for_titles_right).length() > 0)\n    .group_by(name=\"left_name\")\n    .agg(together_with=_.right_name.collect())\n    .mutate(together_with=_.together_with.unique().sort())\n)\nshared_titles\n```\n\n::: {.cell-output .cell-output-display execution_count=168}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> name                  </span>┃<span style=\"font-weight: bold\"> together_with                                       </span>┃\n┡━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                                       │\n├───────────────────────┼─────────────────────────────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Chief Willie Sellars </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Amy Tan'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Bruce Williams'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">13</span><span style=\"font-weight: bold\">]</span>              │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Rainer Spanagel      </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Andra Arnicane'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Aziz Sheikh'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">9</span><span style=\"font-weight: bold\">]</span>           │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Sam Cooper           </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Amy Tan'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Bruce Williams'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">10</span><span style=\"font-weight: bold\">]</span>              │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Michelle Porter      </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Amy Tan'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Bruce Williams'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">8</span><span style=\"font-weight: bold\">]</span>               │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Bryan Carter         </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Andrew Bower'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Austin Murtha'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">11</span><span style=\"font-weight: bold\">]</span>          │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Timothy Johnson      </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Betsy Blaney'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Brendan Halko'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">19</span><span style=\"font-weight: bold\">]</span>          │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Colin McLean         </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Alison Garnham'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Ashley Fox'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">20</span><span style=\"font-weight: bold\">]</span>           │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Jessica Williams     </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Austin Williams'</span><span style=\"font-weight: bold\">]</span>                                 │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Leighann Falcon      </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Aaron Green'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Alejandro Garza y Garza'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">71</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Oldham Tuneless Choir</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Alex Matvienko'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Andy McDonald'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">38</span><span style=\"font-weight: bold\">]</span>        │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                                   │\n└───────────────────────┴─────────────────────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n## Advanced operations\n\n### Flatten arrays into rows\n\nThanks to the [tireless\nefforts](https://github.com/tobymao/sqlglot/commit/06e0869e7aa5714d77e6ec763da38d6a422965fa)\nof the [folks](https://github.com/tobymao/sqlglot/graphs/contributors) working\non [`sqlglot`](https://github.com/tobymao/sqlglot), as of version 7.0.0 Ibis\nsupports\n[`unnest`](../../reference/expression-collections.qmd#ibis.expr.types.arrays.ArrayValue.unnest)\nfor BigQuery!\n\nYou can use it standalone on a column expression:\n\n::: {#e28c4519 .cell execution_count=14}\n``` {.python .cell-code}\nents.primary_profession.unnest()\n```\n\n::: {.cell-output .cell-output-display execution_count=169}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> primary_profession </span>┃\n┡━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>             │\n├────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                  │\n└────────────────────┘\n</pre>\n```\n:::\n:::\n\n\nYou can also use it in `select`/`mutate` calls to expand the table accordingly:\n\n::: {#99e2daa3 .cell execution_count=15}\n``` {.python .cell-code}\nents.mutate(primary_profession=_.primary_profession.unnest())\n```\n\n::: {.cell-output .cell-output-display execution_count=170}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst    </span>┃<span style=\"font-weight: bold\"> primary_name       </span>┃<span style=\"font-weight: bold\"> primary_profession </span>┃<span style=\"font-weight: bold\"> known_for_titles </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>             │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>             │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>    │\n├───────────┼────────────────────┼────────────────────┼──────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7211030</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Josh Berry        </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4046896'</span><span style=\"font-weight: bold\">]</span>    │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7211205</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Alan Douglas      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0038449'</span><span style=\"font-weight: bold\">]</span>    │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7213536</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Wilson Recalde    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt2333598'</span><span style=\"font-weight: bold\">]</span>    │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7214355</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Julian Owen       </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt3488298'</span><span style=\"font-weight: bold\">]</span>    │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7215983</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Zach Ladouceur    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4546288'</span><span style=\"font-weight: bold\">]</span>    │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7221941</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Alain Milani      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4548654'</span><span style=\"font-weight: bold\">]</span>    │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7225536</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Gary Flanzer      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4521030'</span><span style=\"font-weight: bold\">]</span>    │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7236543</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Bastiaan Schreuder</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4506254'</span><span style=\"font-weight: bold\">]</span>    │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7241255</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Jared Young       </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4579992'</span><span style=\"font-weight: bold\">]</span>    │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7241835</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Fagyas Alex       </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4580414'</span><span style=\"font-weight: bold\">]</span>    │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                │\n└───────────┴────────────────────┴────────────────────┴──────────────────┘\n</pre>\n```\n:::\n:::\n\n\nUnnesting can be useful when joining nested data.\n\nHere we use unnest to find people known for any of the godfather movies:\n\n::: {#d3d9d571 .cell execution_count=16}\n``` {.python .cell-code}\nbasics = con.tables.title_basics.filter(  # <1>\n    [\n        _.title_type == \"movie\",\n        _.original_title.lower().startswith(\"the godfather\"),\n        _.genres.lower().contains(\"crime\"),\n    ]\n)  # <1>\n\nknown_for_the_godfather = (\n    ents.mutate(tconst=_.known_for_titles.unnest())  # <2>\n    .join(basics, \"tconst\")  # <3>\n    .select(\"primary_title\", \"primary_name\")  # <4>\n    .distinct()\n    .order_by([\"primary_title\", \"primary_name\"]) # <4>\n)\nknown_for_the_godfather\n```\n\n::: {.cell-output .cell-output-display execution_count=171}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> primary_title </span>┃<span style=\"font-weight: bold\"> primary_name        </span>┃\n┡━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>        │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>              │\n├───────────────┼─────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">A. Emmett Adams    </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Abe Vigoda         </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Al Lettieri        </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Al Martino         </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Al Pacino          </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Albert S. Ruddy    </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Alex Rocco         </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Andrea Eastman     </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Angelo Infanti     </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Anna Hill Johnstone</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>             │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                   │\n└───────────────┴─────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n1. Filter the `title_basics` data set to only the Godfather movies\n2. Unnest the `known_for_titles` array column\n3. Join with `basics` to get movie titles\n4. Ensure that each entity is only listed once and sort the results\n\nLet's summarize by showing how many people are known for each Godfather movie:\n\n::: {#7a6153fd .cell execution_count=17}\n``` {.python .cell-code}\nknown_for_the_godfather.primary_title.value_counts()\n```\n\n::: {.cell-output .cell-output-display execution_count=172}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> primary_title          </span>┃<span style=\"font-weight: bold\"> primary_title_count </span>┃\n┡━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                 │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>               │\n├────────────────────────┼─────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather Part III</span> │                 <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">196</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather Part II </span> │                 <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">117</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather         </span> │                  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">96</span> │\n└────────────────────────┴─────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n### Filtering array elements\n\nFiltering array elements can be done with the\n[`filter`](../../reference/expression-collections.qmd#ibis.expr.types.arrays.ArrayValue.filter)\nmethod, which applies a predicate to each array element and returns an array of\nelements for which the predicate returns `True`.\n\nThis method is similar to Python's\n[`filter`](https://docs.python.org/3.7/library/functions.html#filter) function.\n\nLet's show all people who are neither editors nor actors:\n\n::: {#888e227f .cell execution_count=18}\n``` {.python .cell-code}\nents.mutate(\n    primary_profession=_.primary_profession.filter(  # <1>\n        lambda pp: ~pp.isin((\"actor\", \"editor\"))\n    )\n).filter(_.primary_profession.length() > 0)  # <2>\n```\n\n::: {.cell-output .cell-output-display execution_count=173}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst     </span>┃<span style=\"font-weight: bold\"> primary_name       </span>┃<span style=\"font-weight: bold\"> primary_profession </span>┃<span style=\"font-weight: bold\"> known_for_titles </span>┃\n┡━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>             │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>    │\n├────────────┼────────────────────┼────────────────────┼──────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm14701100</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Karin Roach       </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'legal'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[]</span>               │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm3709802 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Kristin L. Holland</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'legal'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[]</span>               │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm13336378</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Rok Salazar       </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'legal'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[]</span>               │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7514782 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Christopher Spicer</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'legal'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[]</span>               │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm11531194</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">J Manuel          </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'legal'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[]</span>               │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm9114713 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Huy Nguyen        </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'legal'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[]</span>               │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm2230248 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Jeffrey Galen     </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'legal'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[]</span>               │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm8479496 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Fatima Amgane     </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'legal'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[]</span>               │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm2229345 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Harold Brown      </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'legal'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[]</span>               │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7383201 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Ashley Silver     </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'legal'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[]</span>               │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                │\n└────────────┴────────────────────┴────────────────────┴──────────────────┘\n</pre>\n```\n:::\n:::\n\n\n1. This `filter` call is applied to each array element\n2. This `filter` call is applied to the table\n\n### Applying a function to array elements\n\nYou can apply a function to run an ibis expression on each element of an array\nusing the\n[`map`](../../reference/expression-collections.qmd#ibis.expr.types.arrays.ArrayValue.map)\nmethod.\n\nLet's normalize the case of primary_profession to upper case:\n\n::: {#b979917c .cell execution_count=19}\n``` {.python .cell-code}\nents.mutate(\n    primary_profession=_.primary_profession.map(lambda pp: pp.upper())\n).filter(_.primary_profession.length() > 0)\n```\n\n::: {.cell-output .cell-output-display execution_count=174}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst    </span>┃<span style=\"font-weight: bold\"> primary_name      </span>┃<span style=\"font-weight: bold\"> primary_profession </span>┃<span style=\"font-weight: bold\"> known_for_titles                    </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>            │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                       │\n├───────────┼───────────────────┼────────────────────┼─────────────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7199328</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Renzo Castro     </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4623856'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt4494580'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>  │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7199362</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Pankaj           </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4367318'</span><span style=\"font-weight: bold\">]</span>                       │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7200119</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Thibault Péan    </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4534250'</span><span style=\"font-weight: bold\">]</span>                       │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7203213</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Tim Goodman      </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt2234701'</span><span style=\"font-weight: bold\">]</span>                       │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7207130</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Ruupertti Arponen</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0185819'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt10628202'</span><span style=\"font-weight: bold\">]</span>         │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7223822</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Federico Carghini</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt1556087'</span><span style=\"font-weight: bold\">]</span>                       │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7232704</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Ned Jackson      </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0407361'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt20453990'</span><span style=\"font-weight: bold\">]</span>         │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7238980</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Rasmus Cassanelli</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0782510'</span><span style=\"font-weight: bold\">]</span>                       │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7240979</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Changyuan Zhou   </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0311913'</span><span style=\"font-weight: bold\">]</span>                       │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7242332</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">James Dolbeare   </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt10151048'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt5769738'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                 │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                   │\n└───────────┴───────────────────┴────────────────────┴─────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n## Conclusion\n\nIbis has a sizable collection of array APIs that work with many different\nbackends and as of version 7.0.0, Ibis supports a much larger set of those APIs\nfor BigQuery!\n\nCheck out [the API\ndocumentation](../../reference/expression-collections.qmd#ibis.expr.types.arrays.ArrayValue)\nfor the full set of available methods.\n\nTry it out, and let us know what you think.\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}