{
  "hash": "01dfd143b9a173aa5325737aa228bd82",
  "result": {
    "markdown": "---\ntitle: Working with arrays in Google BigQuery\nauthor: \"Phillip Cloud\"\ndate: \"2023-09-12\"\ncategories:\n    - blog\n    - bigquery\n    - arrays\n    - cloud\n---\n\n## Introduction\n\nIbis and BigQuery have [worked well together for years](https://cloud.google.com/blog/products/data-analytics/ibis-and-bigquery-scalable-analytics-comfort-python).\n\nIn Ibis 7.0.0, they work even better together with the addition of array\nfunctionality for BigQuery.\n\nLet's look at some examples using BigQuery's [IMDB sample\ndata](https://developer.imdb.com/non-commercial-datasets/).\n\n## Basics\n\nFirst we'll connect to BigQuery and pluck out a table to work with.\n\nWe'll start with `from ibis.interactive import *` for maximum convenience.\n\n::: {#5faa101c .cell execution_count=1}\n``` {.python .cell-code}\nfrom ibis.interactive import *  # <1>\n\ncon = ibis.connect(\"bigquery://ibis-gbq\")  # <2>\ncon.set_database(\"bigquery-public-data.imdb\")  # <3>\n```\n:::\n\n\n1. `from ibis.interactive import *` imports Ibis APIs into the global namespace\n   and enables [interactive mode](../../how-to/configure/basics.qmd#interactive-mode).\n2. Connect to Google BigQuery. Compute (but not storage) is billed to the\n   project you connect to--`ibis-gbq` in this case.\n3. Set the database to the project and dataset that we will use for analysis.\n\nLet's look at the tables in this dataset:\n\n::: {#e348f2a8 .cell execution_count=2}\n``` {.python .cell-code}\ncon.tables\n```\n\n::: {.cell-output .cell-output-display execution_count=2}\n```\nTables\n------\n- name_basics\n- reviews\n- title_akas\n- title_basics\n- title_crew\n- title_episode\n- title_principals\n- title_ratings\n```\n:::\n:::\n\n\nLet's pull out the `name_basics` table, which contains names and metadata about\npeople listed on IMDB. We'll call this `ents` (short for `entities`), and remove some\ncolumns we won't need:\n\n::: {#3bb7fb0f .cell execution_count=3}\n``` {.python .cell-code}\nents = con.tables.name_basics.drop(\"birth_year\", \"death_year\")\nents\n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst    </span>┃<span style=\"font-weight: bold\"> primary_name         </span>┃<span style=\"font-weight: bold\"> primary_profession </span>┃<span style=\"font-weight: bold\"> known_for_titles              </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>             │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                        │\n├───────────┼──────────────────────┼────────────────────┼───────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7138056</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Rick Rosenthal      </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>                          │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7139577</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Swearwolf           </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>                          │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7142352</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Sue Alcock          </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"color: #008000; text-decoration-color: #008000\">tt0106077,tt2882076,tt0206501</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7148481</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Fayez Sayegh        </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"color: #008000; text-decoration-color: #008000\">tt0334858,tt0257303          </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7152942</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Tyler Trevyon Wilson</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>                          │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7155448</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Kieran Statham      </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>                          │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7180904</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Ivan Houston        </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"color: #008000; text-decoration-color: #008000\">tt4513850,tt6479150          </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7205405</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Beryl Heryet        </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"color: #008000; text-decoration-color: #008000\">tt0108961                    </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7205905</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Catherine A. Hughes </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>                          │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7224551</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Rick Young          </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>                          │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                             │\n└───────────┴──────────────────────┴────────────────────┴───────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n### Splitting strings into arrays\n\nWe can see that `known_for_titles` looks sort of like an array, so let's call\nthe\n[`split`](../../reference/expression-strings.qmd#ibis.expr.types.strings.StringValue.split)\nmethod on that column and replace the existing column:\n\n::: {#5d4e28ad .cell execution_count=4}\n``` {.python .cell-code}\nents = ents.mutate(known_for_titles=_.known_for_titles.split(\",\"))\nents\n```\n\n::: {.cell-output .cell-output-display execution_count=4}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst    </span>┃<span style=\"font-weight: bold\"> primary_name     </span>┃<span style=\"font-weight: bold\"> primary_profession </span>┃<span style=\"font-weight: bold\"> known_for_titles </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>             │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>    │\n├───────────┼──────────────────┼────────────────────┼──────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7136100</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Aaisha Nance    </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"font-weight: bold\">[]</span>               │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7154336</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Eduardo Martínez</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt3916326'</span><span style=\"font-weight: bold\">]</span>    │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7159199</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Russell Michael </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"font-weight: bold\">[]</span>               │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7164837</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Chris Hayden    </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"font-weight: bold\">[]</span>               │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7173311</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Brenda Richmond </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"font-weight: bold\">[]</span>               │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7184223</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Lise Hogstad    </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4517204'</span><span style=\"font-weight: bold\">]</span>    │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7188457</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Jake Hirsch     </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"font-weight: bold\">[]</span>               │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7201641</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Zvi Hillman     </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt3800526'</span><span style=\"font-weight: bold\">]</span>    │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7201872</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Eleanor Glissan </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"font-weight: bold\">[]</span>               │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7202400</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Don Wolfe       </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>               │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0350393'</span><span style=\"font-weight: bold\">]</span>    │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                │\n└───────────┴──────────────────┴────────────────────┴──────────────────┘\n</pre>\n```\n:::\n:::\n\n\nSimilarly for `primary_profession`, since people involved in show business often\nhave more than one responsibility on a project:\n\n::: {#8387c80b .cell execution_count=5}\n``` {.python .cell-code}\nents = ents.mutate(primary_profession=_.primary_profession.split(\",\"))\n```\n:::\n\n\n### Array length\n\nLet's see how many titles each entity is known for, and then show the five\npeople with the largest number of titles they're known for:\n\nThis is computed using the\n[`length`](../../reference/expression-collections.qmd#ibis.expr.types.arrays.ArrayValue.length)\nAPI on array expressions:\n\n::: {#01b35e5c .cell execution_count=6}\n``` {.python .cell-code}\n(\n    ents.select(\"primary_name\", num_titles=_.known_for_titles.length())\n    .order_by(_.num_titles.desc())\n    .limit(5)\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> primary_name       </span>┃<span style=\"font-weight: bold\"> num_titles </span>┃\n┡━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>             │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>      │\n├────────────────────┼────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Paul Winter       </span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">6</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Chris Estrada     </span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">6</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Jonathon Saunders </span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Jean-Marie Dupriez</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Henry Townsend    </span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span> │\n└────────────────────┴────────────┘\n</pre>\n```\n:::\n:::\n\n\nIt seems like the length of the `known_for_titles` might be capped at five!\n\n### Index\n\nWe can see the position of `\"actor\"` in `primary_profession`s:\n\n::: {#2f3e6c62 .cell execution_count=7}\n``` {.python .cell-code}\nents.primary_profession.index(\"actor\")\n```\n\n::: {.cell-output .cell-output-display execution_count=7}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> ArrayPosition(primary_profession, 'actor') </span>┃\n┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>                                      │\n├────────────────────────────────────────────┤\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                          <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │\n└────────────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\nA return value of `-1` indicates that `\"actor\"` is not present in the value:\n\nLet's look for entities that are not primarily actors:\n\nWe can do this using the\n[`index`](../../reference/expression-collections.qmd#ibis.expr.types.arrays.ArrayValue.index)\nmethod by checking whether the position of the string `\"actor\"` is greater than\nzero:\n\n::: {#c7f296bc .cell execution_count=8}\n``` {.python .cell-code}\nactor_index = ents.primary_profession.index(\"actor\")\nnot_primarily_actors = actor_index > 0\nnot_primarily_actors.mean()  # <1>\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"></pre>\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=8}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-cyan-fg ansi-bold\">0.019416901585524518</span></pre>\n```\n:::\n\n:::\n:::\n\n\n1. The average of a `bool` column gives the percentage of `True` values\n\nWho are they?\n\n::: {#d91d5c0b .cell execution_count=9}\n``` {.python .cell-code}\nents[not_primarily_actors]\n```\n\n::: {.cell-output .cell-output-display execution_count=9}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst     </span>┃<span style=\"font-weight: bold\"> primary_name      </span>┃<span style=\"font-weight: bold\"> primary_profession                </span>┃<span style=\"font-weight: bold\"> known_for_titles                     </span>┃\n┡━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>            │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                        │\n├────────────┼───────────────────┼───────────────────────────────────┼──────────────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm4130226 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Brian Castleforte</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'animation_department'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt6565702'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0379786'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span>   │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm8393678 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Vincent Bonduau  </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'animation_department'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt1807824'</span><span style=\"font-weight: bold\">]</span>                        │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm14260828</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Brian Nurken     </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'animation_department'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt23752664'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt23772766'</span><span style=\"font-weight: bold\">]</span>         │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm4683360 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Youngmin Yoon    </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'animation_department'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt2063592'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0206512'</span><span style=\"font-weight: bold\">]</span>           │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm3549362 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Rundeep Khaira   </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'animation_department'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt8801880'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt10468754'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span>  │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm4797828 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Sandria Dajani   </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'animation_department'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt13614758'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt11714502'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm9568757 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Katsuki Fukuda   </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'animation_department'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt9179096'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt9203780'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>   │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm14460434</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Akuago220        </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'animation_department'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt26241684'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt26241620'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm3707489 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Sejin Lee        </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'animation_department'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt1554501'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt4612828'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>   │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm5427775 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Man Yee Wong     </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'animation_department'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt6726818'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt2355236'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>   │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                 │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                 │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                    │\n└────────────┴───────────────────┴───────────────────────────────────┴──────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\nIt's not 100% clear whether the order of elements in `primary_profession` matters here.\n\n### Containment\n\nWe can get people who are **not** actors using `contains`:\n\n::: {#f1a185d8 .cell execution_count=10}\n``` {.python .cell-code}\nnon_actors = ents[~ents.primary_profession.contains(\"actor\")]\nnon_actors\n```\n\n::: {.cell-output .cell-output-display execution_count=10}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst    </span>┃<span style=\"font-weight: bold\"> primary_name               </span>┃<span style=\"font-weight: bold\"> primary_profession </span>┃<span style=\"font-weight: bold\"> known_for_titles                     </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                        │\n├───────────┼────────────────────────────┼────────────────────┼──────────────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7150442</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Amelia Fay Robinson       </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actress'</span><span style=\"font-weight: bold\">]</span>        │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt13481164'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt13465802'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7165224</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Isabel Gregory            </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actress'</span><span style=\"font-weight: bold\">]</span>        │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4443854'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt4496070'</span><span style=\"font-weight: bold\">]</span>           │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7178372</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Stephanie Antia           </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actress'</span><span style=\"font-weight: bold\">]</span>        │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4511160'</span><span style=\"font-weight: bold\">]</span>                        │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7185484</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Roberta Fjelsted Rasmussen</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actress'</span><span style=\"font-weight: bold\">]</span>        │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt1973692'</span><span style=\"font-weight: bold\">]</span>                        │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7207148</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Vinti Idnani              </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actress'</span><span style=\"font-weight: bold\">]</span>        │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4193556'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt1949650'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span>   │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7226395</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Ezgi Geles                </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actress'</span><span style=\"font-weight: bold\">]</span>        │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4562100'</span><span style=\"font-weight: bold\">]</span>                        │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7240877</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Natalie Mitchell          </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actress'</span><span style=\"font-weight: bold\">]</span>        │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4579596'</span><span style=\"font-weight: bold\">]</span>                        │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7242240</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Lea Monique Chavez        </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actress'</span><span style=\"font-weight: bold\">]</span>        │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt5862516'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt4580910'</span><span style=\"font-weight: bold\">]</span>           │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7244117</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Claire Luger              </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actress'</span><span style=\"font-weight: bold\">]</span>        │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt2287817'</span><span style=\"font-weight: bold\">]</span>                        │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7270151</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Kitty                     </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actress'</span><span style=\"font-weight: bold\">]</span>        │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4461794'</span><span style=\"font-weight: bold\">]</span>                        │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                    │\n└───────────┴────────────────────────────┴────────────────────┴──────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n### Element removal\n\nWe can remove elements from arrays too.\n\n::: {.callout-note}\n## [`remove()`](../../reference/expression-collections.qmd#ibis.expr.types.arrays.ArrayValue.remove) does not mutate the underlying data\n:::\n\nLet's see who only has \"actor\" in the list of their primary professions:\n\n::: {#5a802a3e .cell execution_count=11}\n``` {.python .cell-code}\nents.filter(\n    [\n        _.primary_profession.length() > 0,\n        _.primary_profession.remove(\"actor\").length() == 0,\n    ]\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=11}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst    </span>┃<span style=\"font-weight: bold\"> primary_name     </span>┃<span style=\"font-weight: bold\"> primary_profession </span>┃<span style=\"font-weight: bold\"> known_for_titles                   </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                      │\n├───────────┼──────────────────┼────────────────────┼────────────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7149861</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Max Arnoud      </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt3385542'</span><span style=\"font-weight: bold\">]</span>                      │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7165794</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Arnaud Charrin  </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt6441072'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt9120416'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7166580</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Dragoslav Curcin</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4497928'</span><span style=\"font-weight: bold\">]</span>                      │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7172699</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Guillaume Ferrer</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4505204'</span><span style=\"font-weight: bold\">]</span>                      │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7181207</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Lino Vitale     </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt2396200'</span><span style=\"font-weight: bold\">]</span>                      │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7183738</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Taia Handlin    </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4516616'</span><span style=\"font-weight: bold\">]</span>                      │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7189398</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Attila Gal      </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt3414510'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt2442080'</span><span style=\"font-weight: bold\">]</span>         │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7202327</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Leonardo Tadeu  </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4536560'</span><span style=\"font-weight: bold\">]</span>                      │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7213972</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Michael Davis   </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4547714'</span><span style=\"font-weight: bold\">]</span>                      │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7215705</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Darryl Daniels  </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4549616'</span><span style=\"font-weight: bold\">]</span>                      │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                  │\n└───────────┴──────────────────┴────────────────────┴────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n### Slicing with square-bracket syntax\n\nLet's remove everyone's first profession from the list, but only if they have\nmore than one profession listed:\n\n::: {#bbfac9ce .cell execution_count=12}\n``` {.python .cell-code}\nents[_.primary_profession.length() > 1].mutate(\n    primary_profession=_.primary_profession[1:],\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=12}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst     </span>┃<span style=\"font-weight: bold\"> primary_name     </span>┃<span style=\"font-weight: bold\"> primary_profession       </span>┃<span style=\"font-weight: bold\"> known_for_titles                   </span>┃\n┡━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>            │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                      │\n├────────────┼──────────────────┼──────────────────────────┼────────────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm4461143 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Sima Gorjestani </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actress'</span><span style=\"font-weight: bold\">]</span>              │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt10570018'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt1933537'</span><span style=\"font-weight: bold\">]</span>        │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm3178635 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Bing Lei Li     </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'animation_department'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt1527823'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt1311062'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm11878910</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Wang Yu         </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'animation_department'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt17067176'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt13051266'</span><span style=\"font-weight: bold\">]</span>       │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0878047 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Jack Turpin     </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'animation_department'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt5377482'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0249683'</span><span style=\"font-weight: bold\">]</span>         │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm9844243 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Alaa Alamri     </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'animation_department'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt8426318'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt12326056'</span><span style=\"font-weight: bold\">]</span>        │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm3878112 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Rodney Baker    </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'animation_department'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt1638935'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt1667135'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm10066507</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Matthew Creed   </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'animation_department'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt8881470'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt26342009'</span><span style=\"font-weight: bold\">]</span>        │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm4429144 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Cisko Vandeverre</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'animation_department'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt3104592'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt1908523'</span><span style=\"font-weight: bold\">]</span>         │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm2024311 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Oliver Morales  </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'animation_department'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0477716'</span><span style=\"font-weight: bold\">]</span>                      │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm10216453</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Alister Fell    </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'animation_department'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt9177850'</span><span style=\"font-weight: bold\">]</span>                      │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                        │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                  │\n└────────────┴──────────────────┴──────────────────────────┴────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n## Set operations and sorting\n\nTreating arrays as sets is possible with the\n[`union`](../../reference/expression-collections.qmd#ibis.expr.types.arrays.ArrayValue.union)\nand\n[`intersect`](../../reference/expression-collections.qmd#ibis.expr.types.arrays.ArrayValue.intersect)\nAPIs.\n\nLet's take a look at `intersect`:\n\n### Intersection\n\nLet's see if we can use array intersection to figure which actors share\nknown-for titles and sort the result:\n\n::: {#6a04967e .cell execution_count=13}\n``` {.python .cell-code}\nleft = ents.filter(_.known_for_titles.length() > 0).limit(10_000)\nright = left.view()\nshared_titles = (\n    left\n    .join(right, left.nconst != right.nconst)\n    .select(\n        s.startswith(\"known_for_titles\"),\n        left_name=\"primary_name\",\n        right_name=\"primary_name_right\",\n    )\n    .filter(_.known_for_titles.intersect(_.known_for_titles_right).length() > 0)\n    .group_by(name=\"left_name\")\n    .agg(together_with=_.right_name.collect())\n    .mutate(together_with=_.together_with.unique().sort())\n)\nshared_titles\n```\n\n::: {.cell-output .cell-output-display execution_count=13}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> name                </span>┃<span style=\"font-weight: bold\"> together_with                                    </span>┃\n┡━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>              │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                                    │\n├─────────────────────┼──────────────────────────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Juan Manuel Urtubey</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Adrián Ventura'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Carlos Gallardo'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">6</span><span style=\"font-weight: bold\">]</span>    │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Too Too            </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Hainan Liu'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Zhao Xianfei'</span><span style=\"font-weight: bold\">]</span>                   │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Elizabeth Daughtry </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Angela DiPentima'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Anthony Coard'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span><span style=\"font-weight: bold\">]</span>   │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Marc               </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Ava'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Clint Sanner'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">6</span><span style=\"font-weight: bold\">]</span>                  │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Geoffrey Devereux  </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Rex Chaston'</span><span style=\"font-weight: bold\">]</span>                                  │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Philippe Gandilhon </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Claude Leicher'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Fabrice Leste'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">8</span><span style=\"font-weight: bold\">]</span>      │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Pete Freeman       </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Monica Iken'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Roberta Prisco'</span><span style=\"font-weight: bold\">]</span>                │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Vivian Murray      </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Alice Seifullan'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Andre Lowe'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span><span style=\"font-weight: bold\">]</span>       │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Patrick Bahnken    </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Adele Springsteen'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Alexander Sich'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">73</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Robin Eames        </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Adele Springsteen'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Alexander Sich'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">73</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                   │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                                │\n└─────────────────────┴──────────────────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n## Advanced operations\n\n### Flatten arrays into rows\n\nThanks to the [tireless\nefforts](https://github.com/tobymao/sqlglot/commit/06e0869e7aa5714d77e6ec763da38d6a422965fa)\nof the [folks](https://github.com/tobymao/sqlglot/graphs/contributors) working\non [`sqlglot`](https://github.com/tobymao/sqlglot), as of version 7.0.0 Ibis\nsupports\n[`unnest`](../../reference/expression-collections.qmd#ibis.expr.types.arrays.ArrayValue.unnest)\nfor BigQuery!\n\nYou can use it standalone on a column expression:\n\n::: {#8dd09a8d .cell execution_count=14}\n``` {.python .cell-code}\nents.primary_profession.unnest()\n```\n\n::: {.cell-output .cell-output-display execution_count=14}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> primary_profession </span>┃\n┡━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>             │\n├────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                  │\n└────────────────────┘\n</pre>\n```\n:::\n:::\n\n\nYou can also use it in `select`/`mutate` calls to expand the table accordingly:\n\n::: {#69f0a3df .cell execution_count=15}\n``` {.python .cell-code}\nents.mutate(primary_profession=_.primary_profession.unnest())\n```\n\n::: {.cell-output .cell-output-display execution_count=15}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst    </span>┃<span style=\"font-weight: bold\"> primary_name     </span>┃<span style=\"font-weight: bold\"> primary_profession </span>┃<span style=\"font-weight: bold\"> known_for_titles                   </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>             │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                      │\n├───────────┼──────────────────┼────────────────────┼────────────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7149861</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Max Arnoud      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt3385542'</span><span style=\"font-weight: bold\">]</span>                      │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7165794</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Arnaud Charrin  </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt6441072'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt9120416'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7166580</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Dragoslav Curcin</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4497928'</span><span style=\"font-weight: bold\">]</span>                      │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7172699</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Guillaume Ferrer</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4505204'</span><span style=\"font-weight: bold\">]</span>                      │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7181207</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Lino Vitale     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt2396200'</span><span style=\"font-weight: bold\">]</span>                      │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7183738</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Taia Handlin    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4516616'</span><span style=\"font-weight: bold\">]</span>                      │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7189398</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Attila Gal      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt3414510'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt2442080'</span><span style=\"font-weight: bold\">]</span>         │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7202327</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Leonardo Tadeu  </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4536560'</span><span style=\"font-weight: bold\">]</span>                      │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7213972</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Michael Davis   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4547714'</span><span style=\"font-weight: bold\">]</span>                      │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7215705</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Darryl Daniels  </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4549616'</span><span style=\"font-weight: bold\">]</span>                      │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                  │\n└───────────┴──────────────────┴────────────────────┴────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\nUnnesting can be useful when joining nested data.\n\nHere we use unnest to find people known for any of the godfather movies:\n\n::: {#c668bd07 .cell execution_count=16}\n``` {.python .cell-code}\nbasics = con.tables.title_basics.filter(  # <1>\n    [\n        _.title_type == \"movie\",\n        _.original_title.lower().startswith(\"the godfather\"),\n        _.genres.lower().contains(\"crime\"),\n    ]\n)  # <1>\n\nknown_for_the_godfather = (\n    ents.mutate(tconst=_.known_for_titles.unnest())  # <2>\n    .join(basics, \"tconst\")  # <3>\n    .select(\"primary_title\", \"primary_name\")  # <4>\n    .distinct()\n    .order_by([\"primary_title\", \"primary_name\"]) # <4>\n)\nknown_for_the_godfather\n```\n\n::: {.cell-output .cell-output-display execution_count=16}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> primary_title </span>┃<span style=\"font-weight: bold\"> primary_name        </span>┃\n┡━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>        │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>              │\n├───────────────┼─────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">A. Emmett Adams    </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Abe Vigoda         </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Al Lettieri        </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Al Martino         </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Al Pacino          </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Albert S. Ruddy    </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Alex Rocco         </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Andrea Eastman     </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Angelo Infanti     </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Anna Hill Johnstone</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>             │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                   │\n└───────────────┴─────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n1. Filter the `title_basics` data set to only the Godfather movies\n2. Unnest the `known_for_titles` array column\n3. Join with `basics` to get movie titles\n4. Ensure that each entity is only listed once and sort the results\n\nLet's summarize by showing how many people are known for each Godfather movie:\n\n::: {#a669b2ae .cell execution_count=17}\n``` {.python .cell-code}\nknown_for_the_godfather.primary_title.value_counts()\n```\n\n::: {.cell-output .cell-output-display execution_count=17}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> primary_title          </span>┃<span style=\"font-weight: bold\"> primary_title_count </span>┃\n┡━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                 │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>               │\n├────────────────────────┼─────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather Part II </span> │                 <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">113</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather Part III</span> │                 <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">199</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather         </span> │                  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">97</span> │\n└────────────────────────┴─────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n### Filtering array elements\n\nFiltering array elements can be done with the\n[`filter`](../../reference/expression-collections.qmd#ibis.expr.types.arrays.ArrayValue.filter)\nmethod, which applies a predicate to each array element and returns an array of\nelements for which the predicate returns `True`.\n\nThis method is similar to Python's\n[`filter`](https://docs.python.org/3.7/library/functions.html#filter) function.\n\nLet's show all people who are neither editors nor actors:\n\n::: {#02d2ec3b .cell execution_count=18}\n``` {.python .cell-code}\nents.mutate(\n    primary_profession=_.primary_profession.filter(  # <1>\n        lambda pp: ~pp.isin((\"actor\", \"editor\"))\n    )\n).filter(_.primary_profession.length() > 0)  # <2>\n```\n\n::: {.cell-output .cell-output-display execution_count=18}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst     </span>┃<span style=\"font-weight: bold\"> primary_name          </span>┃<span style=\"font-weight: bold\"> primary_profession       </span>┃<span style=\"font-weight: bold\"> known_for_titles                    </span>┃\n┡━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>            │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                       │\n├────────────┼───────────────────────┼──────────────────────────┼─────────────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm8193687 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Mandl Cho            </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'animation_department'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt5782050'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt5792070'</span><span style=\"font-weight: bold\">]</span>          │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm1894548 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Frederic Cabral      </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'animation_department'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0414853'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0265223'</span><span style=\"font-weight: bold\">]</span>          │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm5810804 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Yukio Narita         </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'animation_department'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt1375678'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt8339440'</span><span style=\"font-weight: bold\">]</span>          │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm6194234 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Noc                  </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'animation_department'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0084904'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt4916874'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>  │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm11022011</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Shea Lawrence        </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'animation_department'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0297607'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt10954022'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm11160130</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Tim Steeman          </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'animation_department'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt11158166'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt21401568'</span><span style=\"font-weight: bold\">]</span>        │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0547493 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Philippe Marin       </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'animation_department'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0071653'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0367288'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>  │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm13967963</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Christopher O'Connell</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'animation_department'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt6283598'</span><span style=\"font-weight: bold\">]</span>                       │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm5216032 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Jorge Cereijo        </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'animation_department'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt2304694'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt3010976'</span><span style=\"font-weight: bold\">]</span>          │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm6381330 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">William Harris       </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'animation_department'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt3916088'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt3621408'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>  │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                        │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                   │\n└────────────┴───────────────────────┴──────────────────────────┴─────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n1. This `filter` call is applied to each array element\n2. This `filter` call is applied to the table\n\n### Applying a function to array elements\n\nYou can apply a function to run an ibis expression on each element of an array\nusing the\n[`map`](../../reference/expression-collections.qmd#ibis.expr.types.arrays.ArrayValue.map)\nmethod.\n\nLet's normalize the case of primary_profession to upper case:\n\n::: {#91efce5b .cell execution_count=19}\n``` {.python .cell-code}\nents.mutate(\n    primary_profession=_.primary_profession.map(lambda pp: pp.upper())\n).filter(_.primary_profession.length() > 0)\n```\n\n::: {.cell-output .cell-output-display execution_count=19}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst    </span>┃<span style=\"font-weight: bold\"> primary_name       </span>┃<span style=\"font-weight: bold\"> primary_profession </span>┃<span style=\"font-weight: bold\"> known_for_titles                   </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>             │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                      │\n├───────────┼────────────────────┼────────────────────┼────────────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7145114</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Andrés León       </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt1831897'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0315638'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7146648</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Eric Hunter       </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4473584'</span><span style=\"font-weight: bold\">]</span>                      │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7162932</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Karsten Wolf      </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4493476'</span><span style=\"font-weight: bold\">]</span>                      │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7189102</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Nagibe Chader     </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt5487218'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt4513020'</span><span style=\"font-weight: bold\">]</span>         │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7213059</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Alberto Tofoletti </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt2333598'</span><span style=\"font-weight: bold\">]</span>                      │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7213261</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Gianni Rojas      </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt2333598'</span><span style=\"font-weight: bold\">]</span>                      │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7219361</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Danny Mendes      </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4553846'</span><span style=\"font-weight: bold\">]</span>                      │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7232029</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Sabin Rich        </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt4568740'</span><span style=\"font-weight: bold\">]</span>                      │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7233638</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Jorge José do Lana</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt1999221'</span><span style=\"font-weight: bold\">]</span>                      │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm7236648</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Joe Mulgrew       </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span><span style=\"font-weight: bold\">]</span>          │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt2318795'</span><span style=\"font-weight: bold\">]</span>                      │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                  │\n└───────────┴────────────────────┴────────────────────┴────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n## Conclusion\n\nIbis has a sizable collection of array APIs that work with many different\nbackends and as of version 7.0.0, Ibis supports a much larger set of those APIs\nfor BigQuery!\n\nCheck out [the API\ndocumentation](../../reference/expression-collections.qmd#ibis.expr.types.arrays.ArrayValue)\nfor the full set of available methods.\n\nTry it out, and let us know what you think.\n\n",
    "supporting": [
      "index_files/figure-html"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}