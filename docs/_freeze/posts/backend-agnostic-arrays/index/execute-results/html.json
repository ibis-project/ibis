{
  "hash": "8e61910a8bd05e2e50367d1206f17b3d",
  "result": {
    "markdown": "---\ntitle: Backend agnostic arrays\nauthor: \"Phillip Cloud\"\ndate: 2024-01-19\ncategories:\n    - arrays\n    - bigquery\n    - blog\n    - cloud\n    - duckdb\n    - portability\n---\n\n## Introduction\n\nThis is a redux of a [previous post](../bigquery-arrays/index.qmd) showing\nIbis's portability in action.\n\nIbis is portable across complex operations and backends of very different\nscales and deployment models!\n\n::: {.callout-note}\n\n## Results differ slightly between BigQuery and DuckDB\n\nThe datasets used in each backend are slightly different.\n\nI opted to avoid ETL for the BigQuery backend by reusing the Google-provided\nIMDB dataset.\n\nThe tradeoff is the slight discrepancy in results.\n:::\n\n## Basics\n\nWe'll start with `from ibis.interactive import *` for maximum convenience.\n\n::: {#0b066bd8 .cell execution_count=1}\n``` {.python .cell-code}\nfrom ibis.interactive import *  # <1>\n```\n:::\n\n\n1. `from ibis.interactive import *` imports Ibis APIs into the global namespace\n   and enables [interactive mode](../../how-to/configure/basics.qmd#interactive-mode).\n\n### Connect to your database\n\n::: {.panel-tabset}\n\n## DuckDB\n\n::: {#7caf0298 .cell execution_count=2}\n``` {.python .cell-code}\nddb = ibis.connect(\"duckdb://\")\nddb.create_table(  # <1>\n    \"name_basics\", ex.imdb_name_basics.fetch(backend=ddb).rename(\"snake_case\")\n)  # <1>\nddb.create_table(  # <2>\n    \"title_basics\", ex.imdb_title_basics.fetch(backend=ddb).rename(\"snake_case\")\n)  # <2>\n```\n\n::: {.cell-output .cell-output-display execution_count=2}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> tconst    </span>┃<span style=\"font-weight: bold\"> title_type </span>┃<span style=\"font-weight: bold\"> primary_title                               </span>┃<span style=\"font-weight: bold\"> original_title                              </span>┃<span style=\"font-weight: bold\"> is_adult </span>┃<span style=\"font-weight: bold\"> start_year </span>┃<span style=\"font-weight: bold\"> end_year </span>┃<span style=\"font-weight: bold\"> runtime_minutes </span>┃<span style=\"font-weight: bold\"> genres                   </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                                      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                                      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>   │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                   │\n├───────────┼────────────┼─────────────────────────────────────────────┼─────────────────────────────────────────────┼──────────┼────────────┼──────────┼─────────────────┼──────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">tt0000001</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">short     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Carmencita                                 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Carmencita                                 </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1894</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Documentary,Short       </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">tt0000002</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">short     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Le clown et ses chiens                     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Le clown et ses chiens                     </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1892</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Animation,Short         </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">tt0000003</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">short     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Pauvre Pierrot                             </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Pauvre Pierrot                             </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1892</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Animation,Comedy,Romance</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">tt0000004</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">short     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Un bon bock                                </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Un bon bock                                </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1892</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │              <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Animation,Short         </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">tt0000005</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">short     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Blacksmith Scene                           </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Blacksmith Scene                           </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1893</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Comedy,Short            </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">tt0000006</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">short     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Chinese Opium Den                          </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Chinese Opium Den                          </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1894</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Short                   </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">tt0000007</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">short     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Corbett and Courtney Before the Kinetograph</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Corbett and Courtney Before the Kinetograph</span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1894</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Short,Sport             </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">tt0000008</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">short     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Edison Kinetoscopic Record of a Sneeze     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Edison Kinetoscopic Record of a Sneeze     </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1894</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Documentary,Short       </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">tt0000009</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">movie     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Miss Jerry                                 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Miss Jerry                                 </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1894</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │              <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">45</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Romance                 </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">tt0000010</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">short     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Leaving the Factory                        </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">La sortie de l'usine Lumière à Lyon        </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1895</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Documentary,Short       </span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                           │        <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │          <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>        │               <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                        │\n└───────────┴────────────┴─────────────────────────────────────────────┴─────────────────────────────────────────────┴──────────┴────────────┴──────────┴─────────────────┴──────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n1. Create a table called `name_basics` in our DuckDB database using `ibis.examples` data\n2. Create a table called `title_basics` in our DuckDB database using `ibis.examples` data\n\n## BigQuery\n\n::: {#399dd705 .cell execution_count=3}\n``` {.python .cell-code}\nbq = ibis.connect(\"bigquery://ibis-gbq\")\nbq.set_database(\"bigquery-public-data.imdb\")  # <1>\n```\n:::\n\n\n1. Google provides a public BigQuery dataset for IMDB data.\n\n:::\n\nLet's pull out the `name_basics` table, which contains names and metadata about\npeople listed on IMDB. We'll call this `ents` (short for `entities`), and remove some\ncolumns we won't need:\n\n::: {.panel-tabset}\n\n## DuckDB\n\n::: {#108c077d .cell execution_count=4}\n``` {.python .cell-code}\nddb_ents = ddb.tables.name_basics.drop(\"birth_year\", \"death_year\")\nddb_ents.order_by(\"nconst\")\n```\n\n::: {.cell-output .cell-output-display execution_count=4}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst    </span>┃<span style=\"font-weight: bold\"> primary_name    </span>┃<span style=\"font-weight: bold\"> primary_profession                  </span>┃<span style=\"font-weight: bold\"> known_for_titles                        </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                              │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                                  │\n├───────────┼─────────────────┼─────────────────────────────────────┼─────────────────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000001</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Fred Astaire   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">soundtrack,actor,miscellaneous     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">tt0053137,tt0072308,tt0045537,tt0050419</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000002</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Lauren Bacall  </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actress,soundtrack                 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">tt0037382,tt0117057,tt0075213,tt0038355</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000003</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Brigitte Bardot</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actress,soundtrack,music_department</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">tt0057345,tt0054452,tt0049189,tt0056404</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000004</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">John Belushi   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor,soundtrack,writer            </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">tt0072562,tt0078723,tt0077975,tt0080455</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000005</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Ingmar Bergman </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">writer,director,actor              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">tt0083922,tt0069467,tt0050976,tt0050986</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000006</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Ingrid Bergman </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actress,soundtrack,producer        </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">tt0038109,tt0036855,tt0034583,tt0038787</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000007</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Humphrey Bogart</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor,soundtrack,producer          </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">tt0037382,tt0034583,tt0042593,tt0043265</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000008</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Marlon Brando  </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor,soundtrack,director          </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">tt0068646,tt0070849,tt0078788,tt0047296</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000009</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Richard Burton </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor,soundtrack,producer          </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">tt0057877,tt0059749,tt0061184,tt0087803</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000010</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">James Cagney   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor,soundtrack,director          </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">tt0042041,tt0035575,tt0029870,tt0031867</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                   │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                       │\n└───────────┴─────────────────┴─────────────────────────────────────┴─────────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n## BigQuery\n\n::: {#9a444397 .cell execution_count=5}\n``` {.python .cell-code}\nbq_ents = bq.tables.name_basics.drop(\"birth_year\", \"death_year\")\nbq_ents.order_by(\"nconst\")\n```\n\n::: {.cell-output .cell-output-display execution_count=5}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst    </span>┃<span style=\"font-weight: bold\"> primary_name    </span>┃<span style=\"font-weight: bold\"> primary_profession                  </span>┃<span style=\"font-weight: bold\"> known_for_titles                        </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                              │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                                  │\n├───────────┼─────────────────┼─────────────────────────────────────┼─────────────────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000001</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Fred Astaire   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">soundtrack,actor,miscellaneous     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">tt0072308,tt0053137,tt0031983,tt0050419</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000002</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Lauren Bacall  </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actress,soundtrack                 </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">tt0038355,tt0075213,tt0117057,tt0037382</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000003</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Brigitte Bardot</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actress,soundtrack,music_department</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">tt0049189,tt0054452,tt0056404,tt0057345</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000004</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">John Belushi   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor,soundtrack,writer            </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">tt0072562,tt0078723,tt0080455,tt0077975</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000005</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Ingmar Bergman </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">writer,director,actor              </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">tt0050976,tt0083922,tt0069467,tt0050986</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000006</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Ingrid Bergman </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actress,soundtrack,producer        </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">tt0034583,tt0038787,tt0038109,tt0036855</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000007</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Humphrey Bogart</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor,soundtrack,producer          </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">tt0037382,tt0043265,tt0034583,tt0042593</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000008</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Marlon Brando  </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor,soundtrack,director          </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">tt0068646,tt0070849,tt0047296,tt0078788</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000009</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Richard Burton </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor,soundtrack,producer          </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">tt0061184,tt0087803,tt0057877,tt0059749</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000010</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">James Cagney   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor,soundtrack,director          </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">tt0042041,tt0029870,tt0031867,tt0035575</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                   │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                       │\n└───────────┴─────────────────┴─────────────────────────────────────┴─────────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n:::\n\n### Splitting strings into arrays\n\nWe can see that `known_for_titles` looks sort of like an array, so let's call\nthe\n[`split`](../../reference/expression-strings.qmd#ibis.expr.types.strings.StringValue.split)\nmethod on that column and replace the existing column:\n\n::: {.panel-tabset}\n\n## DuckDB\n\n::: {#337dbe6a .cell execution_count=6}\n``` {.python .cell-code}\nddb_ents = ddb_ents.mutate(known_for_titles=_.known_for_titles.split(\",\"))\nddb_ents.order_by(\"nconst\")\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst    </span>┃<span style=\"font-weight: bold\"> primary_name    </span>┃<span style=\"font-weight: bold\"> primary_profession                  </span>┃<span style=\"font-weight: bold\"> known_for_titles                   </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                              │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                      │\n├───────────┼─────────────────┼─────────────────────────────────────┼────────────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000001</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Fred Astaire   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">soundtrack,actor,miscellaneous     </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0053137'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0072308'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000002</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Lauren Bacall  </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actress,soundtrack                 </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0037382'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0117057'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000003</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Brigitte Bardot</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actress,soundtrack,music_department</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0057345'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0054452'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000004</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">John Belushi   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor,soundtrack,writer            </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0072562'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0078723'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000005</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Ingmar Bergman </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">writer,director,actor              </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0083922'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0069467'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000006</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Ingrid Bergman </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actress,soundtrack,producer        </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0038109'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0036855'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000007</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Humphrey Bogart</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor,soundtrack,producer          </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0037382'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0034583'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000008</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Marlon Brando  </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor,soundtrack,director          </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0068646'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0070849'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000009</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Richard Burton </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor,soundtrack,producer          </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0057877'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0059749'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000010</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">James Cagney   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor,soundtrack,director          </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0042041'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0035575'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                   │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                  │\n└───────────┴─────────────────┴─────────────────────────────────────┴────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n## BigQuery\n\n::: {#bb1ea1fe .cell execution_count=7}\n``` {.python .cell-code}\nbq_ents = bq_ents.mutate(known_for_titles=_.known_for_titles.split(\",\"))\nbq_ents.order_by(\"nconst\")\n```\n\n::: {.cell-output .cell-output-display execution_count=7}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst    </span>┃<span style=\"font-weight: bold\"> primary_name    </span>┃<span style=\"font-weight: bold\"> primary_profession                  </span>┃<span style=\"font-weight: bold\"> known_for_titles                   </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                              │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                      │\n├───────────┼─────────────────┼─────────────────────────────────────┼────────────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000001</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Fred Astaire   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">soundtrack,actor,miscellaneous     </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0072308'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0053137'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000002</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Lauren Bacall  </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actress,soundtrack                 </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0038355'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0075213'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000003</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Brigitte Bardot</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actress,soundtrack,music_department</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0049189'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0054452'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000004</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">John Belushi   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor,soundtrack,writer            </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0072562'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0078723'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000005</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Ingmar Bergman </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">writer,director,actor              </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0050976'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0083922'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000006</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Ingrid Bergman </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actress,soundtrack,producer        </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0034583'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0038787'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000007</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Humphrey Bogart</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor,soundtrack,producer          </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0037382'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0043265'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000008</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Marlon Brando  </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor,soundtrack,director          </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0068646'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0070849'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000009</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Richard Burton </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor,soundtrack,producer          </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0061184'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0087803'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000010</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">James Cagney   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor,soundtrack,director          </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0042041'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0029870'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                   │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                  │\n└───────────┴─────────────────┴─────────────────────────────────────┴────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n:::\n\nSimilarly for `primary_profession`, since people involved in show business often\nhave more than one responsibility on a project:\n\n::: {.panel-tabset}\n\n## DuckDB\n\n::: {#bf33447a .cell execution_count=8}\n``` {.python .cell-code}\nddb_ents = ddb_ents.mutate(primary_profession=_.primary_profession.split(\",\"))\n```\n:::\n\n\n## BigQuery\n\n::: {#eea20c44 .cell execution_count=9}\n``` {.python .cell-code}\nbq_ents = bq_ents.mutate(primary_profession=_.primary_profession.split(\",\"))\n```\n:::\n\n\n:::\n\n### Array length\n\nLet's see how many titles each entity is known for, and then show the five\npeople with the largest number of titles they're known for.\n\nThis is computed using the\n[`length`](../../reference/expression-collections.qmd#ibis.expr.types.arrays.ArrayValue.length)\nAPI on array expressions:\n\n::: {.panel-tabset}\n\n## DuckDB\n\n::: {#5f0b413d .cell execution_count=10}\n``` {.python .cell-code}\n(\n    ddb_ents.select(\"primary_name\", num_titles=_.known_for_titles.length())\n    .order_by(_.num_titles.desc())\n    .limit(5)\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=10}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> primary_name     </span>┃<span style=\"font-weight: bold\"> num_titles </span>┃\n┡━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>      │\n├──────────────────┼────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Alex Koenigsmark</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Carrie Schnelker</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Henry Townsend  </span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Sally Sun       </span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Matthew Kavuma  </span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span> │\n└──────────────────┴────────────┘\n</pre>\n```\n:::\n:::\n\n\n## BigQuery\n\n::: {#056cde90 .cell execution_count=11}\n``` {.python .cell-code}\n(\n    bq_ents.select(\"primary_name\", num_titles=_.known_for_titles.length())\n    .order_by(_.num_titles.desc())\n    .limit(5)\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=11}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> primary_name        </span>┃<span style=\"font-weight: bold\"> num_titles </span>┃\n┡━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>              │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>      │\n├─────────────────────┼────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">José Jaime Espinosa</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">6</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Paul Winter        </span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">6</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Nicolas Bernier    </span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">6</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Chris Estrada      </span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">6</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Tsuyotake Matsuda  </span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span> │\n└─────────────────────┴────────────┘\n</pre>\n```\n:::\n:::\n\n\n:::\n\nIt seems like the length of the `known_for_titles` might be capped at some small number!\n\n### Index\n\nWe can see the position of `\"actor\"` or `\"actress\"` in `primary_profession`s:\n\n::: {.panel-tabset}\n\n## DuckDB\n\n::: {#cbc557e3 .cell execution_count=12}\n``` {.python .cell-code}\nddb_ents.primary_profession.index(\"actor\")\n```\n\n::: {.cell-output .cell-output-display execution_count=12}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> ArrayPosition(primary_profession, 'actor') </span>┃\n┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>                                      │\n├────────────────────────────────────────────┤\n│                                          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │\n│                                          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span> │\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │\n│                                          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │\n│                                          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │\n│                                          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │\n│                                          <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │\n└────────────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n::: {#3eb36d0b .cell execution_count=13}\n``` {.python .cell-code}\nddb_ents.primary_profession.index(\"actress\")\n```\n\n::: {.cell-output .cell-output-display execution_count=13}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> ArrayPosition(primary_profession, 'actress') </span>┃\n┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>                                        │\n├──────────────────────────────────────────────┤\n│                                           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │\n│                                            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │\n│                                           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │\n│                                           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                            <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │\n└──────────────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n## BigQuery\n\n::: {#7efe2a42 .cell execution_count=14}\n``` {.python .cell-code}\nbq_ents.primary_profession.index(\"actor\")\n```\n\n::: {.cell-output .cell-output-display execution_count=14}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> ArrayPosition(primary_profession, 'actor') </span>┃\n┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>                                      │\n├────────────────────────────────────────────┤\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                          <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │\n└────────────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n::: {#909e212d .cell execution_count=15}\n``` {.python .cell-code}\nbq_ents.primary_profession.index(\"actress\")\n```\n\n::: {.cell-output .cell-output-display execution_count=15}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> ArrayPosition(primary_profession, 'actress') </span>┃\n┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>                                        │\n├──────────────────────────────────────────────┤\n│                                           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-1</span> │\n│                                            <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │\n└──────────────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n:::\n\nA return value of `-1` indicates that `\"actor\"` is not present in the value.\n\nLet's look for entities that are not primarily actors.\n\nWe can do this using the\n[`index`](../../reference/expression-collections.qmd#ibis.expr.types.arrays.ArrayValue.index)\nmethod by checking whether the positions of the strings `\"actor\"` or\n`\"actress\"` are both greater than 0:\n\n::: {.panel-tabset}\n\n## DuckDB\n\n::: {#96ef0c2b .cell execution_count=16}\n``` {.python .cell-code}\nactor_index = ddb_ents.primary_profession.index(\"actor\")\nactress_index = ddb_ents.primary_profession.index(\"actress\")\n\nddb_not_primarily_acting = (actor_index > 0) & (actress_index > 0)\nddb_not_primarily_acting.mean()\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"></pre>\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=16}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-cyan-fg ansi-bold\">0.0</span></pre>\n```\n:::\n\n:::\n:::\n\n\n## BigQuery\n\n::: {#e10553cc .cell execution_count=17}\n``` {.python .cell-code}\nactor_index = bq_ents.primary_profession.index(\"actor\")\nactress_index = bq_ents.primary_profession.index(\"actress\")\n\nbq_not_primarily_acting = (actor_index > 0) & (actress_index > 0)\nbq_not_primarily_acting.mean()\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"></pre>\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=17}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-cyan-fg ansi-bold\">0.0</span></pre>\n```\n:::\n\n:::\n:::\n\n\n:::\n\nWho are they?\n\n::: {.panel-tabset}\n\n## DuckDB\n\n::: {#a4243c7c .cell execution_count=18}\n``` {.python .cell-code}\nddb_ents[ddb_not_primarily_acting].order_by(\"nconst\")\n```\n\n::: {.cell-output .cell-output-display execution_count=18}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst </span>┃<span style=\"font-weight: bold\"> primary_name </span>┃<span style=\"font-weight: bold\"> primary_profession </span>┃<span style=\"font-weight: bold\"> known_for_titles </span>┃\n┡━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>    │\n└────────┴──────────────┴────────────────────┴──────────────────┘\n</pre>\n```\n:::\n:::\n\n\n## BigQuery\n\n::: {#40b5ad2f .cell execution_count=19}\n``` {.python .cell-code}\nbq_ents[bq_not_primarily_acting].order_by(\"nconst\")\n```\n\n::: {.cell-output .cell-output-display execution_count=19}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst </span>┃<span style=\"font-weight: bold\"> primary_name </span>┃<span style=\"font-weight: bold\"> primary_profession </span>┃<span style=\"font-weight: bold\"> known_for_titles </span>┃\n┡━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>    │\n└────────┴──────────────┴────────────────────┴──────────────────┘\n</pre>\n```\n:::\n:::\n\n\n:::\n\nIt's not 100% clear whether the order of elements in `primary_profession` matters here.\n\n### Containment\n\nWe can get people who are listed as actors or actresses using `contains`:\n\n::: {.panel-tabset}\n\n## DuckDB\n\n::: {#db2f9479 .cell execution_count=20}\n``` {.python .cell-code}\nddb_non_actors = bq_ents[\n    ~_.primary_profession.contains(\"actor\") & ~_.primary_profession.contains(\"actress\")\n]\nddb_non_actors.order_by(\"nconst\")\n```\n\n::: {.cell-output .cell-output-display execution_count=20}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst    </span>┃<span style=\"font-weight: bold\"> primary_name     </span>┃<span style=\"font-weight: bold\"> primary_profession                         </span>┃<span style=\"font-weight: bold\"> known_for_titles                   </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                              │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                      │\n├───────────┼──────────────────┼────────────────────────────────────────────┼────────────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000016</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Georges Delerue </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'composer'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt8847712'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0091763'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000025</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Jerry Goldsmith </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'music_department'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0077269'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0117731'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000033</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Alfred Hitchcock</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'director'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'producer'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>           │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0054215'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0052357'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000035</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">James Horner    </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'music_department'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0177971'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0120338'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000040</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Stanley Kubrick </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'director'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'writer'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>             │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0120663'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0066921'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000041</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Akira Kurosawa  </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'writer'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'director'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>             │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0080979'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0089881'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000049</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Henry Mancini   </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'music_department'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0383216'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0054698'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000055</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Alfred Newman   </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'music_department'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'composer'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>   │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0049408'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0434409'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000065</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Nino Rota       </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'composer'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0071562'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0056801'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000067</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Miklós Rózsa    </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'music_department'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'composer'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>   │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0052618'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0038109'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                  │\n└───────────┴──────────────────┴────────────────────────────────────────────┴────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n## BigQuery\n\n::: {#9fb71b70 .cell execution_count=21}\n``` {.python .cell-code}\nbq_non_actors = bq_ents[\n    ~_.primary_profession.contains(\"actor\") & ~_.primary_profession.contains(\"actress\")\n]\nbq_non_actors.order_by(\"nconst\")\n```\n\n::: {.cell-output .cell-output-display execution_count=21}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst    </span>┃<span style=\"font-weight: bold\"> primary_name     </span>┃<span style=\"font-weight: bold\"> primary_profession                         </span>┃<span style=\"font-weight: bold\"> known_for_titles                   </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                              │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                      │\n├───────────┼──────────────────┼────────────────────────────────────────────┼────────────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000016</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Georges Delerue </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'composer'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt8847712'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0091763'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000025</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Jerry Goldsmith </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'music_department'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0077269'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0117731'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000033</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Alfred Hitchcock</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'director'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'producer'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>           │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0054215'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0052357'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000035</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">James Horner    </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'music_department'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0177971'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0120338'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000040</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Stanley Kubrick </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'director'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'writer'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>             │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0120663'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0066921'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000041</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Akira Kurosawa  </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'writer'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'director'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>             │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0080979'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0089881'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000049</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Henry Mancini   </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'music_department'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0383216'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0054698'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000055</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Alfred Newman   </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'music_department'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'composer'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>   │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0049408'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0434409'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000065</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Nino Rota       </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'composer'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0071562'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0056801'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000067</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Miklós Rózsa    </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'music_department'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'composer'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>   │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0052618'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0038109'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                  │\n└───────────┴──────────────────┴────────────────────────────────────────────┴────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n:::\n\n### Element removal\n\nWe can remove elements from arrays too.\n\n::: {.callout-note}\n## [`remove()`](../../reference/expression-collections.qmd#ibis.expr.types.arrays.ArrayValue.remove) does not mutate the underlying data\n:::\n\nLet's see who only has \"actor\" in the list of their primary professions:\n\n::: {.panel-tabset}\n\n## DuckDB\n\n::: {#551005a1 .cell execution_count=22}\n``` {.python .cell-code}\nddb_ents.filter(\n    [\n        _.primary_profession.length() > 0,\n        _.primary_profession.remove(\"actor\").length() == 0,\n        _.primary_profession.remove(\"actress\").length() == 0,\n    ]\n).order_by(\"nconst\")\n```\n\n::: {.cell-output .cell-output-display execution_count=22}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst </span>┃<span style=\"font-weight: bold\"> primary_name </span>┃<span style=\"font-weight: bold\"> primary_profession </span>┃<span style=\"font-weight: bold\"> known_for_titles </span>┃\n┡━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>    │\n└────────┴──────────────┴────────────────────┴──────────────────┘\n</pre>\n```\n:::\n:::\n\n\n## BigQuery\n\n::: {#6b4f941c .cell execution_count=23}\n``` {.python .cell-code}\nbq_ents.filter(\n    [\n        _.primary_profession.length() > 0,\n        _.primary_profession.remove(\"actor\").length() == 0,\n        _.primary_profession.remove(\"actress\").length() == 0,\n    ]\n).order_by(\"nconst\")\n```\n\n::: {.cell-output .cell-output-display execution_count=23}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst </span>┃<span style=\"font-weight: bold\"> primary_name </span>┃<span style=\"font-weight: bold\"> primary_profession </span>┃<span style=\"font-weight: bold\"> known_for_titles </span>┃\n┡━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>    │\n└────────┴──────────────┴────────────────────┴──────────────────┘\n</pre>\n```\n:::\n:::\n\n\n:::\n\n### Slicing with square-bracket syntax\n\nLet's remove everyone's first profession from the list, but only if they have\nmore than one profession listed:\n\n::: {.panel-tabset}\n\n## DuckDB\n\n::: {#7751efa4 .cell execution_count=24}\n``` {.python .cell-code}\nddb_ents[_.primary_profession.length() > 1].mutate(\n    primary_profession=_.primary_profession[1:],\n).order_by(\"nconst\")\n```\n\n::: {.cell-output .cell-output-display execution_count=24}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst    </span>┃<span style=\"font-weight: bold\"> primary_name    </span>┃<span style=\"font-weight: bold\"> primary_profession                 </span>┃<span style=\"font-weight: bold\"> known_for_titles                   </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                      │\n├───────────┼─────────────────┼────────────────────────────────────┼────────────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000001</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Fred Astaire   </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'miscellaneous'</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0053137'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0072308'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000002</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Lauren Bacall  </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span><span style=\"font-weight: bold\">]</span>                     │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0037382'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0117057'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000003</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Brigitte Bardot</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'music_department'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0057345'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0054452'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000004</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">John Belushi   </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'writer'</span><span style=\"font-weight: bold\">]</span>           │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0072562'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0078723'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000005</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Ingmar Bergman </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'director'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span>              │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0083922'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0069467'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000006</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Ingrid Bergman </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'producer'</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0038109'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0036855'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000007</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Humphrey Bogart</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'producer'</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0037382'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0034583'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000008</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Marlon Brando  </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'director'</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0068646'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0070849'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000009</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Richard Burton </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'producer'</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0057877'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0059749'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000010</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">James Cagney   </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'director'</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0042041'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0035575'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                  │\n└───────────┴─────────────────┴────────────────────────────────────┴────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n## BigQuery\n\n::: {#295ffc5a .cell execution_count=25}\n``` {.python .cell-code}\nbq_ents[_.primary_profession.length() > 1].mutate(\n    primary_profession=_.primary_profession[1:],\n).order_by(\"nconst\")\n```\n\n::: {.cell-output .cell-output-display execution_count=25}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst    </span>┃<span style=\"font-weight: bold\"> primary_name    </span>┃<span style=\"font-weight: bold\"> primary_profession                 </span>┃<span style=\"font-weight: bold\"> known_for_titles                   </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                      │\n├───────────┼─────────────────┼────────────────────────────────────┼────────────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000001</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Fred Astaire   </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'miscellaneous'</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0072308'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0053137'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000002</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Lauren Bacall  </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span><span style=\"font-weight: bold\">]</span>                     │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0038355'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0075213'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000003</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Brigitte Bardot</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'music_department'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0049189'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0054452'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000004</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">John Belushi   </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'writer'</span><span style=\"font-weight: bold\">]</span>           │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0072562'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0078723'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000005</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Ingmar Bergman </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'director'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'actor'</span><span style=\"font-weight: bold\">]</span>              │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0050976'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0083922'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000006</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Ingrid Bergman </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'producer'</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0034583'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0038787'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000007</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Humphrey Bogart</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'producer'</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0037382'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0043265'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000008</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Marlon Brando  </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'director'</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0068646'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0070849'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000009</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Richard Burton </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'producer'</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0061184'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0087803'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000010</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">James Cagney   </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'director'</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0042041'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0029870'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                  │\n└───────────┴─────────────────┴────────────────────────────────────┴────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n:::\n\n## Set operations and sorting\n\nTreating arrays as sets is possible with the\n[`union`](../../reference/expression-collections.qmd#ibis.expr.types.arrays.ArrayValue.union)\nand\n[`intersect`](../../reference/expression-collections.qmd#ibis.expr.types.arrays.ArrayValue.intersect)\nAPIs.\n\nLet's take a look at `intersect`.\n\n### Intersection\n\nLet's see if we can use array intersection to figure which actors share\nknown-for titles and sort the result:\n\n::: {.panel-tabset}\n\n## DuckDB\n\n::: {#1d68e19a .cell execution_count=26}\n``` {.python .cell-code}\nleft = ddb_ents.filter(_.known_for_titles.length() > 0).limit(10_000)\nright = left.view()\nshared_titles = (\n    left\n    .join(right, left.nconst != right.nconst)\n    .select(\n        s.startswith(\"known_for_titles\"),\n        left_name=\"primary_name\",\n        right_name=\"primary_name_right\",\n    )\n    .filter(_.known_for_titles.intersect(_.known_for_titles_right).length() > 0)\n    .group_by(name=\"left_name\")\n    .agg(together_with=_.right_name.collect())\n    .mutate(together_with=_.together_with.unique().sort())\n)\nshared_titles\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<script type=\"application/vnd.jupyter.widget-view+json\">\n{\"model_id\":\"cb46ead42abf4f4684b5f9b2fa75b2ed\",\"version_major\":2,\"version_minor\":0,\"quarto_mimetype\":\"application/vnd.jupyter.widget-view+json\"}\n</script>\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=26}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> name                 </span>┃<span style=\"font-weight: bold\"> together_with                                 </span>┃\n┡━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                                 │\n├──────────────────────┼───────────────────────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Ava Gardner         </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Ernest Gold'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Fred Astaire'</span><span style=\"font-weight: bold\">]</span>               │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Cyd Charisse        </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Fred Astaire'</span><span style=\"font-weight: bold\">]</span>                              │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">John Landis         </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Dan Aykroyd'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Dick Ziker'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">14</span><span style=\"font-weight: bold\">]</span>        │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Michael Curtiz      </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Alan Hale'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Ann Blyth'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">19</span><span style=\"font-weight: bold\">]</span>           │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Francis Ford Coppola</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Abe Vigoda'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Al Pacino'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">19</span><span style=\"font-weight: bold\">]</span>          │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Bernardo Bertolucci </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Armand Abplanalp'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'James Acheson'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Karl Malden         </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Abraxas Aaran'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Alex North'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">14</span><span style=\"font-weight: bold\">]</span>      │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Richard Conte       </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Abe Vigoda'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Al Pacino'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">9</span><span style=\"font-weight: bold\">]</span>           │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">George Orwell       </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'John Hurt'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Richard Burton'</span><span style=\"font-weight: bold\">]</span>               │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Joseph L. Mankiewicz</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Alfred Newman'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Anne Baxter'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">13</span><span style=\"font-weight: bold\">]</span>     │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                             │\n└──────────────────────┴───────────────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n## BigQuery\n\n::: {#ecaee965 .cell execution_count=27}\n``` {.python .cell-code}\nleft = bq_ents.filter(_.known_for_titles.length() > 0).limit(10_000)\nright = left.view()\nshared_titles = (\n    left\n    .join(right, left.nconst != right.nconst)\n    .select(\n        s.startswith(\"known_for_titles\"),\n        left_name=\"primary_name\",\n        right_name=\"primary_name_right\",\n    )\n    .filter(_.known_for_titles.intersect(_.known_for_titles_right).length() > 0)\n    .group_by(name=\"left_name\")\n    .agg(together_with=_.right_name.collect())\n    .mutate(together_with=_.together_with.unique().sort())\n)\nshared_titles\n```\n\n::: {.cell-output .cell-output-display execution_count=27}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> name                    </span>┃<span style=\"font-weight: bold\"> together_with                                       </span>┃\n┡━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                                       │\n├─────────────────────────┼─────────────────────────────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Pavel Vrba             </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'F.C. Lokomotiv Moscow'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Jeffrey Bruma'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4</span><span style=\"font-weight: bold\">]</span>  │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Greg Carrolan          </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Al Cambronne'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Alana Tornello'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">20</span><span style=\"font-weight: bold\">]</span>         │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Aleksander Parzychowski</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Adam Korszun'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Grzegorz Wawrzenczyk'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span><span style=\"font-weight: bold\">]</span>    │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">James Walt             </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Anton Testino'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Ben Walanka'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">10</span><span style=\"font-weight: bold\">]</span>           │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Ellen Dallaglio        </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Antonia Giovanazzi'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Fra McCann'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">10</span><span style=\"font-weight: bold\">]</span>       │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Catarina Martins       </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Miguel Oliveira'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Ricardo Gordon'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>       │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Stanislav Sesták       </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Martin Glenn'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Miso Brecko'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">6</span><span style=\"font-weight: bold\">]</span>             │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Allison Cabot          </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Brenda Beard'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Brian Fenmore'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">16</span><span style=\"font-weight: bold\">]</span>          │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Vasilis Bouzianas      </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Aggelos Kasolas'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Christos Patriarheas'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Marie Muldoon          </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'Alan Oxley'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'Andrew Raeber'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">39</span><span style=\"font-weight: bold\">]</span>            │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                                   │\n└─────────────────────────┴─────────────────────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n:::\n\n## Advanced operations\n\n### Flatten arrays into rows\n\nThanks to the [tireless\nefforts](https://github.com/tobymao/sqlglot/commit/06e0869e7aa5714d77e6ec763da38d6a422965fa)\nof the [folks](https://github.com/tobymao/sqlglot/graphs/contributors) working\non [`sqlglot`](https://github.com/tobymao/sqlglot), as of version 7.0.0 Ibis\nsupports\n[`unnest`](../../reference/expression-collections.qmd#ibis.expr.types.arrays.ArrayValue.unnest)\nfor BigQuery!\n\nYou can use it standalone on a column expression:\n\n::: {.panel-tabset}\n\n## DuckDB\n\n::: {#e5f62712 .cell execution_count=28}\n``` {.python .cell-code}\nddb_ents.primary_profession.unnest()\n```\n\n::: {.cell-output .cell-output-display execution_count=28}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> primary_profession </span>┃\n┡━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>             │\n├────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">soundtrack        </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">miscellaneous     </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actress           </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">soundtrack        </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actress           </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">soundtrack        </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">music_department  </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">soundtrack        </span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                  │\n└────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n## BigQuery\n\n::: {#39a19645 .cell execution_count=29}\n``` {.python .cell-code}\nbq_ents.primary_profession.unnest()\n```\n\n::: {.cell-output .cell-output-display execution_count=29}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> primary_profession </span>┃\n┡━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>             │\n├────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                  │\n└────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n:::\n\nYou can also use it in `select`/`mutate` calls to expand the table accordingly:\n\n::: {.panel-tabset}\n\n## DuckDB\n\n::: {#bd167fb0 .cell execution_count=30}\n``` {.python .cell-code}\nddb_ents.mutate(primary_profession=_.primary_profession.unnest()).order_by(\"nconst\")\n```\n\n::: {.cell-output .cell-output-display execution_count=30}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst    </span>┃<span style=\"font-weight: bold\"> primary_name    </span>┃<span style=\"font-weight: bold\"> primary_profession </span>┃<span style=\"font-weight: bold\"> known_for_titles                   </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>             │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                      │\n├───────────┼─────────────────┼────────────────────┼────────────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000001</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Fred Astaire   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">soundtrack        </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0053137'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0072308'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000001</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Fred Astaire   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">miscellaneous     </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0053137'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0072308'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000001</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Fred Astaire   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0053137'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0072308'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000002</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Lauren Bacall  </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">soundtrack        </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0037382'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0117057'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000002</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Lauren Bacall  </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actress           </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0037382'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0117057'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000003</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Brigitte Bardot</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">music_department  </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0057345'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0054452'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000003</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Brigitte Bardot</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">soundtrack        </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0057345'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0054452'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000003</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Brigitte Bardot</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actress           </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0057345'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0054452'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000004</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">John Belushi   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">soundtrack        </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0072562'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0078723'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000004</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">John Belushi   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">writer            </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0072562'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0078723'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                  │\n└───────────┴─────────────────┴────────────────────┴────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n## BigQuery\n\n::: {#419d71fd .cell execution_count=31}\n``` {.python .cell-code}\nbq_ents.mutate(primary_profession=_.primary_profession.unnest()).order_by(\"nconst\")\n```\n\n::: {.cell-output .cell-output-display execution_count=31}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst    </span>┃<span style=\"font-weight: bold\"> primary_name    </span>┃<span style=\"font-weight: bold\"> primary_profession </span>┃<span style=\"font-weight: bold\"> known_for_titles                   </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>             │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                      │\n├───────────┼─────────────────┼────────────────────┼────────────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000001</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Fred Astaire   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">miscellaneous     </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0072308'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0053137'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000001</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Fred Astaire   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0072308'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0053137'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000001</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Fred Astaire   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">soundtrack        </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0072308'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0053137'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000002</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Lauren Bacall  </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actress           </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0038355'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0075213'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000002</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Lauren Bacall  </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">soundtrack        </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0038355'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0075213'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000003</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Brigitte Bardot</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">music_department  </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0049189'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0054452'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000003</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Brigitte Bardot</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">soundtrack        </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0049189'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0054452'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000003</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Brigitte Bardot</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actress           </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0049189'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0054452'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000004</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">John Belushi   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">soundtrack        </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0072562'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0078723'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000004</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">John Belushi   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">actor             </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0072562'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0078723'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                  │\n└───────────┴─────────────────┴────────────────────┴────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n:::\n\nUnnesting can be useful when joining nested data.\n\nHere we use unnest to find people known for any of the godfather movies:\n\n::: {.panel-tabset}\n\n## DuckDB\n\n::: {#3bc2513c .cell execution_count=32}\n``` {.python .cell-code}\nbasics = ddb.tables.title_basics.filter(  # <1>\n    [\n        _.title_type == \"movie\",\n        _.original_title.lower().startswith(\"the godfather\"),\n        _.genres.lower().contains(\"crime\"),\n    ]\n)  # <1>\n\nddb_known_for_the_godfather = (\n    ddb_ents.mutate(tconst=_.known_for_titles.unnest())  # <2>\n    .join(basics, \"tconst\")  # <3>\n    .select(\"primary_title\", \"primary_name\")  # <4>\n    .distinct()\n    .order_by([\"primary_title\", \"primary_name\"]) # <4>\n)\nddb_known_for_the_godfather\n```\n\n::: {.cell-output .cell-output-display execution_count=32}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> primary_title </span>┃<span style=\"font-weight: bold\"> primary_name        </span>┃\n┡━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>        │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>              │\n├───────────────┼─────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">A. Emmett Adams    </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Abe Vigoda         </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Al Lettieri        </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Al Martino         </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Al Pacino          </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Albert S. Ruddy    </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Alex Rocco         </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Andrea Eastman     </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Angelo Infanti     </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Anna Hill Johnstone</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>             │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                   │\n└───────────────┴─────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n1. Filter the `title_basics` data set to only the Godfather movies\n2. Unnest the `known_for_titles` array column\n3. Join with `basics` to get movie titles\n4. Ensure that each entity is only listed once and sort the results\n\n## BigQuery\n\n::: {#3f9231e0 .cell execution_count=33}\n``` {.python .cell-code}\nbasics = bq.tables.title_basics.filter(  # <1>\n    [\n        _.title_type == \"movie\",\n        _.original_title.lower().startswith(\"the godfather\"),\n        _.genres.lower().contains(\"crime\"),\n    ]\n)  # <1>\n\nbq_known_for_the_godfather = (\n    bq_ents.mutate(tconst=_.known_for_titles.unnest())  # <2>\n    .join(basics, \"tconst\")  # <3>\n    .select(\"primary_title\", \"primary_name\")  # <4>\n    .distinct()\n    .order_by([\"primary_title\", \"primary_name\"]) # <4>\n)\nbq_known_for_the_godfather\n```\n\n::: {.cell-output .cell-output-display execution_count=33}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> primary_title </span>┃<span style=\"font-weight: bold\"> primary_name        </span>┃\n┡━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>        │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>              │\n├───────────────┼─────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">A. Emmett Adams    </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Abe Vigoda         </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Al Lettieri        </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Al Martino         </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Al Pacino          </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Albert S. Ruddy    </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Alex Rocco         </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Andrea Eastman     </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Angelo Infanti     </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Anna Hill Johnstone</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>             │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                   │\n└───────────────┴─────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n1. Filter the `title_basics` data set to only the Godfather movies\n2. Unnest the `known_for_titles` array column\n3. Join with `basics` to get movie titles\n4. Ensure that each entity is only listed once and sort the results\n\n:::\n\nLet's summarize by showing how many people are known for each Godfather movie:\n\n::: {.panel-tabset}\n\n## DuckDB\n\n::: {#eb030865 .cell execution_count=34}\n``` {.python .cell-code}\nddb_known_for_the_godfather.primary_title.value_counts()\n```\n\n::: {.cell-output .cell-output-display execution_count=34}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> primary_title          </span>┃<span style=\"font-weight: bold\"> primary_title_count </span>┃\n┡━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                 │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>               │\n├────────────────────────┼─────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather Part II </span> │                 <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">117</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather         </span> │                  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">93</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather Part III</span> │                 <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">196</span> │\n└────────────────────────┴─────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n## BigQuery\n\n::: {#4786c6f4 .cell execution_count=35}\n``` {.python .cell-code}\nbq_known_for_the_godfather.primary_title.value_counts()\n```\n\n::: {.cell-output .cell-output-display execution_count=35}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> primary_title          </span>┃<span style=\"font-weight: bold\"> primary_title_count </span>┃\n┡━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                 │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>               │\n├────────────────────────┼─────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather Part II </span> │                 <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">114</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather Part III</span> │                 <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">202</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather         </span> │                  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">97</span> │\n└────────────────────────┴─────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n:::\n\n### Filtering array elements\n\nFiltering array elements can be done with the\n[`filter`](../../reference/expression-collections.qmd#ibis.expr.types.arrays.ArrayValue.filter)\nmethod, which applies a predicate to each array element and returns an array of\nelements for which the predicate returns `True`.\n\nThis method is similar to Python's\n[`filter`](https://docs.python.org/3.7/library/functions.html#filter) function.\n\nLet's show all people who are neither editors nor actors:\n\n::: {.panel-tabset}\n\n## DuckDB\n\n::: {#d8bdd118 .cell execution_count=36}\n``` {.python .cell-code}\nddb_ents.mutate(\n    primary_profession=_.primary_profession.filter(  # <1>\n        lambda pp: ~pp.isin((\"actor\", \"actress\", \"editor\"))\n    )\n).filter(_.primary_profession.length() > 0).order_by(\"nconst\")  # <2>\n```\n\n::: {.cell-output .cell-output-display execution_count=36}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst    </span>┃<span style=\"font-weight: bold\"> primary_name    </span>┃<span style=\"font-weight: bold\"> primary_profession                 </span>┃<span style=\"font-weight: bold\"> known_for_titles                   </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                      │\n├───────────┼─────────────────┼────────────────────────────────────┼────────────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000001</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Fred Astaire   </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'miscellaneous'</span><span style=\"font-weight: bold\">]</span>    │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0053137'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0072308'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000002</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Lauren Bacall  </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span><span style=\"font-weight: bold\">]</span>                     │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0037382'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0117057'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000003</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Brigitte Bardot</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'music_department'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0057345'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0054452'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000004</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">John Belushi   </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'writer'</span><span style=\"font-weight: bold\">]</span>           │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0072562'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0078723'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000005</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Ingmar Bergman </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'writer'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'director'</span><span style=\"font-weight: bold\">]</span>             │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0083922'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0069467'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000006</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Ingrid Bergman </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'producer'</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0038109'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0036855'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000007</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Humphrey Bogart</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'producer'</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0037382'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0034583'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000008</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Marlon Brando  </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'director'</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0068646'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0070849'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000009</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Richard Burton </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'producer'</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0057877'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0059749'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000010</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">James Cagney   </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'director'</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0042041'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0035575'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                  │\n└───────────┴─────────────────┴────────────────────────────────────┴────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n1. This `filter` call is applied to each array element\n2. This `filter` call is applied to the table\n\n## BigQuery\n\n::: {#1ad9065c .cell execution_count=37}\n``` {.python .cell-code}\nbq_ents.mutate(\n    primary_profession=_.primary_profession.filter(  # <1>\n        lambda pp: ~pp.isin((\"actor\", \"actress\", \"editor\"))\n    )\n).filter(_.primary_profession.length() > 0).order_by(\"nconst\")  # <2>\n```\n\n::: {.cell-output .cell-output-display execution_count=37}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst    </span>┃<span style=\"font-weight: bold\"> primary_name    </span>┃<span style=\"font-weight: bold\"> primary_profession                 </span>┃<span style=\"font-weight: bold\"> known_for_titles                   </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                      │\n├───────────┼─────────────────┼────────────────────────────────────┼────────────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000001</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Fred Astaire   </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'miscellaneous'</span><span style=\"font-weight: bold\">]</span>    │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0072308'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0053137'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000002</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Lauren Bacall  </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span><span style=\"font-weight: bold\">]</span>                     │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0038355'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0075213'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000003</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Brigitte Bardot</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'music_department'</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0049189'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0054452'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000004</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">John Belushi   </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'writer'</span><span style=\"font-weight: bold\">]</span>           │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0072562'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0078723'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000005</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Ingmar Bergman </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'writer'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'director'</span><span style=\"font-weight: bold\">]</span>             │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0050976'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0083922'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000006</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Ingrid Bergman </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'producer'</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0034583'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0038787'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000007</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Humphrey Bogart</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'producer'</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0037382'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0043265'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000008</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Marlon Brando  </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'director'</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0068646'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0070849'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000009</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Richard Burton </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'producer'</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0061184'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0087803'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000010</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">James Cagney   </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'soundtrack'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'director'</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0042041'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0029870'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                  │\n└───────────┴─────────────────┴────────────────────────────────────┴────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n1. This `filter` call is applied to each array element\n2. This `filter` call is applied to the table\n\n:::\n\n### Applying a function to array elements\n\nYou can apply a function to run an ibis expression on each element of an array\nusing the\n[`map`](../../reference/expression-collections.qmd#ibis.expr.types.arrays.ArrayValue.map)\nmethod.\n\nLet's normalize the case of primary_profession to upper case:\n\n::: {.panel-tabset}\n\n## DuckDB\n\n::: {#2935069b .cell execution_count=38}\n``` {.python .cell-code}\nddb_ents.mutate(\n    primary_profession=_.primary_profession.map(lambda pp: pp.upper())\n).filter(_.primary_profession.length() > 0).order_by(\"nconst\")\n```\n\n::: {.cell-output .cell-output-display execution_count=38}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst    </span>┃<span style=\"font-weight: bold\"> primary_name    </span>┃<span style=\"font-weight: bold\"> primary_profession                </span>┃<span style=\"font-weight: bold\"> known_for_titles                   </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                      │\n├───────────┼─────────────────┼───────────────────────────────────┼────────────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000001</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Fred Astaire   </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'SOUNDTRACK'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>   │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0053137'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0072308'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000002</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Lauren Bacall  </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTRESS'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'SOUNDTRACK'</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0037382'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0117057'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000003</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Brigitte Bardot</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTRESS'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'SOUNDTRACK'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0057345'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0054452'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000004</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">John Belushi   </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'SOUNDTRACK'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>   │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0072562'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0078723'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000005</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Ingmar Bergman </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'WRITER'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'DIRECTOR'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>    │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0083922'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0069467'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000006</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Ingrid Bergman </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTRESS'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'SOUNDTRACK'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0038109'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0036855'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000007</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Humphrey Bogart</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'SOUNDTRACK'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>   │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0037382'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0034583'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000008</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Marlon Brando  </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'SOUNDTRACK'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>   │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0068646'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0070849'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000009</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Richard Burton </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'SOUNDTRACK'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>   │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0057877'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0059749'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000010</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">James Cagney   </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'SOUNDTRACK'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>   │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0042041'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0035575'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                 │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                  │\n└───────────┴─────────────────┴───────────────────────────────────┴────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n## BigQuery\n\n::: {#33931d68 .cell execution_count=39}\n``` {.python .cell-code}\nbq_ents.mutate(\n    primary_profession=_.primary_profession.map(lambda pp: pp.upper())\n).filter(_.primary_profession.length() > 0).order_by(\"nconst\")\n```\n\n::: {.cell-output .cell-output-display execution_count=39}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> nconst    </span>┃<span style=\"font-weight: bold\"> primary_name    </span>┃<span style=\"font-weight: bold\"> primary_profession                </span>┃<span style=\"font-weight: bold\"> known_for_titles                   </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;string&gt;</span>                      │\n├───────────┼─────────────────┼───────────────────────────────────┼────────────────────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000001</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Fred Astaire   </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'SOUNDTRACK'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>   │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0072308'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0053137'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000002</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Lauren Bacall  </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTRESS'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'SOUNDTRACK'</span><span style=\"font-weight: bold\">]</span>         │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0038355'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0075213'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000003</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Brigitte Bardot</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTRESS'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'SOUNDTRACK'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0049189'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0054452'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000004</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">John Belushi   </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'SOUNDTRACK'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>   │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0072562'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0078723'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000005</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Ingmar Bergman </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'WRITER'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'DIRECTOR'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>    │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0050976'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0083922'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000006</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Ingrid Bergman </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTRESS'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'SOUNDTRACK'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0034583'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0038787'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000007</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Humphrey Bogart</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'SOUNDTRACK'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>   │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0037382'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0043265'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000008</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Marlon Brando  </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'SOUNDTRACK'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>   │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0068646'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0070849'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000009</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Richard Burton </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'SOUNDTRACK'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>   │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0061184'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0087803'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">nm0000010</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">James Cagney   </span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'ACTOR'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'SOUNDTRACK'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">]</span>   │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008000; text-decoration-color: #008000\">'tt0042041'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'tt0029870'</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                 │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                  │\n└───────────┴─────────────────┴───────────────────────────────────┴────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n:::\n\n## Conclusion\n\nIbis has a sizable collection of array APIs that work with many different\nbackends and as of version 7.0.0, Ibis supports a much larger set of those APIs\nfor BigQuery!\n\nCheck out [the API\ndocumentation](../../reference/expression-collections.qmd#ibis.expr.types.arrays.ArrayValue)\nfor the full set of available methods.\n\nTry it out, and let us know what you think.\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n<script src=\"https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js\" crossorigin=\"anonymous\"></script>\n"
      ],
      "include-after-body": [
        "<script type=application/vnd.jupyter.widget-state+json>\n{\"state\":{\"8a5cece49d6449c99b428b6956c827e5\":{\"model_module\":\"@jupyter-widgets/controls\",\"model_module_version\":\"2.0.0\",\"model_name\":\"ProgressStyleModel\",\"state\":{\"_model_module\":\"@jupyter-widgets/controls\",\"_model_module_version\":\"2.0.0\",\"_model_name\":\"ProgressStyleModel\",\"_view_count\":null,\"_view_module\":\"@jupyter-widgets/base\",\"_view_module_version\":\"2.0.0\",\"_view_name\":\"StyleView\",\"bar_color\":\"black\",\"description_width\":\"\"}},\"cb46ead42abf4f4684b5f9b2fa75b2ed\":{\"model_module\":\"@jupyter-widgets/controls\",\"model_module_version\":\"2.0.0\",\"model_name\":\"FloatProgressModel\",\"state\":{\"_dom_classes\":[],\"_model_module\":\"@jupyter-widgets/controls\",\"_model_module_version\":\"2.0.0\",\"_model_name\":\"FloatProgressModel\",\"_view_count\":null,\"_view_module\":\"@jupyter-widgets/controls\",\"_view_module_version\":\"2.0.0\",\"_view_name\":\"ProgressView\",\"bar_style\":\"\",\"description\":\"\",\"description_allow_html\":false,\"layout\":\"IPY_MODEL_e30018f3207649bca84a1bb8982aebdd\",\"max\":100,\"min\":0,\"orientation\":\"horizontal\",\"style\":\"IPY_MODEL_8a5cece49d6449c99b428b6956c827e5\",\"tabbable\":null,\"tooltip\":null,\"value\":100}},\"e30018f3207649bca84a1bb8982aebdd\":{\"model_module\":\"@jupyter-widgets/base\",\"model_module_version\":\"2.0.0\",\"model_name\":\"LayoutModel\",\"state\":{\"_model_module\":\"@jupyter-widgets/base\",\"_model_module_version\":\"2.0.0\",\"_model_name\":\"LayoutModel\",\"_view_count\":null,\"_view_module\":\"@jupyter-widgets/base\",\"_view_module_version\":\"2.0.0\",\"_view_name\":\"LayoutView\",\"align_content\":null,\"align_items\":null,\"align_self\":null,\"border_bottom\":null,\"border_left\":null,\"border_right\":null,\"border_top\":null,\"bottom\":null,\"display\":null,\"flex\":null,\"flex_flow\":null,\"grid_area\":null,\"grid_auto_columns\":null,\"grid_auto_flow\":null,\"grid_auto_rows\":null,\"grid_column\":null,\"grid_gap\":null,\"grid_row\":null,\"grid_template_areas\":null,\"grid_template_columns\":null,\"grid_template_rows\":null,\"height\":null,\"justify_content\":null,\"justify_items\":null,\"left\":null,\"margin\":null,\"max_height\":null,\"max_width\":null,\"min_height\":null,\"min_width\":null,\"object_fit\":null,\"object_position\":null,\"order\":null,\"overflow\":null,\"padding\":null,\"right\":null,\"top\":null,\"visibility\":null,\"width\":\"auto\"}}},\"version_major\":2,\"version_minor\":0}\n</script>\n"
      ]
    }
  }
}