{
  "hash": "39940ef53ab2088e51d68a4b09f6509c",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Scaling to infinity and beyond: the Unix backend\"\nauthor: \"Phillip Cloud\"\ndate: \"2024-04-01\"\ncategories:\n    - blog\n    - serious\n    - web-scale\n    - unix\n---\n\n## The Unix backend for Ibis\n\nWe're happy to announce a new Ibis backend built on the world's best known web\nscale technology: Unix pipes.\n\n## Why?\n\nWhy not? Pipes rock and they automatically stream data between operators and\nscale to your hard drive.\n\nWhat's not to love?\n\n## Demo\n\nAll production ready backends ship with amazing demos.\n\nThe Unix backend is no different. Let's see it in action.\n\nFirst we'll install the Unix backend.\n\n```bash\npip install ibish\n```\n\nLike all production-ready libraries `ibish` depends on the latest commit of `ibis-framework`.\n\nNext we'll download some data.\n\n::: {#3d238b30 .cell execution_count=1}\n``` {.python .cell-code}\n!curl -LsS 'https://storage.googleapis.com/ibis-examples/penguins/20240322T125036Z-9aae2/penguins.csv.gz' | zcat > penguins.csv\n```\n:::\n\n\n::: {#4cabee38 .cell execution_count=2}\n``` {.python .cell-code}\nimport ibis\nimport ibish\n\n\nibis.options.interactive = True\n\nunix = ibish.connect({\"p\": \"penguins.csv\"})\n\nt = unix.table(\"p\")\nt\n```\n\n::: {.cell-output .cell-output-display execution_count=2}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━┓\n┃<span style=\"font-weight: bold\"> species </span>┃<span style=\"font-weight: bold\"> island    </span>┃<span style=\"font-weight: bold\"> bill_length_mm </span>┃<span style=\"font-weight: bold\"> bill_depth_mm </span>┃<span style=\"font-weight: bold\"> flipper_length_mm </span>┃<span style=\"font-weight: bold\"> body_mass_g </span>┃<span style=\"font-weight: bold\"> sex    </span>┃<span style=\"font-weight: bold\"> year  </span>┃\n┡━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>        │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span> │\n├─────────┼───────────┼────────────────┼───────────────┼───────────────────┼─────────────┼────────┼───────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Torgersen</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">39.1</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">18.7</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">181.0</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3750.0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">male  </span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2007</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Torgersen</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">39.5</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">17.4</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">186.0</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3800.0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">female</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2007</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Torgersen</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">40.3</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">18.0</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">195.0</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3250.0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">female</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2007</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Torgersen</span> │           <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span> │          <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span> │              <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span> │        <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>   │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2007</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Torgersen</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">36.7</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">19.3</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">193.0</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3450.0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">female</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2007</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Torgersen</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">39.3</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">20.6</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">190.0</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3650.0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">male  </span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2007</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Torgersen</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">38.9</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">17.8</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">181.0</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3625.0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">female</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2007</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Torgersen</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">39.2</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">19.6</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">195.0</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4675.0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">male  </span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2007</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Torgersen</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">34.1</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">18.1</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">193.0</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3475.0</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>   │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2007</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Torgersen</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">42.0</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">20.2</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">190.0</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4250.0</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>   │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2007</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>         │              <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │             <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │                 <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │           <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>      │     <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │\n└─────────┴───────────┴────────────────┴───────────────┴───────────────────┴─────────────┴────────┴───────┘\n</pre>\n```\n:::\n:::\n\n\nSweet, huh?\n\nLet's filter the data and look at only the year 2009.\n\n::: {#321eac96 .cell execution_count=3}\n``` {.python .cell-code}\nexpr = t.filter(t.year == 2009)\nexpr\n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━┓\n┃<span style=\"font-weight: bold\"> species </span>┃<span style=\"font-weight: bold\"> island </span>┃<span style=\"font-weight: bold\"> bill_length_mm </span>┃<span style=\"font-weight: bold\"> bill_depth_mm </span>┃<span style=\"font-weight: bold\"> flipper_length_mm </span>┃<span style=\"font-weight: bold\"> body_mass_g </span>┃<span style=\"font-weight: bold\"> sex    </span>┃<span style=\"font-weight: bold\"> year  </span>┃\n┡━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>        │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span> │\n├─────────┼────────┼────────────────┼───────────────┼───────────────────┼─────────────┼────────┼───────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Biscoe</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">35.0</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">17.9</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">192.0</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3725.0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">female</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2009</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Biscoe</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">41.0</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">20.0</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">203.0</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4725.0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">male  </span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2009</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Biscoe</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">37.7</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">16.0</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">183.0</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3075.0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">female</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2009</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Biscoe</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">37.8</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">20.0</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">190.0</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4250.0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">male  </span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2009</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Biscoe</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">37.9</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">18.6</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">193.0</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2925.0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">female</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2009</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Biscoe</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">39.7</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">18.9</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">184.0</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3550.0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">male  </span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2009</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Biscoe</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">38.6</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">17.2</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">199.0</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3750.0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">female</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2009</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Biscoe</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">38.2</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">20.0</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">190.0</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3900.0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">male  </span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2009</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Biscoe</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">38.1</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">17.0</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">181.0</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3175.0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">female</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2009</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Biscoe</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">43.2</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">19.0</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">197.0</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4775.0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">male  </span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2009</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>      │              <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │             <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │                 <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │           <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>      │     <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │\n└─────────┴────────┴────────────────┴───────────────┴───────────────────┴─────────────┴────────┴───────┘\n</pre>\n```\n:::\n:::\n\n\nWe can sort the result of that too, and filter again.\n\n::: {#efe8d4ef .cell execution_count=4}\n``` {.python .cell-code}\nexpr = (\n    expr.order_by(\"species\", ibis.desc(\"bill_length_mm\"))\n    .filter(lambda t: t.island == \"Biscoe\")\n)\nexpr\n```\n\n::: {.cell-output .cell-output-display execution_count=4}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━┓\n┃<span style=\"font-weight: bold\"> species </span>┃<span style=\"font-weight: bold\"> island </span>┃<span style=\"font-weight: bold\"> bill_length_mm </span>┃<span style=\"font-weight: bold\"> bill_depth_mm </span>┃<span style=\"font-weight: bold\"> flipper_length_mm </span>┃<span style=\"font-weight: bold\"> body_mass_g </span>┃<span style=\"font-weight: bold\"> sex    </span>┃<span style=\"font-weight: bold\"> year  </span>┃\n┡━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>        │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span> │\n├─────────┼────────┼────────────────┼───────────────┼───────────────────┼─────────────┼────────┼───────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Biscoe</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">45.6</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">20.3</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">191.0</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4600.0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">male  </span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2009</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Biscoe</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">43.2</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">19.0</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">197.0</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4775.0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">male  </span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2009</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Biscoe</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">42.7</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">18.3</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">196.0</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4075.0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">male  </span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2009</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Biscoe</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">42.2</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">19.5</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">197.0</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4275.0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">male  </span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2009</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Biscoe</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">41.0</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">20.0</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">203.0</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4725.0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">male  </span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2009</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Biscoe</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">39.7</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">17.7</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">193.0</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3200.0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">female</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2009</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Biscoe</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">39.7</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">18.9</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">184.0</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3550.0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">male  </span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2009</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Biscoe</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">39.6</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">20.7</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">191.0</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3900.0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">female</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2009</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Biscoe</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">38.6</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">17.2</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">199.0</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3750.0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">female</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2009</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Biscoe</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">38.2</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">20.0</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">190.0</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3900.0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">male  </span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2009</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>      │              <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │             <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │                 <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │           <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>      │     <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │\n└─────────┴────────┴────────────────┴───────────────┴───────────────────┴─────────────┴────────┴───────┘\n</pre>\n```\n:::\n:::\n\n\nThere's even support for joins and aggregations!\n\nLet's count the number of island, species pairs and sort descending by the count.\n\n::: {#b67fd46d .cell execution_count=5}\n``` {.python .cell-code}\nexpr = (\n    t.group_by(\"island\", \"species\")\n    .agg(n=lambda t: t.count())\n    .order_by(ibis.desc(\"n\"))\n)\nexpr\n```\n\n::: {.cell-output .cell-output-display execution_count=5}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━┓\n┃<span style=\"font-weight: bold\"> island    </span>┃<span style=\"font-weight: bold\"> species   </span>┃<span style=\"font-weight: bold\"> n     </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span> │\n├───────────┼───────────┼───────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Biscoe   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Gentoo   </span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">124</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Dream    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Chinstrap</span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">68</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Dream    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie   </span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">56</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Torgersen</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie   </span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">52</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Biscoe   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie   </span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">44</span> │\n└───────────┴───────────┴───────┘\n</pre>\n```\n:::\n:::\n\n\nFor kicks, let's compare that to the DuckDB backend to make sure we're able to count stuff.\n\nTo be extra awesome, we'll *reuse the same expression to do the computation*.\n\n::: {#1412a8fa .cell execution_count=6}\n``` {.python .cell-code}\nddb = ibis.duckdb.connect()\nddb.read_csv(\"penguins.csv\", table_name=\"p\")  # <1>\nibis.memtable(ddb.to_pyarrow(expr.unbind()))\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━┓\n┃<span style=\"font-weight: bold\"> island    </span>┃<span style=\"font-weight: bold\"> species   </span>┃<span style=\"font-weight: bold\"> n     </span>┃\n┡━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span> │\n├───────────┼───────────┼───────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Biscoe   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Gentoo   </span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">124</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Dream    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Chinstrap</span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">68</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Dream    </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie   </span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">56</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Torgersen</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie   </span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">52</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Biscoe   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Adelie   </span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">44</span> │\n└───────────┴───────────┴───────┘\n</pre>\n```\n:::\n:::\n\n\n1. The `read_csv` is necessary so that the expression's table\n   name--`p`--matches one inside the DuckDB database.\n\n## How does it work?\n\nGlad you asked!\n\nThe Unix backend for Ibis was built over the course of a few hours, which is\nabout the time it takes to make a production ready Ibis backend.\n\nBroadly speaking, the Unix backend:\n\n1. Produces a shell command for each Ibis _table_ operation.\n1. Produces a nominal output location for the output of that command, in the form of a [named pipe](https://en.wikipedia.org/wiki/Named_pipe) opened in write mode.\n1. Reads output from the named pipe output location of the root of the expression tree.\n1. Calls `pandas.read_csv` on that output.\n\n::: {.callout-note collapse=\"true\"}\n# Why named pipes?\n\nShell commands only allow a single input from `stdin`.\n\nHowever, joins accept > 1 input so we need a way to stream more than one input to a join operation.\n\nNamed pipes support the semantics of \"unnamed\" pipes (FIFO queue behavior) but\ncan be used in pipelines with nodes that have more a single input since they\nexist as paths on the file system.\n:::\n\n### Expressions\n\nIbis expressions are an abstract representation of an analytics computation\nover tabular data.\n\nIbis ships a public API, whose instances we call *expressions*.\n\nExpressions have an associated type--accessible via their\n[`type()`](../../reference/expression-generic.qmd#ibis.expr.types.generic.Value.type)\nmethod--that determines what methods are available on them.\n\nExpressions are ignorant of their underlying implementation: their\ncomposability is determined solely by their type.\n\nThis type is determined by the expression's underlying *operation*.\n\nThe two-layer model makes it easy to describe operations in terms of the data\ntypes produced by an expression, rather than as instances of a specific class\nin a hierarchy.\n\nThis allows Ibis maintainers to alter expression API implementations without\nchanging those APIs making it easier to maintain and easier to keep stable than\nif we had a complex (but not necessarily deep!) class hierarchy.\n\nOperations, though, are really where the nitty gritty implementation details\nstart.\n\n### Operations\n\nIbis _operations_ are lightweight classes that model the tree structure of a computation.\n\nThey have zero or more inputs, whose types and values are constrained by Ibis's _type system_.\n\nNotably operations are *not* part of Ibis's public API.\n\nWhen we talk about \"compilation\" in Ibis, we're talking about the process of\nconverting an _operation_ into something that the backend knows how to execute.\n\nIn the case of this 1̵0̸0̵%̵ p̶̺̑r̴̛ͅo̵̒ͅḍ̴̌u̷͇͒c̵̠̈t̷͍̿i̶̪͐o̸̳̾n̷͓̄-r̵̡̫̞͓͆̂̏ẽ̸̪̱̽ͅā̸̤̹̘̅̓͝d̵͇̞̏̂̔̽y̴̝͎̫̬͋̇̒̅ Unix backend, each operation\nis compiled into a list of strings that represent the shell command to run to\nexecute the operation.\n\nIn other backends, like DuckDB, these compilation rules produce a sqlglot object.\n\nThe `compile` method is also the place where the backend has a chance to invoke\ncustom rewrite rules over operations.\n\nRewrites are a very useful tool for the Unix backend. For example, the `join`\ncommand (yep, it's in coreutils!) that we use to execute inner joins with this\nbackend requires that the inputs be sorted, otherwise the results won't be\ncorrect. So, I added a rewrite rule that replaces the left and right relations\nin a join operation with equivalent relations sorted on the join keys.\n\nOnce you obtain the output of compile, it's up to the backend what to do next.\n\n### Backend implementation\n\nAt this point we've got our shell commands and some output locations created as\nnamed pipes.\n\nWhat next?\n\nWell, we need to execute the commands and write their output to the corresponding named pipe.\n\nYou might think\n\n> I'll just loop over the operations, open the pipe in write mode and call\n> `subprocess.Popen(cmd, stdout=named_pipe)`.\n\nNot a bad thought, but the semantics of named pipes do not abide such thoughts :)\n\nNamed pipes, when opened in write mode, will block until a corresponding handle\nis opened in *read* mode.\n\nFutures using a scoped thread pool are a decent way to handle this.\n\nThe idea is to launch every node concurrently and then read from the last\nnode's output. This initial read of the root node's output pipe kicks off the\ncascade of other reads necessary to move data through the pipeline.\n\nThe Unix backend thus constructs a scoped `ThreadPoolExecutor()` using\na context manager and submits a task for each operation to the executor.\nImportantly, opening the named pipe in write mode happens **inside** the task,\nto avoid blocking the main thread while waiting for a reader to be opened.\n\nThe final output task's path is then passed directly to `read_csv`, and we've\nnow got the result of our computation.\n\n#### Show me the commands already!\n\nRoger that.\n\n::: {#9cba0561 .cell execution_count=7}\n``` {.python .cell-code}\nexpr = (\n    t.filter([t.year == 2009])\n    .select(\n        \"year\", \"species\", \"flipper_length_mm\", island=lambda t: t.island.lower()\n    )\n    .group_by(\"island\", \"species\")\n    .agg(n=lambda t: t.count(), avg=lambda t: t.island.upper().length().mean())\n    .order_by(\"n\")\n    .mutate(ilength=lambda t: t.island.length())\n    .limit(5)\n)\nprint(unix.explain(expr))  # <1>\n```\n\n::: {.cell-output .cell-output-stdout}\n```\ntail --lines +2 /home/cloud/src/ibis/docs/posts/unix-backend/penguins.csv > t0\nawk -F , '{ if (($8 == 2009)) { print }}' t0 > t1\nawk -F , '{ print $8 \",\" $1 \",\" $5 \",\" tolower($2) }' t1 > t2\nawk -F , '{\n  agg0[$4\",\"$2]++\n  agg1[$4\",\"$2] += length(toupper($4))\n}\nEND { for (key in agg0) print key \",\" agg0[key] \",\" agg1[key]/NR }' t2 > t3\nsort -t , -k 3,3n t3 > t4\nawk -F , '{ print $1 \",\" $2 \",\" $3 \",\" $4 \",\" length($1) }' t4 > t5\nhead --lines 5 t5 > t6\n```\n:::\n:::\n\n\n1. `explain` isn't a public method and not likely to become one any time soon.\n\n## Conclusion\n\nIf you've gotten this far hopefully you've had a good laugh.\n\nLet's wrap up with some final thoughts.\n\n### Things to do\n\n- Join our [Zulip](https://ibis-project.zulipchat.com/)!\n- Open a GitHub [issue](https://github.com/ibis-project/ibis/issues/new/choose)\n  or [discussion](https://github.com/ibis-project/ibis/discussions/new/choose)!\n\n### Things to avoid doing\n\n- Putting this into production\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}