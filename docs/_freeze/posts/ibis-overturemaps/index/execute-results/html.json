{
  "hash": "bdcb9bd7db9a0f415fd943d48d80b9f8",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"From query to plot: Exploring GeoParquet Overture Maps with Ibis, DuckDB, and Lonboard\"\nauthor: Naty Clementi and Kyle Barron\ndate: 2024-09-25\ncategories:\n  - blog\n  - duckdb\n  - overturemaps\n  - lonboard\n  - geospatial\n#execute:\n#  freeze: false\n---\n\n\nWith the release of `DuckDB 1.1.1`, now we have support for reading GeoParquet\nfiles! With this exciting update we can query rich datasets from Overture Maps\nusing python via Ibis with the performance of `DuckDB`.\n\nBut the good news doesn't stop there, since `Ibis 9.2`, `lonboard` can plot data\ndirectly from an `Ibis` table, adding more simplicity and speed to your\ngeospatial analysis.\n\nLet’s dive into how these tools come together.\n\n## Installation\n\nFirst make sure you have `duckdb>=1.1.1`, then install Ibis with the dependencies\nneeded to work with geospatial data using DuckDB.\n\n```bash\n$ pip install 'duckdb>=1.1.1'\n$ pip install 'ibis-framework[duckdb,geospatial]' lonboard\n```\n\n## Motivation\n\nOverture Maps is an open-source initiative that provides high-quality,\ninteroperable map data by integrating contributions from leading companies and\nopen data sources to support a wide range of applications.\n\nOverture Maps offers a variety of datasets to query. For example, there is plenty\nof information about power infrastructure.\n\nLet's create some plots of the U.S. power infrastructure. We'll look into power\nplants and power lines for the lower 48 states (excluding Hawaii and Alaska for\nsimplicity of the bounding box).\n\n## Download data\n\nFirst we import Ibis, its [deferred expression object](https://ibis-project.org/reference/expression-generic.html#ibis.expr.api.deferred) `_` ,\nand we use our default backend, DuckDB:\n\n::: {#c99f42a5 .cell execution_count=1}\n``` {.python .cell-code}\nimport ibis\nfrom ibis import _\n\ncon = ibis.get_backend() # default duckdb backend\n```\n:::\n\n\nWith Ibis and DuckDB we can be more specific about the data we want thanks to the\nfilter push down. For example, if we want to select only a few columns and\nlook only at the power infrastructure when can do this as follow.\n\n\n```python\n# look into type infrastructure\nurl = (\n    \"s3://overturemaps-us-west-2/release/2024-07-22.0/theme=base/type=infrastructure/*\"\n)\nt = con.read_parquet(url, table_name=\"infra-usa\")\n\n# filter for USA bounding box, subtype=\"power\", and selecting only few columns\nexpr = t.filter(\n    _.bbox.xmin > -125.0,\n    _.bbox.ymin > 24.8,\n    _.bbox.xmax < -65.8,\n    _.bbox.ymax < 49.2,\n    _.subtype == \"power\",\n).select([\"names\", \"geometry\", \"bbox\", \"class\", \"sources\", \"source_tags\"])\n```\n\n::: {.callout-note}\nIf you inspect expr, you can see that the filters and projections get pushed down,\nmeaning you only download the data that you asked for.\n:::\n\n```python\ncon.to_parquet(expr, \"power-infra-usa.geoparquet\")\n```\n\nNow that we have the data lets explore it in Ibis interactive mode and make some\nbeautiful maps.\n\n## Data exploration\n\nTo explore the data interactively we turn on the interactive mode:\n\n::: {#d27ce9f5 .cell execution_count=2}\n``` {.python .cell-code}\nibis.options.interactive = True\n```\n:::\n\n\n::: {#0522920a .cell execution_count=3}\n``` {.python .cell-code}\nusa_power_infra = con.read_parquet(\"power-infra-usa.geoparquet\")\nusa_power_infra\n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> names </span>┃<span style=\"font-weight: bold\"> geometry                                                                         </span>┃<span style=\"font-weight: bold\"> bbox                                                               </span>┃<span style=\"font-weight: bold\"> class       </span>┃<span style=\"font-weight: bold\"> sources                                                                          </span>┃<span style=\"font-weight: bold\"> source_tags                                  </span>┃\n┡━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">stru…</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">geospatial:geometry</span>                                                              │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">struct&lt;xmin: float32, xmax: float32, ymin: float32, ymax: float32&gt;</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;struct&lt;property: string, dataset: string, record_id: string, update_time:…</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">map&lt;string, string&gt;</span>                          │\n├───────┼──────────────────────────────────────────────────────────────────────────────────┼────────────────────────────────────────────────────────────────────┼─────────────┼──────────────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────┤\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>  │ <span style=\"font-weight: bold\">&lt;</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold\">POINT</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">(</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.291</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">27.151</span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">)</span><span style=\"font-weight: bold\">&gt;</span>                                                        │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'xmin'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.29095458984375</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'xmax'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.29093933105469</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">}</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">power_tower</span> │ <span style=\"font-weight: bold\">[{</span><span style=\"color: #808000; text-decoration-color: #808000\">...</span><span style=\"font-weight: bold\">}]</span>                                                                          │ <span style=\"font-weight: bold\">{}</span>                                           │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>  │ <span style=\"font-weight: bold\">&lt;</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold\">POINT</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">(</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.289</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">27.149</span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">)</span><span style=\"font-weight: bold\">&gt;</span>                                                        │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'xmin'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.28852844238281</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'xmax'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.28851318359375</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">}</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">power_tower</span> │ <span style=\"font-weight: bold\">[{</span><span style=\"color: #808000; text-decoration-color: #808000\">...</span><span style=\"font-weight: bold\">}]</span>                                                                          │ <span style=\"font-weight: bold\">{}</span>                                           │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>  │ <span style=\"font-weight: bold\">&lt;</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold\">POINT</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">(</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.29</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">27.15</span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">)</span><span style=\"font-weight: bold\">&gt;</span>                                                          │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'xmin'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.29006958007812</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'xmax'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.29005432128906</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">}</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">power_tower</span> │ <span style=\"font-weight: bold\">[{</span><span style=\"color: #808000; text-decoration-color: #808000\">...</span><span style=\"font-weight: bold\">}]</span>                                                                          │ <span style=\"font-weight: bold\">{}</span>                                           │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>  │ <span style=\"font-weight: bold\">&lt;</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold\">POINT</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">(</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.29</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">27.151</span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">)</span><span style=\"font-weight: bold\">&gt;</span>                                                         │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'xmin'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.2900619506836</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'xmax'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.29004669189453</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">}</span>  │ <span style=\"color: #008000; text-decoration-color: #008000\">power_tower</span> │ <span style=\"font-weight: bold\">[{</span><span style=\"color: #808000; text-decoration-color: #808000\">...</span><span style=\"font-weight: bold\">}]</span>                                                                          │ <span style=\"font-weight: bold\">{}</span>                                           │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>  │ <span style=\"font-weight: bold\">&lt;</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold\">POLYGON</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">((</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.29</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">27.152</span><span style=\"color: #000000; text-decoration-color: #000000\">, </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.29</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">27.151</span><span style=\"color: #000000; text-decoration-color: #000000\">, </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.29</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">27.15</span><span style=\"color: #000000; text-decoration-color: #000000\">, </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.291</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">27.151</span><span style=\"color: #000000; text-decoration-color: #000000\">, -</span><span style=\"color: #808000; text-decoration-color: #808000\">...</span><span style=\"font-weight: bold\">&gt;</span> │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'xmin'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.29100036621094</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'xmax'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.28948974609375</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">}</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">substation </span> │ <span style=\"font-weight: bold\">[{</span><span style=\"color: #808000; text-decoration-color: #808000\">...</span><span style=\"font-weight: bold\">}]</span>                                                                          │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'location'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'outdoor'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'voltage'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'115000'</span><span style=\"font-weight: bold\">}</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>  │ <span style=\"font-weight: bold\">&lt;</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold\">POINT</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">(</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.291</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">27.151</span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">)</span><span style=\"font-weight: bold\">&gt;</span>                                                        │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'xmin'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.29055786132812</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'xmax'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.29054260253906</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">}</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">portal     </span> │ <span style=\"font-weight: bold\">[{</span><span style=\"color: #808000; text-decoration-color: #808000\">...</span><span style=\"font-weight: bold\">}]</span>                                                                          │ <span style=\"font-weight: bold\">{}</span>                                           │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>  │ <span style=\"font-weight: bold\">&lt;</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold\">POINT</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">(</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.291</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">27.152</span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">)</span><span style=\"font-weight: bold\">&gt;</span>                                                        │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'xmin'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.29069519042969</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'xmax'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.29067993164062</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">}</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">power_tower</span> │ <span style=\"font-weight: bold\">[{</span><span style=\"color: #808000; text-decoration-color: #808000\">...</span><span style=\"font-weight: bold\">}]</span>                                                                          │ <span style=\"font-weight: bold\">{}</span>                                           │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>  │ <span style=\"font-weight: bold\">&lt;</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold\">POINT</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">(</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.288</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">27.151</span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">)</span><span style=\"font-weight: bold\">&gt;</span>                                                        │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'xmin'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.28756713867188</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'xmax'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.28755187988281</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">}</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">power_tower</span> │ <span style=\"font-weight: bold\">[{</span><span style=\"color: #808000; text-decoration-color: #808000\">...</span><span style=\"font-weight: bold\">}]</span>                                                                          │ <span style=\"font-weight: bold\">{}</span>                                           │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>  │ <span style=\"font-weight: bold\">&lt;</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold\">POINT</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">(</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.286</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">27.152</span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">)</span><span style=\"font-weight: bold\">&gt;</span>                                                        │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'xmin'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.28639221191406</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'xmax'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.286376953125</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">}</span>   │ <span style=\"color: #008000; text-decoration-color: #008000\">power_tower</span> │ <span style=\"font-weight: bold\">[{</span><span style=\"color: #808000; text-decoration-color: #808000\">...</span><span style=\"font-weight: bold\">}]</span>                                                                          │ <span style=\"font-weight: bold\">{}</span>                                           │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>  │ <span style=\"font-weight: bold\">&lt;</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold\">POINT</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">(</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.285</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">27.152</span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">)</span><span style=\"font-weight: bold\">&gt;</span>                                                        │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'xmin'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.2851333618164</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'xmax'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-114.28511810302734</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">}</span>  │ <span style=\"color: #008000; text-decoration-color: #008000\">power_tower</span> │ <span style=\"font-weight: bold\">[{</span><span style=\"color: #808000; text-decoration-color: #808000\">...</span><span style=\"font-weight: bold\">}]</span>                                                                          │ <span style=\"font-weight: bold\">{}</span>                                           │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                                                                │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                                                  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                                                                │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                            │\n└───────┴──────────────────────────────────────────────────────────────────────────────────┴────────────────────────────────────────────────────────────────────┴─────────────┴──────────────────────────────────────────────────────────────────────────────────┴──────────────────────────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\nLet's quickly rename the `class` column, since this is a reserved word and causes\nconflicts when using the deferred operator:\n\n::: {#4f8fae15 .cell execution_count=4}\n``` {.python .cell-code}\nusa_power_infra = usa_power_infra.rename(infra_class=\"class\")\n```\n:::\n\n\nWe take a look at the different classes of infrastructure under the subtype power:\n\n::: {#6aa400c1 .cell execution_count=5}\n``` {.python .cell-code}\nusa_power_infra.infra_class.value_counts().order_by(\n    ibis.desc(\"infra_class_count\")\n).preview(max_rows=15)\n```\n\n::: {.cell-output .cell-output-display execution_count=5}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> infra_class   </span>┃<span style=\"font-weight: bold\"> infra_class_count </span>┃\n┡━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>        │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>             │\n├───────────────┼───────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">power_pole   </span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2961946</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">power_tower  </span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2600392</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">generator    </span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">736083</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">power_line   </span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">246948</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">minor_line   </span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">112266</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">substation   </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">64868</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">portal       </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">58033</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">switch       </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">51485</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">transformer  </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">50456</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">plant        </span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12416</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">cable        </span> │              <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4977</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">catenary_mast</span> │              <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2921</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">insulator    </span> │              <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1713</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">connection   </span> │              <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1226</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">terminal     </span> │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">402</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>             │                 <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │\n└───────────────┴───────────────────┘\n</pre>\n```\n:::\n:::\n\n\nLooks like we have `plant`, `power_line` and `minor_line` among others.\n\n::: {#ce3a4491 .cell execution_count=6}\n``` {.python .cell-code}\nplants = usa_power_infra.filter(_.infra_class==\"plant\")\npower_lines = usa_power_infra.filter(_.infra_class==\"power_line\")\nminor_lines = usa_power_infra.filter(_.infra_class==\"minor_line\")\n```\n:::\n\n\n## Plotting with Lonboard\n\nLonboard is a Python plotting library optimized for efficient visualizations\nof large geospatial data. It integrates well with Ibis and DuckDB, making\ninteractive plotting scalable.\n\n::: {.callout-note}\nYou can try this in your machine, for the purpose the blog file size, we will show\nscreenshots of the visualization\n:::\n\n```python\nimport lonboard\nfrom lonboard.basemap import CartoBasemap # to choose color of basemap\n```\n\nLet's visualize the `power plants`\n\n```python\nlonboard.viz(\n    plants,\n    scatterplot_kwargs={\"get_fill_color\": \"red\"},\n    polygon_kwargs={\"get_fill_color\": \"red\"},\n    map_kwargs={\n        \"basemap_style\": CartoBasemap.Positron,\n        \"view_state\": {\"longitude\": -100, \"latitude\": 36, \"zoom\": 3},\n    },\n)\n```\n\n![Power plants in the USA](usa-power-plants.png)\n\nIf you are visualizing this in your machine, you can zoom in and see some of the\ngeometry where the plants are located. As an example, we can plot in a small\narea of California:\n\n```python\nplants_CA = plants.filter(\n    _.bbox.xmin.between(-118.6, -117.9), _.bbox.ymin.between(34.5, 35.3)\n).select(_.names.primary, _.geometry)\n```\n\n```python\nlonboard.viz(\n    plants_CA,\n    scatterplot_kwargs={\"get_fill_color\": \"red\"},\n    polygon_kwargs={\"get_fill_color\": \"red\"},\n    map_kwargs={\n        \"basemap_style\": CartoBasemap.Positron,\n    },\n)\n```\n\n![Power plants near Lancaster, CA](ca-power-plants.png)\n\nWe can also visualize together the `power_lines` and the `minor_lines` by doing:\n\n```python\nlonboard.viz([minor_lines, power_lines])\n```\n\n![Minor and Power lines of USA](usa-power-and-minor-lines.png)\n\nand that's how you can visualize ~7 million coordinates from the comfort of\nyour laptop.\n\n```python\n>>> power_lines.geometry.n_points().sum()\n5329836\n>>> minor_lines.geometry.n_points().sum()\n1430042\n```\n\nWith Ibis and DuckDB working with geospatial data has never been easier or faster.\nWe saw how to query a dataset from Overture Maps with the simplicity of Python and\nthe performance of DuckDB. Last but not least, we saw how simple and quick Lonboard\ngot us from query-to-plot. Together, these libraries make exploring and handling\ngeospatial data a breeze.\n\n\n## Resources\n- [Ibis Docs](https://ibis-project.org/)\n- [Lonboard Docs](https://developmentseed.org/lonboard/latest/)\n- [DuckDB spatial extension](https://duckdb.org/docs/extensions/spatial.html)\n- [DuckDB spatial functions docs](https://github.com/duckdb/duckdb_spatial/blob/main/docs/functions.md)\n\nChat with us on Zulip:\n\n- [Ibis Zulip Chat](https://ibis-project.zulipchat.com/)\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}