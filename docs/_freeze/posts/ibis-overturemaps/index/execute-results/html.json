{
  "hash": "dfab10a1fc121c101991cf67117a23ff",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"From query to plot: Exploring GeoParquet Overture Maps with Ibis, DuckDB, and Lonboard\"\nauthor: Naty Clementi and Kyle Barron\ndate: 2024-09-13\ncategories:\n  - blog\n  - duckdb\n  - overturemaps\n  - lonboard\n  - geospatial\n---\n\n\nWith the release of `DuckDB 1.1.0`, now we have support for reading GeoParquet\nfiles! With this exciting update we can query rich datasets from Overture Maps using python via Ibis with the performance of `DuckDB`.\n\nBut the good news don't stop there, since `Ibis 9.2`, `lonboard` can plot data directly from an `Ibis` table, adding more simplicity and speed to your geospatial analysis.\n\nLet’s dive into how these tools come together.\n\n## Installation\n\nInstall Ibis with the dependencies needed to work with geospatial data using DuckDB. To be able to read geoparquet files the duckdb version should be `>=1.1.0`.\n\n::: {.callout-note}\nAt the moment duckdb 1.1.0 has a bug that prevents us from querying and writing the data to parquet using Ibis and DuckDB, so we are installing the `overturemaps` CLI to get the data.\n:::\n\n```bash\n$ pip install 'ibis-framework[duckdb,geospatial]' lonboard overturemaps\n```\n\n## Motivation\n\nOverture Maps offers a variety of datasets to query, but we thought that it would\nbe interesting to see some plots related to the power infrastructure. We'll look\ninto power plants, and power lines of most of the USA (excluding territories and\nAlaska for simplicity of the bounding box).\n\n## Download data\n\n**NOTE: not sure if I should have this here or avoid it because it's broken**\n\nWith Ibis and DuckDB we could download only the necessary columns needed but at\nthe moment this fails due to a bug.\n\nFor future reference when this gets fixed, the expression would look like this:\n\n```python\nimport ibis\nfrom ibis import _\n\ncon = ibis.get_backend()\n\n# look into type infrastructure\nurl = \"s3://overturemaps-us-west-2/release/2024-07-22.0/theme=base/type=infrastructure/*\"\nt = con.read_parquet(url, table_name=\"infra-usa\")\n\n# filter for USA bounding box, subtype=\"power\", and selecting only few columns\nexpr = t.filter(_.bbox.xmin > -125.0, _.bbox.ymin > 24.8,\n                _.bbox.xmax < -65.8, _.bbox.ymax < 49.2,\n                _.subtype==\"power\"\n                ).select([\"names\",\n                          \"geometry\",\n                          \"class\",\n                          \"sources\",\n                          \"source_tags\"])\n\n```\n\n::: {.callout-note}\nIf you inspect expr, you can see that the filters and projections get pushed down\nmeaning you only bring the data that you asked for.\n:::\n\n```python\n# to write it to a parquet file we would do (currently broken)\ncon.to_parquet(expr, \"power-infra-usa.parquet\")\n```\n\nBut, no worries! Overture Maps has a nice [python CLI](https://docs.overturemaps.org/getting-data/overturemaps-py/) that allow us to download\nsome the data, we can filter by bounding box and type but any other filters will have to happen afterwards.\n\n```bash\n$ overturemaps download --bbox=-125.0,24.8,-65.8,49.2 -f geoparquet --type=infrastructure -o usa-infra.geoparquet\n```\n\nNow that we have the data lets explore it in Ibis interactive mode and make some beautiful maps.\n\n## Data exploration\n\n::: {#09d3591a .cell execution_count=1}\n``` {.python .cell-code}\nimport ibis\nfrom ibis import _\n\nibis.options.interactive = True\ncon = ibis.get_backend() # default duckdb backend\n```\n:::\n\n\n::: {#2905df8d .cell execution_count=2}\n``` {.python .cell-code}\nusa_infra = con.read_parquet(\"usa-infra.geoparquet\")\nusa_infra\n```\n\n::: {.cell-output .cell-output-display execution_count=9}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> id                               </span>┃<span style=\"font-weight: bold\"> geometry                                                                         </span>┃<span style=\"font-weight: bold\"> bbox                                                               </span>┃<span style=\"font-weight: bold\"> version </span>┃<span style=\"font-weight: bold\"> sources                                                                          </span>┃<span style=\"font-weight: bold\"> subtype </span>┃<span style=\"font-weight: bold\"> class  </span>┃<span style=\"font-weight: bold\"> surface </span>┃<span style=\"font-weight: bold\"> names                                                                            </span>┃<span style=\"font-weight: bold\"> level </span>┃<span style=\"font-weight: bold\"> source_tags            </span>┃<span style=\"font-weight: bold\"> wikidata </span>┃\n┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">geospatial:geometry</span>                                                              │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">struct&lt;xmin: float32, xmax: float32, ymin: float32, ymax: float32&gt;</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int32</span>   │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">array&lt;struct&lt;property: string, dataset: string, record_id: string, update_time:…</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">struct&lt;primary: string, common: map&lt;string, string&gt;, rules: array&lt;struct&lt;varian…</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int32</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">map&lt;string, string&gt;</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>   │\n├──────────────────────────────────┼──────────────────────────────────────────────────────────────────────────────────┼────────────────────────────────────────────────────────────────────┼─────────┼──────────────────────────────────────────────────────────────────────────────────┼─────────┼────────┼─────────┼──────────────────────────────────────────────────────────────────────────────────┼───────┼────────────────────────┼──────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">08b4872910712fff0001bd2a98181d63</span> │ <span style=\"font-weight: bold\">&lt;</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold\">LINESTRING</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">(</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.751</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26.443</span><span style=\"color: #000000; text-decoration-color: #000000\">, </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.752</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26.443</span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">)</span><span style=\"font-weight: bold\">&gt;</span>                                  │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'xmin'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.75163269042969</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'xmax'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.75121307373047</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">}</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │ <span style=\"font-weight: bold\">[{</span><span style=\"color: #808000; text-decoration-color: #808000\">...</span><span style=\"font-weight: bold\">}]</span>                                                                          │ <span style=\"color: #008000; text-decoration-color: #008000\">barrier</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">fence </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>                                                                             │  <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span> │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'barrier'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'fence'</span><span style=\"font-weight: bold\">}</span>   │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">08b48729107adfff0001be94b7094f98</span> │ <span style=\"font-weight: bold\">&lt;</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold\">LINESTRING</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">(</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.752</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26.443</span><span style=\"color: #000000; text-decoration-color: #000000\">, </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.752</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26.443</span><span style=\"color: #000000; text-decoration-color: #000000\">, </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.752</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26.443</span><span style=\"color: #000000; text-decoration-color: #000000\">, </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.752</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26</span><span style=\"color: #808000; text-decoration-color: #808000\">...</span><span style=\"color: #000000; text-decoration-color: #000000\">.</span><span style=\"font-weight: bold\">&gt;</span> │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'xmin'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.75247192382812</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'xmax'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.75128936767578</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">}</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │ <span style=\"font-weight: bold\">[{</span><span style=\"color: #808000; text-decoration-color: #808000\">...</span><span style=\"font-weight: bold\">}]</span>                                                                          │ <span style=\"color: #008000; text-decoration-color: #008000\">barrier</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">fence </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>                                                                             │  <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span> │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'barrier'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'fence'</span><span style=\"font-weight: bold\">}</span>   │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">08b48729107acfff0001b9d2fa063cd0</span> │ <span style=\"font-weight: bold\">&lt;</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold\">LINESTRING</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">(</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.752</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26.443</span><span style=\"color: #000000; text-decoration-color: #000000\">, </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.752</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26.443</span><span style=\"color: #000000; text-decoration-color: #000000\">, </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.752</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26.443</span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">)</span><span style=\"font-weight: bold\">&gt;</span>                 │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'xmin'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.7518310546875</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'xmax'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.75159454345703</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">}</span>  │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │ <span style=\"font-weight: bold\">[{</span><span style=\"color: #808000; text-decoration-color: #808000\">...</span><span style=\"font-weight: bold\">}]</span>                                                                          │ <span style=\"color: #008000; text-decoration-color: #008000\">barrier</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">fence </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>                                                                             │  <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span> │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'barrier'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'fence'</span><span style=\"font-weight: bold\">}</span>   │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">08b48729107acfff0001b2a999988dee</span> │ <span style=\"font-weight: bold\">&lt;</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold\">LINESTRING</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">(</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.752</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26.443</span><span style=\"color: #000000; text-decoration-color: #000000\">, </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.752</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26.443</span><span style=\"color: #000000; text-decoration-color: #000000\">, </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.752</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26.443</span><span style=\"color: #000000; text-decoration-color: #000000\">, </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.752</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26</span><span style=\"color: #808000; text-decoration-color: #808000\">...</span><span style=\"color: #000000; text-decoration-color: #000000\">.</span><span style=\"font-weight: bold\">&gt;</span> │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'xmin'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.75196075439453</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'xmax'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.75128936767578</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">}</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │ <span style=\"font-weight: bold\">[{</span><span style=\"color: #808000; text-decoration-color: #808000\">...</span><span style=\"font-weight: bold\">}]</span>                                                                          │ <span style=\"color: #008000; text-decoration-color: #008000\">barrier</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">fence </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>                                                                             │  <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span> │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'barrier'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'fence'</span><span style=\"font-weight: bold\">}</span>   │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">08b48729107acfff0001b78a05e4b26d</span> │ <span style=\"font-weight: bold\">&lt;</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold\">LINESTRING</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">(</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.752</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26.443</span><span style=\"color: #000000; text-decoration-color: #000000\">, </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.751</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26.443</span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">)</span><span style=\"font-weight: bold\">&gt;</span>                                  │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'xmin'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.7516098022461</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'xmax'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.75145721435547</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">}</span>  │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │ <span style=\"font-weight: bold\">[{</span><span style=\"color: #808000; text-decoration-color: #808000\">...</span><span style=\"font-weight: bold\">}]</span>                                                                          │ <span style=\"color: #008000; text-decoration-color: #008000\">barrier</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">fence </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>                                                                             │  <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span> │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'barrier'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'fence'</span><span style=\"font-weight: bold\">}</span>   │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">08b48729107acfff0001b4f0fb8a8add</span> │ <span style=\"font-weight: bold\">&lt;</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold\">LINESTRING</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">(</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.751</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26.443</span><span style=\"color: #000000; text-decoration-color: #000000\">, </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.751</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26.443</span><span style=\"color: #000000; text-decoration-color: #000000\">, </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.751</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26.443</span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">)</span><span style=\"font-weight: bold\">&gt;</span>                 │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'xmin'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.75147247314453</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'xmax'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.75127410888672</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">}</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │ <span style=\"font-weight: bold\">[{</span><span style=\"color: #808000; text-decoration-color: #808000\">...</span><span style=\"font-weight: bold\">}]</span>                                                                          │ <span style=\"color: #008000; text-decoration-color: #008000\">barrier</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">fence </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>                                                                             │  <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span> │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'barrier'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'fence'</span><span style=\"font-weight: bold\">}</span>   │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">08b48729107a1fff0001b83d857e5f12</span> │ <span style=\"font-weight: bold\">&lt;</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold\">LINESTRING</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">(</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.751</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26.443</span><span style=\"color: #000000; text-decoration-color: #000000\">, </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.751</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26.443</span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">)</span><span style=\"font-weight: bold\">&gt;</span>                                  │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'xmin'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.75128936767578</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'xmax'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.75121307373047</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">}</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │ <span style=\"font-weight: bold\">[{</span><span style=\"color: #808000; text-decoration-color: #808000\">...</span><span style=\"font-weight: bold\">}]</span>                                                                          │ <span style=\"color: #008000; text-decoration-color: #008000\">barrier</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">fence </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>                                                                             │  <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span> │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'barrier'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'fence'</span><span style=\"font-weight: bold\">}</span>   │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">08b4872910785fff0001bdb9d542ab99</span> │ <span style=\"font-weight: bold\">&lt;</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold\">LINESTRING</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">(</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.751</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26.443</span><span style=\"color: #000000; text-decoration-color: #000000\">, </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.751</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26.443</span><span style=\"color: #000000; text-decoration-color: #000000\">, </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.751</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26.444</span><span style=\"color: #000000; text-decoration-color: #000000\">, </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.75</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26.443</span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">)</span><span style=\"font-weight: bold\">&gt;</span> │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'xmin'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.75137329101562</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'xmax'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.75019836425781</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">}</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │ <span style=\"font-weight: bold\">[{</span><span style=\"color: #808000; text-decoration-color: #808000\">...</span><span style=\"font-weight: bold\">}]</span>                                                                          │ <span style=\"color: #008000; text-decoration-color: #008000\">barrier</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">fence </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>                                                                             │  <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span> │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'barrier'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'fence'</span><span style=\"font-weight: bold\">}</span>   │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">08b4872910780fff0001b7f776ed2f65</span> │ <span style=\"font-weight: bold\">&lt;</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold\">LINESTRING</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">(</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.751</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26.444</span><span style=\"color: #000000; text-decoration-color: #000000\">, </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.751</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26.444</span><span style=\"color: #000000; text-decoration-color: #000000\">, </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.751</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26.444</span><span style=\"color: #000000; text-decoration-color: #000000\">, </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.75</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26.4</span><span style=\"color: #808000; text-decoration-color: #808000\">...</span><span style=\"font-weight: bold\">&gt;</span> │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'xmin'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.75130462646484</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'xmax'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.74915313720703</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">}</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │ <span style=\"font-weight: bold\">[{</span><span style=\"color: #808000; text-decoration-color: #808000\">...</span><span style=\"font-weight: bold\">}]</span>                                                                          │ <span style=\"color: #008000; text-decoration-color: #008000\">barrier</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">fence </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>                                                                             │  <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span> │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'barrier'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'fence'</span><span style=\"font-weight: bold\">}</span>   │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">08b48766e2a1dfff0001bf9082d6913e</span> │ <span style=\"font-weight: bold\">&lt;</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold\">LINESTRING</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">(</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.512</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26.374</span><span style=\"color: #000000; text-decoration-color: #000000\">, </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.516</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26.368</span><span style=\"color: #000000; text-decoration-color: #000000; font-weight: bold\">)</span><span style=\"font-weight: bold\">&gt;</span>                                  │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'xmin'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.51585388183594</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'xmax'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">-112.51177978515625</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">}</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │ <span style=\"font-weight: bold\">[{</span><span style=\"color: #808000; text-decoration-color: #808000\">...</span><span style=\"font-weight: bold\">}]</span>                                                                          │ <span style=\"color: #008000; text-decoration-color: #008000\">airport</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">runway</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">unpaved</span> │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'primary'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'03/21'</span>, <span style=\"color: #008000; text-decoration-color: #008000\">'common'</span>: <span style=\"color: #800080; text-decoration-color: #800080; font-style: italic\">None</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span><span style=\"font-weight: bold\">}</span>                                     │  <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span> │ <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'surface'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'unpaved'</span><span style=\"font-weight: bold\">}</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                                                                │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                                                  │       <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                                                                │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                                                                                │     <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>        │\n└──────────────────────────────────┴──────────────────────────────────────────────────────────────────────────────────┴────────────────────────────────────────────────────────────────────┴─────────┴──────────────────────────────────────────────────────────────────────────────────┴─────────┴────────┴─────────┴──────────────────────────────────────────────────────────────────────────────────┴───────┴────────────────────────┴──────────┘\n</pre>\n```\n:::\n:::\n\n\nWe take a look at the subtypes of infrastructure:\n\n::: {#3d535ba3 .cell execution_count=3}\n``` {.python .cell-code}\nusa_infra.subtype.value_counts().preview(max_rows=15)\n```\n\n::: {.cell-output .cell-output-display execution_count=10}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> subtype          </span>┃<span style=\"font-weight: bold\"> subtype_count </span>┃\n┡━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>         │\n├──────────────────┼───────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">utility         </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">522731</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">bridge          </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">837941</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">aerialway       </span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">29681</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">airport         </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">139602</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">communication   </span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">85119</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">pier            </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">173408</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">tower           </span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">44226</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">recreation      </span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">26958</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">power           </span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">7188023</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">transit         </span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2609816</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">barrier         </span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3236898</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">pedestrian      </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">443787</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">waste_management</span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">133733</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">water           </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">125102</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">manhole         </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">147852</span> │\n└──────────────────┴───────────────┘\n</pre>\n```\n:::\n:::\n\n\nIf we want to look at power lines we need to look into `subtype==\"power\"`\nand see what kind of `class` we have in there.\n\n::: {#750a4c9a .cell execution_count=4}\n``` {.python .cell-code}\n(usa_infra.filter(_.subtype==\"power\")[\"class\"]\n          .value_counts()\n          .order_by(ibis.desc(\"class_count\"))\n          )\n```\n\n::: {.cell-output .cell-output-display execution_count=11}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━┳━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> class       </span>┃<span style=\"font-weight: bold\"> class_count </span>┃\n┡━━━━━━━━━━━━━╇━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>       │\n├─────────────┼─────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">power_pole </span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3007451</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">power_tower</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2608933</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">generator  </span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">952415</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">power_line </span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">252060</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">minor_line </span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">114593</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">substation </span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">65364</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">portal     </span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">59237</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">switch     </span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">52279</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">transformer</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">51710</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">plant      </span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">12495</span> │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>           │           <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │\n└─────────────┴─────────────┘\n</pre>\n```\n:::\n:::\n\n\nLooks like we have `plants`, `power_lines` and `minor_lines`, so we can make get some nice maps.\n\n::: {#ecb97136 .cell execution_count=5}\n``` {.python .cell-code}\nplants = usa_infra.filter(_.subtype==\"power\", usa_infra[\"class\"]==\"plant\")\npower_lines = usa_infra.filter(_.subtype==\"power\", usa_infra[\"class\"]==\"power_line\")\nminor_lines = usa_infra.filter(_.subtype==\"power\", usa_infra[\"class\"]==\"minor_line\")\n```\n:::\n\n\n## Plotting\n\n**Note: maybe here explain why lonboard ?**\n\n::: {.callout-note}\nYou can try this in your machine, for the purpose the blog file size, we will show\nscreenshots of the visualization\n:::\n\n```python\nimport lonboard\nfrom lonboard.basemap import CartoBasemap # to choose color of basemap\n```\n\nLet's visualize the `power plants`\n\n```python\nlonboard.viz(plants,\n            scatterplot_kwargs={\"get_fill_color\": \"red\"},\n            polygon_kwargs={\"get_fill_color\": \"red\"},\n            map_kwargs={\"basemap_style\": CartoBasemap.Positron,\n            \"view_state\": {\"longitude\": -100, \"latitude\": 36, \"zoom\": 3}\n            })\n```\n\n![Power plants in the USA](usa-power-plants.png)\n\nIf you are visualizing this in your machine, you can zoom in and see some of the \ngeometry where the plants are located. But as an example, we can plot in a small \narea of California:\n\n```python\nplants_CA = plants.filter(_.bbox.xmin.between(-118.6, -117.9),\n           _.bbox.ymin.between(34.5, 35.3))[_.names.primary, _.geometry]\n```\n\n```python\nlonboard.viz(plants_CA,\n            scatterplot_kwargs={\"get_fill_color\": \"red\"},\n            polygon_kwargs={\"get_fill_color\": \"red\"},\n            map_kwargs={\"basemap_style\": CartoBasemap.Positron,\n            })\n```\n\n![Power plants near Lancaster CA](ca-power-plants.png)\n\nWe can also visualize together the `power_lines` and the `minor_lines` by doing:\n\n\n```python\nlonboard.viz([minor_lines, power_lines])\n```\n\n![Minor and Power lines of USA](usa-power-and-minor-lines.png)\n\nand that's how you can visualize ~7 million points from the comfort of\nyour laptop.\n\nNote: I got the ~7M by adding the number of points in power_lines and minor_lines. I'm not sure if plotting the lines that connect these points add points to this.\n\n```python\n>>> power_lines.geometry.n_points().sum()\n5329836\n>>> minor_lines.geometry.n_points().sum()\n1430042\n```\n\nWith Ibis and DuckDB working with geospatial data has never been easier or faster.\nWe saw how to query a dataset from Overture Maps with the simplicity of Python and\nthe performance of DuckDB. Last but not least, we saw how simple and quick lonboard\ngot us from query-to-plot. Together, these libraries make exploring and handling\ngeospatial data a breeze.\n\n\n## Resources\n- [Ibis Docs](https://ibis-project.org/)\n- [Lonboard Docs](https://developmentseed.org/lonboard/latest/)\n- [DuckDB spatial extension](https://duckdb.org/docs/extensions/spatial.html)\n- [DuckDB spatial functions docs](https://github.com/duckdb/duckdb_spatial/blob/main/docs/functions.md)\n\nChat with us on Zulip:\n\n- [Ibis Zulip Chat](https://ibis-project.zulipchat.com/)\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}