{
  "hash": "cae139cc73eea2ad94d7c3ede8a68d0b",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Querying 1TB of data in Python on a laptop\"\nauthor: \"Cody Peterson\"\ndate: \"2024-07-01\"\n#image: ibis-duckdb-sort.gif\ncategories:\n    - benchmark\n    - duckdb\n    - datafusion\n    - polars\n---\n\n***TPC-H benchmark at `sf=1024` via DuckDB, DataFusion, and Polars on a MacBook\nPro with 96GiB of RAM.***\n\n---\n\npandas requires your dataframe to fit in memory. Out-of-memory (OOM) errors are\ncommon when working on larger datasets, though the corresponding size of data on\ndisk can be surprising. The creator of pandas and Ibis noted in [\"Apache\nArrow and the '10 Things I Hate About\npandas'\"](https://wesmckinney.com/blog/apache-arrow-pandas-internals):\n\n> To put it simply, **we weren’t thinking about analyzing 100 GB or 1 TB datasets\n> in 2011**. [In 2017], my rule of thumb for pandas is that **you should have 5 to\n> 10 times as much RAM as the size of your dataset**. So if you have a 10 GB\n> dataset, you should really have about 64, preferably 128 GB of RAM if you want\n> to avoid memory management problems. This comes as a shock to users who expect\n> to be able to analyze datasets that are within a factor of 2 or 3 the size of\n> their computer’s RAM.\n\nToday with Ibis you can reliably and efficiently process a 1TB dataset on a\nlaptop with <1/10th the RAM.\n\n:::{.callout-note title=\"How does Ibis work? Separation of query from engine\"\n collapse=\"true\"}\nWell...\n:::\n\n## Exploring the data with Python dataframes\n\nI've generated ~1TB (`sf=1024`) of [TPC-H data](https://www.tpc.org/tpch) on my\nMacBook Pro with 96 GiB of RAM. We'll start exploring it with pandas, Polars,\nand Ibis and discuss where and why they start to struggle.\n\n:::{.callout-tip title=\"Generating the data\" collapse=\"true\"}\nSee [the previous post](../ibis-bench/index.qmd#reproducing-the-benchmark) for\ninstructions on generating the data. I used `bench gen-data -s 1024 -n 128`,\npartitioning the data to avoid OOM errors while it generated.\n\nI'd recommend instead generating a smaller scale factor and copying it as many\ntimes as needed, as generating the data at `sf=1024` can take a long time.\n:::\n\nTo follow along, install the required packages:\n\n```bash\npip install pandas 'ibis-framework[duckdb,datafusion]' polars-u64-idx plotly\n```\n\n:::{.callout-note title=\"Why polars-u64-idx?\" collapse=\"true\"}\nWe need to use `polars-u64-idx` instead of `polars` [to work with >4.2 billion\nrows](https://docs.pola.rs/user-guide/installation/#big-index).\n:::\n\nImports and setup:\n\n::: {#c385dd1a .cell execution_count=2}\n``` {.python .cell-code}\nimport os\nimport glob\nimport ibis\nimport pandas as pd\nimport polars as pl\nimport plotly.express as px\n\npx.defaults.template = \"plotly_dark\"\nibis.options.interactive = True\n```\n:::\n\n\n\n\nLet's check the number of rows across all tables in the TPC-H data:\n\n::: {#e7d13ac6 .cell execution_count=4}\n``` {.python .cell-code code-fold=\"true\" code-summary=\"Show code to get number of rows in TPC-H data\"}\nsf = 1024\nn = 128\ndata_dir = f\"tpch_data/parquet/sf={sf}/n={n}\"\ntables = glob.glob(f\"{data_dir}/*\")\n\ntotal_rows = 0\n\nfor table in tables:\n    t = ibis.read_parquet(f\"{table}/*.parquet\")\n    total_rows += t.count().to_pyarrow().as_py()\n\nprint(f\"total rows: {total_rows:,}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\ntotal rows: 8,867,848,906\n```\n:::\n:::\n\n\nOver 8.8 billion rows!\n\nWe can compute and visualize the sizes of the tables in the TPC-H data (as\ncompressed Parquet files on disk):\n\n::: {#3cacf19a .cell execution_count=5}\n``` {.python .cell-code code-fold=\"true\" code-summary=\"Show code to get sizes of tables in TPC-H data\"}\ndef get_dir_size(path):\n    from pathlib import Path\n\n    return sum(p.stat().st_size for p in Path(path).rglob(\"*\") if p.is_file())\n\n\nsizes = [get_dir_size(table) for table in tables]\nnames = [os.path.basename(table) for table in tables]\n\ntmp = ibis.memtable({\"name\": names, \"size\": sizes})\ntmp = tmp.mutate(size_gb=tmp[\"size\"] / (1024**3))\ntmp = tmp.order_by(ibis.desc(\"size_gb\"))\ntmp = tmp.mutate(size_gb_mem=tmp[\"size_gb\"] * 11 / 5)\n\nc = px.bar(\n    tmp,\n    x=\"name\",\n    y=\"size_gb\",\n    title=\"table sizes in TPC-H data\",\n    hover_data=[\"size_gb_mem\"],\n    labels={\n        \"name\": \"table name\",\n        \"size_gb\": \"size (GB on-disk in compressed Parquet files)\",\n        \"size_gb_mem\": \"size (approximate GB in memory)\",\n    },\n    # color=\"size_gb\",\n    # color_continuous_scale=\"viridis\",\n)\n\nprint(\n    f\"total size: {tmp['size_gb'].sum().to_pyarrow().as_py():,.2f}GBs (compressed Parquet files)\"\n)\nc\n```\n\n::: {.cell-output .cell-output-stdout}\n```\ntotal size: 407.40GBs (compressed Parquet files)\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<div>                            <div id=\"5231d4e7-c0b5-4f67-8903-29d464b4435e\" class=\"plotly-graph-div\" style=\"height:525px; width:100%;\"></div>            <script type=\"text/javascript\">                require([\"plotly\"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById(\"5231d4e7-c0b5-4f67-8903-29d464b4435e\")) {                    Plotly.newPlot(                        \"5231d4e7-c0b5-4f67-8903-29d464b4435e\",                        [{\"alignmentgroup\":\"True\",\"customdata\":[[610.57368901968],[148.12477697525173],[94.80156523771583],[26.504523511976004],[14.584088899753988],[1.6873541740700602],[7.024072110652923e-05],[3.30120325088501e-05]],\"hovertemplate\":\"table name=%{x}\\u003cbr\\u003esize (GB on-disk in compressed Parquet files)=%{y}\\u003cbr\\u003esize (approximate GB in memory)=%{customdata[0]}\\u003cextra\\u003e\\u003c\\u002fextra\\u003e\",\"legendgroup\":\"\",\"marker\":{\"color\":\"#636efa\",\"pattern\":{\"shape\":\"\"}},\"name\":\"\",\"offsetgroup\":\"\",\"orientation\":\"v\",\"showlegend\":false,\"textposition\":\"auto\",\"x\":[\"lineitem\",\"orders\",\"partsupp\",\"customer\",\"part\",\"supplier\",\"nation\",\"region\"],\"xaxis\":\"x\",\"y\":[277.53349500894547,67.32944407965988,43.09162056259811,12.04751068726182,6.6291313180699944,0.7669791700318456,3.1927600502967834e-05,1.500546932220459e-05],\"yaxis\":\"y\",\"type\":\"bar\"}],                        {\"template\":{\"data\":{\"barpolar\":[{\"marker\":{\"line\":{\"color\":\"rgb(17,17,17)\",\"width\":0.5},\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"barpolar\"}],\"bar\":[{\"error_x\":{\"color\":\"#f2f5fa\"},\"error_y\":{\"color\":\"#f2f5fa\"},\"marker\":{\"line\":{\"color\":\"rgb(17,17,17)\",\"width\":0.5},\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"bar\"}],\"carpet\":[{\"aaxis\":{\"endlinecolor\":\"#A2B1C6\",\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"minorgridcolor\":\"#506784\",\"startlinecolor\":\"#A2B1C6\"},\"baxis\":{\"endlinecolor\":\"#A2B1C6\",\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"minorgridcolor\":\"#506784\",\"startlinecolor\":\"#A2B1C6\"},\"type\":\"carpet\"}],\"choropleth\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"type\":\"choropleth\"}],\"contourcarpet\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"type\":\"contourcarpet\"}],\"contour\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"contour\"}],\"heatmapgl\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"heatmapgl\"}],\"heatmap\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"heatmap\"}],\"histogram2dcontour\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"histogram2dcontour\"}],\"histogram2d\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"histogram2d\"}],\"histogram\":[{\"marker\":{\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"histogram\"}],\"mesh3d\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"type\":\"mesh3d\"}],\"parcoords\":[{\"line\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"parcoords\"}],\"pie\":[{\"automargin\":true,\"type\":\"pie\"}],\"scatter3d\":[{\"line\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scatter3d\"}],\"scattercarpet\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scattercarpet\"}],\"scattergeo\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scattergeo\"}],\"scattergl\":[{\"marker\":{\"line\":{\"color\":\"#283442\"}},\"type\":\"scattergl\"}],\"scattermapbox\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scattermapbox\"}],\"scatterpolargl\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scatterpolargl\"}],\"scatterpolar\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scatterpolar\"}],\"scatter\":[{\"marker\":{\"line\":{\"color\":\"#283442\"}},\"type\":\"scatter\"}],\"scatterternary\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scatterternary\"}],\"surface\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"surface\"}],\"table\":[{\"cells\":{\"fill\":{\"color\":\"#506784\"},\"line\":{\"color\":\"rgb(17,17,17)\"}},\"header\":{\"fill\":{\"color\":\"#2a3f5f\"},\"line\":{\"color\":\"rgb(17,17,17)\"}},\"type\":\"table\"}]},\"layout\":{\"annotationdefaults\":{\"arrowcolor\":\"#f2f5fa\",\"arrowhead\":0,\"arrowwidth\":1},\"autotypenumbers\":\"strict\",\"coloraxis\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"colorscale\":{\"diverging\":[[0,\"#8e0152\"],[0.1,\"#c51b7d\"],[0.2,\"#de77ae\"],[0.3,\"#f1b6da\"],[0.4,\"#fde0ef\"],[0.5,\"#f7f7f7\"],[0.6,\"#e6f5d0\"],[0.7,\"#b8e186\"],[0.8,\"#7fbc41\"],[0.9,\"#4d9221\"],[1,\"#276419\"]],\"sequential\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"sequentialminus\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]},\"colorway\":[\"#636efa\",\"#EF553B\",\"#00cc96\",\"#ab63fa\",\"#FFA15A\",\"#19d3f3\",\"#FF6692\",\"#B6E880\",\"#FF97FF\",\"#FECB52\"],\"font\":{\"color\":\"#f2f5fa\"},\"geo\":{\"bgcolor\":\"rgb(17,17,17)\",\"lakecolor\":\"rgb(17,17,17)\",\"landcolor\":\"rgb(17,17,17)\",\"showlakes\":true,\"showland\":true,\"subunitcolor\":\"#506784\"},\"hoverlabel\":{\"align\":\"left\"},\"hovermode\":\"closest\",\"mapbox\":{\"style\":\"dark\"},\"margin\":{\"b\":0,\"l\":0,\"r\":0,\"t\":30},\"paper_bgcolor\":\"rgb(17,17,17)\",\"plot_bgcolor\":\"rgb(17,17,17)\",\"polar\":{\"angularaxis\":{\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"ticks\":\"\"},\"bgcolor\":\"rgb(17,17,17)\",\"radialaxis\":{\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"ticks\":\"\"}},\"scene\":{\"xaxis\":{\"backgroundcolor\":\"rgb(17,17,17)\",\"gridcolor\":\"#506784\",\"gridwidth\":2,\"linecolor\":\"#506784\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"#C8D4E3\"},\"yaxis\":{\"backgroundcolor\":\"rgb(17,17,17)\",\"gridcolor\":\"#506784\",\"gridwidth\":2,\"linecolor\":\"#506784\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"#C8D4E3\"},\"zaxis\":{\"backgroundcolor\":\"rgb(17,17,17)\",\"gridcolor\":\"#506784\",\"gridwidth\":2,\"linecolor\":\"#506784\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"#C8D4E3\"}},\"shapedefaults\":{\"line\":{\"color\":\"#f2f5fa\"}},\"sliderdefaults\":{\"bgcolor\":\"#C8D4E3\",\"bordercolor\":\"rgb(17,17,17)\",\"borderwidth\":1,\"tickwidth\":0},\"ternary\":{\"aaxis\":{\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"ticks\":\"\"},\"baxis\":{\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"ticks\":\"\"},\"bgcolor\":\"rgb(17,17,17)\",\"caxis\":{\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"ticks\":\"\"}},\"title\":{\"x\":0.05},\"updatemenudefaults\":{\"bgcolor\":\"#506784\",\"borderwidth\":0},\"xaxis\":{\"automargin\":true,\"gridcolor\":\"#283442\",\"linecolor\":\"#506784\",\"ticks\":\"\",\"title\":{\"standoff\":15},\"zerolinecolor\":\"#283442\",\"zerolinewidth\":2},\"yaxis\":{\"automargin\":true,\"gridcolor\":\"#283442\",\"linecolor\":\"#506784\",\"ticks\":\"\",\"title\":{\"standoff\":15},\"zerolinecolor\":\"#283442\",\"zerolinewidth\":2}}},\"xaxis\":{\"anchor\":\"y\",\"domain\":[0.0,1.0],\"title\":{\"text\":\"table name\"}},\"yaxis\":{\"anchor\":\"x\",\"domain\":[0.0,1.0],\"title\":{\"text\":\"size (GB on-disk in compressed Parquet files)\"}},\"legend\":{\"tracegroupgap\":0},\"title\":{\"text\":\"table sizes in TPC-H data\"},\"barmode\":\"relative\"},                        {\"responsive\": true}                    ).then(function(){\n                            \nvar gd = document.getElementById('5231d4e7-c0b5-4f67-8903-29d464b4435e');\nvar x = new MutationObserver(function (mutations, observer) {{\n        var display = window.getComputedStyle(gd).display;\n        if (!display || display === 'none') {{\n            console.log([gd, 'removed!']);\n            Plotly.purge(gd);\n            observer.disconnect();\n        }}\n}});\n\n// Listen for the removal of the full notebook cells\nvar notebookContainer = gd.closest('#notebook-container');\nif (notebookContainer) {{\n    x.observe(notebookContainer, {childList: true});\n}}\n\n// Listen for the clearing of the current output cell\nvar outputEl = gd.closest('.output');\nif (outputEl) {{\n    x.observe(outputEl, {childList: true});\n}}\n\n                        })                };                });            </script>        </div>\n```\n:::\n:::\n\n\nIn-memory this would be about 1TB. Uncompressed CSV files would be >1TB on disk.\n\nLet's explore the largest table, `lineitem`. This table in memory is ~6X larger\nthan RAM.\n\n::: {#b6759c5e .cell execution_count=6}\n``` {.python .cell-code code-fold=\"true\" code-summary=\"Show code to explore the lineitem table\"}\nsf = 1\nn = 1\ndata_dir = f\"tpch_data/parquet/sf={sf}/n={n}\"\n\ntable_name = \"lineitem\"\ndata = f\"{data_dir}/{table_name}/*.parquet\"\n\nt = ibis.read_parquet(data)\nprint(f\"rows: {t.count().to_pyarrow().as_py():,} | columns: {len(t.columns)}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nrows: 6,001,215 | columns: 18\n```\n:::\n:::\n\n\nOver 6 billion rows!\n\nLet's try to display the first few rows with Ibis, pandas, and Polars:\n\n::: {.panel-tabset}\n\n## Ibis\n\n::: {#4418e774 .cell execution_count=7}\n``` {.python .cell-code}\nt = ibis.read_parquet(data)\nt.head(3)\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━┳━━━━━━━┓\n┃<span style=\"font-weight: bold\"> l_orderkey </span>┃<span style=\"font-weight: bold\"> l_partkey </span>┃<span style=\"font-weight: bold\"> l_suppkey </span>┃<span style=\"font-weight: bold\"> l_linenumber </span>┃<span style=\"font-weight: bold\"> l_quantity     </span>┃<span style=\"font-weight: bold\"> l_extendedprice </span>┃<span style=\"font-weight: bold\"> l_discount     </span>┃<span style=\"font-weight: bold\"> l_tax          </span>┃<span style=\"font-weight: bold\"> l_returnflag </span>┃<span style=\"font-weight: bold\"> l_linestatus </span>┃<span style=\"font-weight: bold\"> l_shipdate </span>┃<span style=\"font-weight: bold\"> l_commitdate </span>┃<span style=\"font-weight: bold\"> l_receiptdate </span>┃<span style=\"font-weight: bold\"> l_shipinstruct    </span>┃<span style=\"font-weight: bold\"> l_shipmode </span>┃<span style=\"font-weight: bold\"> l_comment                          </span>┃<span style=\"font-weight: bold\"> n     </span>┃<span style=\"font-weight: bold\"> sf    </span>┃\n┡━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━╇━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>        │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">decimal(15, 2)</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">decimal(15, 2)</span>  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">decimal(15, 2)</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">decimal(15, 2)</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">date</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">date</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">date</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>            │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                             │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span> │\n├────────────┼───────────┼───────────┼──────────────┼────────────────┼─────────────────┼────────────────┼────────────────┼──────────────┼──────────────┼────────────┼──────────────┼───────────────┼───────────────────┼────────────┼────────────────────────────────────┼───────┼───────┤\n│          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">155190</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">7706</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">17.00</span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">21168.23</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.04</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.02</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">N           </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">O           </span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-03-13</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-02-12</span>   │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-03-22</span>    │ <span style=\"color: #008000; text-decoration-color: #008000\">DELIVER IN PERSON</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">TRUCK     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">to beans x-ray carefull           </span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │\n│          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">67310</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">7311</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">36.00</span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">45983.16</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.09</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.06</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">N           </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">O           </span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-04-12</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-02-28</span>   │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-04-20</span>    │ <span style=\"color: #008000; text-decoration-color: #008000\">TAKE BACK RETURN </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">MAIL      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\"> according to the final foxes. qui</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │\n│          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">63700</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3701</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">8.00</span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">13309.60</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.10</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.02</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">N           </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">O           </span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-01-29</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-03-05</span>   │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-01-31</span>    │ <span style=\"color: #008000; text-decoration-color: #008000\">TAKE BACK RETURN </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">REG AIR   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ourts cajole above the furiou     </span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │\n└────────────┴───────────┴───────────┴──────────────┴────────────────┴─────────────────┴────────────────┴────────────────┴──────────────┴──────────────┴────────────┴──────────────┴───────────────┴───────────────────┴────────────┴────────────────────────────────────┴───────┴───────┘\n</pre>\n```\n:::\n:::\n\n\n## pandas\n\n```{.python}\ndf = pd.concat([pd.read_parquet(f) for f in glob.glob(data)], ignore_index=True) # <1>\ndf.head(3)\n```\n\n1. Work around lack of reading multiple parquet files in pandas\n\n```html\nThe Kernel crashed while executing code in the current cell or a previous cell.\nPlease review the code in the cell(s) to identify a possible cause of the failure.\nClick here for more info.\nView Jupyter log for further details.\n```\n\n## Polars (eager)\n\n```{.python}\ndf = pl.read_parquet(data)\ndf.head(3)\n```\n\n```html\nThe Kernel crashed while executing code in the current cell or a previous cell.\nPlease review the code in the cell(s) to identify a possible cause of the failure.\nClick here for more info.\nView Jupyter log for further details.\n```\n\n## Polars (lazy)\n\n::: {#06975490 .cell execution_count=8}\n``` {.python .cell-code}\ndf = pl.scan_parquet(data)\ndf.head(3).collect()\n```\n\n::: {.cell-output .cell-output-display execution_count=7}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (3, 16)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>l_orderkey</th><th>l_partkey</th><th>l_suppkey</th><th>l_linenumber</th><th>l_quantity</th><th>l_extendedprice</th><th>l_discount</th><th>l_tax</th><th>l_returnflag</th><th>l_linestatus</th><th>l_shipdate</th><th>l_commitdate</th><th>l_receiptdate</th><th>l_shipinstruct</th><th>l_shipmode</th><th>l_comment</th></tr><tr><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>decimal[15,2]</td><td>decimal[15,2]</td><td>decimal[15,2]</td><td>decimal[15,2]</td><td>str</td><td>str</td><td>date</td><td>date</td><td>date</td><td>str</td><td>str</td><td>str</td></tr></thead><tbody><tr><td>1</td><td>155190</td><td>7706</td><td>1</td><td>17.00</td><td>21168.23</td><td>0.04</td><td>0.02</td><td>&quot;N&quot;</td><td>&quot;O&quot;</td><td>1996-03-13</td><td>1996-02-12</td><td>1996-03-22</td><td>&quot;DELIVER IN PERSON&quot;</td><td>&quot;TRUCK&quot;</td><td>&quot;to beans x-ray carefull&quot;</td></tr><tr><td>1</td><td>67310</td><td>7311</td><td>2</td><td>36.00</td><td>45983.16</td><td>0.09</td><td>0.06</td><td>&quot;N&quot;</td><td>&quot;O&quot;</td><td>1996-04-12</td><td>1996-02-28</td><td>1996-04-20</td><td>&quot;TAKE BACK RETURN&quot;</td><td>&quot;MAIL&quot;</td><td>&quot; according to the final foxes.…</td></tr><tr><td>1</td><td>63700</td><td>3701</td><td>3</td><td>8.00</td><td>13309.60</td><td>0.10</td><td>0.02</td><td>&quot;N&quot;</td><td>&quot;O&quot;</td><td>1996-01-29</td><td>1996-03-05</td><td>1996-01-31</td><td>&quot;TAKE BACK RETURN&quot;</td><td>&quot;REG AIR&quot;</td><td>&quot;ourts cajole above the furiou&quot;</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n## Polars (lazy, streaming)\n\n::: {#2c0dba35 .cell execution_count=9}\n``` {.python .cell-code}\ndf = pl.scan_parquet(data)\ndf.head(3).collect(streaming=True)\n```\n\n::: {.cell-output .cell-output-display execution_count=8}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (3, 16)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>l_orderkey</th><th>l_partkey</th><th>l_suppkey</th><th>l_linenumber</th><th>l_quantity</th><th>l_extendedprice</th><th>l_discount</th><th>l_tax</th><th>l_returnflag</th><th>l_linestatus</th><th>l_shipdate</th><th>l_commitdate</th><th>l_receiptdate</th><th>l_shipinstruct</th><th>l_shipmode</th><th>l_comment</th></tr><tr><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>decimal[15,2]</td><td>decimal[15,2]</td><td>decimal[15,2]</td><td>decimal[15,2]</td><td>str</td><td>str</td><td>date</td><td>date</td><td>date</td><td>str</td><td>str</td><td>str</td></tr></thead><tbody><tr><td>1</td><td>155190</td><td>7706</td><td>1</td><td>17.00</td><td>21168.23</td><td>0.04</td><td>0.02</td><td>&quot;N&quot;</td><td>&quot;O&quot;</td><td>1996-03-13</td><td>1996-02-12</td><td>1996-03-22</td><td>&quot;DELIVER IN PERSON&quot;</td><td>&quot;TRUCK&quot;</td><td>&quot;to beans x-ray carefull&quot;</td></tr><tr><td>1</td><td>67310</td><td>7311</td><td>2</td><td>36.00</td><td>45983.16</td><td>0.09</td><td>0.06</td><td>&quot;N&quot;</td><td>&quot;O&quot;</td><td>1996-04-12</td><td>1996-02-28</td><td>1996-04-20</td><td>&quot;TAKE BACK RETURN&quot;</td><td>&quot;MAIL&quot;</td><td>&quot; according to the final foxes.…</td></tr><tr><td>1</td><td>63700</td><td>3701</td><td>3</td><td>8.00</td><td>13309.60</td><td>0.10</td><td>0.02</td><td>&quot;N&quot;</td><td>&quot;O&quot;</td><td>1996-01-29</td><td>1996-03-05</td><td>1996-01-31</td><td>&quot;TAKE BACK RETURN&quot;</td><td>&quot;REG AIR&quot;</td><td>&quot;ourts cajole above the furiou&quot;</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n:::\n\nIbis, with the default backend of DuckDB, can display the first few rows. Polars (lazy)\ncan handle this in regular and streaming mode. Both pandas and Polars (eager) crash\nthe kernel as they must load all the data into memory to construct their\ndataframes. Since this table is at ~6X larger than our 96GiB of RAM, we can't\nload it all.\n\nFor lazily computed Python dataframes, an underlying query engine has the\nopportunity to determine a subset of data to be read into memory that satisfies\na given query. For example, to display any three rows from the `lineitem` table\nit can just read the first three rows from the first Parquet file in the\ndataset.\n\n:::{.callout-tip title=\"Visualize the Ibis expression tree\" collapse=\"true\"}\n\n::: {#f45fb3aa .cell execution_count=10}\n``` {.python .cell-code code-fold=\"true\" code-summary=\"Show code to visualize the Ibis expression tree\"}\nfrom ibis.expr.visualize import to_graph\n\nto_graph(t.head(3))\n```\n\n::: {.cell-output .cell-output-display execution_count=9}\n![](index_files/figure-html/cell-10-output-1.svg){}\n:::\n:::\n\n\n:::\n\nLet's try something more challenging: [partially\nsorting](https://en.wikipedia.org/wiki/Partial_sorting) the `lineitem` table.\nThis forces at least some columns from all rows of data to pass through the\nquery engine to determine the top 3 rows per the specified ordering. Since the\ndata is larger than RAM, only \"streaming\" engines can handle this. We'll try\nwith the methods that worked on the previous query and add in the DataFusion\nbackend for Ibis.\n\n::: {.panel-tabset}\n\n## Ibis (DuckDB)\n\n```{.python}\nibis.set_backend(\"duckdb\")\nt = ibis.read_parquet(data)\nt.order_by(t[\"l_orderkey\"], t[\"l_partkey\"], t[\"l_suppkey\"]).head(3)\n```\n\n::: {#a586c5e9 .cell execution_count=11}\n\n::: {.cell-output .cell-output-display execution_count=10}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━┳━━━━━━━┓\n┃<span style=\"font-weight: bold\"> l_orderkey </span>┃<span style=\"font-weight: bold\"> l_partkey </span>┃<span style=\"font-weight: bold\"> l_suppkey </span>┃<span style=\"font-weight: bold\"> l_linenumber </span>┃<span style=\"font-weight: bold\"> l_quantity     </span>┃<span style=\"font-weight: bold\"> l_extendedprice </span>┃<span style=\"font-weight: bold\"> l_discount     </span>┃<span style=\"font-weight: bold\"> l_tax          </span>┃<span style=\"font-weight: bold\"> l_returnflag </span>┃<span style=\"font-weight: bold\"> l_linestatus </span>┃<span style=\"font-weight: bold\"> l_shipdate </span>┃<span style=\"font-weight: bold\"> l_commitdate </span>┃<span style=\"font-weight: bold\"> l_receiptdate </span>┃<span style=\"font-weight: bold\"> l_shipinstruct    </span>┃<span style=\"font-weight: bold\"> l_shipmode </span>┃<span style=\"font-weight: bold\"> l_comment                </span>┃<span style=\"font-weight: bold\"> n     </span>┃<span style=\"font-weight: bold\"> sf    </span>┃\n┡━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━╇━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>        │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">decimal(15, 2)</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">decimal(15, 2)</span>  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">decimal(15, 2)</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">decimal(15, 2)</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">date</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">date</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">date</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>            │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                   │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span> │\n├────────────┼───────────┼───────────┼──────────────┼────────────────┼─────────────────┼────────────────┼────────────────┼──────────────┼──────────────┼────────────┼──────────────┼───────────────┼───────────────────┼────────────┼──────────────────────────┼───────┼───────┤\n│          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2132</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4633</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">28.00</span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">28955.64</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.09</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.06</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">N           </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">O           </span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-04-21</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-03-30</span>   │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-05-16</span>    │ <span style=\"color: #008000; text-decoration-color: #008000\">NONE             </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">AIR       </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">s cajole busily above t </span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │\n│          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">15635</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">638</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">6</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">32.00</span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">49620.16</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.07</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.02</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">N           </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">O           </span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-01-30</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-02-07</span>   │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-02-03</span>    │ <span style=\"color: #008000; text-decoration-color: #008000\">DELIVER IN PERSON</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">MAIL      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">rouches. special        </span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │\n│          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">24027</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1534</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">24.00</span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">22824.48</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.10</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.04</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">N           </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">O           </span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-03-30</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-03-14</span>   │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-04-01</span>    │ <span style=\"color: #008000; text-decoration-color: #008000\">NONE             </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">FOB       </span> │ <span style=\"color: #008000; text-decoration-color: #008000\"> the regular, regular pa</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │\n└────────────┴───────────┴───────────┴──────────────┴────────────────┴─────────────────┴────────────────┴────────────────┴──────────────┴──────────────┴────────────┴──────────────┴───────────────┴───────────────────┴────────────┴──────────────────────────┴───────┴───────┘\n</pre>\n```\n:::\n:::\n\n\n## Ibis (DataFusion)\n\n::: {#836d5cd9 .cell execution_count=12}\n``` {.python .cell-code}\nibis.set_backend(\"datafusion\")\nt = ibis.read_parquet(data)\nt.order_by(t[\"l_orderkey\"], t[\"l_partkey\"], t[\"l_suppkey\"]).head(3)\n```\n\n::: {.cell-output .cell-output-display execution_count=11}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> l_orderkey </span>┃<span style=\"font-weight: bold\"> l_partkey </span>┃<span style=\"font-weight: bold\"> l_suppkey </span>┃<span style=\"font-weight: bold\"> l_linenumber </span>┃<span style=\"font-weight: bold\"> l_quantity     </span>┃<span style=\"font-weight: bold\"> l_extendedprice </span>┃<span style=\"font-weight: bold\"> l_discount     </span>┃<span style=\"font-weight: bold\"> l_tax          </span>┃<span style=\"font-weight: bold\"> l_returnflag </span>┃<span style=\"font-weight: bold\"> l_linestatus </span>┃<span style=\"font-weight: bold\"> l_shipdate </span>┃<span style=\"font-weight: bold\"> l_commitdate </span>┃<span style=\"font-weight: bold\"> l_receiptdate </span>┃<span style=\"font-weight: bold\"> l_shipinstruct    </span>┃<span style=\"font-weight: bold\"> l_shipmode </span>┃<span style=\"font-weight: bold\"> l_comment                </span>┃\n┡━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>        │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">decimal(15, 2)</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">decimal(15, 2)</span>  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">decimal(15, 2)</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">decimal(15, 2)</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">date</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">date</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">date</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>            │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                   │\n├────────────┼───────────┼───────────┼──────────────┼────────────────┼─────────────────┼────────────────┼────────────────┼──────────────┼──────────────┼────────────┼──────────────┼───────────────┼───────────────────┼────────────┼──────────────────────────┤\n│          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2132</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4633</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">28.00</span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">28955.64</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.09</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.06</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">N           </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">O           </span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-04-21</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-03-30</span>   │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-05-16</span>    │ <span style=\"color: #008000; text-decoration-color: #008000\">NONE             </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">AIR       </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">s cajole busily above t </span> │\n│          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">15635</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">638</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">6</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">32.00</span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">49620.16</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.07</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.02</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">N           </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">O           </span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-01-30</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-02-07</span>   │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-02-03</span>    │ <span style=\"color: #008000; text-decoration-color: #008000\">DELIVER IN PERSON</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">MAIL      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">rouches. special        </span> │\n│          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">24027</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1534</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">24.00</span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">22824.48</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.10</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.04</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">N           </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">O           </span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-03-30</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-03-14</span>   │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-04-01</span>    │ <span style=\"color: #008000; text-decoration-color: #008000\">NONE             </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">FOB       </span> │ <span style=\"color: #008000; text-decoration-color: #008000\"> the regular, regular pa</span> │\n└────────────┴───────────┴───────────┴──────────────┴────────────────┴─────────────────┴────────────────┴────────────────┴──────────────┴──────────────┴────────────┴──────────────┴───────────────┴───────────────────┴────────────┴──────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n## Polars (lazy)\n\n```{.python}\ndf = pl.scan_parquet(data)\n(\n    df.sort(pl.col(\"l_orderkey\"), pl.col(\"l_partkey\"), pl.col(\"l_suppkey\"))\n    .head(3)\n    .collect()\n)\n```\n\n```html\nThe Kernel crashed while executing code in the current cell or a previous cell.\nPlease review the code in the cell(s) to identify a possible cause of the failure.\nClick here for more info.\nView Jupyter log for further details.\n```\n\n## Polars (lazy, streaming)\n\n```{.python}\ndf = pl.scan_parquet(data)\n(\n    df.sort(pl.col(\"l_orderkey\"), pl.col(\"l_partkey\"), pl.col(\"l_suppkey\"))\n    .head(3)\n    .collect(streaming=True)\n)\n```\n\n```html\nPanicException: called `Result::unwrap()` on an `Err` value: IO { error: Os {\n code: 28, kind: StorageFull, message: \"No space left on device\" }, msg: None }\n```\n\n:::\n\n:::{.callout-tip title=\"Visualize the Ibis expression tree\" collapse=\"true\"}\n\n::: {#06e2e283 .cell execution_count=13}\n``` {.python .cell-code code-fold=\"true\" code-summary=\"Show code to visualize the Ibis expression tree\"}\nfrom ibis.expr.visualize import to_graph\n\nto_graph(t.order_by(t[\"l_orderkey\"], t[\"l_partkey\"], t[\"l_suppkey\"]).head(3))\n```\n\n::: {.cell-output .cell-output-display execution_count=12}\n![](index_files/figure-html/cell-13-output-1.svg){}\n:::\n:::\n\n\n:::\n\n\nIbis with the DuckDB and DataFusion backends complete this in about 2 minutes\neach. Polars (lazy) crashes the kernel after about 2 minutes with its default\nmode and panicks in streaming mode.\n\nTODO more exposition\n\n:::{.callout-tip title=\"Sampling large datasets with Ibis\" collapse=\"true\"}\nIf we want to work with pandas or Polars dataframes at larger scales, we can use\nIbis to sample or filter the data (and perform any other operations) with\ncomputation pushed to a more scalable backend. Then just output the Ibis\ndataframe to pandas or Polars for downstream use:\n\n\n\n:::{.panel-tabset}\n\n## pandas\n\n::: {#cb498887 .cell execution_count=15}\n``` {.python .cell-code}\nt = ibis.read_parquet(data)\n\ndf = (\n    t.sample(fraction=0.01)\n    .order_by(t[\"l_orderkey\"], t[\"l_partkey\"], t[\"l_suppkey\"])\n    .to_pandas()\n)\ndf.head(3)\n```\n\n::: {.cell-output .cell-output-display execution_count=14}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>l_orderkey</th>\n      <th>l_partkey</th>\n      <th>l_suppkey</th>\n      <th>l_linenumber</th>\n      <th>l_quantity</th>\n      <th>l_extendedprice</th>\n      <th>l_discount</th>\n      <th>l_tax</th>\n      <th>l_returnflag</th>\n      <th>l_linestatus</th>\n      <th>l_shipdate</th>\n      <th>l_commitdate</th>\n      <th>l_receiptdate</th>\n      <th>l_shipinstruct</th>\n      <th>l_shipmode</th>\n      <th>l_comment</th>\n      <th>n</th>\n      <th>sf</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>68</td>\n      <td>139247</td>\n      <td>1761</td>\n      <td>7</td>\n      <td>41.00</td>\n      <td>52735.84</td>\n      <td>0.09</td>\n      <td>0.08</td>\n      <td>N</td>\n      <td>O</td>\n      <td>1998-06-24</td>\n      <td>1998-06-27</td>\n      <td>1998-07-06</td>\n      <td>NONE</td>\n      <td>SHIP</td>\n      <td>ravely busy pinto beans. regular, r</td>\n      <td>1</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>133</td>\n      <td>103432</td>\n      <td>5943</td>\n      <td>1</td>\n      <td>27.00</td>\n      <td>38756.61</td>\n      <td>0.00</td>\n      <td>0.02</td>\n      <td>N</td>\n      <td>O</td>\n      <td>1997-12-21</td>\n      <td>1998-02-23</td>\n      <td>1997-12-27</td>\n      <td>TAKE BACK RETURN</td>\n      <td>MAIL</td>\n      <td>structions sleep furiously</td>\n      <td>1</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>198</td>\n      <td>15229</td>\n      <td>7731</td>\n      <td>2</td>\n      <td>20.00</td>\n      <td>22884.40</td>\n      <td>0.03</td>\n      <td>0.00</td>\n      <td>N</td>\n      <td>O</td>\n      <td>1998-01-15</td>\n      <td>1998-03-31</td>\n      <td>1998-01-25</td>\n      <td>DELIVER IN PERSON</td>\n      <td>FOB</td>\n      <td>ithely final deposits. quic</td>\n      <td>1</td>\n      <td>1</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n## Polars\n\n::: {#5badb04b .cell execution_count=16}\n``` {.python .cell-code}\nt = ibis.read_parquet(data)\n\ndf = (\n    t.sample(fraction=0.01)\n    .order_by(t[\"l_orderkey\"], t[\"l_partkey\"], t[\"l_suppkey\"])\n    .to_polars()\n)\ndf.head(3)\n```\n\n::: {.cell-output .cell-output-display execution_count=15}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (3, 18)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>l_orderkey</th><th>l_partkey</th><th>l_suppkey</th><th>l_linenumber</th><th>l_quantity</th><th>l_extendedprice</th><th>l_discount</th><th>l_tax</th><th>l_returnflag</th><th>l_linestatus</th><th>l_shipdate</th><th>l_commitdate</th><th>l_receiptdate</th><th>l_shipinstruct</th><th>l_shipmode</th><th>l_comment</th><th>n</th><th>sf</th></tr><tr><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>decimal[15,2]</td><td>decimal[15,2]</td><td>decimal[15,2]</td><td>decimal[15,2]</td><td>str</td><td>str</td><td>date</td><td>date</td><td>date</td><td>str</td><td>str</td><td>str</td><td>i64</td><td>i64</td></tr></thead><tbody><tr><td>135</td><td>67005</td><td>9512</td><td>4</td><td>34.00</td><td>33048.00</td><td>0.02</td><td>0.03</td><td>&quot;N&quot;</td><td>&quot;O&quot;</td><td>1996-01-12</td><td>1996-01-19</td><td>1996-02-05</td><td>&quot;NONE&quot;</td><td>&quot;TRUCK&quot;</td><td>&quot;cording to the deposits. blith…</td><td>1</td><td>1</td></tr><tr><td>135</td><td>115000</td><td>2534</td><td>6</td><td>13.00</td><td>13195.00</td><td>0.04</td><td>0.02</td><td>&quot;N&quot;</td><td>&quot;O&quot;</td><td>1995-11-12</td><td>1995-12-22</td><td>1995-11-17</td><td>&quot;NONE&quot;</td><td>&quot;FOB&quot;</td><td>&quot;the packages. carefull&quot;</td><td>1</td><td>1</td></tr><tr><td>229</td><td>176948</td><td>1983</td><td>4</td><td>3.00</td><td>6074.82</td><td>0.02</td><td>0.08</td><td>&quot;R&quot;</td><td>&quot;F&quot;</td><td>1994-03-22</td><td>1994-03-24</td><td>1994-04-04</td><td>&quot;DELIVER IN PERSON&quot;</td><td>&quot;REG AIR&quot;</td><td>&quot; theodolites. blithely special…</td><td>1</td><td>1</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n:::\n\nWe can also use this to iterate more quickly on a subset of data with Ibis to\nconstruct our queries. Once we're happy with them, we can change one line of\ncode to run them on the full data.\n\n:::\n\n## 1TB TPC-H benchmark results\n\nLet's delve into the results of benchmarking ~1TB (`sf=1024`) TPC-H queries on a\nlaptop.\n\n:::{.callout-important title=\"Not an official TPC-H benchmark\"}\nThis is not an [official TPC-H benchmark](https://www.tpc.org/tpch). We ran a\nderivate of the TPC-H benchmark.\n:::\n\n:::{.callout-warning title=\"Key differences from previous benchmarking\"}\nSee [the prior benchmark post](../ibis-bench/index.qmd) for more details and key\nconsiderations. Key differences in this iteration include:\n\n1. `polars-u64-idx` was used instead of `polars`\n2. [Some Polars queries were\n updated](https://github.com/lostmygithubaccount/ibis-bench/pull/5)\n3. Parquet files were generated with `n=128` partitions\n    - this was done to avoid OOM errors when generating the data\n    - this should have little impact on the query execution time\n4. Queries 18 and 21 for Polars, 9 and 18 for DataFusion were skipped\n    - they ran for a very long time without completing or failing\n    - the prior benchmark indicates these queries would likely eventually fail\n\nThe Python package versions used were:\n\n- `ibis-framework==9.1.0`\n- `datafusion==38.0.1`\n- `duckdb==1.0.0`\n- `polars-u64-idx==1.0.0`\n\nThe three systems tested were:\n\n- `ibis-duckdb`: Ibis dataframe code on the DuckDB backend\n- `ibis-datafusion`: Ibis dataframe code on the DataFusion backend\n- `polars-lazy`: Polars (lazy API) dataframe code\n:::\n\nTo follow along, install the required packages:\n\n```bash\npip install 'ibis-framework[duckdb]' gcsfs plotly great-tables\n```\n\nThe code for reading and analyzing the data is collapsed below.\n\n::: {#3d2f8650 .cell execution_count=17}\n``` {.python .cell-code code-fold=\"true\" code-summary=\"Show code to read and analyze the benchmark data\"}\nimport ibis\nimport gcsfs\nimport plotly.express as px\n\nfrom great_tables import GT, md\n\npx.defaults.template = \"plotly_dark\"\n\nibis.set_backend(\"duckdb\")\nibis.options.interactive = True\nibis.options.repr.interactive.max_rows = 3\n\nfs = gcsfs.GCSFileSystem()\nibis.get_backend().register_filesystem(fs)\n\nt = (\n    # ibis.read_parquet(\n    #    \"gs://ibis-bench/1tbc/cache/file_id=*.parquet\",\n    # )\n    ibis.read_json(\n        \"bench_logs_v2/raw_json/file_id=*.json\",\n    )\n    # ibis.read_parquet(\n    #     \"bench_logs_v4/cache/file_id=*.parquet\",\n    # )\n    .select(\n        \"system\",\n        \"sf\",\n        \"n_partitions\",\n        \"query_number\",\n        \"execution_seconds\",\n        \"timestamp\",\n    )\n    .mutate(timestamp=ibis._[\"timestamp\"].cast(\"timestamp\"))\n    .order_by(\"system\", \"query_number\")\n    .cache()\n)\n\nsystems = sorted(t.distinct(on=\"system\")[\"system\"].collect().to_pyarrow().as_py())\n\nagg = (\n    t.mutate(\n        run_num=ibis.row_number().over(\n            group_by=[\"system\", \"sf\", \"n_partitions\", \"query_number\"],\n            order_by=[\"timestamp\"],\n        )\n    )\n    .relocate(t.columns[:4], \"run_num\")\n    .group_by(\"system\", \"query_number\", \"run_num\")\n    .agg(execution_seconds=ibis._[\"execution_seconds\"].mean())\n    .order_by(\"system\", \"query_number\", \"run_num\")\n)\nagg2 = (\n    agg.group_by(\"system\", \"query_number\")\n    .agg(avg_execution_seconds=agg.execution_seconds.mean().round(2))\n    .order_by(\"system\", \"query_number\")\n)\npiv = agg2.pivot_wider(\n    names_from=\"system\", values_from=[\"avg_execution_seconds\"]\n).order_by(\"query_number\")\n\n\ndef x_vs_y(piv, x, y):\n    return ibis.ifelse(\n        piv[x] < piv[y],\n        -1,\n        1,\n    ) * (\n        (\n            (piv[x] - piv[y])\n            / ibis.ifelse(\n                piv[y] > piv[x],\n                piv[x],\n                piv[y],\n            )\n        ).abs()\n    ).round(4)\n\n\ncomparisons = [\n    (\"ibis-datafusion\", \"ibis-duckdb\"),\n    (\"polars-lazy\", \"ibis-datafusion\"),\n    (\"polars-lazy\", \"ibis-duckdb\"),\n]\n\ncomparisons = {f\"{x}_v_{y}\": x_vs_y(piv, x, y) for x, y in comparisons}\n\npiv2 = piv.mutate(**comparisons)\npiv2 = piv2.order_by(\"query_number\").relocate(\"query_number\", systems)\n\nagg3 = (\n    agg2.group_by(\"system\")\n    .agg(\n        queries_completed=agg2[\"avg_execution_seconds\"].count(),\n        execution_seconds=agg2[\"avg_execution_seconds\"].sum().round(2),\n        seconds_per_query=agg2[\"avg_execution_seconds\"].mean().round(2),\n    )\n    .order_by(\"system\")\n)\nagg3\n```\n\n::: {.cell-output .cell-output-display execution_count=16}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> system          </span>┃<span style=\"font-weight: bold\"> queries_completed </span>┃<span style=\"font-weight: bold\"> execution_seconds </span>┃<span style=\"font-weight: bold\"> seconds_per_query </span>┃\n┡━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>             │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>           │\n├─────────────────┼───────────────────┼───────────────────┼───────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">ibis-datafusion</span> │                <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">17</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1182.23</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">69.54</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">ibis-duckdb    </span> │                <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">22</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1448.42</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">65.84</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">polars-lazy    </span> │                <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">13</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1995.16</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">153.47</span> │\n└─────────────────┴───────────────────┴───────────────────┴───────────────────┘\n</pre>\n```\n:::\n:::\n\n\n`ibis-duckdb` completed 22/22 queries **in under 30 minutes**. If you need to\nrun batch data jobs on a similar amount of data, a laptop might be all you need!\n\n`ibis-datafusion` only completed 17/22 queries, though recall [3 are failing due\nto a bug that's already been\nfixed](../ibis-bench/index.qmd#failing-datafusion-queries). A new Python release\nfor DataFusion hasn't been made yet, so we ran with the old version. Assuming\nthose queries would complete, only 2 queries would be failing due to lack of\nmemory. More investigation would be needed to determine the work needed for all\n22 queries to pass under these conditions.\n\n`polars-lazy` only completed 14/22 queries, with 8 failing due lack of memory.\nThe [new streaming engine](https://pola.rs/posts/announcing-polars-1/#new-engine-design) will likely\nhelp with this.\n\nLet's plot execution time for each query and system:\n\n:::{.callout-tip title=\"You can de-select systems in the legend\"}\nIt might be easier to look at 2 systems at a time. You can click on a system in\nthe legend of the plot to de-select it.\n:::\n\n::: {#dfcd587a .cell execution_count=18}\n``` {.python .cell-code code-fold=\"true\" code-summary=\"Show code to plot execution time by query and system\"}\nc = px.bar(\n    agg2,\n    x=\"query_number\",\n    y=\"avg_execution_seconds\",\n    title=\"Average execution time by query\",\n    color=\"system\",\n    barmode=\"group\",\n    log_y=True,\n)\nc\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<div>                            <div id=\"65be5744-3ef8-47b3-8d1a-3771de67d633\" class=\"plotly-graph-div\" style=\"height:525px; width:100%;\"></div>            <script type=\"text/javascript\">                require([\"plotly\"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById(\"65be5744-3ef8-47b3-8d1a-3771de67d633\")) {                    Plotly.newPlot(                        \"65be5744-3ef8-47b3-8d1a-3771de67d633\",                        [{\"alignmentgroup\":\"True\",\"hovertemplate\":\"system=ibis-datafusion\\u003cbr\\u003equery_number=%{x}\\u003cbr\\u003eavg_execution_seconds=%{y}\\u003cextra\\u003e\\u003c\\u002fextra\\u003e\",\"legendgroup\":\"ibis-datafusion\",\"marker\":{\"color\":\"#636efa\",\"pattern\":{\"shape\":\"\"}},\"name\":\"ibis-datafusion\",\"offsetgroup\":\"ibis-datafusion\",\"orientation\":\"v\",\"showlegend\":true,\"textposition\":\"auto\",\"x\":[1,2,3,4,5,6,7,8,10,11,12,13,14,15,17,19,20],\"xaxis\":\"x\",\"y\":[87.67,8.68,50.43,34.81,61.43,33.05,90.75,72.98,75.63,22.25,54.09,60.72,40.06,73.67,252.67,79.78,83.56],\"yaxis\":\"y\",\"type\":\"bar\"},{\"alignmentgroup\":\"True\",\"hovertemplate\":\"system=ibis-duckdb\\u003cbr\\u003equery_number=%{x}\\u003cbr\\u003eavg_execution_seconds=%{y}\\u003cextra\\u003e\\u003c\\u002fextra\\u003e\",\"legendgroup\":\"ibis-duckdb\",\"marker\":{\"color\":\"#EF553B\",\"pattern\":{\"shape\":\"\"}},\"name\":\"ibis-duckdb\",\"offsetgroup\":\"ibis-duckdb\",\"orientation\":\"v\",\"showlegend\":true,\"textposition\":\"auto\",\"x\":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22],\"xaxis\":\"x\",\"y\":[77.45,7.38,48.72,33.29,51.99,33.8,102.99,62.05,116.41,58.34,10.22,46.86,48.57,38.79,69.39,9.48,54.44,350.98,64.85,41.18,110.43,10.81],\"yaxis\":\"y\",\"type\":\"bar\"},{\"alignmentgroup\":\"True\",\"hovertemplate\":\"system=polars-lazy\\u003cbr\\u003equery_number=%{x}\\u003cbr\\u003eavg_execution_seconds=%{y}\\u003cextra\\u003e\\u003c\\u002fextra\\u003e\",\"legendgroup\":\"polars-lazy\",\"marker\":{\"color\":\"#00cc96\",\"pattern\":{\"shape\":\"\"}},\"name\":\"polars-lazy\",\"offsetgroup\":\"polars-lazy\",\"orientation\":\"v\",\"showlegend\":true,\"textposition\":\"auto\",\"x\":[2,4,6,7,10,11,12,14,15,16,19,20,22],\"xaxis\":\"x\",\"y\":[9.44,73.72,79.69,305.02,262.09,25.31,126.77,101.46,63.32,10.93,422.94,498.25,16.22],\"yaxis\":\"y\",\"type\":\"bar\"}],                        {\"template\":{\"data\":{\"barpolar\":[{\"marker\":{\"line\":{\"color\":\"rgb(17,17,17)\",\"width\":0.5},\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"barpolar\"}],\"bar\":[{\"error_x\":{\"color\":\"#f2f5fa\"},\"error_y\":{\"color\":\"#f2f5fa\"},\"marker\":{\"line\":{\"color\":\"rgb(17,17,17)\",\"width\":0.5},\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"bar\"}],\"carpet\":[{\"aaxis\":{\"endlinecolor\":\"#A2B1C6\",\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"minorgridcolor\":\"#506784\",\"startlinecolor\":\"#A2B1C6\"},\"baxis\":{\"endlinecolor\":\"#A2B1C6\",\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"minorgridcolor\":\"#506784\",\"startlinecolor\":\"#A2B1C6\"},\"type\":\"carpet\"}],\"choropleth\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"type\":\"choropleth\"}],\"contourcarpet\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"type\":\"contourcarpet\"}],\"contour\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"contour\"}],\"heatmapgl\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"heatmapgl\"}],\"heatmap\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"heatmap\"}],\"histogram2dcontour\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"histogram2dcontour\"}],\"histogram2d\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"histogram2d\"}],\"histogram\":[{\"marker\":{\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"histogram\"}],\"mesh3d\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"type\":\"mesh3d\"}],\"parcoords\":[{\"line\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"parcoords\"}],\"pie\":[{\"automargin\":true,\"type\":\"pie\"}],\"scatter3d\":[{\"line\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scatter3d\"}],\"scattercarpet\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scattercarpet\"}],\"scattergeo\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scattergeo\"}],\"scattergl\":[{\"marker\":{\"line\":{\"color\":\"#283442\"}},\"type\":\"scattergl\"}],\"scattermapbox\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scattermapbox\"}],\"scatterpolargl\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scatterpolargl\"}],\"scatterpolar\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scatterpolar\"}],\"scatter\":[{\"marker\":{\"line\":{\"color\":\"#283442\"}},\"type\":\"scatter\"}],\"scatterternary\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scatterternary\"}],\"surface\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"surface\"}],\"table\":[{\"cells\":{\"fill\":{\"color\":\"#506784\"},\"line\":{\"color\":\"rgb(17,17,17)\"}},\"header\":{\"fill\":{\"color\":\"#2a3f5f\"},\"line\":{\"color\":\"rgb(17,17,17)\"}},\"type\":\"table\"}]},\"layout\":{\"annotationdefaults\":{\"arrowcolor\":\"#f2f5fa\",\"arrowhead\":0,\"arrowwidth\":1},\"autotypenumbers\":\"strict\",\"coloraxis\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"colorscale\":{\"diverging\":[[0,\"#8e0152\"],[0.1,\"#c51b7d\"],[0.2,\"#de77ae\"],[0.3,\"#f1b6da\"],[0.4,\"#fde0ef\"],[0.5,\"#f7f7f7\"],[0.6,\"#e6f5d0\"],[0.7,\"#b8e186\"],[0.8,\"#7fbc41\"],[0.9,\"#4d9221\"],[1,\"#276419\"]],\"sequential\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"sequentialminus\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]},\"colorway\":[\"#636efa\",\"#EF553B\",\"#00cc96\",\"#ab63fa\",\"#FFA15A\",\"#19d3f3\",\"#FF6692\",\"#B6E880\",\"#FF97FF\",\"#FECB52\"],\"font\":{\"color\":\"#f2f5fa\"},\"geo\":{\"bgcolor\":\"rgb(17,17,17)\",\"lakecolor\":\"rgb(17,17,17)\",\"landcolor\":\"rgb(17,17,17)\",\"showlakes\":true,\"showland\":true,\"subunitcolor\":\"#506784\"},\"hoverlabel\":{\"align\":\"left\"},\"hovermode\":\"closest\",\"mapbox\":{\"style\":\"dark\"},\"margin\":{\"b\":0,\"l\":0,\"r\":0,\"t\":30},\"paper_bgcolor\":\"rgb(17,17,17)\",\"plot_bgcolor\":\"rgb(17,17,17)\",\"polar\":{\"angularaxis\":{\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"ticks\":\"\"},\"bgcolor\":\"rgb(17,17,17)\",\"radialaxis\":{\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"ticks\":\"\"}},\"scene\":{\"xaxis\":{\"backgroundcolor\":\"rgb(17,17,17)\",\"gridcolor\":\"#506784\",\"gridwidth\":2,\"linecolor\":\"#506784\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"#C8D4E3\"},\"yaxis\":{\"backgroundcolor\":\"rgb(17,17,17)\",\"gridcolor\":\"#506784\",\"gridwidth\":2,\"linecolor\":\"#506784\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"#C8D4E3\"},\"zaxis\":{\"backgroundcolor\":\"rgb(17,17,17)\",\"gridcolor\":\"#506784\",\"gridwidth\":2,\"linecolor\":\"#506784\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"#C8D4E3\"}},\"shapedefaults\":{\"line\":{\"color\":\"#f2f5fa\"}},\"sliderdefaults\":{\"bgcolor\":\"#C8D4E3\",\"bordercolor\":\"rgb(17,17,17)\",\"borderwidth\":1,\"tickwidth\":0},\"ternary\":{\"aaxis\":{\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"ticks\":\"\"},\"baxis\":{\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"ticks\":\"\"},\"bgcolor\":\"rgb(17,17,17)\",\"caxis\":{\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"ticks\":\"\"}},\"title\":{\"x\":0.05},\"updatemenudefaults\":{\"bgcolor\":\"#506784\",\"borderwidth\":0},\"xaxis\":{\"automargin\":true,\"gridcolor\":\"#283442\",\"linecolor\":\"#506784\",\"ticks\":\"\",\"title\":{\"standoff\":15},\"zerolinecolor\":\"#283442\",\"zerolinewidth\":2},\"yaxis\":{\"automargin\":true,\"gridcolor\":\"#283442\",\"linecolor\":\"#506784\",\"ticks\":\"\",\"title\":{\"standoff\":15},\"zerolinecolor\":\"#283442\",\"zerolinewidth\":2}}},\"xaxis\":{\"anchor\":\"y\",\"domain\":[0.0,1.0],\"title\":{\"text\":\"query_number\"}},\"yaxis\":{\"anchor\":\"x\",\"domain\":[0.0,1.0],\"title\":{\"text\":\"avg_execution_seconds\"},\"type\":\"log\"},\"legend\":{\"title\":{\"text\":\"system\"},\"tracegroupgap\":0},\"title\":{\"text\":\"Average execution time by query\"},\"barmode\":\"group\"},                        {\"responsive\": true}                    ).then(function(){\n                            \nvar gd = document.getElementById('65be5744-3ef8-47b3-8d1a-3771de67d633');\nvar x = new MutationObserver(function (mutations, observer) {{\n        var display = window.getComputedStyle(gd).display;\n        if (!display || display === 'none') {{\n            console.log([gd, 'removed!']);\n            Plotly.purge(gd);\n            observer.disconnect();\n        }}\n}});\n\n// Listen for the removal of the full notebook cells\nvar notebookContainer = gd.closest('#notebook-container');\nif (notebookContainer) {{\n    x.observe(notebookContainer, {childList: true});\n}}\n\n// Listen for the clearing of the current output cell\nvar outputEl = gd.closest('.output');\nif (outputEl) {{\n    x.observe(outputEl, {childList: true});\n}}\n\n                        })                };                });            </script>        </div>\n```\n:::\n:::\n\n\nLet's show a [Great Tables](https://github.com/posit-dev/great-tables) table of\npivoted data including relative speed differences between the systems:\n\n::: {#4fc855ab .cell execution_count=19}\n``` {.python .cell-code code-fold=\"true\" code-summary=\"Show code to great_table pivoted aggregated benchmark data\"}\ncolor_palette = \"viridis\"\nna_color = \"yellow\"\nstyle_color = \"cyan\"\n\ntbl = (\n    GT(piv2.to_polars())\n    .opt_stylize(\n        style=1,\n        color=style_color,\n    )\n    .tab_header(\n        title=md(\"1TB (`sf=1024`) TPC-H queries\"),\n        subtitle=md(\"*on a laptop* (MacBook Pro | Apple M2 Max | 96GiB RAM)\"),\n    )\n    .tab_spanner(label=\"execution time (seconds)\", columns=systems)\n    .tab_spanner(label=\"relative speed difference†\", columns=list(comparisons))\n    .tab_source_note(\n        source_note=md(\n            \"†[Relative speed difference formula](https://docs.coiled.io/blog/tpch#measurements), with negative values indicating A was faster than B for A_v_B\"\n        )\n    )\n    .tab_source_note(\n        source_note=md(\n            \"Benchmark results source data (public bucket): `gs://ibis-bench/1tbc/cache/file_id=*.parquet`\"\n        )\n    )\n    .fmt_percent(list(comparisons), decimals=2, scale_values=True)\n    .data_color(\n        columns=systems,\n        domain=[0, agg2[\"avg_execution_seconds\"].max().to_pyarrow().as_py()],\n        palette=color_palette,\n        na_color=na_color,\n    )\n    .data_color(\n        columns=list(comparisons),\n        domain=[\n            min(\n                [piv2[c].min().to_pyarrow().as_py() for c in list(comparisons)],\n            ),\n            max(\n                [piv2[c].max().to_pyarrow().as_py() for c in list(comparisons)],\n            ),\n        ],\n        palette=color_palette,\n        na_color=na_color,\n    )\n)\ntbl\n```\n\n::: {.cell-output .cell-output-display execution_count=18}\n```{=html}\n<div id=\"nhpedijapm\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>\n#nhpedijapm table {\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n          -webkit-font-smoothing: antialiased;\n          -moz-osx-font-smoothing: grayscale;\n        }\n\n#nhpedijapm thead, tbody, tfoot, tr, td, th { border-style: none; }\n tr { background-color: transparent; }\n#nhpedijapm p { margin: 0; padding: 0; }\n #nhpedijapm .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #016763; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #016763; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }\n #nhpedijapm .gt_caption { padding-top: 4px; padding-bottom: 4px; }\n #nhpedijapm .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }\n #nhpedijapm .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }\n #nhpedijapm .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #nhpedijapm .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #01837B; }\n #nhpedijapm .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #01837B; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #01837B; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #nhpedijapm .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }\n #nhpedijapm .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }\n #nhpedijapm .gt_column_spanner_outer:first-child { padding-left: 0; }\n #nhpedijapm .gt_column_spanner_outer:last-child { padding-right: 0; }\n #nhpedijapm .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #01837B; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }\n #nhpedijapm .gt_spanner_row { border-bottom-style: hidden; }\n #nhpedijapm .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #01837B; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #01837B; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }\n #nhpedijapm .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #01837B; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #01837B; vertical-align: middle; }\n #nhpedijapm .gt_from_md> :first-child { margin-top: 0; }\n #nhpedijapm .gt_from_md> :last-child { margin-bottom: 0; }\n #nhpedijapm .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: none; border-top-width: 1px; border-top-color: #A5FEF2; border-left-style: none; border-left-width: 1px; border-left-color: #A5FEF2; border-right-style: none; border-right-width: 1px; border-right-color: #A5FEF2; vertical-align: middle; overflow-x: hidden; }\n #nhpedijapm .gt_stub { color: #FFFFFF; background-color: #01837B; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #01837B; padding-left: 5px; padding-right: 5px; }\n #nhpedijapm .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }\n #nhpedijapm .gt_row_group_first td { border-top-width: 2px; }\n #nhpedijapm .gt_row_group_first th { border-top-width: 2px; }\n #nhpedijapm .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #01837B; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #01837B; }\n #nhpedijapm .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }\n #nhpedijapm .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }\n #nhpedijapm .gt_left { text-align: left; }\n #nhpedijapm .gt_center { text-align: center; }\n #nhpedijapm .gt_right { text-align: right; font-variant-numeric: tabular-nums; }\n #nhpedijapm .gt_font_normal { font-weight: normal; }\n #nhpedijapm .gt_font_bold { font-weight: bold; }\n #nhpedijapm .gt_font_italic { font-style: italic; }\n #nhpedijapm .gt_super { font-size: 65%; }\n #nhpedijapm .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }\n #nhpedijapm .gt_asterisk { font-size: 100%; vertical-align: 0; }\n \n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n<thead class=\"gt_header\">\n  <tr>\n    <th colspan=\"7\" class=\"gt_heading gt_title gt_font_normal\">1TB (<code>sf=1024</code>) TPC-H queries</th>\n  </tr>\n  <tr>\n    <th colspan=\"7\" class=\"gt_heading gt_subtitle gt_font_normal gt_bottom_border\"><em>on a laptop</em> (MacBook Pro | Apple M2 Max | 96GiB RAM)</th>\n  </tr>\n</thead>\n<tr class=\"gt_col_headings gt_spanner_row\">\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"2\" colspan=\"1\" scope=\"col\" id=\"query_number\">query_number</th>\n  <th class=\"gt_center gt_columns_top_border gt_column_spanner_outer\" rowspan=\"1\" colspan=\"3\" scope=\"colgroup\" id=\"execution time (seconds)\">\n    <span class=\"gt_column_spanner\">execution time (seconds)</span>\n  </th>\n  <th class=\"gt_center gt_columns_top_border gt_column_spanner_outer\" rowspan=\"1\" colspan=\"3\" scope=\"colgroup\" id=\"relative speed difference†\">\n    <span class=\"gt_column_spanner\">relative speed difference†</span>\n  </th>\n</tr>\n<tr class=\"gt_col_headings\">\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"ibis-datafusion\">ibis-datafusion</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"ibis-duckdb\">ibis-duckdb</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"polars-lazy\">polars-lazy</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"ibis-datafusion_v_ibis-duckdb\">ibis-datafusion_v_ibis-duckdb</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"polars-lazy_v_ibis-datafusion\">polars-lazy_v_ibis-datafusion</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"polars-lazy_v_ibis-duckdb\">polars-lazy_v_ibis-duckdb</th>\n</tr>\n<tbody class=\"gt_table_body\">\n  <tr>\n    <td class=\"gt_row gt_right\">1</td>\n    <td style=\"color: #FFFFFF; background-color: #423b82;\" class=\"gt_row gt_right\">87.67</td>\n    <td style=\"color: #FFFFFF; background-color: #44357f;\" class=\"gt_row gt_right\">77.45</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #450a5d;\" class=\"gt_row gt_right\">13.20%</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">2</td>\n    <td style=\"color: #FFFFFF; background-color: #45075a;\" class=\"gt_row gt_right\">8.68</td>\n    <td style=\"color: #FFFFFF; background-color: #450659;\" class=\"gt_row gt_right\">7.38</td>\n    <td style=\"color: #FFFFFF; background-color: #45085a;\" class=\"gt_row gt_right\">9.44</td>\n    <td style=\"color: #FFFFFF; background-color: #450c5e;\" class=\"gt_row gt_right\">17.62%</td>\n    <td style=\"color: #FFFFFF; background-color: #45095b;\" class=\"gt_row gt_right\">8.76%</td>\n    <td style=\"color: #FFFFFF; background-color: #450f61;\" class=\"gt_row gt_right\">27.91%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">3</td>\n    <td style=\"color: #FFFFFF; background-color: #482575;\" class=\"gt_row gt_right\">50.43</td>\n    <td style=\"color: #FFFFFF; background-color: #482374;\" class=\"gt_row gt_right\">48.72</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #45075a;\" class=\"gt_row gt_right\">3.51%</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">4</td>\n    <td style=\"color: #FFFFFF; background-color: #471a6b;\" class=\"gt_row gt_right\">34.81</td>\n    <td style=\"color: #FFFFFF; background-color: #46186a;\" class=\"gt_row gt_right\">33.29</td>\n    <td style=\"color: #FFFFFF; background-color: #45337e;\" class=\"gt_row gt_right\">73.72</td>\n    <td style=\"color: #FFFFFF; background-color: #45085a;\" class=\"gt_row gt_right\">4.57%</td>\n    <td style=\"color: #FFFFFF; background-color: #482978;\" class=\"gt_row gt_right\">111.78%</td>\n    <td style=\"color: #FFFFFF; background-color: #472b7a;\" class=\"gt_row gt_right\">121.45%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">5</td>\n    <td style=\"color: #FFFFFF; background-color: #472c7a;\" class=\"gt_row gt_right\">61.43</td>\n    <td style=\"color: #FFFFFF; background-color: #482676;\" class=\"gt_row gt_right\">51.99</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #450c5e;\" class=\"gt_row gt_right\">18.16%</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">6</td>\n    <td style=\"color: #FFFFFF; background-color: #461869;\" class=\"gt_row gt_right\">33.05</td>\n    <td style=\"color: #FFFFFF; background-color: #46196a;\" class=\"gt_row gt_right\">33.8</td>\n    <td style=\"color: #FFFFFF; background-color: #44377f;\" class=\"gt_row gt_right\">79.69</td>\n    <td style=\"color: #FFFFFF; background-color: #440558;\" class=\"gt_row gt_right\">−2.27%</td>\n    <td style=\"color: #FFFFFF; background-color: #45317c;\" class=\"gt_row gt_right\">141.12%</td>\n    <td style=\"color: #FFFFFF; background-color: #462f7c;\" class=\"gt_row gt_right\">135.77%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">7</td>\n    <td style=\"color: #FFFFFF; background-color: #423d83;\" class=\"gt_row gt_right\">90.75</td>\n    <td style=\"color: #FFFFFF; background-color: #3f4487;\" class=\"gt_row gt_right\">102.99</td>\n    <td style=\"color: #000000; background-color: #2aab81;\" class=\"gt_row gt_right\">305.02</td>\n    <td style=\"color: #FFFFFF; background-color: #440255;\" class=\"gt_row gt_right\">−13.49%</td>\n    <td style=\"color: #FFFFFF; background-color: #3e4a89;\" class=\"gt_row gt_right\">236.11%</td>\n    <td style=\"color: #FFFFFF; background-color: #413f84;\" class=\"gt_row gt_right\">196.16%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">8</td>\n    <td style=\"color: #FFFFFF; background-color: #45337d;\" class=\"gt_row gt_right\">72.98</td>\n    <td style=\"color: #FFFFFF; background-color: #472c7a;\" class=\"gt_row gt_right\">62.05</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #450c5e;\" class=\"gt_row gt_right\">17.61%</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">9</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #3d4c8a;\" class=\"gt_row gt_right\">116.41</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">10</td>\n    <td style=\"color: #FFFFFF; background-color: #44347e;\" class=\"gt_row gt_right\">75.63</td>\n    <td style=\"color: #FFFFFF; background-color: #472a79;\" class=\"gt_row gt_right\">58.34</td>\n    <td style=\"color: #000000; background-color: #21978a;\" class=\"gt_row gt_right\">262.09</td>\n    <td style=\"color: #FFFFFF; background-color: #450f61;\" class=\"gt_row gt_right\">29.64%</td>\n    <td style=\"color: #FFFFFF; background-color: #3d4c8a;\" class=\"gt_row gt_right\">246.54%</td>\n    <td style=\"color: #FFFFFF; background-color: #32668e;\" class=\"gt_row gt_right\">349.25%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">11</td>\n    <td style=\"color: #FFFFFF; background-color: #461162;\" class=\"gt_row gt_right\">22.25</td>\n    <td style=\"color: #FFFFFF; background-color: #45085b;\" class=\"gt_row gt_right\">10.22</td>\n    <td style=\"color: #FFFFFF; background-color: #461364;\" class=\"gt_row gt_right\">25.31</td>\n    <td style=\"color: #FFFFFF; background-color: #472a79;\" class=\"gt_row gt_right\">117.71%</td>\n    <td style=\"color: #FFFFFF; background-color: #450a5d;\" class=\"gt_row gt_right\">13.75%</td>\n    <td style=\"color: #FFFFFF; background-color: #45327d;\" class=\"gt_row gt_right\">147.65%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">12</td>\n    <td style=\"color: #FFFFFF; background-color: #482777;\" class=\"gt_row gt_right\">54.09</td>\n    <td style=\"color: #FFFFFF; background-color: #472272;\" class=\"gt_row gt_right\">46.86</td>\n    <td style=\"color: #FFFFFF; background-color: #3a528a;\" class=\"gt_row gt_right\">126.77</td>\n    <td style=\"color: #FFFFFF; background-color: #450b5d;\" class=\"gt_row gt_right\">15.43%</td>\n    <td style=\"color: #FFFFFF; background-color: #462f7b;\" class=\"gt_row gt_right\">134.37%</td>\n    <td style=\"color: #FFFFFF; background-color: #433880;\" class=\"gt_row gt_right\">170.53%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">13</td>\n    <td style=\"color: #FFFFFF; background-color: #472b7a;\" class=\"gt_row gt_right\">60.72</td>\n    <td style=\"color: #FFFFFF; background-color: #482374;\" class=\"gt_row gt_right\">48.57</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #450e60;\" class=\"gt_row gt_right\">25.02%</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">14</td>\n    <td style=\"color: #FFFFFF; background-color: #471d6e;\" class=\"gt_row gt_right\">40.06</td>\n    <td style=\"color: #FFFFFF; background-color: #471c6d;\" class=\"gt_row gt_right\">38.79</td>\n    <td style=\"color: #FFFFFF; background-color: #404386;\" class=\"gt_row gt_right\">101.46</td>\n    <td style=\"color: #FFFFFF; background-color: #45075a;\" class=\"gt_row gt_right\">3.27%</td>\n    <td style=\"color: #FFFFFF; background-color: #44347e;\" class=\"gt_row gt_right\">153.27%</td>\n    <td style=\"color: #FFFFFF; background-color: #44367f;\" class=\"gt_row gt_right\">161.56%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">15</td>\n    <td style=\"color: #FFFFFF; background-color: #45337e;\" class=\"gt_row gt_right\">73.67</td>\n    <td style=\"color: #FFFFFF; background-color: #45307c;\" class=\"gt_row gt_right\">69.39</td>\n    <td style=\"color: #FFFFFF; background-color: #472d7a;\" class=\"gt_row gt_right\">63.32</td>\n    <td style=\"color: #FFFFFF; background-color: #45085a;\" class=\"gt_row gt_right\">6.17%</td>\n    <td style=\"color: #FFFFFF; background-color: #440154;\" class=\"gt_row gt_right\">−16.35%</td>\n    <td style=\"color: #FFFFFF; background-color: #440356;\" class=\"gt_row gt_right\">−9.59%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">16</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #45085a;\" class=\"gt_row gt_right\">9.48</td>\n    <td style=\"color: #FFFFFF; background-color: #45095b;\" class=\"gt_row gt_right\">10.93</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #450b5d;\" class=\"gt_row gt_right\">15.30%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">17</td>\n    <td style=\"color: #000000; background-color: #22928b;\" class=\"gt_row gt_right\">252.67</td>\n    <td style=\"color: #FFFFFF; background-color: #482777;\" class=\"gt_row gt_right\">54.44</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #31698e;\" class=\"gt_row gt_right\">364.13%</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">18</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #000000; background-color: #48be6e;\" class=\"gt_row gt_right\">350.98</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">19</td>\n    <td style=\"color: #FFFFFF; background-color: #44377f;\" class=\"gt_row gt_right\">79.78</td>\n    <td style=\"color: #FFFFFF; background-color: #462e7b;\" class=\"gt_row gt_right\">64.85</td>\n    <td style=\"color: #000000; background-color: #9ad73c;\" class=\"gt_row gt_right\">422.94</td>\n    <td style=\"color: #FFFFFF; background-color: #450d5f;\" class=\"gt_row gt_right\">23.02%</td>\n    <td style=\"color: #FFFFFF; background-color: #2b778e;\" class=\"gt_row gt_right\">430.13%</td>\n    <td style=\"color: #000000; background-color: #22918b;\" class=\"gt_row gt_right\">552.18%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">20</td>\n    <td style=\"color: #FFFFFF; background-color: #433981;\" class=\"gt_row gt_right\">83.56</td>\n    <td style=\"color: #FFFFFF; background-color: #471e6f;\" class=\"gt_row gt_right\">41.18</td>\n    <td style=\"color: #000000; background-color: #fde725;\" class=\"gt_row gt_right\">498.25</td>\n    <td style=\"color: #FFFFFF; background-color: #482676;\" class=\"gt_row gt_right\">102.91%</td>\n    <td style=\"color: #000000; background-color: #25858e;\" class=\"gt_row gt_right\">496.28%</td>\n    <td style=\"color: #000000; background-color: #fde725;\" class=\"gt_row gt_right\">1,109.93%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">21</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #3e4989;\" class=\"gt_row gt_right\">110.43</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">22</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #45095b;\" class=\"gt_row gt_right\">10.81</td>\n    <td style=\"color: #FFFFFF; background-color: #450c5f;\" class=\"gt_row gt_right\">16.22</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #000000; background-color: #FFFF00;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #461667;\" class=\"gt_row gt_right\">50.05%</td>\n  </tr>\n</tbody>\n  <tfoot class=\"gt_sourcenotes\">\n  \n  <tr>\n    <td class=\"gt_sourcenote\" colspan=\"7\">†<a href=\"https://docs.coiled.io/blog/tpch#measurements\">Relative speed difference formula</a>, with negative values indicating A was faster than B for A_v_B</td>\n  </tr>\n\n\n  <tr>\n    <td class=\"gt_sourcenote\" colspan=\"7\">Benchmark results source data (public bucket): <code>gs://ibis-bench/1tbc/cache/file_id=*.parquet</code></td>\n  </tr>\n\n</tfoot>\n\n</table>\n\n</div>\n        \n```\n:::\n:::\n\n\nYou can use the code above to further explore and visualize the results.\n\n## Why does this matter?\n\nThe ability to run all 1TB TPC-H queries on a relatively standard laptop with\nminimal setup represents a significant shift in the Python data ecosystem.\n\n### Scale up, then scale out\n\nWhile distributed OLAP query engines have their place, the threshold for\nconsidering them against a single-node OLAP query engine has been raised\ndrastically over the last few years. You can [see how much DuckDB has improved\nover the years](https://duckdb.org/2024/06/26/benchmarks-over-time) and it shows\nin this benchmark.\n\nIt's a good idea to start with a single node and see how far you can get. You'll\nneed to consider the tradeoffs for your own situation to make a decision. With\nIbis, you can write your queries once and try them on different engines to see\nwhich is best for your workload.\n\n### Composable data systems are here\n\nIbis separates the query from the engine. It translates dataframe code into an\nintermediate representation (IR) in the backend's native language -- often SQL,\nsometimes other Python dataframe code. This separation allows you **to use a\nsingle dataframe API for the best engine(s) across your workload(s)**.\n\nIf you need to analyze data in\n[Postgres](https://ibis-project.org/backends/postgres), you can use Ibis. If you\nneed to [speed that up with\nDuckDB](https://duckdb.org/2022/09/30/postgres-scanner.html), you can [use\nIbis](https://ibis-project.org/backends/duckdb#ibis.backends.duckdb.Backend.read_postgres).\nIf you need to scale out with [Dask](https://ibis-project.org/backends/dask) or\n[PySpark](https://ibis-project.org/backends/pyspark) or\n[Trino](https://ibis-project.org/backends/trino), you can use Ibis. If you need\nto [scale out on distributed GPUs you can use\nIbis](../why-voda-supports-ibis/index.qmd). If another query engine comes along\nand is best for your workload, you can probably use Ibis. New backends are\nfairly easy to add!\n\n### It's efficient\n\nA composable data system with a modern single-node OLAP query engine can likely\nscale vertically to handle workloads into 10TB+ range, though you're likely to\nhit storage or network bottlenecks before hitting compute bottlenecks for real\nworkloads. Still, how much money does your organization spend on data\ntransformation per terabyte? Using [the GCP pricing\ncalculator](https://cloud.google.com/products/calculator) we'll sample the\nmonthly cost of some cloud instances and solid-state hard drive space. Hover\nover to see the vCPUs and RAM for each instance.\n\n::: {#8d442d35 .cell execution_count=20}\n``` {.python .cell-code code-fold=\"true\" code-summary=\"Show code to plot monthly cost of various GCP instances\"}\ndata = {\n    \"m1-megamem-40\": {\"vCPUs\": 40, \"RAM\": 961, \"cost\": 6200},\n    \"m1-ultramem-80\": {\"vCPUs\": 80, \"RAM\": 1922, \"cost\": 10900},\n    \"m1-ultramem-160\": {\"vCPUs\": 160, \"RAM\": 3844, \"cost\": 20100},\n    \"h3-standard-88\": {\"vCPUs\": 88, \"RAM\": 352, \"cost\": 4600},\n    \"c2-standard-30\": {\"vCPUs\": 30, \"RAM\": 120, \"cost\": 1600},\n    \"c2-standard-60\": {\"vCPUs\": 60, \"RAM\": 240, \"cost\": 2700},\n}\n\nt = ibis.memtable(\n    {\n        \"name\": list(data.keys()),\n        \"vCPUs\": [v[\"vCPUs\"] for v in data.values()],\n        \"RAM\": [v[\"RAM\"] for v in data.values()],\n        \"cost\": [v[\"cost\"] for v in data.values()],\n    }\n).order_by(\"cost\")\n\nc = px.bar(\n    t,\n    x=\"name\",\n    y=\"cost\",\n    title=\"Monthly cost (USD) of various GCP instances\",\n    hover_data=[\"vCPUs\", \"RAM\"],\n)\nc\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<div>                            <div id=\"f1256bd7-dd66-45d3-ac33-587ad623710c\" class=\"plotly-graph-div\" style=\"height:525px; width:100%;\"></div>            <script type=\"text/javascript\">                require([\"plotly\"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById(\"f1256bd7-dd66-45d3-ac33-587ad623710c\")) {                    Plotly.newPlot(                        \"f1256bd7-dd66-45d3-ac33-587ad623710c\",                        [{\"alignmentgroup\":\"True\",\"customdata\":[[30,120],[60,240],[88,352],[40,961],[80,1922],[160,3844]],\"hovertemplate\":\"name=%{x}\\u003cbr\\u003ecost=%{y}\\u003cbr\\u003evCPUs=%{customdata[0]}\\u003cbr\\u003eRAM=%{customdata[1]}\\u003cextra\\u003e\\u003c\\u002fextra\\u003e\",\"legendgroup\":\"\",\"marker\":{\"color\":\"#636efa\",\"pattern\":{\"shape\":\"\"}},\"name\":\"\",\"offsetgroup\":\"\",\"orientation\":\"v\",\"showlegend\":false,\"textposition\":\"auto\",\"x\":[\"c2-standard-30\",\"c2-standard-60\",\"h3-standard-88\",\"m1-megamem-40\",\"m1-ultramem-80\",\"m1-ultramem-160\"],\"xaxis\":\"x\",\"y\":[1600,2700,4600,6200,10900,20100],\"yaxis\":\"y\",\"type\":\"bar\"}],                        {\"template\":{\"data\":{\"barpolar\":[{\"marker\":{\"line\":{\"color\":\"rgb(17,17,17)\",\"width\":0.5},\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"barpolar\"}],\"bar\":[{\"error_x\":{\"color\":\"#f2f5fa\"},\"error_y\":{\"color\":\"#f2f5fa\"},\"marker\":{\"line\":{\"color\":\"rgb(17,17,17)\",\"width\":0.5},\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"bar\"}],\"carpet\":[{\"aaxis\":{\"endlinecolor\":\"#A2B1C6\",\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"minorgridcolor\":\"#506784\",\"startlinecolor\":\"#A2B1C6\"},\"baxis\":{\"endlinecolor\":\"#A2B1C6\",\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"minorgridcolor\":\"#506784\",\"startlinecolor\":\"#A2B1C6\"},\"type\":\"carpet\"}],\"choropleth\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"type\":\"choropleth\"}],\"contourcarpet\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"type\":\"contourcarpet\"}],\"contour\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"contour\"}],\"heatmapgl\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"heatmapgl\"}],\"heatmap\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"heatmap\"}],\"histogram2dcontour\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"histogram2dcontour\"}],\"histogram2d\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"histogram2d\"}],\"histogram\":[{\"marker\":{\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"histogram\"}],\"mesh3d\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"type\":\"mesh3d\"}],\"parcoords\":[{\"line\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"parcoords\"}],\"pie\":[{\"automargin\":true,\"type\":\"pie\"}],\"scatter3d\":[{\"line\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scatter3d\"}],\"scattercarpet\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scattercarpet\"}],\"scattergeo\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scattergeo\"}],\"scattergl\":[{\"marker\":{\"line\":{\"color\":\"#283442\"}},\"type\":\"scattergl\"}],\"scattermapbox\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scattermapbox\"}],\"scatterpolargl\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scatterpolargl\"}],\"scatterpolar\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scatterpolar\"}],\"scatter\":[{\"marker\":{\"line\":{\"color\":\"#283442\"}},\"type\":\"scatter\"}],\"scatterternary\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scatterternary\"}],\"surface\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"surface\"}],\"table\":[{\"cells\":{\"fill\":{\"color\":\"#506784\"},\"line\":{\"color\":\"rgb(17,17,17)\"}},\"header\":{\"fill\":{\"color\":\"#2a3f5f\"},\"line\":{\"color\":\"rgb(17,17,17)\"}},\"type\":\"table\"}]},\"layout\":{\"annotationdefaults\":{\"arrowcolor\":\"#f2f5fa\",\"arrowhead\":0,\"arrowwidth\":1},\"autotypenumbers\":\"strict\",\"coloraxis\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"colorscale\":{\"diverging\":[[0,\"#8e0152\"],[0.1,\"#c51b7d\"],[0.2,\"#de77ae\"],[0.3,\"#f1b6da\"],[0.4,\"#fde0ef\"],[0.5,\"#f7f7f7\"],[0.6,\"#e6f5d0\"],[0.7,\"#b8e186\"],[0.8,\"#7fbc41\"],[0.9,\"#4d9221\"],[1,\"#276419\"]],\"sequential\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"sequentialminus\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]},\"colorway\":[\"#636efa\",\"#EF553B\",\"#00cc96\",\"#ab63fa\",\"#FFA15A\",\"#19d3f3\",\"#FF6692\",\"#B6E880\",\"#FF97FF\",\"#FECB52\"],\"font\":{\"color\":\"#f2f5fa\"},\"geo\":{\"bgcolor\":\"rgb(17,17,17)\",\"lakecolor\":\"rgb(17,17,17)\",\"landcolor\":\"rgb(17,17,17)\",\"showlakes\":true,\"showland\":true,\"subunitcolor\":\"#506784\"},\"hoverlabel\":{\"align\":\"left\"},\"hovermode\":\"closest\",\"mapbox\":{\"style\":\"dark\"},\"margin\":{\"b\":0,\"l\":0,\"r\":0,\"t\":30},\"paper_bgcolor\":\"rgb(17,17,17)\",\"plot_bgcolor\":\"rgb(17,17,17)\",\"polar\":{\"angularaxis\":{\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"ticks\":\"\"},\"bgcolor\":\"rgb(17,17,17)\",\"radialaxis\":{\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"ticks\":\"\"}},\"scene\":{\"xaxis\":{\"backgroundcolor\":\"rgb(17,17,17)\",\"gridcolor\":\"#506784\",\"gridwidth\":2,\"linecolor\":\"#506784\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"#C8D4E3\"},\"yaxis\":{\"backgroundcolor\":\"rgb(17,17,17)\",\"gridcolor\":\"#506784\",\"gridwidth\":2,\"linecolor\":\"#506784\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"#C8D4E3\"},\"zaxis\":{\"backgroundcolor\":\"rgb(17,17,17)\",\"gridcolor\":\"#506784\",\"gridwidth\":2,\"linecolor\":\"#506784\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"#C8D4E3\"}},\"shapedefaults\":{\"line\":{\"color\":\"#f2f5fa\"}},\"sliderdefaults\":{\"bgcolor\":\"#C8D4E3\",\"bordercolor\":\"rgb(17,17,17)\",\"borderwidth\":1,\"tickwidth\":0},\"ternary\":{\"aaxis\":{\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"ticks\":\"\"},\"baxis\":{\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"ticks\":\"\"},\"bgcolor\":\"rgb(17,17,17)\",\"caxis\":{\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"ticks\":\"\"}},\"title\":{\"x\":0.05},\"updatemenudefaults\":{\"bgcolor\":\"#506784\",\"borderwidth\":0},\"xaxis\":{\"automargin\":true,\"gridcolor\":\"#283442\",\"linecolor\":\"#506784\",\"ticks\":\"\",\"title\":{\"standoff\":15},\"zerolinecolor\":\"#283442\",\"zerolinewidth\":2},\"yaxis\":{\"automargin\":true,\"gridcolor\":\"#283442\",\"linecolor\":\"#506784\",\"ticks\":\"\",\"title\":{\"standoff\":15},\"zerolinecolor\":\"#283442\",\"zerolinewidth\":2}}},\"xaxis\":{\"anchor\":\"y\",\"domain\":[0.0,1.0],\"title\":{\"text\":\"name\"}},\"yaxis\":{\"anchor\":\"x\",\"domain\":[0.0,1.0],\"title\":{\"text\":\"cost\"}},\"legend\":{\"tracegroupgap\":0},\"title\":{\"text\":\"Monthly cost (USD) of various GCP instances\"},\"barmode\":\"relative\"},                        {\"responsive\": true}                    ).then(function(){\n                            \nvar gd = document.getElementById('f1256bd7-dd66-45d3-ac33-587ad623710c');\nvar x = new MutationObserver(function (mutations, observer) {{\n        var display = window.getComputedStyle(gd).display;\n        if (!display || display === 'none') {{\n            console.log([gd, 'removed!']);\n            Plotly.purge(gd);\n            observer.disconnect();\n        }}\n}});\n\n// Listen for the removal of the full notebook cells\nvar notebookContainer = gd.closest('#notebook-container');\nif (notebookContainer) {{\n    x.observe(notebookContainer, {childList: true});\n}}\n\n// Listen for the clearing of the current output cell\nvar outputEl = gd.closest('.output');\nif (outputEl) {{\n    x.observe(outputEl, {childList: true});\n}}\n\n                        })                };                });            </script>        </div>\n```\n:::\n:::\n\n\nFor ~$1,600/month we can get a machine with more CPU cores and RAM than our\nlaptop in this post. This cost also assumes you're running the machine 24/7 --\nif you only needed to run a workload similar to the benchmark here, you'd only\nneed to the machine on for <1 hour per day using Ibis (DuckDB backend).\n\n## Next steps\n\nWe'll follow up on this post once new versions that fix issues or improve\nperformance significantly are released. If you're interested in getting started\nwith Ibis, see [our tutorial](/tutorials/getting_started.qmd).\n\n",
    "supporting": [
      "index_files/figure-html"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n<script type=\"text/javascript\">\nwindow.PlotlyConfig = {MathJaxConfig: 'local'};\nif (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: \"STIX-Web\"}});}\nif (typeof require !== 'undefined') {\nrequire.undef(\"plotly\");\nrequirejs.config({\n    paths: {\n        'plotly': ['https://cdn.plot.ly/plotly-2.32.0.min']\n    }\n});\nrequire(['plotly'], function(Plotly) {\n    window._Plotly = Plotly;\n});\n}\n</script>\n\n"
      ]
    }
  }
}