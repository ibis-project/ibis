{
  "hash": "dd199dc50ff61d602ee3b185a476aad8",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Querying 1TB on a laptop with Python dataframes\"\nauthor: \"Cody Peterson\"\ndate: \"2024-07-08\"\nimage: ibis-duckdb-sort.gif\ncategories:\n    - benchmark\n    - duckdb\n    - datafusion\n    - polars\n---\n\n***TPC-H benchmark at `sf=1024` via DuckDB, DataFusion, and Polars on a MacBook\nPro with 96GiB of RAM.***\n\n---\n\npandas requires your dataframe to fit in memory. Out-of-memory (OOM) errors are\ncommon when working on larger datasets, though the corresponding size of data on\ndisk can be surprising. The creator of pandas and Ibis noted in [\"Apache\nArrow and the '10 Things I Hate About\npandas'\"](https://wesmckinney.com/blog/apache-arrow-pandas-internals):\n\n> To put it simply, **we weren’t thinking about analyzing 100 GB or 1 TB datasets\n> in 2011**. [In 2017], my rule of thumb for pandas is that **you should have 5 to\n> 10 times as much RAM as the size of your dataset**. So if you have a 10 GB\n> dataset, you should really have about 64, preferably 128 GB of RAM if you want\n> to avoid memory management problems. This comes as a shock to users who expect\n> to be able to analyze datasets that are within a factor of 2 or 3 the size of\n> their computer’s RAM.\n\nToday with Ibis you can reliably and efficiently process a 1TB dataset on a\nlaptop with <1/10th the RAM.\n\n:::{.callout-important}\nThis represents **a 50-100X improvement** in RAM requirements for Python\ndataframes in just 7 years thanks to [composable data\nsystems](https://wesmckinney.com/blog/looking-back-15-years) and [hard work by\nthe DuckDB team](https://duckdb.org/2024/06/26/benchmarks-over-time).\n:::\n\n## Exploring the data with Python dataframes\n\nI've generated ~1TB (`sf=1024`) of [TPC-H data](https://www.tpc.org/tpch) on my\nMacBook Pro with 96 GiB of RAM. We'll start exploring it with pandas, Polars,\nand Ibis and discuss where and why they start to struggle.\n\n:::{.callout-tip title=\"Generating the data\" collapse=\"true\"}\nSee [the previous post](../ibis-bench/index.qmd#reproducing-the-benchmark) for\ninstructions on generating the data. I used `bench gen-data -s 1024 -n 128`,\npartitioning the data to avoid OOM errors while it generated.\n\nI'd recommend instead generating a smaller scale factor and copying it as many\ntimes as needed, as generating the data at `sf=1024` can take a long time.\n:::\n\nTo follow along, install the required packages:\n\n```bash\npip install pandas 'ibis-framework[duckdb,datafusion]' polars-u64-idx plotly\n```\n\n:::{.callout-note title=\"Why polars-u64-idx?\" collapse=\"true\"}\nWe need to use `polars-u64-idx` instead of `polars` [to work with >4.2 billion\nrows](https://docs.pola.rs/user-guide/installation/#big-index).\n:::\n\nImports and setup:\n\n::: {#10f98bb4 .cell execution_count=2}\n``` {.python .cell-code}\nimport os\nimport glob\nimport ibis\nimport pandas as pd\nimport polars as pl\nimport plotly.express as px\n\npx.defaults.template = \"plotly_dark\"\nibis.options.interactive = True\n```\n:::\n\n\n\n\nLet's check the number of rows across all tables in the TPC-H data:\n\n::: {#4582c6e3 .cell execution_count=4}\n``` {.python .cell-code code-fold=\"true\" code-summary=\"Show code to get number of rows in TPC-H data\"}\nsf = 1024\nn = 128\ndata_dir = f\"tpch_data/parquet/sf={sf}/n={n}\"\ntables = glob.glob(f\"{data_dir}/*\")\n\ntotal_rows = 0\n\nfor table in tables:\n    t = ibis.read_parquet(f\"{table}/*.parquet\")\n    total_rows += t.count().to_pyarrow().as_py()\n\nprint(f\"total rows: {total_rows:,}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\ntotal rows: 8,867,848,906\n```\n:::\n:::\n\n\nOver 8.8 billion rows!\n\nWe can compute and visualize the sizes of the tables in the TPC-H data (as\ncompressed Parquet files on disk):\n\n::: {#93ee34d9 .cell execution_count=5}\n``` {.python .cell-code code-fold=\"true\" code-summary=\"Show code to get sizes of tables in TPC-H data\"}\ndef get_dir_size(path):\n    from pathlib import Path\n\n    return sum(p.stat().st_size for p in Path(path).rglob(\"*\") if p.is_file())\n\n\nsizes = [get_dir_size(table) for table in tables]\nnames = [os.path.basename(table) for table in tables]\n\ntmp = ibis.memtable({\"name\": names, \"size\": sizes})\ntmp = tmp.mutate(size_gb=tmp[\"size\"] / (1024**3))\ntmp = tmp.mutate(size_gb_mem=tmp[\"size_gb\"] * 11 / 5)\ntmp = tmp.order_by(ibis.desc(\"size_gb\"))\n\nc = px.bar(\n    tmp,\n    x=\"name\",\n    y=\"size_gb\",\n    title=\"table sizes in TPC-H data\",\n    hover_data=[\"size_gb_mem\"],\n    labels={\n        \"name\": \"table name\",\n        \"size_gb\": \"size (GB on-disk in compressed Parquet files)\",\n        \"size_gb_mem\": \"size (approximate GB in memory)\",\n    },\n)\n\nprint(\n    f\"total size: {tmp['size_gb'].sum().to_pyarrow().as_py():,.2f}GBs (compressed Parquet files)\"\n)\nc\n```\n\n::: {.cell-output .cell-output-stdout}\n```\ntotal size: 407.40GBs (compressed Parquet files)\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<div>                            <div id=\"3453571d-830f-4df8-9f8a-07890ab3ad2c\" class=\"plotly-graph-div\" style=\"height:525px; width:100%;\"></div>            <script type=\"text/javascript\">                require([\"plotly\"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById(\"3453571d-830f-4df8-9f8a-07890ab3ad2c\")) {                    Plotly.newPlot(                        \"3453571d-830f-4df8-9f8a-07890ab3ad2c\",                        [{\"alignmentgroup\":\"True\",\"customdata\":[[610.57368901968],[148.12477697525173],[94.80156523771583],[26.504523511976004],[14.584088899753988],[1.6873541740700602],[7.024072110652923e-05],[3.30120325088501e-05]],\"hovertemplate\":\"table name=%{x}\\u003cbr\\u003esize (GB on-disk in compressed Parquet files)=%{y}\\u003cbr\\u003esize (approximate GB in memory)=%{customdata[0]}\\u003cextra\\u003e\\u003c\\u002fextra\\u003e\",\"legendgroup\":\"\",\"marker\":{\"color\":\"#636efa\",\"pattern\":{\"shape\":\"\"}},\"name\":\"\",\"offsetgroup\":\"\",\"orientation\":\"v\",\"showlegend\":false,\"textposition\":\"auto\",\"x\":[\"lineitem\",\"orders\",\"partsupp\",\"customer\",\"part\",\"supplier\",\"nation\",\"region\"],\"xaxis\":\"x\",\"y\":[277.53349500894547,67.32944407965988,43.09162056259811,12.04751068726182,6.6291313180699944,0.7669791700318456,3.1927600502967834e-05,1.500546932220459e-05],\"yaxis\":\"y\",\"type\":\"bar\"}],                        {\"template\":{\"data\":{\"barpolar\":[{\"marker\":{\"line\":{\"color\":\"rgb(17,17,17)\",\"width\":0.5},\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"barpolar\"}],\"bar\":[{\"error_x\":{\"color\":\"#f2f5fa\"},\"error_y\":{\"color\":\"#f2f5fa\"},\"marker\":{\"line\":{\"color\":\"rgb(17,17,17)\",\"width\":0.5},\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"bar\"}],\"carpet\":[{\"aaxis\":{\"endlinecolor\":\"#A2B1C6\",\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"minorgridcolor\":\"#506784\",\"startlinecolor\":\"#A2B1C6\"},\"baxis\":{\"endlinecolor\":\"#A2B1C6\",\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"minorgridcolor\":\"#506784\",\"startlinecolor\":\"#A2B1C6\"},\"type\":\"carpet\"}],\"choropleth\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"type\":\"choropleth\"}],\"contourcarpet\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"type\":\"contourcarpet\"}],\"contour\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"contour\"}],\"heatmapgl\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"heatmapgl\"}],\"heatmap\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"heatmap\"}],\"histogram2dcontour\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"histogram2dcontour\"}],\"histogram2d\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"histogram2d\"}],\"histogram\":[{\"marker\":{\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"histogram\"}],\"mesh3d\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"type\":\"mesh3d\"}],\"parcoords\":[{\"line\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"parcoords\"}],\"pie\":[{\"automargin\":true,\"type\":\"pie\"}],\"scatter3d\":[{\"line\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scatter3d\"}],\"scattercarpet\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scattercarpet\"}],\"scattergeo\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scattergeo\"}],\"scattergl\":[{\"marker\":{\"line\":{\"color\":\"#283442\"}},\"type\":\"scattergl\"}],\"scattermapbox\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scattermapbox\"}],\"scatterpolargl\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scatterpolargl\"}],\"scatterpolar\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scatterpolar\"}],\"scatter\":[{\"marker\":{\"line\":{\"color\":\"#283442\"}},\"type\":\"scatter\"}],\"scatterternary\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scatterternary\"}],\"surface\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"surface\"}],\"table\":[{\"cells\":{\"fill\":{\"color\":\"#506784\"},\"line\":{\"color\":\"rgb(17,17,17)\"}},\"header\":{\"fill\":{\"color\":\"#2a3f5f\"},\"line\":{\"color\":\"rgb(17,17,17)\"}},\"type\":\"table\"}]},\"layout\":{\"annotationdefaults\":{\"arrowcolor\":\"#f2f5fa\",\"arrowhead\":0,\"arrowwidth\":1},\"autotypenumbers\":\"strict\",\"coloraxis\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"colorscale\":{\"diverging\":[[0,\"#8e0152\"],[0.1,\"#c51b7d\"],[0.2,\"#de77ae\"],[0.3,\"#f1b6da\"],[0.4,\"#fde0ef\"],[0.5,\"#f7f7f7\"],[0.6,\"#e6f5d0\"],[0.7,\"#b8e186\"],[0.8,\"#7fbc41\"],[0.9,\"#4d9221\"],[1,\"#276419\"]],\"sequential\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"sequentialminus\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]},\"colorway\":[\"#636efa\",\"#EF553B\",\"#00cc96\",\"#ab63fa\",\"#FFA15A\",\"#19d3f3\",\"#FF6692\",\"#B6E880\",\"#FF97FF\",\"#FECB52\"],\"font\":{\"color\":\"#f2f5fa\"},\"geo\":{\"bgcolor\":\"rgb(17,17,17)\",\"lakecolor\":\"rgb(17,17,17)\",\"landcolor\":\"rgb(17,17,17)\",\"showlakes\":true,\"showland\":true,\"subunitcolor\":\"#506784\"},\"hoverlabel\":{\"align\":\"left\"},\"hovermode\":\"closest\",\"mapbox\":{\"style\":\"dark\"},\"margin\":{\"b\":0,\"l\":0,\"r\":0,\"t\":30},\"paper_bgcolor\":\"rgb(17,17,17)\",\"plot_bgcolor\":\"rgb(17,17,17)\",\"polar\":{\"angularaxis\":{\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"ticks\":\"\"},\"bgcolor\":\"rgb(17,17,17)\",\"radialaxis\":{\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"ticks\":\"\"}},\"scene\":{\"xaxis\":{\"backgroundcolor\":\"rgb(17,17,17)\",\"gridcolor\":\"#506784\",\"gridwidth\":2,\"linecolor\":\"#506784\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"#C8D4E3\"},\"yaxis\":{\"backgroundcolor\":\"rgb(17,17,17)\",\"gridcolor\":\"#506784\",\"gridwidth\":2,\"linecolor\":\"#506784\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"#C8D4E3\"},\"zaxis\":{\"backgroundcolor\":\"rgb(17,17,17)\",\"gridcolor\":\"#506784\",\"gridwidth\":2,\"linecolor\":\"#506784\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"#C8D4E3\"}},\"shapedefaults\":{\"line\":{\"color\":\"#f2f5fa\"}},\"sliderdefaults\":{\"bgcolor\":\"#C8D4E3\",\"bordercolor\":\"rgb(17,17,17)\",\"borderwidth\":1,\"tickwidth\":0},\"ternary\":{\"aaxis\":{\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"ticks\":\"\"},\"baxis\":{\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"ticks\":\"\"},\"bgcolor\":\"rgb(17,17,17)\",\"caxis\":{\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"ticks\":\"\"}},\"title\":{\"x\":0.05},\"updatemenudefaults\":{\"bgcolor\":\"#506784\",\"borderwidth\":0},\"xaxis\":{\"automargin\":true,\"gridcolor\":\"#283442\",\"linecolor\":\"#506784\",\"ticks\":\"\",\"title\":{\"standoff\":15},\"zerolinecolor\":\"#283442\",\"zerolinewidth\":2},\"yaxis\":{\"automargin\":true,\"gridcolor\":\"#283442\",\"linecolor\":\"#506784\",\"ticks\":\"\",\"title\":{\"standoff\":15},\"zerolinecolor\":\"#283442\",\"zerolinewidth\":2}}},\"xaxis\":{\"anchor\":\"y\",\"domain\":[0.0,1.0],\"title\":{\"text\":\"table name\"}},\"yaxis\":{\"anchor\":\"x\",\"domain\":[0.0,1.0],\"title\":{\"text\":\"size (GB on-disk in compressed Parquet files)\"}},\"legend\":{\"tracegroupgap\":0},\"title\":{\"text\":\"table sizes in TPC-H data\"},\"barmode\":\"relative\"},                        {\"responsive\": true}                    ).then(function(){\n                            \nvar gd = document.getElementById('3453571d-830f-4df8-9f8a-07890ab3ad2c');\nvar x = new MutationObserver(function (mutations, observer) {{\n        var display = window.getComputedStyle(gd).display;\n        if (!display || display === 'none') {{\n            console.log([gd, 'removed!']);\n            Plotly.purge(gd);\n            observer.disconnect();\n        }}\n}});\n\n// Listen for the removal of the full notebook cells\nvar notebookContainer = gd.closest('#notebook-container');\nif (notebookContainer) {{\n    x.observe(notebookContainer, {childList: true});\n}}\n\n// Listen for the clearing of the current output cell\nvar outputEl = gd.closest('.output');\nif (outputEl) {{\n    x.observe(outputEl, {childList: true});\n}}\n\n                        })                };                });            </script>        </div>\n```\n:::\n:::\n\n\nIn-memory this would be about 1TB. Uncompressed CSV files would be >1TB on disk.\n\nLet's explore the largest table, `lineitem`. This table in memory is ~6X larger\nthan RAM.\n\n::: {#def68271 .cell execution_count=6}\n``` {.python .cell-code code-fold=\"true\" code-summary=\"Show code to explore the lineitem table\"}\ntable_name = \"lineitem\"\ndata = f\"{data_dir}/{table_name}/*.parquet\"\n\nt = ibis.read_parquet(data)\nprint(f\"rows: {t.count().to_pyarrow().as_py():,} | columns: {len(t.columns)}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nrows: 6,144,008,876 | columns: 18\n```\n:::\n:::\n\n\nOver 6 billion rows!\n\nLet's try to display the first few rows with Ibis, pandas, and Polars:\n\n::: {.panel-tabset}\n\n## Ibis\n\n::: {#01bda6fa .cell execution_count=7}\n``` {.python .cell-code}\nt = ibis.read_parquet(data)\nt.head(3)\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━┳━━━━━━━┓\n┃<span style=\"font-weight: bold\"> l_orderkey </span>┃<span style=\"font-weight: bold\"> l_partkey </span>┃<span style=\"font-weight: bold\"> l_suppkey </span>┃<span style=\"font-weight: bold\"> l_linenumber </span>┃<span style=\"font-weight: bold\"> l_quantity     </span>┃<span style=\"font-weight: bold\"> l_extendedprice </span>┃<span style=\"font-weight: bold\"> l_discount     </span>┃<span style=\"font-weight: bold\"> l_tax          </span>┃<span style=\"font-weight: bold\"> l_returnflag </span>┃<span style=\"font-weight: bold\"> l_linestatus </span>┃<span style=\"font-weight: bold\"> l_shipdate </span>┃<span style=\"font-weight: bold\"> l_commitdate </span>┃<span style=\"font-weight: bold\"> l_receiptdate </span>┃<span style=\"font-weight: bold\"> l_shipinstruct    </span>┃<span style=\"font-weight: bold\"> l_shipmode </span>┃<span style=\"font-weight: bold\"> l_comment                          </span>┃<span style=\"font-weight: bold\"> n     </span>┃<span style=\"font-weight: bold\"> sf    </span>┃\n┡━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━╇━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>        │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">decimal(15, 2)</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">decimal(15, 2)</span>  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">decimal(15, 2)</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">decimal(15, 2)</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">date</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">date</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">date</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>            │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                             │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span> │\n├────────────┼───────────┼───────────┼──────────────┼────────────────┼─────────────────┼────────────────┼────────────────┼──────────────┼──────────────┼────────────┼──────────────┼───────────────┼───────────────────┼────────────┼────────────────────────────────────┼───────┼───────┤\n│          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">158913889</span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">7873905</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">17.00</span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">32213.98</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.04</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.02</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">N           </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">O           </span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-03-13</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-02-12</span>   │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-03-22</span>    │ <span style=\"color: #008000; text-decoration-color: #008000\">DELIVER IN PERSON</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">TRUCK     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">to beans x-ray carefull           </span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">128</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1024</span> │\n│          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">68924498</span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">7484499</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">36.00</span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">54685.80</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.09</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.06</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">N           </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">O           </span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-04-12</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-02-28</span>   │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-04-20</span>    │ <span style=\"color: #008000; text-decoration-color: #008000\">TAKE BACK RETURN </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">MAIL      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\"> according to the final foxes. qui</span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">128</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1024</span> │\n│          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">65228571</span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3788572</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">8.00</span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">11970.48</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.10</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.02</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">N           </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">O           </span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-01-29</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-03-05</span>   │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-01-31</span>    │ <span style=\"color: #008000; text-decoration-color: #008000\">TAKE BACK RETURN </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">REG AIR   </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">ourts cajole above the furiou     </span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">128</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1024</span> │\n└────────────┴───────────┴───────────┴──────────────┴────────────────┴─────────────────┴────────────────┴────────────────┴──────────────┴──────────────┴────────────┴──────────────┴───────────────┴───────────────────┴────────────┴────────────────────────────────────┴───────┴───────┘\n</pre>\n```\n:::\n:::\n\n\n## pandas\n\n```{.python}\ndf = pd.concat([pd.read_parquet(f) for f in glob.glob(data)], ignore_index=True) # <1>\ndf.head(3)\n```\n\n1. Work around lack of reading multiple parquet files in pandas\n\n```html\nThe Kernel crashed while executing code in the current cell or a previous cell.\nPlease review the code in the cell(s) to identify a possible cause of the failure.\nClick here for more info.\nView Jupyter log for further details.\n```\n\n## Polars (eager)\n\n```{.python}\ndf = pl.read_parquet(data)\ndf.head(3)\n```\n\n```html\nThe Kernel crashed while executing code in the current cell or a previous cell.\nPlease review the code in the cell(s) to identify a possible cause of the failure.\nClick here for more info.\nView Jupyter log for further details.\n```\n\n## Polars (lazy)\n\n::: {#37880636 .cell execution_count=8}\n``` {.python .cell-code}\ndf = pl.scan_parquet(data)\ndf.head(3).collect()\n```\n\n::: {.cell-output .cell-output-display execution_count=7}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (3, 16)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>l_orderkey</th><th>l_partkey</th><th>l_suppkey</th><th>l_linenumber</th><th>l_quantity</th><th>l_extendedprice</th><th>l_discount</th><th>l_tax</th><th>l_returnflag</th><th>l_linestatus</th><th>l_shipdate</th><th>l_commitdate</th><th>l_receiptdate</th><th>l_shipinstruct</th><th>l_shipmode</th><th>l_comment</th></tr><tr><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>decimal[15,2]</td><td>decimal[15,2]</td><td>decimal[15,2]</td><td>decimal[15,2]</td><td>str</td><td>str</td><td>date</td><td>date</td><td>date</td><td>str</td><td>str</td><td>str</td></tr></thead><tbody><tr><td>1</td><td>158913889</td><td>7873905</td><td>1</td><td>17.00</td><td>32213.98</td><td>0.04</td><td>0.02</td><td>&quot;N&quot;</td><td>&quot;O&quot;</td><td>1996-03-13</td><td>1996-02-12</td><td>1996-03-22</td><td>&quot;DELIVER IN PERSON&quot;</td><td>&quot;TRUCK&quot;</td><td>&quot;to beans x-ray carefull&quot;</td></tr><tr><td>1</td><td>68924498</td><td>7484499</td><td>2</td><td>36.00</td><td>54685.80</td><td>0.09</td><td>0.06</td><td>&quot;N&quot;</td><td>&quot;O&quot;</td><td>1996-04-12</td><td>1996-02-28</td><td>1996-04-20</td><td>&quot;TAKE BACK RETURN&quot;</td><td>&quot;MAIL&quot;</td><td>&quot; according to the final foxes.…</td></tr><tr><td>1</td><td>65228571</td><td>3788572</td><td>3</td><td>8.00</td><td>11970.48</td><td>0.10</td><td>0.02</td><td>&quot;N&quot;</td><td>&quot;O&quot;</td><td>1996-01-29</td><td>1996-03-05</td><td>1996-01-31</td><td>&quot;TAKE BACK RETURN&quot;</td><td>&quot;REG AIR&quot;</td><td>&quot;ourts cajole above the furiou&quot;</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n## Polars (lazy, streaming)\n\n::: {#e85a3292 .cell execution_count=9}\n``` {.python .cell-code}\ndf = pl.scan_parquet(data)\ndf.head(3).collect(streaming=True)\n```\n\n::: {.cell-output .cell-output-display execution_count=8}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (3, 16)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>l_orderkey</th><th>l_partkey</th><th>l_suppkey</th><th>l_linenumber</th><th>l_quantity</th><th>l_extendedprice</th><th>l_discount</th><th>l_tax</th><th>l_returnflag</th><th>l_linestatus</th><th>l_shipdate</th><th>l_commitdate</th><th>l_receiptdate</th><th>l_shipinstruct</th><th>l_shipmode</th><th>l_comment</th></tr><tr><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>decimal[15,2]</td><td>decimal[15,2]</td><td>decimal[15,2]</td><td>decimal[15,2]</td><td>str</td><td>str</td><td>date</td><td>date</td><td>date</td><td>str</td><td>str</td><td>str</td></tr></thead><tbody><tr><td>1</td><td>158913889</td><td>7873905</td><td>1</td><td>17.00</td><td>32213.98</td><td>0.04</td><td>0.02</td><td>&quot;N&quot;</td><td>&quot;O&quot;</td><td>1996-03-13</td><td>1996-02-12</td><td>1996-03-22</td><td>&quot;DELIVER IN PERSON&quot;</td><td>&quot;TRUCK&quot;</td><td>&quot;to beans x-ray carefull&quot;</td></tr><tr><td>1</td><td>68924498</td><td>7484499</td><td>2</td><td>36.00</td><td>54685.80</td><td>0.09</td><td>0.06</td><td>&quot;N&quot;</td><td>&quot;O&quot;</td><td>1996-04-12</td><td>1996-02-28</td><td>1996-04-20</td><td>&quot;TAKE BACK RETURN&quot;</td><td>&quot;MAIL&quot;</td><td>&quot; according to the final foxes.…</td></tr><tr><td>1</td><td>65228571</td><td>3788572</td><td>3</td><td>8.00</td><td>11970.48</td><td>0.10</td><td>0.02</td><td>&quot;N&quot;</td><td>&quot;O&quot;</td><td>1996-01-29</td><td>1996-03-05</td><td>1996-01-31</td><td>&quot;TAKE BACK RETURN&quot;</td><td>&quot;REG AIR&quot;</td><td>&quot;ourts cajole above the furiou&quot;</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n:::\n\nIbis, with the default backend of DuckDB, can display the first few rows. Polars\n(lazy) can too in regular and streaming mode.  For lazily computation, an\nunderlying query engine has the opportunity to determine a subset of data to be\nread into memory that satisfies a given query. For example, to display any three\nrows from the `lineitem` table it can just read the first three rows from the\nfirst Parquet file in the dataset.\n\nBoth pandas and Polars (eager) crash Python as they must load all the data into\nmemory to construct their dataframes. This is expected because the table in\nmemory ~6X larger than our 96GiB of RAM.\n\n:::{.callout-tip title=\"Visualize the Ibis expression tree\" collapse=\"true\"}\n\n::: {#84082a56 .cell execution_count=10}\n``` {.python .cell-code code-fold=\"true\" code-summary=\"Show code to visualize the Ibis expression tree\"}\nfrom ibis.expr.visualize import to_graph\n\nto_graph(t.head(3))\n```\n\n::: {.cell-output .cell-output-display execution_count=9}\n![](index_files/figure-html/cell-10-output-1.svg){}\n:::\n:::\n\n\n:::\n\nLet's try something more challenging: [partially\nsorting](https://en.wikipedia.org/wiki/Partial_sorting) the `lineitem` table.\nThis forces at least some columns from all rows of data to pass through the\nquery engine to determine the top 3 rows per the specified ordering. Since the\ndata is larger than RAM, only \"streaming\" engines can handle this. We'll try\nwith the methods that worked on the previous query and add in the DataFusion\nbackend for Ibis.\n\n::: {.panel-tabset}\n\n## Ibis (DuckDB)\n\n```{.python}\nibis.set_backend(\"duckdb\")\nt = ibis.read_parquet(data)\nt.order_by(t[\"l_orderkey\"], t[\"l_partkey\"], t[\"l_suppkey\"]).head(3)\n```\n\n::: {#2370b7da .cell execution_count=11}\n\n::: {.cell-output .cell-output-display execution_count=10}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━┳━━━━━━━┓\n┃<span style=\"font-weight: bold\"> l_orderkey </span>┃<span style=\"font-weight: bold\"> l_partkey </span>┃<span style=\"font-weight: bold\"> l_suppkey </span>┃<span style=\"font-weight: bold\"> l_linenumber </span>┃<span style=\"font-weight: bold\"> l_quantity     </span>┃<span style=\"font-weight: bold\"> l_extendedprice </span>┃<span style=\"font-weight: bold\"> l_discount     </span>┃<span style=\"font-weight: bold\"> l_tax          </span>┃<span style=\"font-weight: bold\"> l_returnflag </span>┃<span style=\"font-weight: bold\"> l_linestatus </span>┃<span style=\"font-weight: bold\"> l_shipdate </span>┃<span style=\"font-weight: bold\"> l_commitdate </span>┃<span style=\"font-weight: bold\"> l_receiptdate </span>┃<span style=\"font-weight: bold\"> l_shipinstruct    </span>┃<span style=\"font-weight: bold\"> l_shipmode </span>┃<span style=\"font-weight: bold\"> l_comment                </span>┃<span style=\"font-weight: bold\"> n     </span>┃<span style=\"font-weight: bold\"> sf    </span>┃\n┡━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━╇━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>        │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">decimal(15, 2)</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">decimal(15, 2)</span>  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">decimal(15, 2)</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">decimal(15, 2)</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">date</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">date</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">date</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>            │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                   │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span> │\n├────────────┼───────────┼───────────┼──────────────┼────────────────┼─────────────────┼────────────────┼────────────────┼──────────────┼──────────────┼────────────┼──────────────┼───────────────┼───────────────────┼────────────┼──────────────────────────┼───────┼───────┤\n│          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2182651</span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4742652</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">28.00</span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">48539.40</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.09</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.06</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">N           </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">O           </span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-04-21</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-03-30</span>   │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-05-16</span>    │ <span style=\"color: #008000; text-decoration-color: #008000\">NONE             </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">AIR       </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">s cajole busily above t </span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">128</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1024</span> │\n│          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">16009676</span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">649679</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">6</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">32.00</span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">50715.84</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.07</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.02</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">N           </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">O           </span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-01-30</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-02-07</span>   │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-02-03</span>    │ <span style=\"color: #008000; text-decoration-color: #008000\">DELIVER IN PERSON</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">MAIL      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">rouches. special        </span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">128</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1024</span> │\n│          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">24603274</span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1563281</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">24.00</span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">28224.96</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.10</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.04</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">N           </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">O           </span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-03-30</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-03-14</span>   │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-04-01</span>    │ <span style=\"color: #008000; text-decoration-color: #008000\">NONE             </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">FOB       </span> │ <span style=\"color: #008000; text-decoration-color: #008000\"> the regular, regular pa</span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">128</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1024</span> │\n└────────────┴───────────┴───────────┴──────────────┴────────────────┴─────────────────┴────────────────┴────────────────┴──────────────┴──────────────┴────────────┴──────────────┴───────────────┴───────────────────┴────────────┴──────────────────────────┴───────┴───────┘\n</pre>\n```\n:::\n:::\n\n\n![CPU/RAM while Ibis with the DuckDB backend sorting](ibis-duckdb-sort.gif)\n\n## Ibis (DataFusion)\n\n::: {#b07e6926 .cell execution_count=12}\n``` {.python .cell-code}\nibis.set_backend(\"datafusion\")\nt = ibis.read_parquet(data)\nt.order_by(t[\"l_orderkey\"], t[\"l_partkey\"], t[\"l_suppkey\"]).head(3)\n```\n\n::: {.cell-output .cell-output-display execution_count=11}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> l_orderkey </span>┃<span style=\"font-weight: bold\"> l_partkey </span>┃<span style=\"font-weight: bold\"> l_suppkey </span>┃<span style=\"font-weight: bold\"> l_linenumber </span>┃<span style=\"font-weight: bold\"> l_quantity     </span>┃<span style=\"font-weight: bold\"> l_extendedprice </span>┃<span style=\"font-weight: bold\"> l_discount     </span>┃<span style=\"font-weight: bold\"> l_tax          </span>┃<span style=\"font-weight: bold\"> l_returnflag </span>┃<span style=\"font-weight: bold\"> l_linestatus </span>┃<span style=\"font-weight: bold\"> l_shipdate </span>┃<span style=\"font-weight: bold\"> l_commitdate </span>┃<span style=\"font-weight: bold\"> l_receiptdate </span>┃<span style=\"font-weight: bold\"> l_shipinstruct    </span>┃<span style=\"font-weight: bold\"> l_shipmode </span>┃<span style=\"font-weight: bold\"> l_comment                </span>┃\n┡━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>        │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">decimal(15, 2)</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">decimal(15, 2)</span>  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">decimal(15, 2)</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">decimal(15, 2)</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">date</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">date</span>         │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">date</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>            │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                   │\n├────────────┼───────────┼───────────┼──────────────┼────────────────┼─────────────────┼────────────────┼────────────────┼──────────────┼──────────────┼────────────┼──────────────┼───────────────┼───────────────────┼────────────┼──────────────────────────┤\n│          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2182651</span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4742652</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">28.00</span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">48539.40</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.09</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.06</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">N           </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">O           </span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-04-21</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-03-30</span>   │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-05-16</span>    │ <span style=\"color: #008000; text-decoration-color: #008000\">NONE             </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">AIR       </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">s cajole busily above t </span> │\n│          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">16009676</span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">649679</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">6</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">32.00</span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">50715.84</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.07</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.02</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">N           </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">O           </span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-01-30</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-02-07</span>   │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-02-03</span>    │ <span style=\"color: #008000; text-decoration-color: #008000\">DELIVER IN PERSON</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">MAIL      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">rouches. special        </span> │\n│          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │  <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">24603274</span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1563281</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span> │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">24.00</span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">28224.96</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.10</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0.04</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">N           </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">O           </span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-03-30</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-03-14</span>   │ <span style=\"color: #800080; text-decoration-color: #800080\">1996-04-01</span>    │ <span style=\"color: #008000; text-decoration-color: #008000\">NONE             </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">FOB       </span> │ <span style=\"color: #008000; text-decoration-color: #008000\"> the regular, regular pa</span> │\n└────────────┴───────────┴───────────┴──────────────┴────────────────┴─────────────────┴────────────────┴────────────────┴──────────────┴──────────────┴────────────┴──────────────┴───────────────┴───────────────────┴────────────┴──────────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n![CPU/RAM while Ibis with the DataFusion backend sorting](ibis-datafusion-sort.gif)\n\n## Polars (lazy)\n\n```{.python}\ndf = pl.scan_parquet(data)\n(\n    df.sort(pl.col(\"l_orderkey\"), pl.col(\"l_partkey\"), pl.col(\"l_suppkey\"))\n    .head(3)\n    .collect()\n)\n```\n\n```html\nThe Kernel crashed while executing code in the current cell or a previous cell.\nPlease review the code in the cell(s) to identify a possible cause of the failure.\nClick here for more info.\nView Jupyter log for further details.\n```\n\n![CPU/RAM while Polars with the lazy API sorting](polars-lazy-sort.gif)\n\n## Polars (lazy, streaming)\n\n```{.python}\ndf = pl.scan_parquet(data)\n(\n    df.sort(pl.col(\"l_orderkey\"), pl.col(\"l_partkey\"), pl.col(\"l_suppkey\"))\n    .head(3)\n    .collect(streaming=True)\n)\n```\n\n```html\nPanicException: called `Result::unwrap()` on an `Err` value: \"SendError(..)\"\n```\n\nSee [GitHub\nissue](https://github.com/pola-rs/polars/issues/17289#issuecomment-2200469528).\n\n![CPU/RAM while Polars with the lazy API, streaming engine sorting](polars-lazy-streaming-sort.gif)\n\n:::\n\n:::{.callout-tip title=\"Visualize the Ibis expression tree\" collapse=\"true\"}\n\n::: {#83b9f9ff .cell execution_count=13}\n``` {.python .cell-code code-fold=\"true\" code-summary=\"Show code to visualize the Ibis expression tree\"}\nfrom ibis.expr.visualize import to_graph\n\nto_graph(t.order_by(t[\"l_orderkey\"], t[\"l_partkey\"], t[\"l_suppkey\"]).head(3))\n```\n\n::: {.cell-output .cell-output-display execution_count=12}\n![](index_files/figure-html/cell-13-output-1.svg){}\n:::\n:::\n\n\n:::\n\nIbis with the DuckDB and DataFusion backends complete this in about 2 minutes\neach. Polars (lazy) crashes the kernel after about 2 minutes with its default\nmode and panics in streaming mode.\n\n**Streaming is an overloaded term here**. In the context of Ibis, a streaming\nbackend refers to a near real-time data processing engine like [Apache\nFlink](https://ibis-project.org/backends/flink) or\n[RisingWave](https://ibis-project.org/backends/risingwave). In the context of\nPolars, streaming is a separate engine from the default that can handle\nlarger-than-memory data. This general paradigm is already used by DuckDB and\nDataFusion, hence their ability to complete the above query. [The Polars team\ndoes not recommend using their current streaming engine for\nbenchmarking](https://github.com/pola-rs/polars/issues/16694#issuecomment-2146668559)\nand has [announced a new version of their streaming\nengine](https://pola.rs/posts/announcing-polars-1/#new-engine-design).\n\nAs we'll see in the benchmark result, some queries will fail to complete with\nPolars and DataFusion. These queries are killed by the operating system due to a\nlack of memory.\n\n:::{.callout-tip title=\"Sampling large datasets with Ibis\" collapse=\"true\"}\nIf we want to work with pandas or Polars dataframes at larger scales, we can use\nIbis to sample or filter the data (and perform any other operations) with\ncomputation pushed to a more scalable backend. Then just output the Ibis\ndataframe to pandas or Polars for downstream use:\n\n\n\n:::{.panel-tabset}\n\n## pandas\n\n::: {#66fb5bcd .cell execution_count=15}\n``` {.python .cell-code}\nt = ibis.read_parquet(data)\n\ndf = (\n    t.sample(fraction=0.0001)\n    .order_by(t[\"l_orderkey\"], t[\"l_partkey\"], t[\"l_suppkey\"])\n    .to_pandas()\n)\ndf.head(3)\n```\n\n::: {.cell-output .cell-output-display execution_count=14}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>l_orderkey</th>\n      <th>l_partkey</th>\n      <th>l_suppkey</th>\n      <th>l_linenumber</th>\n      <th>l_quantity</th>\n      <th>l_extendedprice</th>\n      <th>l_discount</th>\n      <th>l_tax</th>\n      <th>l_returnflag</th>\n      <th>l_linestatus</th>\n      <th>l_shipdate</th>\n      <th>l_commitdate</th>\n      <th>l_receiptdate</th>\n      <th>l_shipinstruct</th>\n      <th>l_shipmode</th>\n      <th>l_comment</th>\n      <th>n</th>\n      <th>sf</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>3298</td>\n      <td>29573398</td>\n      <td>6533405</td>\n      <td>3</td>\n      <td>25.00</td>\n      <td>36748.00</td>\n      <td>0.10</td>\n      <td>0.08</td>\n      <td>N</td>\n      <td>O</td>\n      <td>1996-06-30</td>\n      <td>1996-05-31</td>\n      <td>1996-07-23</td>\n      <td>COLLECT COD</td>\n      <td>SHIP</td>\n      <td>s! final pin</td>\n      <td>128</td>\n      <td>1024</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>17921</td>\n      <td>67164080</td>\n      <td>604093</td>\n      <td>5</td>\n      <td>21.00</td>\n      <td>23955.33</td>\n      <td>0.07</td>\n      <td>0.00</td>\n      <td>N</td>\n      <td>O</td>\n      <td>1998-09-21</td>\n      <td>1998-10-08</td>\n      <td>1998-10-19</td>\n      <td>TAKE BACK RETURN</td>\n      <td>TRUCK</td>\n      <td>ress requests nag against the slyl</td>\n      <td>128</td>\n      <td>1024</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>19270</td>\n      <td>58990671</td>\n      <td>7790672</td>\n      <td>2</td>\n      <td>7.00</td>\n      <td>12311.11</td>\n      <td>0.08</td>\n      <td>0.01</td>\n      <td>N</td>\n      <td>O</td>\n      <td>1998-03-17</td>\n      <td>1997-12-20</td>\n      <td>1998-03-18</td>\n      <td>TAKE BACK RETURN</td>\n      <td>TRUCK</td>\n      <td>boost closely. furiously</td>\n      <td>128</td>\n      <td>1024</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n## Polars\n\n::: {#74b1e54c .cell execution_count=16}\n``` {.python .cell-code}\nt = ibis.read_parquet(data)\n\ndf = (\n    t.sample(fraction=0.0001)\n    .order_by(t[\"l_orderkey\"], t[\"l_partkey\"], t[\"l_suppkey\"])\n    .to_polars()\n)\ndf.head(3)\n```\n\n::: {.cell-output .cell-output-display execution_count=15}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (3, 18)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>l_orderkey</th><th>l_partkey</th><th>l_suppkey</th><th>l_linenumber</th><th>l_quantity</th><th>l_extendedprice</th><th>l_discount</th><th>l_tax</th><th>l_returnflag</th><th>l_linestatus</th><th>l_shipdate</th><th>l_commitdate</th><th>l_receiptdate</th><th>l_shipinstruct</th><th>l_shipmode</th><th>l_comment</th><th>n</th><th>sf</th></tr><tr><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>decimal[15,2]</td><td>decimal[15,2]</td><td>decimal[15,2]</td><td>decimal[15,2]</td><td>str</td><td>str</td><td>date</td><td>date</td><td>date</td><td>str</td><td>str</td><td>str</td><td>i64</td><td>i64</td></tr></thead><tbody><tr><td>9639</td><td>23541025</td><td>501032</td><td>2</td><td>42.00</td><td>44723.70</td><td>0.09</td><td>0.08</td><td>&quot;A&quot;</td><td>&quot;F&quot;</td><td>1993-09-24</td><td>1993-11-16</td><td>1993-09-27</td><td>&quot;NONE&quot;</td><td>&quot;MAIL&quot;</td><td>&quot;ses through th&quot;</td><td>128</td><td>1024</td></tr><tr><td>33153</td><td>182687032</td><td>8607033</td><td>4</td><td>15.00</td><td>15148.50</td><td>0.08</td><td>0.04</td><td>&quot;N&quot;</td><td>&quot;O&quot;</td><td>1997-08-20</td><td>1997-07-11</td><td>1997-08-30</td><td>&quot;COLLECT COD&quot;</td><td>&quot;REG AIR&quot;</td><td>&quot;iously furio&quot;</td><td>128</td><td>1024</td></tr><tr><td>37284</td><td>33051969</td><td>4891973</td><td>2</td><td>16.00</td><td>30708.96</td><td>0.04</td><td>0.00</td><td>&quot;N&quot;</td><td>&quot;O&quot;</td><td>1995-07-10</td><td>1995-05-16</td><td>1995-07-22</td><td>&quot;DELIVER IN PERSON&quot;</td><td>&quot;AIR&quot;</td><td>&quot;ts. even deposits cajole after…</td><td>128</td><td>1024</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n:::\n\nWe can also use this to iterate more quickly on a subset of data with Ibis to\nconstruct our queries. Once we're happy with them, we can change one line of\ncode to run them on the full data.\n\n:::\n\n## 1TB TPC-H benchmark results\n\nLet's delve into the results of benchmarking ~1TB (`sf=1024`) TPC-H queries on a\nlaptop.\n\n:::{.callout-important title=\"Not an official TPC-H benchmark\"}\nThis is not an [official TPC-H benchmark](https://www.tpc.org/tpch). We ran a\nderivate of the TPC-H benchmark.\n:::\n\n:::{.callout-warning title=\"Key differences from previous benchmarking\"}\nSee [the prior benchmark post](../ibis-bench/index.qmd) for more details and key\nconsiderations. Key differences in this iteration include:\n\n1. `polars-u64-idx` was used instead of `polars`\n2. [Some Polars queries were\n updated](https://github.com/lostmygithubaccount/ibis-bench/pull/5)\n3. Parquet files were generated with `n=128` partitions\n    - this was done to avoid OOM errors when generating the data\n    - this should have little impact on the query execution time\n4. Queries 18 and 21 for Polars, 9 and 18 for DataFusion were skipped\n    - they ran for a very long time without completing or failing\n    - the prior benchmark indicates these queries would likely eventually fail\n\nThe Python package versions used were:\n\n- `ibis-framework==9.1.0`\n- `datafusion==38.0.1`\n- `duckdb==1.0.0`\n- `polars-u64-idx==1.0.0`\n\nThe three systems tested were:\n\n- `ibis-duckdb`: Ibis dataframe code on the DuckDB backend\n- `ibis-datafusion`: Ibis dataframe code on the DataFusion backend\n- `polars-lazy`: Polars (lazy API) dataframe code\n:::\n\nTo follow along, install the required packages:\n\n```bash\npip install 'ibis-framework[duckdb]' gcsfs plotly great-tables\n```\n\nThe code for reading and analyzing the data is collapsed below.\n\n::: {#5cf05c32 .cell execution_count=17}\n``` {.python .cell-code code-fold=\"true\" code-summary=\"Show code to read and analyze the benchmark data\"}\nimport ibis\nimport gcsfs\nimport plotly.express as px\n\nfrom great_tables import GT, md\n\npx.defaults.template = \"plotly_dark\"\n\nibis.set_backend(\"duckdb\")\nibis.options.interactive = True\nibis.options.repr.interactive.max_rows = 3\n\nfs = gcsfs.GCSFileSystem()\nibis.get_backend().register_filesystem(fs)\n\nt = (\n    ibis.read_parquet(\n        \"gs://ibis-bench/1tbc/cache/file_id=*.parquet\",\n    )\n    .select(\n        \"system\",\n        \"sf\",\n        \"n_partitions\",\n        \"query_number\",\n        \"execution_seconds\",\n        \"timestamp\",\n    )\n    .mutate(timestamp=ibis._[\"timestamp\"].cast(\"timestamp\"))\n    .order_by(\"system\", \"query_number\")\n    .cache()\n)\n\nsystems = sorted(t.distinct(on=\"system\")[\"system\"].collect().to_pyarrow().as_py())\n\nagg = (\n    t.mutate(\n        run_num=ibis.row_number().over(\n            group_by=[\"system\", \"sf\", \"n_partitions\", \"query_number\"],\n            order_by=[\"timestamp\"],\n        )\n    )\n    .relocate(t.columns[:4], \"run_num\")\n    .group_by(\"system\", \"query_number\", \"run_num\")\n    .agg(execution_seconds=ibis._[\"execution_seconds\"].mean())\n    .order_by(\"system\", \"query_number\", \"run_num\")\n)\nagg2 = (\n    agg.group_by(\"system\", \"query_number\")\n    .agg(avg_execution_seconds=agg.execution_seconds.mean().round(2))\n    .order_by(\"system\", \"query_number\")\n)\npiv = agg2.pivot_wider(\n    names_from=\"system\", values_from=[\"avg_execution_seconds\"]\n).order_by(\"query_number\")\n\n\ndef x_vs_y(piv, x, y):\n    return ibis.ifelse(\n        piv[x] < piv[y],\n        -1,\n        1,\n    ) * (\n        (\n            (piv[x] - piv[y])\n            / ibis.ifelse(\n                piv[y] > piv[x],\n                piv[x],\n                piv[y],\n            )\n        ).abs()\n    ).round(4)\n\n\ncomparisons = [\n    (\"ibis-datafusion\", \"ibis-duckdb\"),\n    (\"polars-lazy\", \"ibis-datafusion\"),\n    (\"polars-lazy\", \"ibis-duckdb\"),\n]\n\ncomparisons = {f\"{x}_v_{y}\": x_vs_y(piv, x, y) for x, y in comparisons}\n\npiv2 = piv.mutate(**comparisons)\npiv2 = piv2.order_by(\"query_number\").relocate(\"query_number\", systems)\n\nagg3 = (\n    agg2.group_by(\"system\")\n    .agg(\n        queries_completed=agg2[\"avg_execution_seconds\"].count(),\n        execution_seconds=agg2[\"avg_execution_seconds\"].sum().round(2),\n        seconds_per_query=agg2[\"avg_execution_seconds\"].mean().round(2),\n    )\n    .order_by(ibis.desc(\"queries_completed\"))\n)\nagg3\n```\n\n::: {.cell-output .cell-output-display execution_count=16}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> system          </span>┃<span style=\"font-weight: bold\"> queries_completed </span>┃<span style=\"font-weight: bold\"> execution_seconds </span>┃<span style=\"font-weight: bold\"> seconds_per_query </span>┃\n┡━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>             │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>           │\n├─────────────────┼───────────────────┼───────────────────┼───────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">ibis-duckdb    </span> │                <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">22</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1448.42</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">65.84</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">ibis-datafusion</span> │                <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">17</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1182.23</span> │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">69.54</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">polars-lazy    </span> │                <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">13</span> │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1995.16</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">153.47</span> │\n└─────────────────┴───────────────────┴───────────────────┴───────────────────┘\n</pre>\n```\n:::\n:::\n\n\n`ibis-duckdb` completed all 22/22 queries **in under 30 minutes**. If you need\nto run batch data jobs on a similar amount of data, a laptop might be all you\nneed!\n\n`ibis-datafusion` only completed 17/22 queries, though recall [3 are failing due\nto a bug that's already been\nfixed](../ibis-bench/index.qmd#failing-datafusion-queries). A new Python release\nfor DataFusion hasn't been made yet, so we ran with the old version. Assuming\nthose queries would complete, only 2 queries would be failing due to lack of\nmemory. More investigation would be needed to determine the work needed for all\n22 queries to pass under these conditions.\n\n`polars-lazy` only completed 13/22 queries, with 8 failing due lack of memory.\nThe [new streaming\nengine](https://pola.rs/posts/announcing-polars-1/#new-engine-design) will\nlikely help with this.\n\nLet's plot execution time for each query and system:\n\n:::{.callout-tip title=\"You can de-select systems in the legend\"}\nIt might be easier to look at 2 systems at a time. You can click on a system in\nthe legend of the plot to de-select it.\n:::\n\n::: {#f03b08fb .cell execution_count=18}\n``` {.python .cell-code code-fold=\"true\" code-summary=\"Show code to plot execution time by query and system\"}\nc = px.bar(\n    agg2,\n    x=\"query_number\",\n    y=\"avg_execution_seconds\",\n    title=\"Average execution time by query\",\n    color=\"system\",\n    barmode=\"group\",\n    log_y=True,\n)\nc\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<div>                            <div id=\"078f867f-086b-4abc-a75f-9b85bd8fbd6d\" class=\"plotly-graph-div\" style=\"height:525px; width:100%;\"></div>            <script type=\"text/javascript\">                require([\"plotly\"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById(\"078f867f-086b-4abc-a75f-9b85bd8fbd6d\")) {                    Plotly.newPlot(                        \"078f867f-086b-4abc-a75f-9b85bd8fbd6d\",                        [{\"alignmentgroup\":\"True\",\"hovertemplate\":\"system=ibis-datafusion\\u003cbr\\u003equery_number=%{x}\\u003cbr\\u003eavg_execution_seconds=%{y}\\u003cextra\\u003e\\u003c\\u002fextra\\u003e\",\"legendgroup\":\"ibis-datafusion\",\"marker\":{\"color\":\"#636efa\",\"pattern\":{\"shape\":\"\"}},\"name\":\"ibis-datafusion\",\"offsetgroup\":\"ibis-datafusion\",\"orientation\":\"v\",\"showlegend\":true,\"textposition\":\"auto\",\"x\":[1,2,3,4,5,6,7,8,10,11,12,13,14,15,17,19,20],\"xaxis\":\"x\",\"y\":[87.67,8.68,50.43,34.81,61.43,33.05,90.75,72.98,75.63,22.25,54.09,60.72,40.06,73.67,252.67,79.78,83.56],\"yaxis\":\"y\",\"type\":\"bar\"},{\"alignmentgroup\":\"True\",\"hovertemplate\":\"system=ibis-duckdb\\u003cbr\\u003equery_number=%{x}\\u003cbr\\u003eavg_execution_seconds=%{y}\\u003cextra\\u003e\\u003c\\u002fextra\\u003e\",\"legendgroup\":\"ibis-duckdb\",\"marker\":{\"color\":\"#EF553B\",\"pattern\":{\"shape\":\"\"}},\"name\":\"ibis-duckdb\",\"offsetgroup\":\"ibis-duckdb\",\"orientation\":\"v\",\"showlegend\":true,\"textposition\":\"auto\",\"x\":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22],\"xaxis\":\"x\",\"y\":[77.45,7.38,48.72,33.29,51.99,33.8,102.99,62.05,116.41,58.34,10.22,46.86,48.57,38.79,69.39,9.48,54.44,350.98,64.85,41.18,110.43,10.81],\"yaxis\":\"y\",\"type\":\"bar\"},{\"alignmentgroup\":\"True\",\"hovertemplate\":\"system=polars-lazy\\u003cbr\\u003equery_number=%{x}\\u003cbr\\u003eavg_execution_seconds=%{y}\\u003cextra\\u003e\\u003c\\u002fextra\\u003e\",\"legendgroup\":\"polars-lazy\",\"marker\":{\"color\":\"#00cc96\",\"pattern\":{\"shape\":\"\"}},\"name\":\"polars-lazy\",\"offsetgroup\":\"polars-lazy\",\"orientation\":\"v\",\"showlegend\":true,\"textposition\":\"auto\",\"x\":[2,4,6,7,10,11,12,14,15,16,19,20,22],\"xaxis\":\"x\",\"y\":[9.44,73.72,79.69,305.02,262.09,25.31,126.77,101.46,63.32,10.93,422.94,498.25,16.22],\"yaxis\":\"y\",\"type\":\"bar\"}],                        {\"template\":{\"data\":{\"barpolar\":[{\"marker\":{\"line\":{\"color\":\"rgb(17,17,17)\",\"width\":0.5},\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"barpolar\"}],\"bar\":[{\"error_x\":{\"color\":\"#f2f5fa\"},\"error_y\":{\"color\":\"#f2f5fa\"},\"marker\":{\"line\":{\"color\":\"rgb(17,17,17)\",\"width\":0.5},\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"bar\"}],\"carpet\":[{\"aaxis\":{\"endlinecolor\":\"#A2B1C6\",\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"minorgridcolor\":\"#506784\",\"startlinecolor\":\"#A2B1C6\"},\"baxis\":{\"endlinecolor\":\"#A2B1C6\",\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"minorgridcolor\":\"#506784\",\"startlinecolor\":\"#A2B1C6\"},\"type\":\"carpet\"}],\"choropleth\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"type\":\"choropleth\"}],\"contourcarpet\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"type\":\"contourcarpet\"}],\"contour\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"contour\"}],\"heatmapgl\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"heatmapgl\"}],\"heatmap\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"heatmap\"}],\"histogram2dcontour\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"histogram2dcontour\"}],\"histogram2d\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"histogram2d\"}],\"histogram\":[{\"marker\":{\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"histogram\"}],\"mesh3d\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"type\":\"mesh3d\"}],\"parcoords\":[{\"line\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"parcoords\"}],\"pie\":[{\"automargin\":true,\"type\":\"pie\"}],\"scatter3d\":[{\"line\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scatter3d\"}],\"scattercarpet\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scattercarpet\"}],\"scattergeo\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scattergeo\"}],\"scattergl\":[{\"marker\":{\"line\":{\"color\":\"#283442\"}},\"type\":\"scattergl\"}],\"scattermapbox\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scattermapbox\"}],\"scatterpolargl\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scatterpolargl\"}],\"scatterpolar\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scatterpolar\"}],\"scatter\":[{\"marker\":{\"line\":{\"color\":\"#283442\"}},\"type\":\"scatter\"}],\"scatterternary\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scatterternary\"}],\"surface\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"surface\"}],\"table\":[{\"cells\":{\"fill\":{\"color\":\"#506784\"},\"line\":{\"color\":\"rgb(17,17,17)\"}},\"header\":{\"fill\":{\"color\":\"#2a3f5f\"},\"line\":{\"color\":\"rgb(17,17,17)\"}},\"type\":\"table\"}]},\"layout\":{\"annotationdefaults\":{\"arrowcolor\":\"#f2f5fa\",\"arrowhead\":0,\"arrowwidth\":1},\"autotypenumbers\":\"strict\",\"coloraxis\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"colorscale\":{\"diverging\":[[0,\"#8e0152\"],[0.1,\"#c51b7d\"],[0.2,\"#de77ae\"],[0.3,\"#f1b6da\"],[0.4,\"#fde0ef\"],[0.5,\"#f7f7f7\"],[0.6,\"#e6f5d0\"],[0.7,\"#b8e186\"],[0.8,\"#7fbc41\"],[0.9,\"#4d9221\"],[1,\"#276419\"]],\"sequential\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"sequentialminus\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]},\"colorway\":[\"#636efa\",\"#EF553B\",\"#00cc96\",\"#ab63fa\",\"#FFA15A\",\"#19d3f3\",\"#FF6692\",\"#B6E880\",\"#FF97FF\",\"#FECB52\"],\"font\":{\"color\":\"#f2f5fa\"},\"geo\":{\"bgcolor\":\"rgb(17,17,17)\",\"lakecolor\":\"rgb(17,17,17)\",\"landcolor\":\"rgb(17,17,17)\",\"showlakes\":true,\"showland\":true,\"subunitcolor\":\"#506784\"},\"hoverlabel\":{\"align\":\"left\"},\"hovermode\":\"closest\",\"mapbox\":{\"style\":\"dark\"},\"margin\":{\"b\":0,\"l\":0,\"r\":0,\"t\":30},\"paper_bgcolor\":\"rgb(17,17,17)\",\"plot_bgcolor\":\"rgb(17,17,17)\",\"polar\":{\"angularaxis\":{\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"ticks\":\"\"},\"bgcolor\":\"rgb(17,17,17)\",\"radialaxis\":{\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"ticks\":\"\"}},\"scene\":{\"xaxis\":{\"backgroundcolor\":\"rgb(17,17,17)\",\"gridcolor\":\"#506784\",\"gridwidth\":2,\"linecolor\":\"#506784\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"#C8D4E3\"},\"yaxis\":{\"backgroundcolor\":\"rgb(17,17,17)\",\"gridcolor\":\"#506784\",\"gridwidth\":2,\"linecolor\":\"#506784\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"#C8D4E3\"},\"zaxis\":{\"backgroundcolor\":\"rgb(17,17,17)\",\"gridcolor\":\"#506784\",\"gridwidth\":2,\"linecolor\":\"#506784\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"#C8D4E3\"}},\"shapedefaults\":{\"line\":{\"color\":\"#f2f5fa\"}},\"sliderdefaults\":{\"bgcolor\":\"#C8D4E3\",\"bordercolor\":\"rgb(17,17,17)\",\"borderwidth\":1,\"tickwidth\":0},\"ternary\":{\"aaxis\":{\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"ticks\":\"\"},\"baxis\":{\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"ticks\":\"\"},\"bgcolor\":\"rgb(17,17,17)\",\"caxis\":{\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"ticks\":\"\"}},\"title\":{\"x\":0.05},\"updatemenudefaults\":{\"bgcolor\":\"#506784\",\"borderwidth\":0},\"xaxis\":{\"automargin\":true,\"gridcolor\":\"#283442\",\"linecolor\":\"#506784\",\"ticks\":\"\",\"title\":{\"standoff\":15},\"zerolinecolor\":\"#283442\",\"zerolinewidth\":2},\"yaxis\":{\"automargin\":true,\"gridcolor\":\"#283442\",\"linecolor\":\"#506784\",\"ticks\":\"\",\"title\":{\"standoff\":15},\"zerolinecolor\":\"#283442\",\"zerolinewidth\":2}}},\"xaxis\":{\"anchor\":\"y\",\"domain\":[0.0,1.0],\"title\":{\"text\":\"query_number\"}},\"yaxis\":{\"anchor\":\"x\",\"domain\":[0.0,1.0],\"title\":{\"text\":\"avg_execution_seconds\"},\"type\":\"log\"},\"legend\":{\"title\":{\"text\":\"system\"},\"tracegroupgap\":0},\"title\":{\"text\":\"Average execution time by query\"},\"barmode\":\"group\"},                        {\"responsive\": true}                    ).then(function(){\n                            \nvar gd = document.getElementById('078f867f-086b-4abc-a75f-9b85bd8fbd6d');\nvar x = new MutationObserver(function (mutations, observer) {{\n        var display = window.getComputedStyle(gd).display;\n        if (!display || display === 'none') {{\n            console.log([gd, 'removed!']);\n            Plotly.purge(gd);\n            observer.disconnect();\n        }}\n}});\n\n// Listen for the removal of the full notebook cells\nvar notebookContainer = gd.closest('#notebook-container');\nif (notebookContainer) {{\n    x.observe(notebookContainer, {childList: true});\n}}\n\n// Listen for the clearing of the current output cell\nvar outputEl = gd.closest('.output');\nif (outputEl) {{\n    x.observe(outputEl, {childList: true});\n}}\n\n                        })                };                });            </script>        </div>\n```\n:::\n:::\n\n\nLet's show a [Great Tables](https://github.com/posit-dev/great-tables) table of\npivoted data including relative speed differences between the systems:\n\n::: {#5ce12f7f .cell execution_count=19}\n``` {.python .cell-code code-fold=\"true\" code-summary=\"Show code to create Great Table table from pivoted aggregated benchmark data\"}\ncolor_palette = \"plasma\"\nna_color = \"black\"\nstyle_color = \"cyan\"\n\ntbl = (\n    GT(\n        piv2.mutate(**{\" \": ibis.literal(\"\")})\n        .select(\n            \"query_number\",\n            *systems,\n            \" \",\n            *list(comparisons.keys()),\n        )\n        .to_polars()\n    )\n    .opt_stylize(\n        style=1,\n        color=style_color,\n    )\n    .tab_header(\n        title=md(\"1TB (`sf=1024`) TPC-H queries\"),\n        subtitle=md(\"*on a laptop* (MacBook Pro | Apple M2 Max | 96GiB RAM)\"),\n    )\n    .tab_spanner(label=\"execution time (seconds)\", columns=systems)\n    .tab_spanner(label=\"   \", columns=\" \")\n    .tab_spanner(label=\"relative speed difference†\", columns=list(comparisons))\n    .tab_source_note(\n        source_note=md(\n            \"†[Relative speed difference formula](https://docs.coiled.io/blog/tpch#measurements), with negative values indicating A was faster than B for A_v_B\"\n        )\n    )\n    .tab_source_note(\n        source_note=md(\n            \"Benchmark results source data (public bucket): `gs://ibis-bench/1tbc/cache/file_id=*.parquet`\"\n        )\n    )\n    .fmt_percent(list(comparisons), decimals=2, scale_values=True)\n    .data_color(\n        columns=systems,\n        domain=[0, agg2[\"avg_execution_seconds\"].max().to_pyarrow().as_py()],\n        palette=color_palette,\n        na_color=na_color,\n    )\n    .data_color(\n        columns=\" \",\n        palette=[\"#333333\", \"#333333\"],\n    )\n    .data_color(\n        columns=list(comparisons),\n        domain=[\n            min(\n                [piv2[c].min().to_pyarrow().as_py() for c in list(comparisons)],\n            ),\n            max(\n                [piv2[c].max().to_pyarrow().as_py() for c in list(comparisons)],\n            ),\n        ],\n        palette=color_palette,\n        na_color=na_color,\n    )\n)\ntbl\n```\n\n::: {.cell-output .cell-output-display execution_count=18}\n```{=html}\n<div id=\"sejpgylidw\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>\n#sejpgylidw table {\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n          -webkit-font-smoothing: antialiased;\n          -moz-osx-font-smoothing: grayscale;\n        }\n\n#sejpgylidw thead, tbody, tfoot, tr, td, th { border-style: none; }\n tr { background-color: transparent; }\n#sejpgylidw p { margin: 0; padding: 0; }\n #sejpgylidw .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #016763; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #016763; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }\n #sejpgylidw .gt_caption { padding-top: 4px; padding-bottom: 4px; }\n #sejpgylidw .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }\n #sejpgylidw .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }\n #sejpgylidw .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #sejpgylidw .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #01837B; }\n #sejpgylidw .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #01837B; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #01837B; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #sejpgylidw .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }\n #sejpgylidw .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }\n #sejpgylidw .gt_column_spanner_outer:first-child { padding-left: 0; }\n #sejpgylidw .gt_column_spanner_outer:last-child { padding-right: 0; }\n #sejpgylidw .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #01837B; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }\n #sejpgylidw .gt_spanner_row { border-bottom-style: hidden; }\n #sejpgylidw .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #01837B; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #01837B; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }\n #sejpgylidw .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #01837B; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #01837B; vertical-align: middle; }\n #sejpgylidw .gt_from_md> :first-child { margin-top: 0; }\n #sejpgylidw .gt_from_md> :last-child { margin-bottom: 0; }\n #sejpgylidw .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: none; border-top-width: 1px; border-top-color: #A5FEF2; border-left-style: none; border-left-width: 1px; border-left-color: #A5FEF2; border-right-style: none; border-right-width: 1px; border-right-color: #A5FEF2; vertical-align: middle; overflow-x: hidden; }\n #sejpgylidw .gt_stub { color: #FFFFFF; background-color: #01837B; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #01837B; padding-left: 5px; padding-right: 5px; }\n #sejpgylidw .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }\n #sejpgylidw .gt_row_group_first td { border-top-width: 2px; }\n #sejpgylidw .gt_row_group_first th { border-top-width: 2px; }\n #sejpgylidw .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #01837B; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #01837B; }\n #sejpgylidw .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }\n #sejpgylidw .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }\n #sejpgylidw .gt_left { text-align: left; }\n #sejpgylidw .gt_center { text-align: center; }\n #sejpgylidw .gt_right { text-align: right; font-variant-numeric: tabular-nums; }\n #sejpgylidw .gt_font_normal { font-weight: normal; }\n #sejpgylidw .gt_font_bold { font-weight: bold; }\n #sejpgylidw .gt_font_italic { font-style: italic; }\n #sejpgylidw .gt_super { font-size: 65%; }\n #sejpgylidw .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }\n #sejpgylidw .gt_asterisk { font-size: 100%; vertical-align: 0; }\n \n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n<thead class=\"gt_header\">\n  <tr>\n    <th colspan=\"8\" class=\"gt_heading gt_title gt_font_normal\">1TB (<code>sf=1024</code>) TPC-H queries</th>\n  </tr>\n  <tr>\n    <th colspan=\"8\" class=\"gt_heading gt_subtitle gt_font_normal gt_bottom_border\"><em>on a laptop</em> (MacBook Pro | Apple M2 Max | 96GiB RAM)</th>\n  </tr>\n</thead>\n<tr class=\"gt_col_headings gt_spanner_row\">\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"2\" colspan=\"1\" scope=\"col\" id=\"query_number\">query_number</th>\n  <th class=\"gt_center gt_columns_top_border gt_column_spanner_outer\" rowspan=\"1\" colspan=\"3\" scope=\"colgroup\" id=\"execution time (seconds)\">\n    <span class=\"gt_column_spanner\">execution time (seconds)</span>\n  </th>\n  <th class=\"gt_center gt_columns_top_border gt_column_spanner_outer\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"   \">\n    <span class=\"gt_column_spanner\">   </span>\n  </th>\n  <th class=\"gt_center gt_columns_top_border gt_column_spanner_outer\" rowspan=\"1\" colspan=\"3\" scope=\"colgroup\" id=\"relative speed difference†\">\n    <span class=\"gt_column_spanner\">relative speed difference†</span>\n  </th>\n</tr>\n<tr class=\"gt_col_headings\">\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"ibis-datafusion\">ibis-datafusion</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"ibis-duckdb\">ibis-duckdb</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"polars-lazy\">polars-lazy</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\" \"> </th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"ibis-datafusion_v_ibis-duckdb\">ibis-datafusion_v_ibis-duckdb</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"polars-lazy_v_ibis-datafusion\">polars-lazy_v_ibis-datafusion</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"polars-lazy_v_ibis-duckdb\">polars-lazy_v_ibis-duckdb</th>\n</tr>\n<tbody class=\"gt_table_body\">\n  <tr>\n    <td class=\"gt_row gt_right\">1</td>\n    <td style=\"color: #FFFFFF; background-color: #6002a4;\" class=\"gt_row gt_right\">87.67</td>\n    <td style=\"color: #FFFFFF; background-color: #5802a3;\" class=\"gt_row gt_right\">77.45</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #333333;\" class=\"gt_row gt_left\"></td>\n    <td style=\"color: #FFFFFF; background-color: #1a078d;\" class=\"gt_row gt_right\">13.20%</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">2</td>\n    <td style=\"color: #FFFFFF; background-color: #16078b;\" class=\"gt_row gt_right\">8.68</td>\n    <td style=\"color: #FFFFFF; background-color: #15078a;\" class=\"gt_row gt_right\">7.38</td>\n    <td style=\"color: #FFFFFF; background-color: #17078b;\" class=\"gt_row gt_right\">9.44</td>\n    <td style=\"color: #FFFFFF; background-color: #333333;\" class=\"gt_row gt_left\"></td>\n    <td style=\"color: #FFFFFF; background-color: #1c078e;\" class=\"gt_row gt_right\">17.62%</td>\n    <td style=\"color: #FFFFFF; background-color: #18078c;\" class=\"gt_row gt_right\">8.76%</td>\n    <td style=\"color: #FFFFFF; background-color: #21068f;\" class=\"gt_row gt_right\">27.91%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">3</td>\n    <td style=\"color: #FFFFFF; background-color: #41039d;\" class=\"gt_row gt_right\">50.43</td>\n    <td style=\"color: #FFFFFF; background-color: #3f049c;\" class=\"gt_row gt_right\">48.72</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #333333;\" class=\"gt_row gt_left\"></td>\n    <td style=\"color: #FFFFFF; background-color: #16078b;\" class=\"gt_row gt_right\">3.51%</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">4</td>\n    <td style=\"color: #FFFFFF; background-color: #310596;\" class=\"gt_row gt_right\">34.81</td>\n    <td style=\"color: #FFFFFF; background-color: #2f0595;\" class=\"gt_row gt_right\">33.29</td>\n    <td style=\"color: #FFFFFF; background-color: #5502a2;\" class=\"gt_row gt_right\">73.72</td>\n    <td style=\"color: #FFFFFF; background-color: #333333;\" class=\"gt_row gt_left\"></td>\n    <td style=\"color: #FFFFFF; background-color: #17078b;\" class=\"gt_row gt_right\">4.57%</td>\n    <td style=\"color: #FFFFFF; background-color: #47039f;\" class=\"gt_row gt_right\">111.78%</td>\n    <td style=\"color: #FFFFFF; background-color: #4a03a0;\" class=\"gt_row gt_right\">121.45%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">5</td>\n    <td style=\"color: #FFFFFF; background-color: #4b03a0;\" class=\"gt_row gt_right\">61.43</td>\n    <td style=\"color: #FFFFFF; background-color: #43039e;\" class=\"gt_row gt_right\">51.99</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #333333;\" class=\"gt_row gt_left\"></td>\n    <td style=\"color: #FFFFFF; background-color: #1d078e;\" class=\"gt_row gt_right\">18.16%</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">6</td>\n    <td style=\"color: #FFFFFF; background-color: #2f0595;\" class=\"gt_row gt_right\">33.05</td>\n    <td style=\"color: #FFFFFF; background-color: #300596;\" class=\"gt_row gt_right\">33.8</td>\n    <td style=\"color: #FFFFFF; background-color: #5902a3;\" class=\"gt_row gt_right\">79.69</td>\n    <td style=\"color: #FFFFFF; background-color: #333333;\" class=\"gt_row gt_left\"></td>\n    <td style=\"color: #FFFFFF; background-color: #13078a;\" class=\"gt_row gt_right\">−2.27%</td>\n    <td style=\"color: #FFFFFF; background-color: #5102a1;\" class=\"gt_row gt_right\">141.12%</td>\n    <td style=\"color: #FFFFFF; background-color: #4f03a1;\" class=\"gt_row gt_right\">135.77%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">7</td>\n    <td style=\"color: #FFFFFF; background-color: #6202a5;\" class=\"gt_row gt_right\">90.75</td>\n    <td style=\"color: #FFFFFF; background-color: #6c01a7;\" class=\"gt_row gt_right\">102.99</td>\n    <td style=\"color: #000000; background-color: #e3685f;\" class=\"gt_row gt_right\">305.02</td>\n    <td style=\"color: #FFFFFF; background-color: #333333;\" class=\"gt_row gt_left\"></td>\n    <td style=\"color: #FFFFFF; background-color: #0e0888;\" class=\"gt_row gt_right\">−13.49%</td>\n    <td style=\"color: #FFFFFF; background-color: #7301a8;\" class=\"gt_row gt_right\">236.11%</td>\n    <td style=\"color: #FFFFFF; background-color: #6502a5;\" class=\"gt_row gt_right\">196.16%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">8</td>\n    <td style=\"color: #FFFFFF; background-color: #5402a2;\" class=\"gt_row gt_right\">72.98</td>\n    <td style=\"color: #FFFFFF; background-color: #4b03a0;\" class=\"gt_row gt_right\">62.05</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #333333;\" class=\"gt_row gt_left\"></td>\n    <td style=\"color: #FFFFFF; background-color: #1c078e;\" class=\"gt_row gt_right\">17.61%</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">9</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #7603a7;\" class=\"gt_row gt_right\">116.41</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #333333;\" class=\"gt_row gt_left\"></td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">10</td>\n    <td style=\"color: #FFFFFF; background-color: #5602a2;\" class=\"gt_row gt_right\">75.63</td>\n    <td style=\"color: #FFFFFF; background-color: #48039f;\" class=\"gt_row gt_right\">58.34</td>\n    <td style=\"color: #000000; background-color: #d14e72;\" class=\"gt_row gt_right\">262.09</td>\n    <td style=\"color: #FFFFFF; background-color: #333333;\" class=\"gt_row gt_left\"></td>\n    <td style=\"color: #FFFFFF; background-color: #220690;\" class=\"gt_row gt_right\">29.64%</td>\n    <td style=\"color: #FFFFFF; background-color: #7603a7;\" class=\"gt_row gt_right\">246.54%</td>\n    <td style=\"color: #FFFFFF; background-color: #99159f;\" class=\"gt_row gt_right\">349.25%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">11</td>\n    <td style=\"color: #FFFFFF; background-color: #240691;\" class=\"gt_row gt_right\">22.25</td>\n    <td style=\"color: #FFFFFF; background-color: #18078b;\" class=\"gt_row gt_right\">10.22</td>\n    <td style=\"color: #FFFFFF; background-color: #270692;\" class=\"gt_row gt_right\">25.31</td>\n    <td style=\"color: #FFFFFF; background-color: #333333;\" class=\"gt_row gt_left\"></td>\n    <td style=\"color: #FFFFFF; background-color: #4903a0;\" class=\"gt_row gt_right\">117.71%</td>\n    <td style=\"color: #FFFFFF; background-color: #1b078d;\" class=\"gt_row gt_right\">13.75%</td>\n    <td style=\"color: #FFFFFF; background-color: #5402a2;\" class=\"gt_row gt_right\">147.65%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">12</td>\n    <td style=\"color: #FFFFFF; background-color: #45039e;\" class=\"gt_row gt_right\">54.09</td>\n    <td style=\"color: #FFFFFF; background-color: #3d049b;\" class=\"gt_row gt_right\">46.86</td>\n    <td style=\"color: #FFFFFF; background-color: #7e07a5;\" class=\"gt_row gt_right\">126.77</td>\n    <td style=\"color: #FFFFFF; background-color: #333333;\" class=\"gt_row gt_left\"></td>\n    <td style=\"color: #FFFFFF; background-color: #1b078d;\" class=\"gt_row gt_right\">15.43%</td>\n    <td style=\"color: #FFFFFF; background-color: #4f03a1;\" class=\"gt_row gt_right\">134.37%</td>\n    <td style=\"color: #FFFFFF; background-color: #5c02a3;\" class=\"gt_row gt_right\">170.53%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">13</td>\n    <td style=\"color: #FFFFFF; background-color: #4a03a0;\" class=\"gt_row gt_right\">60.72</td>\n    <td style=\"color: #FFFFFF; background-color: #3f049c;\" class=\"gt_row gt_right\">48.57</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #333333;\" class=\"gt_row gt_left\"></td>\n    <td style=\"color: #FFFFFF; background-color: #20068f;\" class=\"gt_row gt_right\">25.02%</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">14</td>\n    <td style=\"color: #FFFFFF; background-color: #360498;\" class=\"gt_row gt_right\">40.06</td>\n    <td style=\"color: #FFFFFF; background-color: #350498;\" class=\"gt_row gt_right\">38.79</td>\n    <td style=\"color: #FFFFFF; background-color: #6b01a6;\" class=\"gt_row gt_right\">101.46</td>\n    <td style=\"color: #FFFFFF; background-color: #333333;\" class=\"gt_row gt_left\"></td>\n    <td style=\"color: #FFFFFF; background-color: #16078b;\" class=\"gt_row gt_right\">3.27%</td>\n    <td style=\"color: #FFFFFF; background-color: #5602a2;\" class=\"gt_row gt_right\">153.27%</td>\n    <td style=\"color: #FFFFFF; background-color: #5902a3;\" class=\"gt_row gt_right\">161.56%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">15</td>\n    <td style=\"color: #FFFFFF; background-color: #5502a2;\" class=\"gt_row gt_right\">73.67</td>\n    <td style=\"color: #FFFFFF; background-color: #5102a1;\" class=\"gt_row gt_right\">69.39</td>\n    <td style=\"color: #FFFFFF; background-color: #4c03a0;\" class=\"gt_row gt_right\">63.32</td>\n    <td style=\"color: #FFFFFF; background-color: #333333;\" class=\"gt_row gt_left\"></td>\n    <td style=\"color: #FFFFFF; background-color: #17078b;\" class=\"gt_row gt_right\">6.17%</td>\n    <td style=\"color: #FFFFFF; background-color: #0d0887;\" class=\"gt_row gt_right\">−16.35%</td>\n    <td style=\"color: #FFFFFF; background-color: #100888;\" class=\"gt_row gt_right\">−9.59%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">16</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #17078b;\" class=\"gt_row gt_right\">9.48</td>\n    <td style=\"color: #FFFFFF; background-color: #18078c;\" class=\"gt_row gt_right\">10.93</td>\n    <td style=\"color: #FFFFFF; background-color: #333333;\" class=\"gt_row gt_left\"></td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #1b078d;\" class=\"gt_row gt_right\">15.30%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">17</td>\n    <td style=\"color: #000000; background-color: #cc4977;\" class=\"gt_row gt_right\">252.67</td>\n    <td style=\"color: #FFFFFF; background-color: #45039f;\" class=\"gt_row gt_right\">54.44</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #333333;\" class=\"gt_row gt_left\"></td>\n    <td style=\"color: #FFFFFF; background-color: #9d189d;\" class=\"gt_row gt_right\">364.13%</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">18</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #000000; background-color: #f2864b;\" class=\"gt_row gt_right\">350.98</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #333333;\" class=\"gt_row gt_left\"></td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">19</td>\n    <td style=\"color: #FFFFFF; background-color: #5902a3;\" class=\"gt_row gt_right\">79.78</td>\n    <td style=\"color: #FFFFFF; background-color: #4e03a1;\" class=\"gt_row gt_right\">64.85</td>\n    <td style=\"color: #000000; background-color: #fcbb2d;\" class=\"gt_row gt_right\">422.94</td>\n    <td style=\"color: #FFFFFF; background-color: #333333;\" class=\"gt_row gt_left\"></td>\n    <td style=\"color: #FFFFFF; background-color: #1f068f;\" class=\"gt_row gt_right\">23.02%</td>\n    <td style=\"color: #FFFFFF; background-color: #af2990;\" class=\"gt_row gt_right\">430.13%</td>\n    <td style=\"color: #000000; background-color: #cc4877;\" class=\"gt_row gt_right\">552.18%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">20</td>\n    <td style=\"color: #FFFFFF; background-color: #5c02a4;\" class=\"gt_row gt_right\">83.56</td>\n    <td style=\"color: #FFFFFF; background-color: #370499;\" class=\"gt_row gt_right\">41.18</td>\n    <td style=\"color: #000000; background-color: #f0f921;\" class=\"gt_row gt_right\">498.25</td>\n    <td style=\"color: #FFFFFF; background-color: #333333;\" class=\"gt_row gt_left\"></td>\n    <td style=\"color: #FFFFFF; background-color: #43039e;\" class=\"gt_row gt_right\">102.91%</td>\n    <td style=\"color: #FFFFFF; background-color: #c03a83;\" class=\"gt_row gt_right\">496.28%</td>\n    <td style=\"color: #000000; background-color: #f0f921;\" class=\"gt_row gt_right\">1,109.93%</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">21</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #7201a8;\" class=\"gt_row gt_right\">110.43</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #333333;\" class=\"gt_row gt_left\"></td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">22</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #18078c;\" class=\"gt_row gt_right\">10.81</td>\n    <td style=\"color: #FFFFFF; background-color: #1e078e;\" class=\"gt_row gt_right\">16.22</td>\n    <td style=\"color: #FFFFFF; background-color: #333333;\" class=\"gt_row gt_left\"></td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #000000;\" class=\"gt_row gt_right\">None</td>\n    <td style=\"color: #FFFFFF; background-color: #2b0594;\" class=\"gt_row gt_right\">50.05%</td>\n  </tr>\n</tbody>\n  <tfoot class=\"gt_sourcenotes\">\n  \n  <tr>\n    <td class=\"gt_sourcenote\" colspan=\"8\">†<a href=\"https://docs.coiled.io/blog/tpch#measurements\">Relative speed difference formula</a>, with negative values indicating A was faster than B for A_v_B</td>\n  </tr>\n\n\n  <tr>\n    <td class=\"gt_sourcenote\" colspan=\"8\">Benchmark results source data (public bucket): <code>gs://ibis-bench/1tbc/cache/file_id=*.parquet</code></td>\n  </tr>\n\n</tfoot>\n\n</table>\n\n</div>\n        \n```\n:::\n:::\n\n\nYou can use the code above to further explore and visualize the results.\n\n## Why does this matter?\n\nThe ability to run all 1TB TPC-H queries on a relatively standard laptop with\nminimal setup represents a significant shift in the Python data ecosystem that\nbenefits individual data practitioners and organizations.\n\n### Scale up, then scale out\n\nDistributed systems are hard and introduce complexity for data workloads. While\ndistributed OLAP query engines have their place, the threshold for considering\nthem against a single-node OLAP query engine has been raised drastically over\nthe last few years. You can [see how much DuckDB has improved over the\nyears](https://duckdb.org/2024/06/26/benchmarks-over-time) and it shows in this\nbenchmark.\n\nIt's a good idea to start with a single node and see how far you can get. You'll\nneed to consider the tradeoffs for your own situation to make a decision. With\nIbis, you can write your queries once and try them on different engines to see\nwhich is best for your workload.\n\n### Composable data systems are here\n\nIbis separates the query from the engine. It translates dataframe code into an\nintermediate representation (IR) in the backend's native language -- often SQL,\nsometimes other Python dataframe code. This separation allows you **to use a\nsingle dataframe API for the best engine(s) across your workload(s)**.\n\nIf you need to analyze data in\n[Postgres](https://ibis-project.org/backends/postgres), you can use Ibis. If you\nneed to [speed that up with\nDuckDB](https://duckdb.org/2022/09/30/postgres-scanner.html), you can [use\nIbis](https://ibis-project.org/backends/duckdb#ibis.backends.duckdb.Backend.read_postgres).\nIf you need to scale out with [Dask](https://ibis-project.org/backends/dask) or\n[PySpark](https://ibis-project.org/backends/pyspark) or\n[Trino](https://ibis-project.org/backends/trino), you can use Ibis. If you need\nto [scale out on distributed GPUs you can use\nIbis](../why-voda-supports-ibis/index.qmd). If another query engine comes along\nand is best for your workload, you can probably use Ibis. New backends are\nfairly easy to add!\n\n### It's efficient\n\nHow much money does your organization spend on data transformation per terabyte?\nUsing [the GCP pricing calculator](https://cloud.google.com/products/calculator)\nwe'll sample the monthly cost of some cloud instances including a few TBs of\nsolid-state hard drive space. Hover over to see the vCPUs and RAM for each\ninstance.\n\n::: {#30e1f6dc .cell execution_count=20}\n``` {.python .cell-code code-fold=\"true\" code-summary=\"Show code to plot monthly cost of various GCP instances\"}\ndata = {\n    \"m1-megamem-40\": {\"vCPUs\": 40, \"RAM\": 961, \"cost\": 6200},\n    \"m1-ultramem-80\": {\"vCPUs\": 80, \"RAM\": 1922, \"cost\": 10900},\n    \"m1-ultramem-160\": {\"vCPUs\": 160, \"RAM\": 3844, \"cost\": 20100},\n    \"h3-standard-88\": {\"vCPUs\": 88, \"RAM\": 352, \"cost\": 4600},\n    \"c2-standard-30\": {\"vCPUs\": 30, \"RAM\": 120, \"cost\": 1600},\n    \"c2-standard-60\": {\"vCPUs\": 60, \"RAM\": 240, \"cost\": 2700},\n}\n\nt = ibis.memtable(\n    {\n        \"name\": list(data.keys()),\n        \"vCPUs\": [v[\"vCPUs\"] for v in data.values()],\n        \"RAM (GBs)\": [v[\"RAM\"] for v in data.values()],\n        \"cost\": [v[\"cost\"] for v in data.values()],\n    }\n).order_by(\"cost\")\n\nc = px.bar(\n    t,\n    x=\"name\",\n    y=\"cost\",\n    title=\"Monthly cost (USD) of various GCP instances\",\n    hover_data=[\"vCPUs\", \"RAM (GBs)\"],\n)\nc\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<div>                            <div id=\"694f35d7-fde4-4d61-9c66-230debf93bad\" class=\"plotly-graph-div\" style=\"height:525px; width:100%;\"></div>            <script type=\"text/javascript\">                require([\"plotly\"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById(\"694f35d7-fde4-4d61-9c66-230debf93bad\")) {                    Plotly.newPlot(                        \"694f35d7-fde4-4d61-9c66-230debf93bad\",                        [{\"alignmentgroup\":\"True\",\"customdata\":[[30,120],[60,240],[88,352],[40,961],[80,1922],[160,3844]],\"hovertemplate\":\"name=%{x}\\u003cbr\\u003ecost=%{y}\\u003cbr\\u003evCPUs=%{customdata[0]}\\u003cbr\\u003eRAM (GBs)=%{customdata[1]}\\u003cextra\\u003e\\u003c\\u002fextra\\u003e\",\"legendgroup\":\"\",\"marker\":{\"color\":\"#636efa\",\"pattern\":{\"shape\":\"\"}},\"name\":\"\",\"offsetgroup\":\"\",\"orientation\":\"v\",\"showlegend\":false,\"textposition\":\"auto\",\"x\":[\"c2-standard-30\",\"c2-standard-60\",\"h3-standard-88\",\"m1-megamem-40\",\"m1-ultramem-80\",\"m1-ultramem-160\"],\"xaxis\":\"x\",\"y\":[1600,2700,4600,6200,10900,20100],\"yaxis\":\"y\",\"type\":\"bar\"}],                        {\"template\":{\"data\":{\"barpolar\":[{\"marker\":{\"line\":{\"color\":\"rgb(17,17,17)\",\"width\":0.5},\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"barpolar\"}],\"bar\":[{\"error_x\":{\"color\":\"#f2f5fa\"},\"error_y\":{\"color\":\"#f2f5fa\"},\"marker\":{\"line\":{\"color\":\"rgb(17,17,17)\",\"width\":0.5},\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"bar\"}],\"carpet\":[{\"aaxis\":{\"endlinecolor\":\"#A2B1C6\",\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"minorgridcolor\":\"#506784\",\"startlinecolor\":\"#A2B1C6\"},\"baxis\":{\"endlinecolor\":\"#A2B1C6\",\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"minorgridcolor\":\"#506784\",\"startlinecolor\":\"#A2B1C6\"},\"type\":\"carpet\"}],\"choropleth\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"type\":\"choropleth\"}],\"contourcarpet\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"type\":\"contourcarpet\"}],\"contour\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"contour\"}],\"heatmapgl\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"heatmapgl\"}],\"heatmap\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"heatmap\"}],\"histogram2dcontour\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"histogram2dcontour\"}],\"histogram2d\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"histogram2d\"}],\"histogram\":[{\"marker\":{\"pattern\":{\"fillmode\":\"overlay\",\"size\":10,\"solidity\":0.2}},\"type\":\"histogram\"}],\"mesh3d\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"type\":\"mesh3d\"}],\"parcoords\":[{\"line\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"parcoords\"}],\"pie\":[{\"automargin\":true,\"type\":\"pie\"}],\"scatter3d\":[{\"line\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scatter3d\"}],\"scattercarpet\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scattercarpet\"}],\"scattergeo\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scattergeo\"}],\"scattergl\":[{\"marker\":{\"line\":{\"color\":\"#283442\"}},\"type\":\"scattergl\"}],\"scattermapbox\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scattermapbox\"}],\"scatterpolargl\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scatterpolargl\"}],\"scatterpolar\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scatterpolar\"}],\"scatter\":[{\"marker\":{\"line\":{\"color\":\"#283442\"}},\"type\":\"scatter\"}],\"scatterternary\":[{\"marker\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"type\":\"scatterternary\"}],\"surface\":[{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"},\"colorscale\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"type\":\"surface\"}],\"table\":[{\"cells\":{\"fill\":{\"color\":\"#506784\"},\"line\":{\"color\":\"rgb(17,17,17)\"}},\"header\":{\"fill\":{\"color\":\"#2a3f5f\"},\"line\":{\"color\":\"rgb(17,17,17)\"}},\"type\":\"table\"}]},\"layout\":{\"annotationdefaults\":{\"arrowcolor\":\"#f2f5fa\",\"arrowhead\":0,\"arrowwidth\":1},\"autotypenumbers\":\"strict\",\"coloraxis\":{\"colorbar\":{\"outlinewidth\":0,\"ticks\":\"\"}},\"colorscale\":{\"diverging\":[[0,\"#8e0152\"],[0.1,\"#c51b7d\"],[0.2,\"#de77ae\"],[0.3,\"#f1b6da\"],[0.4,\"#fde0ef\"],[0.5,\"#f7f7f7\"],[0.6,\"#e6f5d0\"],[0.7,\"#b8e186\"],[0.8,\"#7fbc41\"],[0.9,\"#4d9221\"],[1,\"#276419\"]],\"sequential\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]],\"sequentialminus\":[[0.0,\"#0d0887\"],[0.1111111111111111,\"#46039f\"],[0.2222222222222222,\"#7201a8\"],[0.3333333333333333,\"#9c179e\"],[0.4444444444444444,\"#bd3786\"],[0.5555555555555556,\"#d8576b\"],[0.6666666666666666,\"#ed7953\"],[0.7777777777777778,\"#fb9f3a\"],[0.8888888888888888,\"#fdca26\"],[1.0,\"#f0f921\"]]},\"colorway\":[\"#636efa\",\"#EF553B\",\"#00cc96\",\"#ab63fa\",\"#FFA15A\",\"#19d3f3\",\"#FF6692\",\"#B6E880\",\"#FF97FF\",\"#FECB52\"],\"font\":{\"color\":\"#f2f5fa\"},\"geo\":{\"bgcolor\":\"rgb(17,17,17)\",\"lakecolor\":\"rgb(17,17,17)\",\"landcolor\":\"rgb(17,17,17)\",\"showlakes\":true,\"showland\":true,\"subunitcolor\":\"#506784\"},\"hoverlabel\":{\"align\":\"left\"},\"hovermode\":\"closest\",\"mapbox\":{\"style\":\"dark\"},\"margin\":{\"b\":0,\"l\":0,\"r\":0,\"t\":30},\"paper_bgcolor\":\"rgb(17,17,17)\",\"plot_bgcolor\":\"rgb(17,17,17)\",\"polar\":{\"angularaxis\":{\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"ticks\":\"\"},\"bgcolor\":\"rgb(17,17,17)\",\"radialaxis\":{\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"ticks\":\"\"}},\"scene\":{\"xaxis\":{\"backgroundcolor\":\"rgb(17,17,17)\",\"gridcolor\":\"#506784\",\"gridwidth\":2,\"linecolor\":\"#506784\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"#C8D4E3\"},\"yaxis\":{\"backgroundcolor\":\"rgb(17,17,17)\",\"gridcolor\":\"#506784\",\"gridwidth\":2,\"linecolor\":\"#506784\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"#C8D4E3\"},\"zaxis\":{\"backgroundcolor\":\"rgb(17,17,17)\",\"gridcolor\":\"#506784\",\"gridwidth\":2,\"linecolor\":\"#506784\",\"showbackground\":true,\"ticks\":\"\",\"zerolinecolor\":\"#C8D4E3\"}},\"shapedefaults\":{\"line\":{\"color\":\"#f2f5fa\"}},\"sliderdefaults\":{\"bgcolor\":\"#C8D4E3\",\"bordercolor\":\"rgb(17,17,17)\",\"borderwidth\":1,\"tickwidth\":0},\"ternary\":{\"aaxis\":{\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"ticks\":\"\"},\"baxis\":{\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"ticks\":\"\"},\"bgcolor\":\"rgb(17,17,17)\",\"caxis\":{\"gridcolor\":\"#506784\",\"linecolor\":\"#506784\",\"ticks\":\"\"}},\"title\":{\"x\":0.05},\"updatemenudefaults\":{\"bgcolor\":\"#506784\",\"borderwidth\":0},\"xaxis\":{\"automargin\":true,\"gridcolor\":\"#283442\",\"linecolor\":\"#506784\",\"ticks\":\"\",\"title\":{\"standoff\":15},\"zerolinecolor\":\"#283442\",\"zerolinewidth\":2},\"yaxis\":{\"automargin\":true,\"gridcolor\":\"#283442\",\"linecolor\":\"#506784\",\"ticks\":\"\",\"title\":{\"standoff\":15},\"zerolinecolor\":\"#283442\",\"zerolinewidth\":2}}},\"xaxis\":{\"anchor\":\"y\",\"domain\":[0.0,1.0],\"title\":{\"text\":\"name\"}},\"yaxis\":{\"anchor\":\"x\",\"domain\":[0.0,1.0],\"title\":{\"text\":\"cost\"}},\"legend\":{\"tracegroupgap\":0},\"title\":{\"text\":\"Monthly cost (USD) of various GCP instances\"},\"barmode\":\"relative\"},                        {\"responsive\": true}                    ).then(function(){\n                            \nvar gd = document.getElementById('694f35d7-fde4-4d61-9c66-230debf93bad');\nvar x = new MutationObserver(function (mutations, observer) {{\n        var display = window.getComputedStyle(gd).display;\n        if (!display || display === 'none') {{\n            console.log([gd, 'removed!']);\n            Plotly.purge(gd);\n            observer.disconnect();\n        }}\n}});\n\n// Listen for the removal of the full notebook cells\nvar notebookContainer = gd.closest('#notebook-container');\nif (notebookContainer) {{\n    x.observe(notebookContainer, {childList: true});\n}}\n\n// Listen for the clearing of the current output cell\nvar outputEl = gd.closest('.output');\nif (outputEl) {{\n    x.observe(outputEl, {childList: true});\n}}\n\n                        })                };                });            </script>        </div>\n```\n:::\n:::\n\n\nFor ~$1,600/month we can get a machine with more CPU cores and RAM than the\nlaptop benchmarked in this post. This cost assumes you're running the machine\n24/7 -- if you only needed to run a workload similar to the benchmark here,\nyou'd only need to run the machine <1 hour per day using Ibis with the default\nDuckDB backend. This can serve as a good anchor when evaluating your cost of\ncompute for data.\n\nA composable data system with Python dataframe and SQL user experiences can\nscale vertically to handle workloads into 10TB+ range with modern single-node\nOLAP query engines. If you need a distributed query engine or a better\nsingle-node query engine for your workload materializes, you can swap them out\nwithout changing your queries. However, note that with vertical scaling you're\nlikely to hit storage or network bottlenecks before compute bottlenecks on real\nworkloads.\n\n## Next steps\n\nWe'll follow up on this post once new versions that fix issues or improve\nperformance significantly are released. If you're interested in getting started\nwith Ibis, see [our tutorial](/tutorials/getting_started.qmd).\n\n",
    "supporting": [
      "index_files/figure-html"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n<script type=\"text/javascript\">\nwindow.PlotlyConfig = {MathJaxConfig: 'local'};\nif (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: \"STIX-Web\"}});}\nif (typeof require !== 'undefined') {\nrequire.undef(\"plotly\");\nrequirejs.config({\n    paths: {\n        'plotly': ['https://cdn.plot.ly/plotly-2.32.0.min']\n    }\n});\nrequire(['plotly'], function(Plotly) {\n    window._Plotly = Plotly;\n});\n}\n</script>\n\n"
      ]
    }
  }
}