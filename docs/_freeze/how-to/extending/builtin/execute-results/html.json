{
  "hash": "00ca1d2fd32eb50acb2ec2e7c7a57931",
  "result": {
    "markdown": "---\nfreeze: auto\ntitle: Reference built-in functions\n---\n\n\n\n\n\nFunctions that aren't exposed in ibis directly can be accessed using the\n`@ibis.udf.scalar.builtin` decorator.\n\n::: {.callout-tip}\n## [Ibis APIs](../../reference/index.qmd) may already exist for your function.\n\nBuiltin scalar UDFs are designed to be an escape hatch when Ibis doesn't have\na defined API for a built-in database function.\n\nSee [the reference documentation](../../reference/index.qmd) for existing APIs.\n:::\n\n## DuckDB\n\nIbis doesn't directly expose many of the DuckDB [text similarity\nfunctions](https://duckdb.org/docs/sql/functions/char.html#text-similarity-functions).\nLet's expose the `mismatches` API.\n\n\n::: {#e0a2087b .cell execution_count=1}\n``` {.python .cell-code}\nfrom ibis import udf\n\n@udf.scalar.builtin\ndef mismatches(left: str, right: str) -> int:\n    ...\n```\n:::\n\n\nThe [`...`](https://docs.python.org/3/library/constants.html#Ellipsis) is\na visual indicator that the function definition is unknown to Ibis.\n\n::: {.callout-note collapse=\"true\"}\n## Ibis does not do anything with the function body.\n\nIbis will not inspect the function body or otherwise inspect it. Any code you\nwrite in the function body **will be ignored**.\n:::\n\nWe can now call this function on any ibis expression:\n\n::: {#7c520722 .cell execution_count=2}\n``` {.python .cell-code}\nimport ibis\n\ncon = ibis.duckdb.connect()  # <1>\n```\n:::\n\n\n1. Connect to an in-memory DuckDB database\n\n::: {#ac393010 .cell execution_count=3}\n``` {.python .cell-code}\nexpr = mismatches(\"duck\", \"luck\")\ncon.execute(expr)\n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```\n1\n```\n:::\n:::\n\n\nLike any other ibis expression you can inspect the SQL:\n\n::: {#bb4d8344 .cell execution_count=4}\n``` {.python .cell-code}\nimport ibis\n\nibis.to_sql(expr, dialect=\"duckdb\")  # <1>\n```\n\n::: {.cell-output .cell-output-display execution_count=4}\n```sql\nSELECT\n  MISMATCHES('duck', 'luck') AS \"mismatches('duck', 'luck')\"\n```\n:::\n:::\n\n\n1. The `dialect` keyword argument must be passed, because we constructed\n   a literal expression which has no backend attached.\n\nBecause built-in UDFs are ultimately Ibis expressions, they compose with the\nrest of the library:\n\n::: {#1b20bc7e .cell execution_count=5}\n``` {.python .cell-code}\nibis.options.interactive = True\n\n@udf.scalar.builtin\ndef jaro_winkler_similarity(a: str, b: str) -> float:\n   ...\n\npkgs = ibis.read_parquet(\n   \"https://storage.googleapis.com/ibis-tutorial-data/pypi/packages.parquet\"\n)\npandas_ish = pkgs[jaro_winkler_similarity(pkgs.name, \"pandas\") >= 0.9]\npandas_ish\n```\n\n::: {.cell-output .cell-output-display execution_count=5}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> name     </span>┃<span style=\"font-weight: bold\"> version           </span>┃<span style=\"font-weight: bold\"> requires_python </span>┃<span style=\"font-weight: bold\"> yanked  </span>┃<span style=\"font-weight: bold\"> has_binary_wheel </span>┃<span style=\"font-weight: bold\"> has_vulnerabilities </span>┃<span style=\"font-weight: bold\"> first_uploaded_at   </span>┃<span style=\"font-weight: bold\"> last_uploaded_at    </span>┃<span style=\"font-weight: bold\"> recorded_at         </span>┃<span style=\"font-weight: bold\"> downloads </span>┃<span style=\"font-weight: bold\"> scorecard_overall </span>┃<span style=\"font-weight: bold\"> in_google_assured_oss </span>┃\n┡━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>   │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>            │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">boolean</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">boolean</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">boolean</span>             │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">timestamp</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">timestamp</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">timestamp</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int32</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">boolean</span>               │\n├──────────┼───────────────────┼─────────────────┼─────────┼──────────────────┼─────────────────────┼─────────────────────┼─────────────────────┼─────────────────────┼───────────┼───────────────────┼───────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">bcpandas</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">2.4.1            </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">&gt;=3.8.1        </span> │ True    │ False            │ False               │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-07-12 06:14:22</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-07-12 06:14:23</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-07-12 14:31:41</span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">nan</span> │ False                 │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">espandas</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">1.0.4            </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">~</span>               │ False   │ False            │ False               │ <span style=\"color: #800080; text-decoration-color: #800080\">2018-12-22 20:52:30</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2018-12-22 20:52:30</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-07-12 14:58:47</span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3.6</span> │ False                 │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">fpandas </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">0.5              </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">~</span>               │ False   │ False            │ False               │ <span style=\"color: #800080; text-decoration-color: #800080\">2020-03-09 02:35:31</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2020-03-09 02:35:31</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-07-12 15:04:23</span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">nan</span> │ False                 │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">h3pandas</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">0.2.4            </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">&gt;=3.6          </span> │ False   │ False            │ False               │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-03-19 17:58:16</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-03-19 17:58:16</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-07-12 15:10:06</span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">nan</span> │ False                 │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">ipandas </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">0.0.1            </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">~</span>               │ False   │ False            │ False               │ <span style=\"color: #800080; text-decoration-color: #800080\">2019-05-29 18:46:12</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2019-05-29 18:46:12</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-07-12 15:15:34</span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3.6</span> │ False                 │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">kpandas </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">0.0.1            </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">&gt;=3.6,&lt;4.0     </span> │ False   │ False            │ False               │ <span style=\"color: #800080; text-decoration-color: #800080\">2019-05-02 18:00:29</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2019-05-02 18:00:31</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-07-12 15:20:21</span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">nan</span> │ False                 │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">mpandas </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">0.0.2.1          </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">~</span>               │ False   │ False            │ False               │ <span style=\"color: #800080; text-decoration-color: #800080\">2022-07-03 16:21:21</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2022-07-03 16:21:23</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-07-12 15:30:35</span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">nan</span> │ False                 │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">mtpandas</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">1.14.202306141807</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">&gt;=3.6          </span> │ False   │ False            │ False               │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-06-14 18:08:01</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-06-14 18:08:01</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-07-12 15:31:04</span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4.6</span> │ False                 │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">mypandas</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">0.1.6            </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">&gt;=3.10         </span> │ False   │ False            │ False               │ <span style=\"color: #800080; text-decoration-color: #800080\">2022-10-24 21:01:10</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2022-10-24 21:01:12</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-07-12 15:32:04</span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">nan</span> │ False                 │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">paandas </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">0.0.3            </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">~</span>               │ False   │ False            │ False               │ <span style=\"color: #800080; text-decoration-color: #800080\">2022-11-24 06:11:15</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2022-11-24 06:11:17</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-07-12 15:43:31</span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">nan</span> │ False                 │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>        │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                 │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                   │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                   │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                   │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                   │         <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │                 <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                     │\n└──────────┴───────────────────┴─────────────────┴─────────┴──────────────────┴─────────────────────┴─────────────────────┴─────────────────────┴─────────────────────┴───────────┴───────────────────┴───────────────────────┘\n</pre>\n```\n:::\n:::\n\n\nLet's count the results:\n\n::: {#71158865 .cell execution_count=6}\n``` {.python .cell-code}\npandas_ish.count()\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"></pre>\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=6}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-cyan-fg ansi-bold\">178</span></pre>\n```\n:::\n\n:::\n:::\n\n\nThere are a good number of packages that look similar to `pandas`!\n\n## Snowflake\n\nSimilarly we can expose Snowflake's\n[`jarowinkler_similarity`](https://docs.snowflake.com/en/sql-reference/functions/jarowinkler_similarity)\nfunction.\n\nLet's alias it to `jw_sim` to illustrate some more of the Ibis `udf` API:\n\n::: {#cec67864 .cell execution_count=7}\n``` {.python .cell-code}\n@udf.scalar.builtin(name=\"jarowinkler_similarity\")  # <1>\ndef jw_sim(left: str, right: str) -> float:\n    ...\n```\n:::\n\n\n1. `target` is the name of the function in the backend. This argument is\n   required in this because the function name is different than the name of the\n   function in ibis.\n\n\nNow let's connect to Snowflake and call our `jw_sim` function:\n\n::: {#48696c70 .cell execution_count=8}\n``` {.python .cell-code}\nimport os\n\ncon = ibis.connect(os.environ[\"SNOWFLAKE_URL\"])\n```\n:::\n\n\n::: {#b8951169 .cell execution_count=9}\n``` {.python .cell-code}\nexpr = jw_sim(\"snow\", \"shoe\")\ncon.execute(expr)\n```\n\n::: {.cell-output .cell-output-display execution_count=9}\n```\n66.0\n```\n:::\n:::\n\n\nAnd let's take a look at the SQL\n\n::: {#1073bf2e .cell execution_count=10}\n``` {.python .cell-code}\nibis.to_sql(expr, dialect=\"snowflake\")\n```\n\n::: {.cell-output .cell-output-display execution_count=10}\n```sql\nSELECT\n  JAROWINKLER_SIMILARITY('snow', 'shoe') AS \"jarowinkler_similarity('snow', 'shoe')\"\n```\n:::\n:::\n\n\n",
    "supporting": [
      "builtin_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}