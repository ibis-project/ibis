{
  "hash": "8e4998b46079b45335d9d6385d97243c",
  "result": {
    "markdown": "---\nfreeze: auto\ntitle: Reference built-in functions\n---\n\n\n\n\n\n\n## Scalar functions\n\nFunctions that aren't exposed in ibis directly can be accessed using the\n`@ibis.udf.scalar.builtin` decorator.\n\n::: {.callout-tip}\n### [Ibis APIs](../../reference/index.qmd) may already exist for your function.\n\nBuiltin scalar UDFs are designed to be an escape hatch when Ibis doesn't have\na defined API for a built-in database function.\n\nSee [the reference documentation](../../reference/index.qmd) for existing APIs.\n:::\n\n### DuckDB\n\nIbis doesn't directly expose many of the DuckDB [text similarity\nfunctions](https://duckdb.org/docs/sql/functions/char.html#text-similarity-functions).\nLet's expose the `mismatches` API.\n\n\n::: {#5ba1c78c .cell execution_count=1}\n``` {.python .cell-code}\nfrom ibis import udf\n\n@udf.scalar.builtin\ndef mismatches(left: str, right: str) -> int:\n    ...\n```\n:::\n\n\nThe [`...`](https://docs.python.org/3/library/constants.html#Ellipsis) is\na visual indicator that the function definition is unknown to Ibis.\n\n::: {.callout-note collapse=\"true\"}\n### Ibis does not do anything with the function body.\n\nIbis will not execute the function body or otherwise inspect it. Any code you\nwrite in the function body **will be ignored**.\n:::\n\nWe can now call this function on any ibis expression:\n\n::: {#61fd038a .cell execution_count=2}\n``` {.python .cell-code}\nimport ibis\n\ncon = ibis.duckdb.connect()  # <1>\n```\n:::\n\n\n1. Connect to an in-memory DuckDB database\n\n::: {#1648465b .cell execution_count=3}\n``` {.python .cell-code}\nexpr = mismatches(\"duck\", \"luck\")\ncon.execute(expr)\n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```\n1\n```\n:::\n:::\n\n\nLike any other ibis expression you can inspect the SQL:\n\n::: {#5a8e63ba .cell execution_count=4}\n``` {.python .cell-code}\nimport ibis\n\nibis.to_sql(expr, dialect=\"duckdb\")  # <1>\n```\n\n::: {.cell-output .cell-output-display execution_count=4}\n```sql\nSELECT\n  MISMATCHES('duck', 'luck') AS \"mismatches('duck', 'luck')\"\n```\n:::\n:::\n\n\n1. The `dialect` keyword argument must be passed, because we constructed\n   a literal expression which has no backend attached.\n\nBecause built-in UDFs are ultimately Ibis expressions, they compose with the\nrest of the library:\n\n::: {#b7fa5ac2 .cell execution_count=5}\n``` {.python .cell-code}\nibis.options.interactive = True\n\n@udf.scalar.builtin\ndef jaro_winkler_similarity(a: str, b: str) -> float:\n   ...\n\npkgs = ibis.read_parquet(\n   \"https://storage.googleapis.com/ibis-tutorial-data/pypi/packages.parquet\"\n)\npandas_ish = pkgs[jaro_winkler_similarity(pkgs.name, \"pandas\") >= 0.9]\npandas_ish\n```\n\n::: {.cell-output .cell-output-display execution_count=5}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> name     </span>┃<span style=\"font-weight: bold\"> version           </span>┃<span style=\"font-weight: bold\"> requires_python </span>┃<span style=\"font-weight: bold\"> yanked  </span>┃<span style=\"font-weight: bold\"> has_binary_wheel </span>┃<span style=\"font-weight: bold\"> has_vulnerabilities </span>┃<span style=\"font-weight: bold\"> first_uploaded_at   </span>┃<span style=\"font-weight: bold\"> last_uploaded_at    </span>┃<span style=\"font-weight: bold\"> recorded_at         </span>┃<span style=\"font-weight: bold\"> downloads </span>┃<span style=\"font-weight: bold\"> scorecard_overall </span>┃<span style=\"font-weight: bold\"> in_google_assured_oss </span>┃\n┡━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>   │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>            │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">boolean</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">boolean</span>          │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">boolean</span>             │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">timestamp</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">timestamp</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">timestamp</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int32</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">boolean</span>               │\n├──────────┼───────────────────┼─────────────────┼─────────┼──────────────────┼─────────────────────┼─────────────────────┼─────────────────────┼─────────────────────┼───────────┼───────────────────┼───────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">bcpandas</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">2.4.1            </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">&gt;=3.8.1        </span> │ True    │ False            │ False               │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-07-12 06:14:22</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-07-12 06:14:23</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-07-12 14:31:41</span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">nan</span> │ False                 │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">espandas</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">1.0.4            </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">~</span>               │ False   │ False            │ False               │ <span style=\"color: #800080; text-decoration-color: #800080\">2018-12-22 20:52:30</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2018-12-22 20:52:30</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-07-12 14:58:47</span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3.6</span> │ False                 │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">fpandas </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">0.5              </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">~</span>               │ False   │ False            │ False               │ <span style=\"color: #800080; text-decoration-color: #800080\">2020-03-09 02:35:31</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2020-03-09 02:35:31</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-07-12 15:04:23</span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">nan</span> │ False                 │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">h3pandas</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">0.2.4            </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">&gt;=3.6          </span> │ False   │ False            │ False               │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-03-19 17:58:16</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-03-19 17:58:16</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-07-12 15:10:06</span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">nan</span> │ False                 │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">ipandas </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">0.0.1            </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">~</span>               │ False   │ False            │ False               │ <span style=\"color: #800080; text-decoration-color: #800080\">2019-05-29 18:46:12</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2019-05-29 18:46:12</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-07-12 15:15:34</span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3.6</span> │ False                 │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">kpandas </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">0.0.1            </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">&gt;=3.6,&lt;4.0     </span> │ False   │ False            │ False               │ <span style=\"color: #800080; text-decoration-color: #800080\">2019-05-02 18:00:29</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2019-05-02 18:00:31</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-07-12 15:20:21</span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">nan</span> │ False                 │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">mpandas </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">0.0.2.1          </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">~</span>               │ False   │ False            │ False               │ <span style=\"color: #800080; text-decoration-color: #800080\">2022-07-03 16:21:21</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2022-07-03 16:21:23</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-07-12 15:30:35</span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">nan</span> │ False                 │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">mtpandas</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">1.14.202306141807</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">&gt;=3.6          </span> │ False   │ False            │ False               │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-06-14 18:08:01</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-06-14 18:08:01</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-07-12 15:31:04</span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4.6</span> │ False                 │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">mypandas</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">0.1.6            </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">&gt;=3.10         </span> │ False   │ False            │ False               │ <span style=\"color: #800080; text-decoration-color: #800080\">2022-10-24 21:01:10</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2022-10-24 21:01:12</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-07-12 15:32:04</span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">nan</span> │ False                 │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">paandas </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">0.0.3            </span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">~</span>               │ False   │ False            │ False               │ <span style=\"color: #800080; text-decoration-color: #800080\">2022-11-24 06:11:15</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2022-11-24 06:11:17</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2023-07-12 15:43:31</span> │         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │               <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">nan</span> │ False                 │\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>        │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                 │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>               │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                   │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                   │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                   │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                   │         <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │                 <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">…</span>                     │\n└──────────┴───────────────────┴─────────────────┴─────────┴──────────────────┴─────────────────────┴─────────────────────┴─────────────────────┴─────────────────────┴───────────┴───────────────────┴───────────────────────┘\n</pre>\n```\n:::\n:::\n\n\nLet's count the results:\n\n::: {#3d8a0b17 .cell execution_count=6}\n``` {.python .cell-code}\npandas_ish.count()\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"></pre>\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=6}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-cyan-fg ansi-bold\">178</span></pre>\n```\n:::\n\n:::\n:::\n\n\nThere are a good number of packages that look similar to `pandas`!\n\n### Snowflake\n\nSimilarly we can expose Snowflake's\n[`jarowinkler_similarity`](https://docs.snowflake.com/en/sql-reference/functions/jarowinkler_similarity)\nfunction.\n\nLet's alias it to `jw_sim` to illustrate some more of the Ibis `udf` API:\n\n::: {#6628765c .cell execution_count=7}\n``` {.python .cell-code}\n@udf.scalar.builtin(name=\"jarowinkler_similarity\")  # <1>\ndef jw_sim(left: str, right: str) -> float:\n    ...\n```\n:::\n\n\n1. `target` is the name of the function in the backend. This argument is\n   required in this because the function name is different than the name of the\n   function in ibis.\n\n\nNow let's connect to Snowflake and call our `jw_sim` function:\n\n::: {#32fda4ee .cell execution_count=8}\n``` {.python .cell-code}\nimport os\n\ncon = ibis.connect(os.environ[\"SNOWFLAKE_URL\"])\n```\n:::\n\n\n::: {#265d6145 .cell execution_count=9}\n``` {.python .cell-code}\nexpr = jw_sim(\"snow\", \"shoe\")\ncon.execute(expr)\n```\n\n::: {.cell-output .cell-output-display execution_count=9}\n```\n66.0\n```\n:::\n:::\n\n\nAnd let's take a look at the SQL\n\n::: {#301ff3f1 .cell execution_count=10}\n``` {.python .cell-code}\nibis.to_sql(expr, dialect=\"snowflake\")\n```\n\n::: {.cell-output .cell-output-display execution_count=10}\n```sql\nSELECT\n  JAROWINKLER_SIMILARITY('snow', 'shoe') AS \"jw_sim('snow', 'shoe')\"\n```\n:::\n:::\n\n\n### Input types\n\nSometimes the input types of builtin functions are difficult to spell.\n\nConsider a function that computes the length of any array: the elements in the\narray can be floats, integers, strings and even other arrays. Spelling that\ntype is difficult.\n\nFortunately the `udf.scalar.builtin` decorator doesn't require you to specify\ninput types in these cases:\n\n::: {#e66eeb5f .cell execution_count=11}\n``` {.python .cell-code}\n@udf.scalar.builtin(name=\"array_size\")\ndef cardinality(arr) -> int:\n   ...\n```\n:::\n\n\n::: {.callout-caution}\n## The return type annotation **is always required**.\n:::\n\nWe can pass arrays with different element types to our `cardinality` function:\n\n::: {#e356c5c3 .cell execution_count=12}\n``` {.python .cell-code}\ncon.execute(cardinality([1, 2, 3]))\n```\n\n::: {.cell-output .cell-output-display execution_count=12}\n```\n3\n```\n:::\n:::\n\n\n::: {#726cb281 .cell execution_count=13}\n``` {.python .cell-code}\ncon.execute(cardinality([\"a\", \"b\"]))\n```\n\n::: {.cell-output .cell-output-display execution_count=13}\n```\n2\n```\n:::\n:::\n\n\nWhen you bypass input types the errors you get back are backend dependent:\n\n::: {#31485da0 .cell execution_count=14}\n``` {.python .cell-code}\ncon.execute(cardinality(\"foo\"))\n```\n\n::: {.cell-output .cell-output-error}\n```\nProgrammingError: (snowflake.connector.errors.ProgrammingError) 001044 (42P13): SQL compilation error: error line 1 at position 7\nInvalid argument types for function 'ARRAY_SIZE': (VARCHAR(3))\n[SQL: SELECT array_size(%(param_1)s) AS \"cardinality('foo')\"]\n[parameters: {'param_1': 'foo'}]\n(Background on this error at: https://sqlalche.me/e/14/f405)\n```\n:::\n:::\n\n\nHere, Snowflake is informing us that the `ARRAY_SIZE` function does not accept\nstrings as input.\n\n\n## Aggregate functions\n\nAggregate functions that aren't exposed in ibis directly can be accessed using\nthe `@ibis.udf.agg.builtin` decorator.\n\n::: {.callout-tip}\n### [Ibis APIs](../../reference/index.qmd) may already exist for your function.\n\nBuiltin aggregate UDFs are designed to be an escape hatch when Ibis doesn't have\na defined API for a built-in database function.\n\nSee [the reference documentation](../../reference/index.qmd) for existing APIs.\n:::\n\nLet's the use the DuckDB backend to demonstrate how to access an aggregate\nfunction that isn't exposed in ibis:\n[`kurtosis`](https://en.wikipedia.org/wiki/Kurtosis).\n\n### DuckDB\n\nFirst, define the builtin aggregate function:\n\n::: {#2ccc8b6a .cell execution_count=15}\n``` {.python .cell-code}\n@udf.agg.builtin\ndef kurtosis(x: float) -> float:  # <1>\n   ...\n```\n:::\n\n\n1. Both the input and return type annotations indicate the **element** type of\n   the input, not the shape (column or scalar). Aggregations can only be called\n   on column expressions.\n\nOne of the powerful features of this API is that you can define your UD(A)Fs at\nany point during your analysis. You don't need to connect to the database to\ndefine your functions.\n\nLet's compute the kurtosis of the number of votes across all movies:\n\n::: {#7aa0b023 .cell execution_count=16}\n``` {.python .cell-code}\nfrom ibis import _\n\nexpr = (\n   ibis.examples.imdb_title_ratings.fetch()\n   .rename(\"snake_case\")\n   .agg(kurt=lambda t: kurtosis(t.num_votes))\n)\nexpr\n```\n\n::: {.cell-output .cell-output-display execution_count=16}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> kurt        </span>┃\n┡━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>     │\n├─────────────┤\n│ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4545.349906</span> │\n└─────────────┘\n</pre>\n```\n:::\n:::\n\n\nSince this is an aggregate function, it has the same capabilities as other,\nbuiltin aggregates like `sum`: it can be used in a group by as well as in\na window function expression.\n\nLet's compute kurtosis for all the different types of productions (shorts,\nmovies, TV, etc):\n\n::: {#ae226b1e .cell execution_count=17}\n``` {.python .cell-code}\nbasics = (\n   ibis.examples.imdb_title_basics.fetch()\n   .rename(\"snake_case\")\n   .filter(_.is_adult == 0)\n)\nratings = ibis.examples.imdb_title_ratings.fetch().rename(\"snake_case\")\n\nbasics_ratings = ratings.join(basics, \"tconst\")\n\nexpr = (\n   basics_ratings.group_by(\"title_type\")\n   .agg(kurt=lambda t: kurtosis(t.num_votes))\n   .order_by(_.kurt.desc())\n   .head()\n)\nexpr\n```\n\n::: {.cell-output .cell-output-display execution_count=17}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> title_type   </span>┃<span style=\"font-weight: bold\"> kurt        </span>┃\n┡━━━━━━━━━━━━━━╇━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>     │\n├──────────────┼─────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">tvEpisode   </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">8043.838209</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">tvSeries    </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4030.938238</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">short       </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3645.730119</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">tvMiniSeries</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1901.614316</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">tvMovie     </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1316.403908</span> │\n└──────────────┴─────────────┘\n</pre>\n```\n:::\n:::\n\n\nSimilarly for window functions:\n\n::: {#8a9b28ba .cell execution_count=18}\n``` {.python .cell-code}\nexpr = (\n   basics_ratings.mutate(\n      kurt=lambda t: kurtosis(t.num_votes).over(group_by=\"title_type\")\n   )\n   .relocate(\"kurt\", after=\"tconst\")\n   .filter(\n      [\n         _.original_title.lower().contains(\"godfather\"),\n         _.title_type == \"movie\",\n         _.genres.contains(\"Crime\") & _.genres.contains(\"Drama\"),\n      ]\n   )\n)\nexpr\n```\n\n::: {.cell-output .cell-output-display execution_count=18}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> tconst     </span>┃<span style=\"font-weight: bold\"> kurt        </span>┃<span style=\"font-weight: bold\"> average_rating </span>┃<span style=\"font-weight: bold\"> num_votes </span>┃<span style=\"font-weight: bold\"> title_type </span>┃<span style=\"font-weight: bold\"> primary_title          </span>┃<span style=\"font-weight: bold\"> original_title         </span>┃<span style=\"font-weight: bold\"> is_adult </span>┃<span style=\"font-weight: bold\"> start_year </span>┃<span style=\"font-weight: bold\"> end_year </span>┃<span style=\"font-weight: bold\"> runtime_minutes </span>┃<span style=\"font-weight: bold\"> genres             </span>┃\n┡━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">float64</span>        │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                 │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>                 │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>    │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>   │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>           │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">string</span>             │\n├────────────┼─────────────┼────────────────┼───────────┼────────────┼────────────────────────┼────────────────────────┼──────────┼────────────┼──────────┼─────────────────┼────────────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">tt13130308</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1090.363856</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5.2</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">7303</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">movie     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Godfather             </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Godfather             </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2022</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">157</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Action,Crime,Drama</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">tt0458027 </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1090.363856</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3.7</span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">27</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">movie     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Mumbai Godfather      </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Mumbai Godfather      </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2005</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │            <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Action,Crime,Drama</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">tt0068646 </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1090.363856</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">9.2</span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1945537</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">movie     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather         </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather         </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1972</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">175</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Crime,Drama       </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">tt0071562 </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1090.363856</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">9.0</span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1321642</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">movie     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather Part II </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather Part II </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1974</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">202</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Crime,Drama       </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">tt0074412 </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1090.363856</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5.2</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1733</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">movie     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Disco Godfather       </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Disco Godfather       </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1979</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │              <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">98</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Action,Crime,Drama</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">tt0099674 </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1090.363856</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">7.6</span> │    <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">412936</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">movie     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather Part III</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">The Godfather Part III</span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1990</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │             <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">162</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Crime,Drama       </span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">tt0250404 </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1090.363856</span> │            <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">6.5</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">244</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">movie     </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Godfather             </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Godfather             </span> │        <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1992</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span>     │            <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">NULL</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Crime,Drama       </span> │\n└────────────┴─────────────┴────────────────┴───────────┴────────────┴────────────────────────┴────────────────────────┴──────────┴────────────┴──────────┴─────────────────┴────────────────────┘\n</pre>\n```\n:::\n:::\n\n\n",
    "supporting": [
      "builtin_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}