{
  "hash": "11be6b58a53988934f83b02d31714953",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: ClickHouse\nfreeze: auto\n---\n\n[Ibis](https://ibis-project.com) supports reading and querying data using\n[ClickHouse](https://clickhouse.com/) as a backend.\n\nIn this example we'll demonstrate using Ibis to connect to a ClickHouse server,\nand to execute a few queries.\n\n::: {#c30f10d1 .cell execution_count=1}\n``` {.python .cell-code}\nfrom ibis.interactive import *\n```\n:::\n\n\n## Creating a Connection\n\nFirst we need to connect Ibis to a running ClickHouse server.\n\nIn this example we'll run queries against the publicly available [ClickHouse\nplayground](https://clickhouse.com/docs/en/getting-started/playground) server.\n\nTo run against your own ClickHouse server you'd only need to change the\nconnection details.\n\n::: {#1ec010bb .cell execution_count=2}\n``` {.python .cell-code}\ncon = ibis.connect(\"clickhouse://play:clickhouse@play.clickhouse.com:443?secure=True\")\n```\n:::\n\n\n## Listing available tables\n\nThe ClickHouse playground server has a number of interesting datasets\navailable. To see them, we can examine the tables via the `.tables` attribute.\n\nThis shows a list of all tables available:\n\n::: {#ccb20dfc .cell execution_count=3}\n``` {.python .cell-code}\ncon.tables\n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```\nTables\n------\n- actors\n- benchmark_results\n- benchmark_runs\n- cell_towers\n- checks\n- cisco_umbrella\n- covid\n- dish\n- dns\n- dns2\n- food_facts\n- github_events\n- hackernews\n- hits\n- lineorder\n- loc_stats\n- menu\n- menu_item\n- menu_item_denorm\n- menu_page\n- minicrawl\n- ontime\n- opensky\n- pypi\n- query_metrics_v2\n- rdns\n- recipes\n- repos\n- repos_raw\n- run_attributes_v1\n- search_clickhouse_stackoverflow\n- search_stackoverflow\n- stackoverflow\n- stock\n- tranco\n- trips\n- uk_price_paid\n- uk_price_paid_updater\n- wikistat\n- workflow_jobs\n```\n:::\n:::\n\n\n## Inspecting a Table\n\nLets take a look at the `hackernews` table. This table contains all posts and\ncomments on [Hacker News](https://news.ycombinator.com/).\n\nWe can access the table by attribute as `con.tables.hackernews`.\n\n::: {#ea3033ab .cell execution_count=4}\n``` {.python .cell-code}\nt = con.tables.hackernews\n```\n:::\n\n\nWe can then take a peak at the first few rows using the `.head()` method.\n\n::: {#ca4167ad .cell execution_count=5}\n``` {.python .cell-code}\nt.head()\n```\n\n::: {.cell-output .cell-output-display execution_count=5}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> id      </span>┃<span style=\"font-weight: bold\"> deleted </span>┃<span style=\"font-weight: bold\"> type    </span>┃<span style=\"font-weight: bold\"> by          </span>┃<span style=\"font-weight: bold\"> time                </span>┃<span style=\"font-weight: bold\"> text    </span>┃<span style=\"font-weight: bold\"> dead   </span>┃<span style=\"font-weight: bold\"> parent  </span>┃<span style=\"font-weight: bold\"> poll    </span>┃<span style=\"font-weight: bold\"> kids                 </span>┃<span style=\"font-weight: bold\"> url                                                                           </span>┃<span style=\"font-weight: bold\"> score  </span>┃<span style=\"font-weight: bold\"> title                                                       </span>┃<span style=\"font-weight: bold\"> parts           </span>┃<span style=\"font-weight: bold\"> descendants </span>┃\n┡━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">!uint32</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">!uint8</span>  │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">!string</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">!string</span>     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">!timestamp(0)</span>       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">!string</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">!uint8</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">!uint32</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">!uint32</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">!array&lt;!uint32&gt;</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">!string</span>                                                                       │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">!int32</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">!string</span>                                                     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">!array&lt;!uint32&gt;</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">!int32</span>      │\n├─────────┼─────────┼─────────┼─────────────┼─────────────────────┼─────────┼────────┼─────────┼─────────┼──────────────────────┼───────────────────────────────────────────────────────────────────────────────┼────────┼─────────────────────────────────────────────────────────────┼─────────────────┼─────────────┤\n│       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">story  </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">pg         </span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2006-10-09 18:21:51</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">~</span>       │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">15</span>, <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">234509</span>, <span style=\"color: #808000; text-decoration-color: #808000\">...</span> +<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span><span style=\"font-weight: bold\">]</span> │ <a href=\"http://ycombinator.com\" target=\"_blank\"><span style=\"color: #008000; text-decoration-color: #008000\">http://ycombinator.com</span></a><span style=\"color: #008000; text-decoration-color: #008000\">                                                       </span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">57</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Y Combinator                                               </span> │ <span style=\"font-weight: bold\">[]</span>              │          <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">15</span> │\n│       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">story  </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">phyllis    </span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2006-10-09 18:30:28</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">~</span>       │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │ <span style=\"font-weight: bold\">[]</span>                   │ <a href=\"http://www.paulgraham.com/mit.html\" target=\"_blank\"><span style=\"color: #008000; text-decoration-color: #008000\">http://www.paulgraham.com/mit.html</span></a><span style=\"color: #008000; text-decoration-color: #008000\">                                           </span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">16</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">A Student's Guide to Startups                              </span> │ <span style=\"font-weight: bold\">[]</span>              │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │\n│       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">3</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">story  </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">phyllis    </span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2006-10-09 18:40:33</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">~</span>       │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │ <span style=\"font-weight: bold\">[</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">531602</span><span style=\"font-weight: bold\">]</span>             │ <a href=\"http://www.foundersatwork.com/stevewozniak.html\" target=\"_blank\"><span style=\"color: #008000; text-decoration-color: #008000\">http://www.foundersatwork.com/stevewozniak.html</span></a><span style=\"color: #008000; text-decoration-color: #008000\">                              </span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">7</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Woz Interview: the early days of Apple                     </span> │ <span style=\"font-weight: bold\">[]</span>              │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │\n│       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">story  </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">onebeerdave</span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2006-10-09 18:47:42</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">~</span>       │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │ <span style=\"font-weight: bold\">[]</span>                   │ <a href=\"http://avc.blogs.com/a_vc/2006/10/the_nyc_develop.html\" target=\"_blank\"><span style=\"color: #008000; text-decoration-color: #008000\">http://avc.blogs.com/a_vc/2006/10/the_nyc_develop.html</span></a><span style=\"color: #008000; text-decoration-color: #008000\">                       </span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">NYC Developer Dilemma                                      </span> │ <span style=\"font-weight: bold\">[]</span>              │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │\n│       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">story  </span> │ <span style=\"color: #008000; text-decoration-color: #008000\">perler     </span> │ <span style=\"color: #800080; text-decoration-color: #800080\">2006-10-09 18:51:04</span> │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">~</span>       │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │       <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │ <span style=\"font-weight: bold\">[]</span>                   │ <a href=\"http://www.techcrunch.com/2006/10/09/google-youtube-sign-more-separate-deals/\" target=\"_blank\"><span style=\"color: #008000; text-decoration-color: #008000\">http://www.techcrunch.com/2006/10/09/google-youtube-sign-more-separate-deals/</span></a> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">7</span> │ <span style=\"color: #008000; text-decoration-color: #008000\">Google, YouTube acquisition announcement could come tonight</span> │ <span style=\"font-weight: bold\">[]</span>              │           <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">0</span> │\n└─────────┴─────────┴─────────┴─────────────┴─────────────────────┴─────────┴────────┴─────────┴─────────┴──────────────────────┴───────────────────────────────────────────────────────────────────────────────┴────────┴─────────────────────────────────────────────────────────────┴─────────────────┴─────────────┘\n</pre>\n```\n:::\n:::\n\n\n## Finding the highest scoring posts\n\nHere we find the top 5 posts by score.\n\nPosts have a title, so we:\n\n- `filter` out rows that lack a title\n- `select` only the columns we're interested in\n- `order` them by score, descending\n- `limit` to the top 5 rows\n\n::: {#1d2096cb .cell execution_count=6}\n``` {.python .cell-code}\ntop_posts_by_score = (\n    t.filter(_.title != \"\")\n    .select(\"title\", \"score\")\n    .order_by(ibis.desc(\"score\"))\n    .limit(5)\n)\n\ntop_posts_by_score\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> title                       </span>┃<span style=\"font-weight: bold\"> score  </span>┃\n┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">!string</span>                     │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">!int32</span> │\n├─────────────────────────────┼────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Stephen Hawking has died   </span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">6015</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">A Message to Our Customers </span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">5771</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Steve Jobs has passed away.</span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4338</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Bram Moolenaar has died    </span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4310</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Mechanical Watch           </span> │   <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">4298</span> │\n└─────────────────────────────┴────────┘\n</pre>\n```\n:::\n:::\n\n\n## Finding the most prolific commenters\n\nHere we find the top 5 commenters by number of comments made.\n\nTo do this we:\n\n- `filter` out rows with no author\n- `group_by` author\n- `count` all the rows in each group\n- `order_by` the counts, descending\n- `limit` to the top 5 rows\n\n::: {#38e5a8e3 .cell execution_count=7}\n``` {.python .cell-code}\ntop_commenters = (\n    t.filter(_.by != \"\")\n    .group_by(\"by\")\n    .agg(count=_.count())\n    .order_by(ibis.desc(\"count\"))\n    .limit(5)\n)\n\ntop_commenters\n```\n\n::: {.cell-output .cell-output-display execution_count=7}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━┳━━━━━━━┓\n┃<span style=\"font-weight: bold\"> by           </span>┃<span style=\"font-weight: bold\"> count </span>┃\n┡━━━━━━━━━━━━━━╇━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">!string</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span> │\n├──────────────┼───────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">dang        </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">64937</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">tptacek     </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">61479</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">jacquesm    </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">56408</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">pjmlp       </span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">54785</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">dragonwriter</span> │ <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">51150</span> │\n└──────────────┴───────┘\n</pre>\n```\n:::\n:::\n\n\nThis query could also be expressed using the `.topk` method, which is\na shorthand for the above:\n\n::: {#821bdc88 .cell execution_count=8}\n``` {.python .cell-code}\n# This is a shorthand for the above\ntop_commenters = t.filter(_.by != \"\").by.topk(5)\n\ntop_commenters\n```\n\n::: {.cell-output .cell-output-display execution_count=8}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━┳━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> by           </span>┃<span style=\"font-weight: bold\"> Count(by) </span>┃\n┡━━━━━━━━━━━━━━╇━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">!string</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>     │\n├──────────────┼───────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">dang        </span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">64937</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">tptacek     </span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">61479</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">jacquesm    </span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">56408</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">pjmlp       </span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">54785</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">dragonwriter</span> │     <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">51150</span> │\n└──────────────┴───────────┘\n</pre>\n```\n:::\n:::\n\n\n## Finding top commenters by score\n\nHere we find the top 5 commenters with the highest cumulative scores.\n\n::: {#e63dbbb0 .cell execution_count=9}\n``` {.python .cell-code}\ntop_commenters_by_score = (\n    t.filter(_.by != \"\")\n    .group_by(\"by\")\n    .agg(total_score=_.score.sum())\n    .order_by(ibis.desc(\"total_score\"))\n    .limit(5)\n)\n\ntop_commenters_by_score\n```\n\n::: {.cell-output .cell-output-display execution_count=9}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> by           </span>┃<span style=\"font-weight: bold\"> total_score </span>┃\n┡━━━━━━━━━━━━━━╇━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">!string</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>       │\n├──────────────┼─────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">ingve       </span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">405248</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">tosh        </span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">301694</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">pseudolus   </span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">295067</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Tomte       </span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">276776</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">todsacerdoti</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">269524</span> │\n└──────────────┴─────────────┘\n</pre>\n```\n:::\n:::\n\n\nUsing the `.topk` method, this can be written in a single line:\n\n::: {#b0c21444 .cell execution_count=10}\n``` {.python .cell-code}\ntop_commenters_by_score = t.by.topk(5, by=_.score.sum().name(\"total_score\"))\n\ntop_commenters_by_score\n```\n\n::: {.cell-output .cell-output-display execution_count=10}\n```{=html}\n<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">┏━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┓\n┃<span style=\"font-weight: bold\"> by           </span>┃<span style=\"font-weight: bold\"> total_score </span>┃\n┡━━━━━━━━━━━━━━╇━━━━━━━━━━━━━┩\n│ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">!string</span>      │ <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">int64</span>       │\n├──────────────┼─────────────┤\n│ <span style=\"color: #008000; text-decoration-color: #008000\">ingve       </span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">405248</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">tosh        </span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">301694</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">pseudolus   </span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">295067</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">Tomte       </span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">276776</span> │\n│ <span style=\"color: #008000; text-decoration-color: #008000\">todsacerdoti</span> │      <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">269524</span> │\n└──────────────┴─────────────┘\n</pre>\n```\n:::\n:::\n\n\n## Next Steps\n\nThere are lots of other interesting queries one might ask of this dataset.\n\nA few examples:\n\n- What posts had the most comments?\n- How do post scores fluctuate over time?\n- What day of the week has the highest average post score? What day has the lowest?\n\nTo learn more about how to use Ibis with Clickhouse, see [the\ndocumentation](https://ibis-project.org/backends/ClickHouse/).\n\n",
    "supporting": [
      "clickhouse_files/figure-html"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}