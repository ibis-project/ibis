<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Ibis</title>
<link>https://ibis-project.org/posts.html</link>
<atom:link href="https://ibis-project.org/posts.xml" rel="self" type="application/rss+xml"/>
<description>the portable Python dataframe library</description>
<generator>quarto-1.4.549</generator>
<lastBuildDate>Wed, 31 Jan 2024 05:00:00 GMT</lastBuildDate>
<item>
  <title>Building scalable data pipelines with Kedro</title>
  <dc:creator>Cody </dc:creator>
  <link>https://ibis-project.org/posts/kedro-ibis/</link>
  <description><![CDATA[ 





<section id="overview" class="level1">
<h1>Overview</h1>
<p><a href="https://kedro.org">Kedro</a> is a toolbox for production-ready data science. It is an open-source Python framework like Ibis, and together you can bring the portability and scale of Ibis to the production-ready pipelines of Kedro.</p>
<blockquote class="blockquote">
<p>In your <del>Kedro</del> data journey, have you ever…</p>
<p>…slurped up large amounts of data into memory, instead of pushing execution down to the source database/engine?</p>
<p>…prototyped a node in pandas, and then rewritten it in PySpark/Snowpark/some other native dataframe API?</p>
<p>…implemented a proof-of-concept solution in 3-4 months on data extracts, and then struggled massively when you needed to move to running against the production databases and scale out? …</p>
</blockquote>
<p>If so, <a href="https://kedro.org/blog/building-scalable-data-pipelines-with-kedro-and-ibis">read the full article on the Kedro blog</a>!</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>blog</category>
  <category>kedro</category>
  <category>data engineering</category>
  <guid>https://ibis-project.org/posts/kedro-ibis/</guid>
  <pubDate>Wed, 31 Jan 2024 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Modern, hybrid, open analytics</title>
  <dc:creator>Cody </dc:creator>
  <link>https://ibis-project.org/posts/ibis-analytics/</link>
  <description><![CDATA[ 





<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>As a Python data user, I’ve wanted a more modular, composable, and scalable ecosystem. <em>I think it’s here</em>. Wes McKinney released pandas c.&nbsp;2009 to bring dataframes into Python and it became one of the most used software packages. It was built when small data was smaller and has some downsides <a href="https://wesmckinney.com/blog/apache-arrow-pandas-internals">Wes wrote about in his “Apache Arrow and the ‘10 things I hate about pandas’” blog post</a>. Wes created Ibis (and co-created Apache Arrow) to address these issues and more with a different approach than any other Python dataframe library by decoupling the dataframe API from the backend implementation. This allows Ibis to support 20+ backends today including pandas, DuckDB, Polars, Postgres, BigQuery, Snowflake, PySpark, and over a dozen more.</p>
<p>I’ve experienced many pains of the ecosystem myself. I’ve downloaded a 1 GB CSV from a database GUI and used pandas to munge it because I couldn’t figure it out in SQL. When building larger ML demos that included data preprocessing on GBs, I hit OOM errors and learned about how much data expands in memory. Schema inference issues and file read speeds led me understand why storing data in compressed Parquet files might be better for my use cases. I learned about partitioning strategies and the joy of subtle differences and incompatibilities across data systems. I started using PySpark and Dask to overcome hurdles. I slowly learned about databases. Fortunately while I’ve been learning, others (<a href="https://github.com/ibis-project/ibis/contributors">including many Ibis contributors</a>) have been building a modern, open-source Python data ecosystem! Now I can use what they’ve built to create a modern analytics application.</p>
<p>In this blog, we’ll look at how to build an end-to-end analytics project using Ibis as the frontend for data in Python. Ibis plays a key role, but is only one component in any real data project.</p>
<p>We’ll combine a variety of open-source tools and freemium services including:</p>
<ul>
<li><a href="https://ibis-project.org">Ibis</a> (dataframe library)</li>
<li><a href="https://duckdb.org">DuckDB</a> (database and query engine)</li>
<li><a href="https://dagster.io">Dagster</a> (orchestration library)</li>
<li><a href="https://plotly.com/python">Plotly</a> (visualization library)</li>
<li><a href="https://streamlit.io">Streamlit</a> (dashboard library)</li>
<li><a href="https://just.systems">justfile</a> (command runner)</li>
<li><a href="https://toml.io">TOML</a> (configuration)</li>
<li><a href="https://github.com">GitHub</a> (source control, CI/CD)</li>
<li><a href="https://azure.microsoft.com/products/virtual-machines">Azure VM</a> (self-hosted runner)</li>
<li><a href="https://docs.github.com/en/graphql">GitHub web APIs</a> (source data)</li>
<li><a href="https://cloud.google.com/free/docs/free-cloud-features#bigquery">Google BigQuery</a> (source data)</li>
<li><a href="https://zulip.com">Zulip</a> (source data)</li>
<li><a href="https://motherduck.com">MotherDuck</a> (cloud service for DuckDB)</li>
<li><a href="https://docs.streamlit.io/streamlit-community-cloud">Streamlit Community Cloud</a> (cloud service for Streamlit)</li>
</ul>
<p>to build an open-source, modular, composable, scalable, automated, hybrid-cloud, end-to-end analytics project processing a few million rows of data that provides real business value.</p>
</section>
<section id="whats-the-business-value" class="level2">
<h2 class="anchored" data-anchor-id="whats-the-business-value">What’s the business value?</h2>
<p>Today, Ibis is a thriving open-source project primarily backed by Voltron Data with contributors at Google, Claypot AI, Singlestore, Exasol, RisingWave, Starburst Data, and anyone who <a href="https://github.com/ibis-project/ibis/contributors">submits a PR and makes a commit</a>. It aims to be a standard frontend for data in Python that scales to your backend. To understand the project’s health, we want to track some key adoption metrics. There was already a dashboard internally at Voltron Data, but it was written in R and I don’t know R. I do know Ibis and a few other OSS tools, and saw this as a cool opportunity to try out a few more while showcasing Ibis in a real-world project.</p>
<p>Let’s get started!</p>
</section>
<section id="finished-product" class="level2">
<h2 class="anchored" data-anchor-id="finished-product">Finished product</h2>
<p>The final result is a MotherDuck database powering a dashboard deployed to Streamlit Community Cloud.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Since writing this blog, I’ve added documentation metrics. This is ongoing and that page may be broken.</p>
<p>Look out for a follow up post on how new metrics are added to the dashboard!</p>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>While I consider this “production” it does go down occasionally, usually because of a stale connection to MotherDuck. There are screenshots below in case that happens while you’re reading this, or you can reproduce it locally (an exercise for the reader).</p>
</div>
</div>
<p>The dashboard can be <a href="https://ibis-analytics.streamlit.app">viewed as a Streamlit app</a> in your browser or embedded in this page below.</p>
<iframe class="streamlit-app-inner" width="100%" height="500" src="https://ibis-analytics.streamlit.app/?embedded=true"></iframe>
</section>
<section id="architecture" class="level2">
<h2 class="anchored" data-anchor-id="architecture">Architecture</h2>
<p>The source of truth for the project’s architecture <a href="https://github.com/ibis-project/ibis-analytics">is the repository of code</a>. A point-in-time description and snapshots of the code are below.</p>
<section id="goals" class="level3">
<h3 class="anchored" data-anchor-id="goals">Goals</h3>
<p>I had the following goals in mind:</p>
<ul>
<li><strong>Modular:</strong> while this project uses Dagster, it should be easily swappable for other orchestration tools like Airflow or Prefect or Kedro. While this project uses DuckDB, it should be easily swappable for Polars or Clickhouse or any other engine. While this project uses Streamlit, it should be swappable for Quarto dashboards…</li>
<li><strong>Composable:</strong> the project should be easy to understand and extend. It should be easy to add new data sources, new data transformations, new metrics, and new visualizations.</li>
<li><strong>Automated:</strong> the project should be easy to run locally and in production. It should be easy to run the entire pipeline or just a single step. It should be easy to run the pipeline on a schedule or on a pull request.</li>
<li><strong>Iterative:</strong> the project should be easy to iterate on. It should be easy to explore the data, transform it, and visualize it. It should be easy to switch between local and production data sources.</li>
</ul>
<p>Our open-source tools and freemium services allow us to accomplish these goals.</p>
</section>
<section id="overview" class="level3">
<h3 class="anchored" data-anchor-id="overview">Overview</h3>
<p>The architecture consists of Python code. Steps in the overall data pipeline are captured in a <code>justfile</code>, which is a Makefile-like command runner. This allows us to run the pipeline locally or in automated CI/CD workflows. The data ingestion is a Python script that makes raw <code>request</code> calls to GitHub web APIs, uses the Zulip Python client for Zulip web APIs, and Ibis + SQL to extract PyPI data from a public Google BigQuery project.</p>
<p>The data is then extracted from its ingested file formats (JSON and Parquet), transformed with Ibis using the default DuckDB backend, and loaded into final DuckDB database files. Further postprocessing is done to combine these into a single DuckDB database file for convenience, though this step isn’t necessary. The tables are then copied using Ibis to connect to MotherDuck, a serverless cloud service for DuckDB. This allows us to use MotherDuck’s servers to access the production data from anywhere, including my laptop and a Streamlit Community Cloud server. The dashboard deployed there updates automatically when the data is updated. Finally, we can run some tests by executing the dashboard code.</p>
<p>For the most part, you just need a Python environment with <code>pip</code> installs including Ibis and a few other packages.</p>
<details>
<summary>
Python <code>pip install</code> requirements
</summary>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode txt code-with-copy"><code class="sourceCode default"><span id="cb1-1"># python</span>
<span id="cb1-2">ruff</span>
<span id="cb1-3">python-dotenv</span>
<span id="cb1-4"></span>
<span id="cb1-5"># web clients</span>
<span id="cb1-6">zulip</span>
<span id="cb1-7">PyGithub # unused for now</span>
<span id="cb1-8"></span>
<span id="cb1-9"># data</span>
<span id="cb1-10">duckdb&gt;=0.9.0</span>
<span id="cb1-11">ibis-framework[duckdb,bigquery,deltalake]</span>
<span id="cb1-12"></span>
<span id="cb1-13"># ML</span>
<span id="cb1-14">ibisml # unused for now</span>
<span id="cb1-15"></span>
<span id="cb1-16"># viz</span>
<span id="cb1-17">plotly</span>
<span id="cb1-18">streamlit</span>
<span id="cb1-19"></span>
<span id="cb1-20"># ops</span>
<span id="cb1-21">dagster</span>
<span id="cb1-22">dagster-webserver</span></code></pre></div>
</details>
<p>Various environment variables set to access the data sources and cloud services are stored in a <code>.env</code> file and set in the respective cloud services (GitHub Actions secrets and Streamlit Community Cloud secrets).</p>
</section>
<section id="configuration" class="level3">
<h3 class="anchored" data-anchor-id="configuration">Configuration</h3>
<p>We use a <code>config.toml</code> file to configure the project. This allows easily switching out the database (i.e.&nbsp;changing over to local for development) and adding new data sources. Most of the ingested data is currently unused, but this makes it easy in the future to set up additional dashboards for other Ibis projects as they grow and need to be tracked.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[app]</span></span>
<span id="cb2-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#database="data/app.ddb"</span></span>
<span id="cb2-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">database</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"md:ibis_analytics"</span></span>
<span id="cb2-4"></span>
<span id="cb2-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[eda]</span></span>
<span id="cb2-6"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">database</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"md:ibis_analytics"</span></span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#database="data/data.ddb"</span></span>
<span id="cb2-8"></span>
<span id="cb2-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[ingest.pypi]</span></span>
<span id="cb2-10"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">packages</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb2-11">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ibis-framework"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb2-12">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ibis-examples"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb2-13">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ibis-substrait"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb2-14">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ibisml"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb2-15">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ibis-birdbrain"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb2-16"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb2-17"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[ingest.github]</span></span>
<span id="cb2-18"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">repos</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb2-19">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ibis-project/ibis"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb2-20">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ibis-project/ibis-examples"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb2-21">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ibis-project/ibis-substrait"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb2-22">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ibis-project/ibisml"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb2-23">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ibis-project/ibis-birdbrain"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb2-24"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb2-25"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">endpoints</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb2-26">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"repo"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb2-27">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stargazers"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb2-28">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"subscribers"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb2-29">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"commits"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb2-30">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"releases"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb2-31">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"forks"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb2-32">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"issues"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb2-33">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contributors"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb2-34"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb2-35"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[ingest.zulip]</span></span>
<span id="cb2-36"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">url</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://ibis-project.zulipchat.com"</span></span></code></pre></div>
</section>
<section id="automation" class="level3">
<h3 class="anchored" data-anchor-id="automation">Automation</h3>
<p>Anything run frequently is put in a <code>justfile</code>. This makes it easy to run the same code locally or in a GitHub Action.</p>
<details>
<summary>
Show the <code>justfile</code> of project commands
</summary>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># justfile</span></span>
<span id="cb3-2"></span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># load environment variables</span></span>
<span id="cb3-4">set dotenv-load</span>
<span id="cb3-5"></span>
<span id="cb3-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># variables</span></span>
<span id="cb3-7"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">module</span> <span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> "dag"</span></span>
<span id="cb3-8"></span>
<span id="cb3-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># aliases</span></span>
<span id="cb3-10"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">alias fmt:</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">=format</span></span>
<span id="cb3-11"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">alias etl:</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">=run</span></span>
<span id="cb3-12"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">alias open:</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">=open-dash</span></span>
<span id="cb3-13"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">alias dag-open:</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">=open-dag</span></span>
<span id="cb3-14"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">alias preview:</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">=app</span></span>
<span id="cb3-15"></span>
<span id="cb3-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># format</span></span>
<span id="cb3-17"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">format:</span></span>
<span id="cb3-18"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">    </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">@</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ruff format .</span></span>
<span id="cb3-19"></span>
<span id="cb3-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># smoke-test</span></span>
<span id="cb3-21"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">smoke-test:</span></span>
<span id="cb3-22"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">    </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">@</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ruff format --check .</span></span>
<span id="cb3-23"></span>
<span id="cb3-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># list justfile recipes</span></span>
<span id="cb3-25"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">default:</span></span>
<span id="cb3-26"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">    </span>just --list</span>
<span id="cb3-27"></span>
<span id="cb3-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># setup</span></span>
<span id="cb3-29"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">setup:</span></span>
<span id="cb3-30"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">    </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">@</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pip install --upgrade -r requirements.txt</span></span>
<span id="cb3-31"></span>
<span id="cb3-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># eda</span></span>
<span id="cb3-33"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">eda:</span></span>
<span id="cb3-34"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">    </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">@</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ipython -i eda.py</span></span>
<span id="cb3-35"></span>
<span id="cb3-36"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ingest</span></span>
<span id="cb3-37"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">ingest:</span></span>
<span id="cb3-38"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">    </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">@</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">python {{module}}/ingest.py</span></span>
<span id="cb3-39"></span>
<span id="cb3-40"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># run</span></span>
<span id="cb3-41"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">run:</span></span>
<span id="cb3-42"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">    </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">@</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dagster job execute -j all_assets -m {{module}}</span></span>
<span id="cb3-43"></span>
<span id="cb3-44"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># postprocess</span></span>
<span id="cb3-45"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">postprocess:</span></span>
<span id="cb3-46"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">    </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">@</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">python {{module}}/postprocess.py</span></span>
<span id="cb3-47"></span>
<span id="cb3-48"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># deploy</span></span>
<span id="cb3-49"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">deploy:</span></span>
<span id="cb3-50"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">    </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">@</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">python {{module}}/deploy.py</span></span>
<span id="cb3-51"></span>
<span id="cb3-52"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># test</span></span>
<span id="cb3-53"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">test:</span></span>
<span id="cb3-54"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">    </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">@</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">python metrics.py</span></span>
<span id="cb3-55">    <span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">@</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">python pages/0_github.py</span></span>
<span id="cb3-56">    <span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">@</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">python pages/1_pypi.py</span></span>
<span id="cb3-57">    <span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">@</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">python pages/2_zulip.py</span></span>
<span id="cb3-58">    <span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">@</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">python pages/3_about.py</span></span>
<span id="cb3-59"></span>
<span id="cb3-60"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># dag</span></span>
<span id="cb3-61"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">dag:</span></span>
<span id="cb3-62"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">    </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">@</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dagster dev -m {{module}}</span></span>
<span id="cb3-63"></span>
<span id="cb3-64"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># streamlit stuff</span></span>
<span id="cb3-65"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">app:</span></span>
<span id="cb3-66"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">    </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">@</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">streamlit run metrics.py</span></span>
<span id="cb3-67"></span>
<span id="cb3-68"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># clean</span></span>
<span id="cb3-69"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">clean:</span></span>
<span id="cb3-70"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">    </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">@</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm -r *.ddb* || true</span></span>
<span id="cb3-71">    <span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">@</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm -r data/system || true</span></span>
<span id="cb3-72">    <span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">@</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm -r data/backup || true</span></span>
<span id="cb3-73">    <span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">@</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm data/backup.ddb || true</span></span>
<span id="cb3-74"></span>
<span id="cb3-75"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># open dag</span></span>
<span id="cb3-76"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">open-dag:</span></span>
<span id="cb3-77"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">    </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">@</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">open http://localhost:3000/asset-groups</span></span>
<span id="cb3-78"></span>
<span id="cb3-79"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># open dash</span></span>
<span id="cb3-80"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">open-dash:</span></span>
<span id="cb3-81"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">    </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">@</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">open https://ibis-analytics.streamlit.app</span></span>
<span id="cb3-82"></span>
<span id="cb3-83"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># cicd</span></span>
<span id="cb3-84"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">cicd:</span></span>
<span id="cb3-85"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">    </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">@</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gh workflow run cicd.yaml</span></span></code></pre></div>
</details>
<p>Then our CI/CD workflow in <code>cicd.yaml</code> is just:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> cicd</span></span>
<span id="cb4-2"></span>
<span id="cb4-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">on</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">workflow_dispatch</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">schedule</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cron</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0 0/3 * * *"</span></span>
<span id="cb4-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull_request</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paths</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.github/workflows/cicd.yaml'</span></span>
<span id="cb4-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'requirements.txt'</span></span>
<span id="cb4-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'**.py'</span></span>
<span id="cb4-12"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'justfile'</span></span>
<span id="cb4-13"></span>
<span id="cb4-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">jobs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-15"></span>
<span id="cb4-16"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ingest-etl-postprocess-deploy-test</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-17"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runs-on</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> self-hosted</span></span>
<span id="cb4-18"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">steps</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-19"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> actions/checkout@v3</span></span>
<span id="cb4-20"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> google-github-actions/auth@v1</span></span>
<span id="cb4-21"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-22"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">credentials_json</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ${{ secrets.GCLOUD_JSON }}</span></span>
<span id="cb4-23"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> extractions/setup-just@v1</span></span>
<span id="cb4-24"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> actions/setup-python@v4</span></span>
<span id="cb4-25"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-26"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">python-version</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.11</span></span>
<span id="cb4-27"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> install requirements</span></span>
<span id="cb4-28"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> just setup</span></span>
<span id="cb4-29"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ingest</span></span>
<span id="cb4-30"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> just ingest</span></span>
<span id="cb4-31"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">env</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-32"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">BQ_PROJECT_ID</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> voltrondata-demo</span></span>
<span id="cb4-33"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">GITHUB_TOKEN</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ${{ secrets.GITHUB_TOKEN }}</span></span>
<span id="cb4-34"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ZULIP_KEY</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ${{ secrets.ZULIP_KEY }}</span></span>
<span id="cb4-35"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> run ETL job</span></span>
<span id="cb4-36"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> just run</span></span>
<span id="cb4-37"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> postprocess</span></span>
<span id="cb4-38"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> just postprocess</span></span>
<span id="cb4-39"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> deploy to prod</span></span>
<span id="cb4-40"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> just deploy</span></span>
<span id="cb4-41"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">env</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-42"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">MOTHERDUCK_TOKEN</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ${{ secrets.MOTHERDUCK_TOKEN }}</span></span>
<span id="cb4-43"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> test</span></span>
<span id="cb4-44"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> just test</span></span>
<span id="cb4-45"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">env</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-46"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">MOTHERDUCK_TOKEN</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ${{ secrets.MOTHERDUCK_TOKEN }}</span></span></code></pre></div>
<p>This will run the entire pipeline on a schedule, on a pull request, or manually. Everything is automated!</p>
</section>
</section>
<section id="data-ingestion" class="level2">
<h2 class="anchored" data-anchor-id="data-ingestion">Data ingestion</h2>
<p>After you <code>just ingest</code> data you end up with:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">data/ingest/</span></span>
<span id="cb5-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> github/</span>
<span id="cb5-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── ibis-project/</span>
<span id="cb5-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       ├── ibis/</span>
<span id="cb5-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── commits.000001.json</span>
<span id="cb5-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── commits.000002.json</span>
<span id="cb5-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── ...</span>
<span id="cb5-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── forks.000001.json</span>
<span id="cb5-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── forks.000002.json</span>
<span id="cb5-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── ...</span>
<span id="cb5-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── issues.000001.json</span>
<span id="cb5-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── issues.000002.json</span>
<span id="cb5-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── ...</span>
<span id="cb5-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── pullRequests.000001.json</span>
<span id="cb5-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── pullRequests.000054.json</span>
<span id="cb5-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── ...</span>
<span id="cb5-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── stargazers.000001.json</span>
<span id="cb5-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── stargazers.000002.json</span>
<span id="cb5-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── ...</span>
<span id="cb5-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   └── watchers.000001.json</span>
<span id="cb5-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       ├── ibis-birdbrain/</span>
<span id="cb5-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── commits.000001.json</span>
<span id="cb5-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── forks.000001.json</span>
<span id="cb5-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── issues.000001.json</span>
<span id="cb5-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── pullRequests.000001.json</span>
<span id="cb5-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── stargazers.000001.json</span>
<span id="cb5-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   └── watchers.000001.json</span>
<span id="cb5-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       ├── ibis-examples/</span>
<span id="cb5-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── commits.000001.json</span>
<span id="cb5-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── forks.000001.json</span>
<span id="cb5-31"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── issues.000001.json</span>
<span id="cb5-32"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── pullRequests.000001.json</span>
<span id="cb5-33"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── stargazers.000001.json</span>
<span id="cb5-34"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   └── watchers.000001.json</span>
<span id="cb5-35"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       ├── ibis-substrait/</span>
<span id="cb5-36"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── commits.000001.json</span>
<span id="cb5-37"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── commits.000002.json</span>
<span id="cb5-38"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── ...</span>
<span id="cb5-39"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── forks.000001.json</span>
<span id="cb5-40"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── issues.000001.json</span>
<span id="cb5-41"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── pullRequests.000001.json</span>
<span id="cb5-42"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── pullRequests.000002.json</span>
<span id="cb5-43"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── ...</span>
<span id="cb5-44"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   ├── stargazers.000001.json</span>
<span id="cb5-45"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       │   └── watchers.000001.json</span>
<span id="cb5-46"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       └── ibisml/</span>
<span id="cb5-47"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>           ├── commits.000001.json</span>
<span id="cb5-48"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>           ├── forks.000001.json</span>
<span id="cb5-49"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>           ├── issues.000001.json</span>
<span id="cb5-50"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>           ├── pullRequests.000001.json</span>
<span id="cb5-51"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>           ├── stargazers.000001.json</span>
<span id="cb5-52"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>           └── watchers.000001.json</span>
<span id="cb5-53"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> pypi/</span>
<span id="cb5-54"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── ibis-birdbrain/</span>
<span id="cb5-55"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   │   └── file_downloads.parquet</span>
<span id="cb5-56"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── ibis-examples/</span>
<span id="cb5-57"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   │   └── file_downloads.parquet</span>
<span id="cb5-58"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── ibis-framework/</span>
<span id="cb5-59"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   │   └── file_downloads.parquet</span>
<span id="cb5-60"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── ibis-substrait/</span>
<span id="cb5-61"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   │   └── file_downloads.parquet</span>
<span id="cb5-62"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── ibisml/</span>
<span id="cb5-63"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       └── file_downloads.parquet</span>
<span id="cb5-64"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> zulip/</span>
<span id="cb5-65">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> members.json</span>
<span id="cb5-66">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> messages.json</span></code></pre></div>
<p>This runs a Python data ingestion script and takes a few minutes. It’s not the best code, but it works!</p>
<details>
<summary>
Show the data ingestion script
</summary>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb6-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis</span>
<span id="cb6-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> toml</span>
<span id="cb6-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> json</span>
<span id="cb6-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> zulip</span>
<span id="cb6-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> inspect</span>
<span id="cb6-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> requests</span>
<span id="cb6-8"></span>
<span id="cb6-9"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> logging <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> log</span>
<span id="cb6-10"></span>
<span id="cb6-11"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> ibis <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> _</span>
<span id="cb6-12"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dotenv <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> load_dotenv</span>
<span id="cb6-13"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> datetime <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime, timedelta, date</span>
<span id="cb6-14"></span>
<span id="cb6-15"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> graphql_queries <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> (</span>
<span id="cb6-16">    issues_query,</span>
<span id="cb6-17">    pulls_query,</span>
<span id="cb6-18">    forks_query,</span>
<span id="cb6-19">    commits_query,</span>
<span id="cb6-20">    stargazers_query,</span>
<span id="cb6-21">    watchers_query,</span>
<span id="cb6-22">)</span>
<span id="cb6-23"></span>
<span id="cb6-24"></span>
<span id="cb6-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># main function</span></span>
<span id="cb6-26"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> main():</span>
<span id="cb6-27">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># load environment variables</span></span>
<span id="cb6-28">    load_dotenv()</span>
<span id="cb6-29"></span>
<span id="cb6-30">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ingest data</span></span>
<span id="cb6-31">    ingest_zulip()</span>
<span id="cb6-32">    ingest_pypi()</span>
<span id="cb6-33">    ingest_gh()</span>
<span id="cb6-34">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ingest_ci() # </span><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">TODO</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: fix permissions, add assets</span></span>
<span id="cb6-35"></span>
<span id="cb6-36"></span>
<span id="cb6-37"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># helper functions</span></span>
<span id="cb6-38"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> write_json(data, filename):</span>
<span id="cb6-39">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># write the data to a file</span></span>
<span id="cb6-40">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(filename, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"w"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb6-41">        json.dump(data, f, indent<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb6-42"></span>
<span id="cb6-43"></span>
<span id="cb6-44"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ingest functions</span></span>
<span id="cb6-45"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> ingest_gh():</span>
<span id="cb6-46">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb6-47"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Ingest the GitHub data.</span></span>
<span id="cb6-48"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb6-49">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># configure logger</span></span>
<span id="cb6-50">    log.basicConfig(level<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>log.INFO)</span>
<span id="cb6-51"></span>
<span id="cb6-52">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># constants</span></span>
<span id="cb6-53">    GRAPH_URL <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://api.github.com/graphql"</span></span>
<span id="cb6-54"></span>
<span id="cb6-55">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># load environment variables</span></span>
<span id="cb6-56">    GH_TOKEN <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GITHUB_TOKEN"</span>)</span>
<span id="cb6-57"></span>
<span id="cb6-58">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># load config</span></span>
<span id="cb6-59">    config <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> toml.load(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"config.toml"</span>)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ingest"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"github"</span>]</span>
<span id="cb6-60">    log.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Using repos: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>config[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'repos'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-61"></span>
<span id="cb6-62">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># construct header</span></span>
<span id="cb6-63">    headers <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb6-64">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Authorization"</span>: <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Bearer </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>GH_TOKEN<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb6-65">    }</span>
<span id="cb6-66"></span>
<span id="cb6-67">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># map queries</span></span>
<span id="cb6-68">    queries <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb6-69">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"issues"</span>: issues_query,</span>
<span id="cb6-70">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pullRequests"</span>: pulls_query,</span>
<span id="cb6-71">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"commits"</span>: commits_query,</span>
<span id="cb6-72">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"forks"</span>: forks_query,</span>
<span id="cb6-73">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stargazers"</span>: stargazers_query,</span>
<span id="cb6-74">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"watchers"</span>: watchers_query,</span>
<span id="cb6-75">    }</span>
<span id="cb6-76"></span>
<span id="cb6-77">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># define helper functions</span></span>
<span id="cb6-78">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_filename(query_name, page):</span>
<span id="cb6-79">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># return the filename</span></span>
<span id="cb6-80">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>query_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">.</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>page<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:06}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">.json"</span></span>
<span id="cb6-81"></span>
<span id="cb6-82">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_next_link(link_header):</span>
<span id="cb6-83">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># if there is no link header, return None</span></span>
<span id="cb6-84">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> link_header <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">is</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb6-85">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb6-86"></span>
<span id="cb6-87">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># split the link header into links</span></span>
<span id="cb6-88">        links <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> link_header.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">", "</span>)</span>
<span id="cb6-89">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> link <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> links:</span>
<span id="cb6-90">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># split the link into segments</span></span>
<span id="cb6-91">            segments <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> link.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"; "</span>)</span>
<span id="cb6-92"></span>
<span id="cb6-93">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># if there are two segments and the second segment is rel="next"</span></span>
<span id="cb6-94">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(segments) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> segments[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'rel="next"'</span>:</span>
<span id="cb6-95">                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># remove the &lt; and &gt; around the link</span></span>
<span id="cb6-96">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> segments[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].strip(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;&gt;"</span>)</span>
<span id="cb6-97"></span>
<span id="cb6-98">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># if there is no next link, return None</span></span>
<span id="cb6-99">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb6-100"></span>
<span id="cb6-101">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> fetch_data(client, owner, repo, query_name, query, output_dir, num_items<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>):</span>
<span id="cb6-102">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initialize variables</span></span>
<span id="cb6-103">        variables <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb6-104">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"owner"</span>: owner,</span>
<span id="cb6-105">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"repo"</span>: repo,</span>
<span id="cb6-106">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"num_items"</span>: num_items,</span>
<span id="cb6-107">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"before"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"null"</span>,</span>
<span id="cb6-108">        }</span>
<span id="cb6-109"></span>
<span id="cb6-110">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initialize page number</span></span>
<span id="cb6-111">        page <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb6-112"></span>
<span id="cb6-113">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># while True</span></span>
<span id="cb6-114">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">while</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>:</span>
<span id="cb6-115">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># request data</span></span>
<span id="cb6-116">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span>:</span>
<span id="cb6-117">                log.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t\t</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Fetching page </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>page<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">..."</span>)</span>
<span id="cb6-118">                resp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> requests.post(</span>
<span id="cb6-119">                    GRAPH_URL,</span>
<span id="cb6-120">                    headers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>headers,</span>
<span id="cb6-121">                    json<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"query"</span>: query, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"variables"</span>: variables},</span>
<span id="cb6-122">                )</span>
<span id="cb6-123">                json_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> resp.json()</span>
<span id="cb6-124"></span>
<span id="cb6-125">                log.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t\t\t</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Status code: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>resp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>status_code<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-126">                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># log.info(f"\t\t\tResponse: {resp.text}")</span></span>
<span id="cb6-127">                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># log.info(f"\t\t\tJSON: {json_data}")</span></span>
<span id="cb6-128"></span>
<span id="cb6-129">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> resp.status_code <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>:</span>
<span id="cb6-130">                    log.error(</span>
<span id="cb6-131">                        <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t\t</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Failed to fetch data for </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>owner<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>repo<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">; url=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>GRAPH_URL<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>resp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>status_code<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>resp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb6-132">                    )</span>
<span id="cb6-133">                    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span></span>
<span id="cb6-134"></span>
<span id="cb6-135">                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># extract data</span></span>
<span id="cb6-136">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> query_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"commits"</span>:</span>
<span id="cb6-137">                    data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> json_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"repository"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"defaultBranchRef"</span>][</span>
<span id="cb6-138">                        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"target"</span></span>
<span id="cb6-139">                    ][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"history"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"edges"</span>]</span>
<span id="cb6-140">                    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get the next link</span></span>
<span id="cb6-141">                    cursor <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> json_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"repository"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"defaultBranchRef"</span>][</span>
<span id="cb6-142">                        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"target"</span></span>
<span id="cb6-143">                    ][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"history"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pageInfo"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"endCursor"</span>]</span>
<span id="cb6-144">                    has_next_page <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> json_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"repository"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"defaultBranchRef"</span>][</span>
<span id="cb6-145">                        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"target"</span></span>
<span id="cb6-146">                    ][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"history"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pageInfo"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hasNextPage"</span>]</span>
<span id="cb6-147"></span>
<span id="cb6-148">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb6-149">                    data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> json_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"repository"</span>][query_name][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"edges"</span>]</span>
<span id="cb6-150">                    cursor <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> json_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"repository"</span>][query_name][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pageInfo"</span>][</span>
<span id="cb6-151">                        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"endCursor"</span></span>
<span id="cb6-152">                    ]</span>
<span id="cb6-153">                    has_next_page <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> json_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"repository"</span>][query_name][</span>
<span id="cb6-154">                        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pageInfo"</span></span>
<span id="cb6-155">                    ][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hasNextPage"</span>]</span>
<span id="cb6-156"></span>
<span id="cb6-157">                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># save json to a file</span></span>
<span id="cb6-158">                filename <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_filename(query_name, page)</span>
<span id="cb6-159">                output_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.path.join(output_dir, filename)</span>
<span id="cb6-160">                log.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t\t</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Writing data to </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>output_path<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-161">                write_json(data, output_path)</span>
<span id="cb6-162"></span>
<span id="cb6-163">                variables[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cursor"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>cursor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb6-164">                <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"has_next_page=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>has_next_page<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-165">                <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"cursor=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>cursor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-166">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> has_next_page:</span>
<span id="cb6-167">                    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">break</span></span>
<span id="cb6-168"></span>
<span id="cb6-169">                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># increment page number</span></span>
<span id="cb6-170">                page <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb6-171">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span>:</span>
<span id="cb6-172">                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print error if response</span></span>
<span id="cb6-173">                log.error(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t\t</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Failed to fetch data for </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>owner<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>repo<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-174"></span>
<span id="cb6-175">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span>:</span>
<span id="cb6-176">                    log.error(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t\t\t</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Response: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>resp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-177">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span>:</span>
<span id="cb6-178">                    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb6-179"></span>
<span id="cb6-180">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">break</span></span>
<span id="cb6-181"></span>
<span id="cb6-182">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create a requests session</span></span>
<span id="cb6-183">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> requests.Session() <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> client:</span>
<span id="cb6-184">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> repo <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> config[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"repos"</span>]:</span>
<span id="cb6-185">            log.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Fetching data for </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>repo<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">..."</span>)</span>
<span id="cb6-186">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> query <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> queries:</span>
<span id="cb6-187">                owner, repo_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> repo.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/"</span>)</span>
<span id="cb6-188">                output_dir <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.path.join(</span>
<span id="cb6-189">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>,</span>
<span id="cb6-190">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ingest"</span>,</span>
<span id="cb6-191">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"github"</span>,</span>
<span id="cb6-192">                    owner,</span>
<span id="cb6-193">                    repo_name,</span>
<span id="cb6-194">                )</span>
<span id="cb6-195">                os.makedirs(output_dir, exist_ok<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb6-196">                log.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Fetching data for </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>owner<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>repo_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>query<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">..."</span>)</span>
<span id="cb6-197">                fetch_data(client, owner, repo_name, query, queries[query], output_dir)</span>
<span id="cb6-198"></span>
<span id="cb6-199"></span>
<span id="cb6-200"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> ingest_pypi():</span>
<span id="cb6-201">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb6-202"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Ingest the PyPI data.</span></span>
<span id="cb6-203"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb6-204">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># constants</span></span>
<span id="cb6-205">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set DEFAULT_BACKFILL to the number of days</span></span>
<span id="cb6-206">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># since July 19th, 2015 until today</span></span>
<span id="cb6-207">    DEFAULT_BACKFILL <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (datetime.now() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> datetime(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2015</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>)).days</span>
<span id="cb6-208">    BIGQUERY_DATASET <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bigquery-public-data.pypi.file_downloads"</span></span>
<span id="cb6-209"></span>
<span id="cb6-210">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># configure logger</span></span>
<span id="cb6-211">    log.basicConfig(level<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>log.INFO)</span>
<span id="cb6-212"></span>
<span id="cb6-213">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># load environment variables</span></span>
<span id="cb6-214">    project_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BQ_PROJECT_ID"</span>)</span>
<span id="cb6-215">    log.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Project ID: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>project_id<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-216"></span>
<span id="cb6-217">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># load config</span></span>
<span id="cb6-218">    config <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> toml.load(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"config.toml"</span>)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ingest"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pypi"</span>]</span>
<span id="cb6-219">    log.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Packages: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>config[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'packages'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-220"></span>
<span id="cb6-221">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># configure lookback window</span></span>
<span id="cb6-222">    backfill <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> config[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"backfill"</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"backfill"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> config <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> DEFAULT_BACKFILL</span>
<span id="cb6-223">    log.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Backfill: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>backfill<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-224"></span>
<span id="cb6-225">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for each package</span></span>
<span id="cb6-226">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> package <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> config[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"packages"</span>]:</span>
<span id="cb6-227">        log.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Package: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>package<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-228">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create output directory</span></span>
<span id="cb6-229">        output_dir <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.path.join(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ingest"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pypi"</span>, package)</span>
<span id="cb6-230">        os.makedirs(output_dir, exist_ok<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb6-231"></span>
<span id="cb6-232">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># construct query</span></span>
<span id="cb6-233">        query <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"""</span></span>
<span id="cb6-234"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        SELECT *</span></span>
<span id="cb6-235"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        FROM `</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>BIGQUERY_DATASET<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span></span>
<span id="cb6-236"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        WHERE file.project = '</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>package<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span></span>
<span id="cb6-237"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        AND DATE(timestamp)</span></span>
<span id="cb6-238"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        BETWEEN DATE_SUB(CURRENT_DATE(), INTERVAL </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>backfill<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> DAY)</span></span>
<span id="cb6-239"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        AND CURRENT_DATE()</span></span>
<span id="cb6-240"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        """</span>.strip()</span>
<span id="cb6-241">        query <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> inspect.cleandoc(query)</span>
<span id="cb6-242"></span>
<span id="cb6-243">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># connect to bigquery and execute query</span></span>
<span id="cb6-244">        con <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"bigquery://</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>project_id<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-245">        log.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Executing query:</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>query<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-246">        t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> con.sql(query)</span>
<span id="cb6-247"></span>
<span id="cb6-248">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># write to parquet</span></span>
<span id="cb6-249">        filename <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"file_downloads.parquet"</span></span>
<span id="cb6-250">        output_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.path.join(output_dir, filename)</span>
<span id="cb6-251">        log.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Writing to: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>output_path<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-252">        t.to_parquet(output_path)</span>
<span id="cb6-253"></span>
<span id="cb6-254"></span>
<span id="cb6-255"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> ingest_ci():</span>
<span id="cb6-256">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb6-257"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Ingest the CI data.</span></span>
<span id="cb6-258"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb6-259">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># constants</span></span>
<span id="cb6-260">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set DEFAULT_BACKFILL to the number of days</span></span>
<span id="cb6-261">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># since July 19th, 2015 until today</span></span>
<span id="cb6-262">    DEFAULT_BACKFILL <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (datetime.now() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> datetime(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2015</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>)).days</span>
<span id="cb6-263"></span>
<span id="cb6-264">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># configure logger</span></span>
<span id="cb6-265">    log.basicConfig(level<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>log.INFO)</span>
<span id="cb6-266"></span>
<span id="cb6-267">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># load environment variables</span></span>
<span id="cb6-268">    project_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BQ_PROJECT_ID"</span>)</span>
<span id="cb6-269">    log.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Project ID: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>project_id<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-270"></span>
<span id="cb6-271">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># load config</span></span>
<span id="cb6-272">    config <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> toml.load(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"config.toml"</span>)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ingest"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ci"</span>]</span>
<span id="cb6-273"></span>
<span id="cb6-274">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># configure lookback window</span></span>
<span id="cb6-275">    backfill <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> config[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"backfill"</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"backfill"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> config <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> DEFAULT_BACKFILL</span>
<span id="cb6-276">    log.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Backfill: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>backfill<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-277"></span>
<span id="cb6-278">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># make sure the data directory exists</span></span>
<span id="cb6-279">    os.makedirs(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/ingest/ci/ibis"</span>, exist_ok<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb6-280"></span>
<span id="cb6-281">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># connect to databases</span></span>
<span id="cb6-282">    con <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"duckdb://data/ingest/ci/ibis/raw.ddb"</span>)</span>
<span id="cb6-283">    bq_con <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"bigquery://</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>project_id<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/workflows"</span>)</span>
<span id="cb6-284"></span>
<span id="cb6-285">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># copy over tables</span></span>
<span id="cb6-286">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> table <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> bq_con.list_tables():</span>
<span id="cb6-287">        log.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Writing table: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>table<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-288">        con.create_table(table, bq_con.table(table).to_pyarrow(), overwrite<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb6-289"></span>
<span id="cb6-290"></span>
<span id="cb6-291"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> ingest_zulip():</span>
<span id="cb6-292">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Ingest the Zulip data."""</span></span>
<span id="cb6-293">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># constants</span></span>
<span id="cb6-294">    email <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cody@dkdc.dev"</span></span>
<span id="cb6-295"></span>
<span id="cb6-296">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># load config</span></span>
<span id="cb6-297">    config <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> toml.load(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"config.toml"</span>)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ingest"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"zulip"</span>]</span>
<span id="cb6-298">    log.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Using url: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>config[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'url'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-299"></span>
<span id="cb6-300">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># configure logger</span></span>
<span id="cb6-301">    log.basicConfig(level<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>log.INFO)</span>
<span id="cb6-302"></span>
<span id="cb6-303">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># load environment variables</span></span>
<span id="cb6-304">    zulip_key <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ZULIP_KEY"</span>)</span>
<span id="cb6-305"></span>
<span id="cb6-306">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create the client</span></span>
<span id="cb6-307">    client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> zulip.Client(email<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>email, site<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>config[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"url"</span>], api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>zulip_key)</span>
<span id="cb6-308"></span>
<span id="cb6-309">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get the users</span></span>
<span id="cb6-310">    r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> client.get_members()</span>
<span id="cb6-311">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> r[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"result"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"success"</span>:</span>
<span id="cb6-312">        log.error(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Failed to get users: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>r<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-313">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb6-314">        members <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> r[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"members"</span>]</span>
<span id="cb6-315">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># make sure the directory exists</span></span>
<span id="cb6-316">        os.makedirs(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/ingest/zulip"</span>, exist_ok<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb6-317"></span>
<span id="cb6-318">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># write the users to a file</span></span>
<span id="cb6-319">        filename <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"members.json"</span></span>
<span id="cb6-320">        output_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.path.join(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ingest"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"zulip"</span>, filename)</span>
<span id="cb6-321">        log.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Writing members to: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>output_path<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-322">        write_json(members, output_path)</span>
<span id="cb6-323"></span>
<span id="cb6-324">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get the messages</span></span>
<span id="cb6-325">    all_messages <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb6-326">    r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> client.get_messages(</span>
<span id="cb6-327">        {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"anchor"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"newest"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"num_before"</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"num_after"</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stream"</span>}</span>
<span id="cb6-328">    )</span>
<span id="cb6-329">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> r[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"result"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"success"</span>:</span>
<span id="cb6-330">        log.error(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Failed to get messages: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>r<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-331">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb6-332">        messages <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> r[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"messages"</span>]</span>
<span id="cb6-333">        all_messages.extend(messages)</span>
<span id="cb6-334">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">while</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(messages) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:</span>
<span id="cb6-335">            r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> client.get_messages(</span>
<span id="cb6-336">                {</span>
<span id="cb6-337">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"anchor"</span>: messages[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span>],</span>
<span id="cb6-338">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"num_before"</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,</span>
<span id="cb6-339">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"num_after"</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb6-340">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stream"</span>,</span>
<span id="cb6-341">                }</span>
<span id="cb6-342">            )</span>
<span id="cb6-343">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> r[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"result"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"success"</span>:</span>
<span id="cb6-344">                log.error(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Failed to get messages: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>r<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-345">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">break</span></span>
<span id="cb6-346">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb6-347">                messages <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> r[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"messages"</span>]</span>
<span id="cb6-348">                all_messages.extend(messages)</span>
<span id="cb6-349"></span>
<span id="cb6-350">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># make sure the directory exists</span></span>
<span id="cb6-351">        os.makedirs(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/ingest/zulip"</span>, exist_ok<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb6-352"></span>
<span id="cb6-353">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># write the messages to a file</span></span>
<span id="cb6-354">        filename <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"messages.json"</span></span>
<span id="cb6-355">        output_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.path.join(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ingest"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"zulip"</span>, filename)</span>
<span id="cb6-356">        log.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Writing messages to: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>output_path<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-357">        write_json(all_messages, output_path)</span>
<span id="cb6-358"></span>
<span id="cb6-359"></span>
<span id="cb6-360"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">__name__</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"__main__"</span>:</span>
<span id="cb6-361">    main()</span></code></pre></div>
</details>
<p>Python’s <code>requests</code> module is used for web API calls to GitHub’s REST and GraphQL APIs. The Zulip Python client is used for extracting data from there. Both of these sets of data are saved as JSON files, which we can read in with the Ibis DuckDB or other local backends.</p>
<p>The PyPI data is extracted using Ibis from BigQuery using raw SQL strings and saved as Parquet files. This is over ten million rows of data for the main Ibis package, so it takes a few minutes to run. We can also read in the Parquet files with Ibis.</p>
</section>
<section id="extract-transform-load-etl" class="level2">
<h2 class="anchored" data-anchor-id="extract-transform-load-etl">Extract, transform, load (ETL)</h2>
<p>It’s fun to <code>just run</code> and watch my system usage spike as DuckDB goes brrrrr:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ibis-project.org/posts/ibis-analytics/top.png" class="img-fluid figure-img"></p>
<figcaption>System usage</figcaption>
</figure>
</div>
<p>This executes the entire Dagster DAG, processing over 10 million rows of data in under a minute on my laptop.</p>
<section id="directed-acyclic-graph-dag-and-inputoutput-management" class="level3">
<h3 class="anchored" data-anchor-id="directed-acyclic-graph-dag-and-inputoutput-management">Directed acyclic graph (DAG) and input/output management</h3>
<p>We use Dagster to manage the ETL pipeline. I chose Dagster to try something new and I like its software-defined assets. Relationships between them in the DAG don’t need to be explicitly defined, and rather are inferred from function names and input parameters. Outside of the input/output management code (shown below), there is almost no Dagster-specific code other than some Python decorators. The rest is just Python code, using Ibis for data processing.</p>
<p>We can <code>just dag</code> and view the DAG in a web browser with the Dagster GUI:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ibis-project.org/posts/ibis-analytics/dag.png" class="img-fluid figure-img"></p>
<figcaption>Dagster GUI</figcaption>
</figure>
</div>
<p>Since this pipeline is so simple, there are no joins and thus no assets with multiple inputs. Of course, joins and other more complex operations are possible with Ibis.</p>
<p>The DAG is defined in the <code>assets</code> directory, separated into the three conventional ETL stages:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dag/assets/</span></span>
<span id="cb7-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> __init__.py</span>
<span id="cb7-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> extract/</span>
<span id="cb7-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── __init__.py</span>
<span id="cb7-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── backends.py</span>
<span id="cb7-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── github.py</span>
<span id="cb7-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── pypi.py</span>
<span id="cb7-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── zulip.py</span>
<span id="cb7-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> load/</span>
<span id="cb7-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── __init__.py</span>
<span id="cb7-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── backends.py</span>
<span id="cb7-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── github.py</span>
<span id="cb7-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── pypi.py</span>
<span id="cb7-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── zulip.py</span>
<span id="cb7-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> transform/</span>
<span id="cb7-16">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> __init__.py</span>
<span id="cb7-17">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> backends.py</span>
<span id="cb7-18">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> github.py</span>
<span id="cb7-19">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> pypi.py</span>
<span id="cb7-20">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> zulip.py</span></code></pre></div>
<p>Ibis makes data input/output management easy with file formats or tables in backends. I define some table IO managers and use the <code>DuckDBIOManager</code> as the default for the project.</p>
<details>
<summary>
Show the input/output management code
</summary>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb8-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis</span>
<span id="cb8-3"></span>
<span id="cb8-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dagster <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ConfigurableIOManager</span>
<span id="cb8-5"></span>
<span id="cb8-6"></span>
<span id="cb8-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> ParquetIOManager(ConfigurableIOManager):</span>
<span id="cb8-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb8-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Manage tables as parquet files.</span></span>
<span id="cb8-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb8-11"></span>
<span id="cb8-12">    extension: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"parquet"</span></span>
<span id="cb8-13">    base_path: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.path.join(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"system"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"parquet"</span>)</span>
<span id="cb8-14"></span>
<span id="cb8-15">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> handle_output(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, context, obj):</span>
<span id="cb8-16">        dirname, filename <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._get_paths(context)</span>
<span id="cb8-17">        os.makedirs(dirname, exist_ok<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb8-18">        output_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.path.join(dirname, filename)</span>
<span id="cb8-19">        obj.to_parquet(output_path)</span>
<span id="cb8-20"></span>
<span id="cb8-21">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> load_input(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, context):</span>
<span id="cb8-22">        dirname, filename <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._get_paths(context)</span>
<span id="cb8-23">        input_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.path.join(dirname, filename)</span>
<span id="cb8-24">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> ibis.read_parquet(input_path)</span>
<span id="cb8-25"></span>
<span id="cb8-26">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _get_paths(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, context):</span>
<span id="cb8-27">        group_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> context.step_context.job_def.asset_layer.assets_def_for_asset(</span>
<span id="cb8-28">            context.asset_key</span>
<span id="cb8-29">        ).group_names_by_key[context.asset_key]</span>
<span id="cb8-30">        dirname <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.path.join(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.base_path, group_name, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>context.asset_key.path[:<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb8-31">        filename <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>context<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>asset_key<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>path[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">.</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>extension<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb8-32">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> dirname, filename</span>
<span id="cb8-33"></span>
<span id="cb8-34"></span>
<span id="cb8-35"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> DeltaIOManager(ConfigurableIOManager):</span>
<span id="cb8-36">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb8-37"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Manage tables as delta tables.</span></span>
<span id="cb8-38"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb8-39"></span>
<span id="cb8-40">    extension: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"delta"</span></span>
<span id="cb8-41">    base_path: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.path.join(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"system"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"delta"</span>)</span>
<span id="cb8-42">    delta_write_mode: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"overwrite"</span></span>
<span id="cb8-43"></span>
<span id="cb8-44">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> handle_output(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, context, obj):</span>
<span id="cb8-45">        dirname, filename <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._get_paths(context)</span>
<span id="cb8-46">        os.makedirs(dirname, exist_ok<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb8-47">        output_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.path.join(dirname, filename)</span>
<span id="cb8-48">        obj.to_delta(output_path, mode<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.delta_write_mode)</span>
<span id="cb8-49"></span>
<span id="cb8-50">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> load_input(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, context):</span>
<span id="cb8-51">        dirname, filename <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._get_paths(context)</span>
<span id="cb8-52">        input_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.path.join(dirname, filename)</span>
<span id="cb8-53">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> ibis.read_delta(input_path)</span>
<span id="cb8-54"></span>
<span id="cb8-55">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _get_paths(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, context):</span>
<span id="cb8-56">        group_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> context.step_context.job_def.asset_layer.assets_def_for_asset(</span>
<span id="cb8-57">            context.asset_key</span>
<span id="cb8-58">        ).group_names_by_key[context.asset_key]</span>
<span id="cb8-59">        dirname <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.path.join(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.base_path, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>context.asset_key.path)</span>
<span id="cb8-60">        filename <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>context<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>asset_key<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>path[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">.</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>extension<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb8-61">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> dirname, filename</span>
<span id="cb8-62"></span>
<span id="cb8-63"></span>
<span id="cb8-64"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> DuckDBIOManager(ConfigurableIOManager):</span>
<span id="cb8-65">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb8-66"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Manage tables as duckdb files.</span></span>
<span id="cb8-67"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb8-68"></span>
<span id="cb8-69">    extension: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ddb"</span></span>
<span id="cb8-70">    base_path: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.path.join(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"system"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"duckdb"</span>)</span>
<span id="cb8-71"></span>
<span id="cb8-72">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> handle_output(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, context, obj):</span>
<span id="cb8-73">        dirname, filename <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._get_paths(context)</span>
<span id="cb8-74">        os.makedirs(dirname, exist_ok<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb8-75">        output_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.path.join(dirname, filename)</span>
<span id="cb8-76">        con <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.duckdb.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>(output_path)</span>
<span id="cb8-77">        con.create_table(context.asset_key.path[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], obj.to_pyarrow(), overwrite<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb8-78"></span>
<span id="cb8-79">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> load_input(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, context):</span>
<span id="cb8-80">        dirname, filename <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._get_paths(context)</span>
<span id="cb8-81">        input_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.path.join(dirname, filename)</span>
<span id="cb8-82">        con <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.duckdb.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>(input_path)</span>
<span id="cb8-83">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> con.table(context.asset_key.path[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb8-84"></span>
<span id="cb8-85">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _get_paths(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, context):</span>
<span id="cb8-86">        group_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> context.step_context.job_def.asset_layer.assets_def_for_asset(</span>
<span id="cb8-87">            context.asset_key</span>
<span id="cb8-88">        ).group_names_by_key[context.asset_key]</span>
<span id="cb8-89">        dirname <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.path.join(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.base_path, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>context.asset_key.path)</span>
<span id="cb8-90">        filename <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>context<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>asset_key<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>path[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">.</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>extension<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb8-91">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> dirname, filename</span></code></pre></div>
</details>
<p>With this setup, we can swap file formats or backends for storage as desired. After executing the DAG, the following data is written to our local filesystem:</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">data/system/</span></span>
<span id="cb9-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> duckdb/</span>
<span id="cb9-3">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> extract_backends/</span>
<span id="cb9-4">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── extract_backends.ddb</span>
<span id="cb9-5">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> extract_commits/</span>
<span id="cb9-6">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── extract_commits.ddb</span>
<span id="cb9-7">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> extract_downloads/</span>
<span id="cb9-8">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── extract_downloads.ddb</span>
<span id="cb9-9">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> extract_forks/</span>
<span id="cb9-10">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── extract_forks.ddb</span>
<span id="cb9-11">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> extract_issues/</span>
<span id="cb9-12">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── extract_issues.ddb</span>
<span id="cb9-13">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> extract_pulls/</span>
<span id="cb9-14">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── extract_pulls.ddb</span>
<span id="cb9-15">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> extract_stars/</span>
<span id="cb9-16">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── extract_stars.ddb</span>
<span id="cb9-17">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> extract_watchers/</span>
<span id="cb9-18">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── extract_watchers.ddb</span>
<span id="cb9-19">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> extract_zulip_members/</span>
<span id="cb9-20">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── extract_zulip_members.ddb</span>
<span id="cb9-21">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> extract_zulip_messages/</span>
<span id="cb9-22">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── extract_zulip_messages.ddb</span>
<span id="cb9-23">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> load_backends/</span>
<span id="cb9-24">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── load_backends.ddb</span>
<span id="cb9-25">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> load_commits/</span>
<span id="cb9-26">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── load_commits.ddb</span>
<span id="cb9-27">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> load_downloads/</span>
<span id="cb9-28">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── load_downloads.ddb</span>
<span id="cb9-29">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> load_forks/</span>
<span id="cb9-30">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── load_forks.ddb</span>
<span id="cb9-31">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> load_issues/</span>
<span id="cb9-32">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── load_issues.ddb</span>
<span id="cb9-33">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> load_pulls/</span>
<span id="cb9-34">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── load_pulls.ddb</span>
<span id="cb9-35">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> load_stars/</span>
<span id="cb9-36">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── load_stars.ddb</span>
<span id="cb9-37">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> load_watchers/</span>
<span id="cb9-38">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── load_watchers.ddb</span>
<span id="cb9-39">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> load_zulip_members/</span>
<span id="cb9-40">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── load_zulip_members.ddb</span>
<span id="cb9-41">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> load_zulip_messages/</span>
<span id="cb9-42">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── load_zulip_messages.ddb</span>
<span id="cb9-43">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> transform_backends/</span>
<span id="cb9-44">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── transform_backends.ddb</span>
<span id="cb9-45">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> transform_commits/</span>
<span id="cb9-46">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── transform_commits.ddb</span>
<span id="cb9-47">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> transform_downloads/</span>
<span id="cb9-48">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── transform_downloads.ddb</span>
<span id="cb9-49">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> transform_forks/</span>
<span id="cb9-50">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── transform_forks.ddb</span>
<span id="cb9-51">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> transform_issues/</span>
<span id="cb9-52">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── transform_issues.ddb</span>
<span id="cb9-53">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> transform_pulls/</span>
<span id="cb9-54">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── transform_pulls.ddb</span>
<span id="cb9-55">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> transform_stars/</span>
<span id="cb9-56">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── transform_stars.ddb</span>
<span id="cb9-57">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> transform_watchers/</span>
<span id="cb9-58">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── transform_watchers.ddb</span>
<span id="cb9-59">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> transform_zulip_members/</span>
<span id="cb9-60">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── transform_zulip_members.ddb</span>
<span id="cb9-61">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> transform_zulip_messages/</span>
<span id="cb9-62">        <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> transform_zulip_messages.ddb</span></code></pre></div>
<p>We can change the configuration in the project to change these to Parquet or Delta Lake tables.</p>
<p>Common Python functions are defined in <code>dag/functions.py</code>, including a fancy user-defined function (UDF) for regex matching.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>A LLM wrote the entire <code>clean_version</code> function, I’m never writing a regex again.</p>
</div>
</div>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> re</span>
<span id="cb10-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis</span>
<span id="cb10-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime</span>
<span id="cb10-4"></span>
<span id="cb10-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis.selectors <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> s</span>
<span id="cb10-6"></span>
<span id="cb10-7"></span>
<span id="cb10-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># udfs</span></span>
<span id="cb10-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@ibis.udf.scalar.python</span></span>
<span id="cb10-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> clean_version(version: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, patch: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb10-11">    pattern <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"(\d+\.\d+\.\d+)"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> patch <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"(\d+\.\d+)"</span></span>
<span id="cb10-12">    match <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> re.search(pattern, version)</span>
<span id="cb10-13">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> match:</span>
<span id="cb10-14">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> match.group(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb10-15">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb10-16">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> version</span>
<span id="cb10-17"></span>
<span id="cb10-18"></span>
<span id="cb10-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># functions</span></span>
<span id="cb10-20"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> now():</span>
<span id="cb10-21">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> datetime.datetime.now()</span>
<span id="cb10-22"></span>
<span id="cb10-23"></span>
<span id="cb10-24"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> today():</span>
<span id="cb10-25">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> now().date()</span>
<span id="cb10-26"></span>
<span id="cb10-27"></span>
<span id="cb10-28"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> clean_data(t):</span>
<span id="cb10-29">    t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> t.rename(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"snake_case"</span>)</span>
<span id="cb10-30">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># t = t.mutate(s.across(s.of_type("timestamp"), lambda x: x.cast("timestamp('')")))</span></span>
<span id="cb10-31">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> t</span>
<span id="cb10-32"></span>
<span id="cb10-33"></span>
<span id="cb10-34"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> add_ingested_at(t, ingested_at<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>now()):</span>
<span id="cb10-35">    t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> t.mutate(ingested_at<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ingested_at).relocate(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ingested_at"</span>)</span>
<span id="cb10-36">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> t</span></code></pre></div>
<p>These are imported as <code>from dag import functions as f</code> by convention in the project.</p>
</section>
<section id="extract" class="level3">
<h3 class="anchored" data-anchor-id="extract">Extract</h3>
<p>We extract the data from the ingested files using Ibis with the default DuckDB backend.</p>
<p>The PyPI download data is in Parquet format:</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis</span>
<span id="cb11-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> dagster</span>
<span id="cb11-3"></span>
<span id="cb11-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dag <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> functions <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f</span>
<span id="cb11-5"></span>
<span id="cb11-6"></span>
<span id="cb11-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># assets</span></span>
<span id="cb11-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@dagster.asset</span></span>
<span id="cb11-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> extract_downloads():</span>
<span id="cb11-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb11-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Extract the ingested PyPI downloads data.</span></span>
<span id="cb11-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb11-13">    downloads <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f.clean_data(</span>
<span id="cb11-14">        ibis.read_parquet(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/ingest/pypi/ibis-framework/*.parquet"</span>)</span>
<span id="cb11-15">    )</span>
<span id="cb11-16">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> downloads</span></code></pre></div>
<p>While the GitHub (omitted for brevity) and Zulip data is in JSON format:</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis</span>
<span id="cb12-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> dagster</span>
<span id="cb12-3"></span>
<span id="cb12-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dag <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> functions <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f</span>
<span id="cb12-5"></span>
<span id="cb12-6"></span>
<span id="cb12-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># assets</span></span>
<span id="cb12-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@dagster.asset</span></span>
<span id="cb12-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> extract_zulip_members():</span>
<span id="cb12-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb12-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Extract the ingested Zulip members data.</span></span>
<span id="cb12-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb12-13">    members <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f.clean_data(ibis.read_json(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/ingest/zulip/members.json"</span>))</span>
<span id="cb12-14">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> members</span>
<span id="cb12-15"></span>
<span id="cb12-16"></span>
<span id="cb12-17"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@dagster.asset</span></span>
<span id="cb12-18"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> extract_zulip_messages():</span>
<span id="cb12-19">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb12-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Extract the ingested Zulip messages data.</span></span>
<span id="cb12-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb12-22">    messages <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f.clean_data(ibis.read_json(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/ingest/zulip/messages.json"</span>))</span>
<span id="cb12-23">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> messages</span></code></pre></div>
<p>As shown above, Dagster assets are configured to use the DuckDB table manager so the output of these functions are written to separate DuckDB database files for use downstream in the DAG.</p>
</section>
<section id="transform" class="level3">
<h3 class="anchored" data-anchor-id="transform">Transform</h3>
<p>With the data extracted, we can now transform it into its desired shape for downstream analytics. The most interesting transformation code is the PyPI data, shown here:</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis</span>
<span id="cb13-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> dagster</span>
<span id="cb13-3"></span>
<span id="cb13-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dag <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> functions <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f</span>
<span id="cb13-5"></span>
<span id="cb13-6"></span>
<span id="cb13-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># assets</span></span>
<span id="cb13-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@dagster.asset</span></span>
<span id="cb13-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> transform_downloads(extract_downloads):</span>
<span id="cb13-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb13-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Transform the PyPI downloads data.</span></span>
<span id="cb13-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb13-13">    downloads <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f.clean_data(</span>
<span id="cb13-14">        extract_downloads.drop(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"project"</span>).unpack(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"file"</span>).unpack(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"details"</span>)</span>
<span id="cb13-15">    )</span>
<span id="cb13-16">    downloads <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> downloads.mutate(</span>
<span id="cb13-17">        major_minor_patch<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>f.clean_version(downloads[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"version"</span>], patch<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>),</span>
<span id="cb13-18">        major_minor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>f.clean_version(downloads[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"version"</span>], patch<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>).cast(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"float"</span>),</span>
<span id="cb13-19">    )</span>
<span id="cb13-20">    downloads <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> downloads.rename(</span>
<span id="cb13-21">        {</span>
<span id="cb13-22">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"version_raw"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"version"</span>,</span>
<span id="cb13-23">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"version"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major_minor_patch"</span>,</span>
<span id="cb13-24">        }</span>
<span id="cb13-25">    )</span>
<span id="cb13-26">    downloads <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb13-27">        downloads.group_by(</span>
<span id="cb13-28">            [</span>
<span id="cb13-29">                ibis._.timestamp.truncate(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D"</span>).name(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"timestamp"</span>),</span>
<span id="cb13-30">                ibis._.country_code,</span>
<span id="cb13-31">                ibis._.version,</span>
<span id="cb13-32">                ibis._.python,</span>
<span id="cb13-33">                ibis._.system[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>].name(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"system"</span>),</span>
<span id="cb13-34">            ]</span>
<span id="cb13-35">        )</span>
<span id="cb13-36">        .agg(</span>
<span id="cb13-37">            ibis._.count().name(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"downloads"</span>),</span>
<span id="cb13-38">        )</span>
<span id="cb13-39">        .order_by(ibis._.timestamp.desc())</span>
<span id="cb13-40">        .mutate(</span>
<span id="cb13-41">            ibis._.downloads.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>()</span>
<span id="cb13-42">            .over(</span>
<span id="cb13-43">                rows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>),</span>
<span id="cb13-44">                group_by<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"country_code"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"version"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"python"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"system"</span>],</span>
<span id="cb13-45">                order_by<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ibis._.timestamp.desc(),</span>
<span id="cb13-46">            )</span>
<span id="cb13-47">            .name(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"total_downloads"</span>)</span>
<span id="cb13-48">        )</span>
<span id="cb13-49">        .order_by(ibis._.timestamp.desc())</span>
<span id="cb13-50">    )</span>
<span id="cb13-51">    downloads <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> downloads.mutate(ibis._[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"python"</span>].fillna(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>).name(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"python_full"</span>))</span>
<span id="cb13-52">    downloads <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> downloads.mutate(</span>
<span id="cb13-53">        f.clean_version(downloads[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"python_full"</span>], patch<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>).name(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"python"</span>)</span>
<span id="cb13-54">    )</span>
<span id="cb13-55">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> downloads</span></code></pre></div>
<p>Like the extract stage, the output of the transform stage is written to DuckDB database files for use downstream in the DAG.</p>
</section>
<section id="load" class="level3">
<h3 class="anchored" data-anchor-id="load">Load</h3>
<p>Honestly this step isn’t doing anything. It could use Ibis to directly upload the tables to MotherDuck, but as implemented these assets are just passing through the transformed data. This is a bit wasteful but allows for a three-stage DAG that conforms to the ETL paradigm.</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis</span>
<span id="cb14-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> dagster</span>
<span id="cb14-3"></span>
<span id="cb14-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dag <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> functions <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f</span>
<span id="cb14-5"></span>
<span id="cb14-6"></span>
<span id="cb14-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># assets</span></span>
<span id="cb14-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@dagster.asset</span></span>
<span id="cb14-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> load_downloads(transform_downloads):</span>
<span id="cb14-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb14-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Finalize the PyPI downloads data.</span></span>
<span id="cb14-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb14-13">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> transform_downloads</span></code></pre></div>
</section>
</section>
<section id="postprocess" class="level2">
<h2 class="anchored" data-anchor-id="postprocess">Postprocess</h2>
<p>We run a postprocessing script to combine the separate data into a single DuckDB database. This step is not necessary, but it makes it easier to query the data locally from a single Ibis connection.</p>
<details>
<summary>
Show the postprocessing script
</summary>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb15-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis</span>
<span id="cb15-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> fnmatch</span>
<span id="cb15-4"></span>
<span id="cb15-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> logging <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> log</span>
<span id="cb15-6"></span>
<span id="cb15-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> datetime <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime, timedelta, date</span>
<span id="cb15-8"></span>
<span id="cb15-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## local imports</span></span>
<span id="cb15-10"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dag <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> functions <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f</span>
<span id="cb15-11"></span>
<span id="cb15-12"></span>
<span id="cb15-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> main():</span>
<span id="cb15-14">    postprocess()</span>
<span id="cb15-15"></span>
<span id="cb15-16"></span>
<span id="cb15-17"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> postprocess() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb15-18">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb15-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Postprocess the data.</span></span>
<span id="cb15-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb15-21">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># configure logger</span></span>
<span id="cb15-22">    log.basicConfig(</span>
<span id="cb15-23">        level<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>log.INFO,</span>
<span id="cb15-24">    )</span>
<span id="cb15-25"></span>
<span id="cb15-26">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># backup loaded data as Delta Lake tables and a DuckDB database</span></span>
<span id="cb15-27">    source_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/system/duckdb"</span></span>
<span id="cb15-28">    target_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/data.ddb"</span></span>
<span id="cb15-29"></span>
<span id="cb15-30">    os.makedirs(source_path, exist_ok<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb15-31"></span>
<span id="cb15-32">    target <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.duckdb.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>(target_path)</span>
<span id="cb15-33"></span>
<span id="cb15-34">    ingested_at <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f.now()</span>
<span id="cb15-35"></span>
<span id="cb15-36">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> root, dirs, files <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> os.walk(source_path):</span>
<span id="cb15-37">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> files:</span>
<span id="cb15-38">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> fnmatch.fnmatch(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"load_*.ddb"</span>):</span>
<span id="cb15-39">                full_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.path.join(root, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span>)</span>
<span id="cb15-40">                con <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.duckdb.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>(full_path)</span>
<span id="cb15-41">                tablename <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span>.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".ddb"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb15-42">                table <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> con.table(tablename)</span>
<span id="cb15-43">                tablename <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tablename.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"load_"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb15-44"></span>
<span id="cb15-45">                log.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Backing up </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>tablename<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> to </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>target_path<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">..."</span>)</span>
<span id="cb15-46">                target.create_table(tablename, table.to_pyarrow(), overwrite<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb15-47"></span>
<span id="cb15-48">                log.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Backing up </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>tablename<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> to data/backup/</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>tablename<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">.delta..."</span>)</span>
<span id="cb15-49">                table.mutate(ingested_at<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ingested_at).to_delta(</span>
<span id="cb15-50">                    <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"data/backup/</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>tablename<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">.delta"</span>, mode<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"overwrite"</span></span>
<span id="cb15-51">                )</span>
<span id="cb15-52"></span>
<span id="cb15-53"></span>
<span id="cb15-54"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">__name__</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"__main__"</span>:</span>
<span id="cb15-55">    main()</span></code></pre></div>
</details>
<p>This script also backs up the data as Delta Lake tables for good measure. After this, our data directory looks like:</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">data/</span></span>
<span id="cb16-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> backup/</span>
<span id="cb16-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── backends.delta/</span>
<span id="cb16-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── commits.delta/</span>
<span id="cb16-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── downloads.delta/</span>
<span id="cb16-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── forks.delta/</span>
<span id="cb16-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── issues.delta/</span>
<span id="cb16-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── pulls.delta/</span>
<span id="cb16-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── stars.delta/</span>
<span id="cb16-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── watchers.delta/</span>
<span id="cb16-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── zulip_members.delta/</span>
<span id="cb16-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── zulip_messages.delta/</span>
<span id="cb16-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> data.ddb</span>
<span id="cb16-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> ingest/</span>
<span id="cb16-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── github/</span>
<span id="cb16-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── pypi/</span>
<span id="cb16-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── zulip/</span>
<span id="cb16-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> system/</span>
<span id="cb16-19">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> duckdb/</span></code></pre></div>
</section>
<section id="exploratory-data-analysis-eda-and-iteration" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-data-analysis-eda-and-iteration">Exploratory data analysis (EDA) and iteration</h2>
<p>While EDA is not part of the production pipeline, it is an essential part of the development workflow. The <code>config.toml</code> shown earlier makes it easy to switch between the local data or the production MotherDuck database.</p>
<p>The <code>eda.py</code> script in the root of the repo imports useful stuff and connects to the database with Ibis:</p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> re</span>
<span id="cb17-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb17-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> sys</span>
<span id="cb17-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> toml</span>
<span id="cb17-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis</span>
<span id="cb17-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> requests</span>
<span id="cb17-7"></span>
<span id="cb17-8"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> logging <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> log</span>
<span id="cb17-9"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> plotly.io <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pio</span>
<span id="cb17-10"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis.selectors <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> s</span>
<span id="cb17-11"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> plotly.express <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> px</span>
<span id="cb17-12"></span>
<span id="cb17-13"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> rich <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span></span>
<span id="cb17-14"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dotenv <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> load_dotenv</span>
<span id="cb17-15"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> datetime <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime, timedelta, date</span>
<span id="cb17-16"></span>
<span id="cb17-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## local imports</span></span>
<span id="cb17-18"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dag <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> functions <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f</span>
<span id="cb17-19"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dag.assets <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> extract, load, transform</span>
<span id="cb17-20"></span>
<span id="cb17-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># configuration</span></span>
<span id="cb17-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## logger</span></span>
<span id="cb17-23">log.basicConfig(level<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>log.INFO)</span>
<span id="cb17-24"></span>
<span id="cb17-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## config.toml</span></span>
<span id="cb17-26">config <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> toml.load(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"config.toml"</span>)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"eda"</span>]</span>
<span id="cb17-27"></span>
<span id="cb17-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## load .env file</span></span>
<span id="cb17-29">load_dotenv()</span>
<span id="cb17-30"></span>
<span id="cb17-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## ibis config</span></span>
<span id="cb17-32">ibis.options.interactive <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb17-33">ibis.options.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">repr</span>.interactive.max_rows <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span></span>
<span id="cb17-34">ibis.options.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">repr</span>.interactive.max_columns <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb17-35"></span>
<span id="cb17-36"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># variables</span></span>
<span id="cb17-37">NOW <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> datetime.now()</span>
<span id="cb17-38">NOW_7 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> NOW <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> timedelta(days<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb17-39">NOW_30 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> NOW <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> timedelta(days<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>)</span>
<span id="cb17-40">NOW_90 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> NOW <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> timedelta(days<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>)</span>
<span id="cb17-41">NOW_180 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> NOW <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> timedelta(days<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">180</span>)</span>
<span id="cb17-42">NOW_365 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> NOW <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> timedelta(days<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>)</span>
<span id="cb17-43">NOW_10 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> NOW <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> timedelta(days<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3650</span>)</span>
<span id="cb17-44"></span>
<span id="cb17-45"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># connect to database</span></span>
<span id="cb17-46">database <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> config[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"database"</span>]</span>
<span id="cb17-47">log.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"database: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>database<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb17-48">con <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"duckdb://</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>database<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<p>I can then <code>just eda</code> to open a quick iPython session and explore:</p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1">(venv) cody<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>voda ibis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>analytics <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> just eda</span>
<span id="cb18-2">Python <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.11.5</span> (main, Sep <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">51</span>) [Clang <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">14.0.3</span> (clang<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1403.0.22.14.1</span>)]</span>
<span id="cb18-3">Type <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'copyright'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'credits'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">or</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'license'</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> more information</span>
<span id="cb18-4">IPython <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.20.0</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> An enhanced Interactive Python. Type <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'?'</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">help</span>.</span>
<span id="cb18-5">INFO:root:database: md:ibis_analytics</span>
<span id="cb18-6"></span>
<span id="cb18-7">[ins] In [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]: con.list_tables()</span>
<span id="cb18-8">Out[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]:</span>
<span id="cb18-9">[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'backends'</span>,</span>
<span id="cb18-10"> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'commits'</span>,</span>
<span id="cb18-11"> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'downloads'</span>,</span>
<span id="cb18-12"> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'forks'</span>,</span>
<span id="cb18-13"> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'issues'</span>,</span>
<span id="cb18-14"> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'pulls'</span>,</span>
<span id="cb18-15"> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'stars'</span>,</span>
<span id="cb18-16"> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'watchers'</span>,</span>
<span id="cb18-17"> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'zulip_members'</span>,</span>
<span id="cb18-18"> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'zulip_messages'</span>]</span>
<span id="cb18-19"></span>
<span id="cb18-20">[ins] In [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]: t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> con.table(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stars"</span>)</span>
<span id="cb18-21"></span>
<span id="cb18-22">[ins] In [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]: t.schema()</span>
<span id="cb18-23">Out[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]:</span>
<span id="cb18-24">ibis.Schema {</span>
<span id="cb18-25">  starred_at   timestamp</span>
<span id="cb18-26">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>           string</span>
<span id="cb18-27">  login        string</span>
<span id="cb18-28">  name         string</span>
<span id="cb18-29">  company      string</span>
<span id="cb18-30">  created_at   timestamp</span>
<span id="cb18-31">  updated_at   timestamp</span>
<span id="cb18-32">  total_stars  int64</span>
<span id="cb18-33">}</span>
<span id="cb18-34"></span>
<span id="cb18-35">[ins] In [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]: t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> t.select(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"starred_at"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"login"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"company"</span>)</span>
<span id="cb18-36"></span>
<span id="cb18-37">[ins] In [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>]: t.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(t.company.lower().contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"voltron"</span>))</span>
<span id="cb18-38">Out[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>]:</span>
<span id="cb18-39">┏━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┓</span>
<span id="cb18-40">┃ starred_at          ┃ login               ┃ company      ┃</span>
<span id="cb18-41">┡━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━┩</span>
<span id="cb18-42">│ timestamp           │ string              │ string       │</span>
<span id="cb18-43">├─────────────────────┼─────────────────────┼──────────────┤</span>
<span id="cb18-44">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">55</span> │ ywc88               │ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>voltrondata │</span>
<span id="cb18-45">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">47</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span> │ EpsilonPrime        │ Voltron Data │</span>
<span id="cb18-46">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">52</span> │ fmichonneau         │ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>voltrondata │</span>
<span id="cb18-47">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span> │ paleolimbot         │ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>voltrondata │</span>
<span id="cb18-48">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">31</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> │ ian<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>flores          │ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>voltrondata │</span>
<span id="cb18-49">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">29</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">57</span> │ MattBBaker          │ Voltron Data │</span>
<span id="cb18-50">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">27</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">29</span> │ zeroshade           │ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>voltrondata │</span>
<span id="cb18-51">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">27</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span> │ kkraus14            │ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>VoltronData │</span>
<span id="cb18-52">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">26</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">59</span> │ cryos               │ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>VoltronData │</span>
<span id="cb18-53">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">26</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">48</span> │ austin3dickey       │ Voltron Data │</span>
<span id="cb18-54">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">26</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">41</span> │ assignUser          │ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>voltrondata │</span>
<span id="cb18-55">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">26</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">39</span> │ boshek              │ Voltron Data │</span>
<span id="cb18-56">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">00</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span> │ lostmygithubaccount │ Voltron Data │</span>
<span id="cb18-57">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">57</span> │ richtia             │ Voltron Data │</span>
<span id="cb18-58">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">58</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span> │ ksuarez1423         │ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>voltrondata │</span>
<span id="cb18-59">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> │ wmalpica            │ Voltron Data │</span>
<span id="cb18-60">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">46</span> │ felipecrv           │ Voltron Data │</span>
<span id="cb18-61">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">46</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span> │ alistaire47         │ Voltron Data │</span>
<span id="cb18-62">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">41</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">58</span> │ mariusvniekerk      │ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>voltrondata │</span>
<span id="cb18-63">│ <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">36</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span> │ andrewseidl         │ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>voltrondata │</span>
<span id="cb18-64">│ …                   │ …                   │ …            │</span>
<span id="cb18-65">└─────────────────────┴─────────────────────┴──────────────┘</span>
<span id="cb18-66"></span>
<span id="cb18-67">[ins] In [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>]:</span></code></pre></div>
<p>Or I can add <code>from eda import *</code> in a <code>untitled.ipynb</code> for a classic notebook experience in VSCode, which I prefer when plotting or just saving my work.</p>
</section>
<section id="defining-metrics-and-dashboarding" class="level2">
<h2 class="anchored" data-anchor-id="defining-metrics-and-dashboarding">Defining metrics and dashboarding</h2>
<p>The EDA makes it easy to iteratively define metrics and plot the data. Once I’ve settled on the code I want, I add it to <code>metrics.py</code> with sufficient comments to make it appear in the Streamlit dashboard. It’s convenient to have the metrics defined as code right where the visualization code happens. I can comment it for explanation of metrics definitions and ensure a level of consistency.</p>
<details>
<summary>
Show the metrics code
</summary>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> toml</span>
<span id="cb19-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis</span>
<span id="cb19-3"></span>
<span id="cb19-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> streamlit <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> st</span>
<span id="cb19-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> plotly.express <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> px</span>
<span id="cb19-6"></span>
<span id="cb19-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dotenv <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> load_dotenv</span>
<span id="cb19-8"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> datetime <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime, timedelta</span>
<span id="cb19-9"></span>
<span id="cb19-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># options</span></span>
<span id="cb19-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## load .env</span></span>
<span id="cb19-12">load_dotenv()</span>
<span id="cb19-13"></span>
<span id="cb19-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## config.toml</span></span>
<span id="cb19-15">config <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> toml.load(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"config.toml"</span>)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"app"</span>]</span>
<span id="cb19-16"></span>
<span id="cb19-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## streamlit config</span></span>
<span id="cb19-18">st.set_page_config(layout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wide"</span>)</span>
<span id="cb19-19"></span>
<span id="cb19-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## ibis config</span></span>
<span id="cb19-21">con <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"duckdb://</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>config[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'database'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, read_only<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb19-22"></span>
<span id="cb19-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># use precomputed data</span></span>
<span id="cb19-24">stars <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> con.table(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stars"</span>)</span>
<span id="cb19-25">forks <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> con.table(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"forks"</span>)</span>
<span id="cb19-26">pulls <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> con.table(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pulls"</span>)</span>
<span id="cb19-27">issues <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> con.table(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"issues"</span>)</span>
<span id="cb19-28">backends <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> con.table(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"backends"</span>)</span>
<span id="cb19-29">downloads <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> con.table(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"downloads"</span>)</span>
<span id="cb19-30">members <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> con.table(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"zulip_members"</span>)</span>
<span id="cb19-31">messages <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> con.table(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"zulip_messages"</span>)</span>
<span id="cb19-32"></span>
<span id="cb19-33"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># display header stuff</span></span>
<span id="cb19-34"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"readme.md"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb19-35">    readme_code <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f.read()</span>
<span id="cb19-36"></span>
<span id="cb19-37"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"""</span></span>
<span id="cb19-38"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>readme_code<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> See [the about page](/about) for more details.</span></span>
<span id="cb19-39"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb19-40"></span>
<span id="cb19-41"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"requirements.txt"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb19-42">    metrics_code <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f.read()</span>
<span id="cb19-43"></span>
<span id="cb19-44"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> st.expander(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"show `requirements.txt`"</span>, expanded<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>):</span>
<span id="cb19-45">    st.code(metrics_code, line_numbers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, language<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"python"</span>)</span>
<span id="cb19-46"></span>
<span id="cb19-47"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"config.toml"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb19-48">    config_code <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f.read()</span>
<span id="cb19-49"></span>
<span id="cb19-50"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> st.expander(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"show `config.toml`"</span>, expanded<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>):</span>
<span id="cb19-51">    st.code(config_code, line_numbers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, language<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"toml"</span>)</span>
<span id="cb19-52"></span>
<span id="cb19-53"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"justfile"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb19-54">    justfile_code <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f.read()</span>
<span id="cb19-55"></span>
<span id="cb19-56"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> st.expander(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"show `justfile`"</span>, expanded<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>):</span>
<span id="cb19-57">    st.code(justfile_code, line_numbers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, language<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"makefile"</span>)</span>
<span id="cb19-58"></span>
<span id="cb19-59"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".github/workflows/cicd.yaml"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb19-60">    cicd_code <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f.read()</span>
<span id="cb19-61"></span>
<span id="cb19-62"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> st.expander(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"show `cicd.yaml`"</span>, expanded<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>):</span>
<span id="cb19-63">    st.code(cicd_code, line_numbers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, language<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yaml"</span>)</span>
<span id="cb19-64"></span>
<span id="cb19-65"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metrics.py"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb19-66">    metrics_code <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f.read()</span>
<span id="cb19-67"></span>
<span id="cb19-68"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> st.expander(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"show `metrics.py` (source for this page)"</span>, expanded<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>):</span>
<span id="cb19-69">    st.code(metrics_code, line_numbers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, language<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"python"</span>)</span>
<span id="cb19-70"></span>
<span id="cb19-71"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb19-72"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">---</span></span>
<span id="cb19-73"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb19-74"></span>
<span id="cb19-75"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb19-76"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## supported backends</span></span>
<span id="cb19-77"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb19-78"></span>
<span id="cb19-79"></span>
<span id="cb19-80"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> fmt_number(value):</span>
<span id="cb19-81">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>value<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb19-82"></span>
<span id="cb19-83"></span>
<span id="cb19-84">current_backends_total <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb19-85">    backends.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(backends.ingested_at <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> backends.ingested_at.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>())</span>
<span id="cb19-86">    .num_backends.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()</span>
<span id="cb19-87">    .to_pandas()</span>
<span id="cb19-88">)</span>
<span id="cb19-89">current_backends <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> backends.backends.unnest().name(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"backends"</span>).as_table()</span>
<span id="cb19-90"></span>
<span id="cb19-91">st.metric(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total"</span>, <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>current_backends_total<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb19-92">st.dataframe(current_backends, use_container_width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb19-93"></span>
<span id="cb19-94"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb19-95"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## totals (all time)</span></span>
<span id="cb19-96"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb19-97"></span>
<span id="cb19-98">total_stars_all_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stars.login.nunique().to_pandas()</span>
<span id="cb19-99">total_forks_all_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> forks.login.nunique().to_pandas()</span>
<span id="cb19-100"></span>
<span id="cb19-101">total_closed_issues_all_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> issues.number.nunique(</span>
<span id="cb19-102">    where<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>issues.state <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"closed"</span></span>
<span id="cb19-103">).to_pandas()</span>
<span id="cb19-104"></span>
<span id="cb19-105">total_merged_pulls_all_time, total_contributors_all_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb19-106">    pulls.agg(</span>
<span id="cb19-107">        total_merged_pulls_all_time<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pulls.number.nunique(where<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pulls.state <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"merged"</span>),</span>
<span id="cb19-108">        total_contributors_all_time<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pulls.login.nunique(</span>
<span id="cb19-109">            where<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pulls.merged_at.notnull()</span>
<span id="cb19-110">        ),</span>
<span id="cb19-111">    )</span>
<span id="cb19-112">    .to_pandas()</span>
<span id="cb19-113">    .squeeze()</span>
<span id="cb19-114">)</span>
<span id="cb19-115"></span>
<span id="cb19-116">downloads_all_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> downloads[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"downloads"</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>().to_pandas()</span>
<span id="cb19-117"></span>
<span id="cb19-118">total_members_all_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> members.user_id.nunique().to_pandas()</span>
<span id="cb19-119">total_messages_all_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> messages.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>.nunique().to_pandas()</span>
<span id="cb19-120"></span>
<span id="cb19-121"></span>
<span id="cb19-122">col0, col1, col2, col3 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> st.columns(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb19-123"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> col0:</span>
<span id="cb19-124">    st.metric(</span>
<span id="cb19-125">        label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GitHub stars"</span>,</span>
<span id="cb19-126">        value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>fmt_number(total_stars_all_time),</span>
<span id="cb19-127">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">help</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>total_stars_all_time<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb19-128">    )</span>
<span id="cb19-129">    st.metric(</span>
<span id="cb19-130">        label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PyPI downloads"</span>,</span>
<span id="cb19-131">        value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>fmt_number(downloads_all_time),</span>
<span id="cb19-132">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">help</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>downloads_all_time<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb19-133">    )</span>
<span id="cb19-134"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> col1:</span>
<span id="cb19-135">    st.metric(</span>
<span id="cb19-136">        label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GitHub contributors"</span>,</span>
<span id="cb19-137">        value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>fmt_number(total_contributors_all_time),</span>
<span id="cb19-138">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">help</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>total_contributors_all_time<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb19-139">    )</span>
<span id="cb19-140">    st.metric(</span>
<span id="cb19-141">        label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GitHub forks"</span>,</span>
<span id="cb19-142">        value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>fmt_number(total_forks_all_time),</span>
<span id="cb19-143">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">help</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>total_forks_all_time<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb19-144">    )</span>
<span id="cb19-145"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> col2:</span>
<span id="cb19-146">    st.metric(</span>
<span id="cb19-147">        label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GitHub PRs merged"</span>,</span>
<span id="cb19-148">        value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>fmt_number(total_merged_pulls_all_time),</span>
<span id="cb19-149">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">help</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>total_merged_pulls_all_time<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb19-150">    )</span>
<span id="cb19-151">    st.metric(</span>
<span id="cb19-152">        label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GitHub issues closed"</span>,</span>
<span id="cb19-153">        value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>fmt_number(total_closed_issues_all_time),</span>
<span id="cb19-154">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">help</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>total_closed_issues_all_time<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb19-155">    )</span>
<span id="cb19-156"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> col3:</span>
<span id="cb19-157">    st.metric(</span>
<span id="cb19-158">        label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Zulip members"</span>,</span>
<span id="cb19-159">        value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>fmt_number(total_members_all_time),</span>
<span id="cb19-160">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">help</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>total_members_all_time<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb19-161">    )</span>
<span id="cb19-162">    st.metric(</span>
<span id="cb19-163">        label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Zulip messages"</span>,</span>
<span id="cb19-164">        value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>fmt_number(total_messages_all_time),</span>
<span id="cb19-165">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">help</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>total_messages_all_time<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb19-166">    )</span>
<span id="cb19-167"></span>
<span id="cb19-168"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># variables</span></span>
<span id="cb19-169"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> st.form(key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"app"</span>):</span>
<span id="cb19-170">    days <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> st.number_input(</span>
<span id="cb19-171">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X days"</span>,</span>
<span id="cb19-172">        min_value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb19-173">        max_value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>,</span>
<span id="cb19-174">        value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>,</span>
<span id="cb19-175">        step<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>,</span>
<span id="cb19-176">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%d</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb19-177">    )</span>
<span id="cb19-178">    update_button <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> st.form_submit_button(label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"update"</span>)</span>
<span id="cb19-179"></span>
<span id="cb19-180"></span>
<span id="cb19-181">START <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> datetime.now() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> timedelta(days<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>days <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb19-182">STOP <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> datetime.now() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> timedelta(days<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>days)</span>
<span id="cb19-183"></span>
<span id="cb19-184"></span>
<span id="cb19-185"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># compute metrics</span></span>
<span id="cb19-186">total_stars, total_stars_prev <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb19-187">    stars.agg(</span>
<span id="cb19-188">        total_stars<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>stars.login.nunique(where<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>stars.starred_at <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> STOP),</span>
<span id="cb19-189">        total_stars_prev<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>stars.login.nunique(</span>
<span id="cb19-190">            where<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>stars.starred_at.between(START, STOP)</span>
<span id="cb19-191">        ),</span>
<span id="cb19-192">    )</span>
<span id="cb19-193">    .to_pandas()</span>
<span id="cb19-194">    .squeeze()</span>
<span id="cb19-195">)</span>
<span id="cb19-196"></span>
<span id="cb19-197">total_forks, total_forks_prev <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb19-198">    forks.agg(</span>
<span id="cb19-199">        total_forks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>forks.login.nunique(where<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>forks.created_at <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> STOP),</span>
<span id="cb19-200">        total_forks_prev<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>forks.login.nunique(</span>
<span id="cb19-201">            where<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>forks.created_at.between(START, STOP)</span>
<span id="cb19-202">        ),</span>
<span id="cb19-203">    )</span>
<span id="cb19-204">    .to_pandas()</span>
<span id="cb19-205">    .squeeze()</span>
<span id="cb19-206">)</span>
<span id="cb19-207"></span>
<span id="cb19-208">(</span>
<span id="cb19-209">    total_issues,</span>
<span id="cb19-210">    total_issues_prev,</span>
<span id="cb19-211">    total_issues_closed,</span>
<span id="cb19-212">    total_issues_closed_prev,</span>
<span id="cb19-213">) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb19-214">    issues.agg(</span>
<span id="cb19-215">        total_issues<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>issues.login.nunique(where<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>issues.created_at <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> STOP),</span>
<span id="cb19-216">        total_issues_prev<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>issues.login.nunique(</span>
<span id="cb19-217">            where<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>issues.created_at.between(START, STOP)</span>
<span id="cb19-218">        ),</span>
<span id="cb19-219">        total_issues_closed<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>issues.number.nunique(where<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>issues.closed_at <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> STOP),</span>
<span id="cb19-220">        total_issues_closed_prev<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>issues.number.nunique(</span>
<span id="cb19-221">            where<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>issues.closed_at.between(START, STOP)</span>
<span id="cb19-222">        ),</span>
<span id="cb19-223">    )</span>
<span id="cb19-224">    .to_pandas()</span>
<span id="cb19-225">    .squeeze()</span>
<span id="cb19-226">)</span>
<span id="cb19-227"></span>
<span id="cb19-228">(</span>
<span id="cb19-229">    total_pulls,</span>
<span id="cb19-230">    total_pulls_prev,</span>
<span id="cb19-231">    total_pulls_merged,</span>
<span id="cb19-232">    total_pulls_merged_prev,</span>
<span id="cb19-233">    total_contributors,</span>
<span id="cb19-234">    total_contributors_prev,</span>
<span id="cb19-235">) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb19-236">    pulls.agg(</span>
<span id="cb19-237">        total_pulls<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pulls.number.nunique(where<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pulls.created_at <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> STOP),</span>
<span id="cb19-238">        total_pulls_prev<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pulls.number.nunique(</span>
<span id="cb19-239">            where<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pulls.created_at.between(START, STOP)</span>
<span id="cb19-240">        ),</span>
<span id="cb19-241">        total_pulls_merged<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pulls.number.nunique(where<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pulls.merged_at <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> STOP),</span>
<span id="cb19-242">        total_pulls_merged_prev<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pulls.number.nunique(</span>
<span id="cb19-243">            where<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pulls.merged_at.between(START, STOP)</span>
<span id="cb19-244">        ),</span>
<span id="cb19-245">        total_contributors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pulls.login.nunique(where<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pulls.merged_at <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> STOP),</span>
<span id="cb19-246">        total_contributors_prev<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pulls.login.nunique(</span>
<span id="cb19-247">            where<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pulls.merged_at.between(START, STOP)</span>
<span id="cb19-248">        ),</span>
<span id="cb19-249">    )</span>
<span id="cb19-250">    .to_pandas()</span>
<span id="cb19-251">    .squeeze()</span>
<span id="cb19-252">)</span>
<span id="cb19-253"></span>
<span id="cb19-254">total_downloads, total_downloads_prev <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb19-255">    downloads.agg(</span>
<span id="cb19-256">        total_downloads<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>downloads.downloads.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(where<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>downloads.timestamp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> STOP),</span>
<span id="cb19-257">        total_downloads_prev<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>downloads.downloads.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(</span>
<span id="cb19-258">            where<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>downloads.timestamp.between(START, STOP)</span>
<span id="cb19-259">        ),</span>
<span id="cb19-260">    )</span>
<span id="cb19-261">    .to_pandas()</span>
<span id="cb19-262">    .squeeze()</span>
<span id="cb19-263">)</span>
<span id="cb19-264"></span>
<span id="cb19-265"></span>
<span id="cb19-266"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> delta(current, previous):</span>
<span id="cb19-267">    delta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> current <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> previous</span>
<span id="cb19-268">    pct_change <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">round</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">100.0</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> delta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> previous, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb19-269">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>fmt_number(delta)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>pct_change<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:d}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">%)"</span></span>
<span id="cb19-270"></span>
<span id="cb19-271"></span>
<span id="cb19-272"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"""</span></span>
<span id="cb19-273"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">## totals (last </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>days<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> days)</span></span>
<span id="cb19-274"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb19-275">col1, col2, col3, col4 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> st.columns(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb19-276"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> col1:</span>
<span id="cb19-277">    st.metric(</span>
<span id="cb19-278">        label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GitHub stars"</span>,</span>
<span id="cb19-279">        value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>fmt_number(total_stars),</span>
<span id="cb19-280">        delta<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>delta(total_stars, total_stars_prev),</span>
<span id="cb19-281">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">help</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>total_stars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb19-282">    )</span>
<span id="cb19-283">    st.metric(</span>
<span id="cb19-284">        label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PyPI downloads"</span>,</span>
<span id="cb19-285">        value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>fmt_number(total_downloads),</span>
<span id="cb19-286">        delta<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>delta(total_downloads, total_downloads_prev),</span>
<span id="cb19-287">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">help</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>total_downloads<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb19-288">    )</span>
<span id="cb19-289"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> col2:</span>
<span id="cb19-290">    st.metric(</span>
<span id="cb19-291">        label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GitHub contributors"</span>,</span>
<span id="cb19-292">        value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>fmt_number(total_contributors),</span>
<span id="cb19-293">        delta<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>delta(total_contributors, total_contributors_prev),</span>
<span id="cb19-294">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">help</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>total_contributors<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb19-295">    )</span>
<span id="cb19-296">    st.metric(</span>
<span id="cb19-297">        label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GitHub forks created"</span>,</span>
<span id="cb19-298">        value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>fmt_number(total_forks),</span>
<span id="cb19-299">        delta<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>delta(total_forks, total_forks_prev),</span>
<span id="cb19-300">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">help</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>total_forks<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb19-301">    )</span>
<span id="cb19-302"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> col3:</span>
<span id="cb19-303">    st.metric(</span>
<span id="cb19-304">        label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GitHub PRs opened"</span>,</span>
<span id="cb19-305">        value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>fmt_number(total_pulls),</span>
<span id="cb19-306">        delta<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>delta(total_pulls, total_pulls_prev),</span>
<span id="cb19-307">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">help</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>total_pulls<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb19-308">    )</span>
<span id="cb19-309">    st.metric(</span>
<span id="cb19-310">        label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GitHub issues opened"</span>,</span>
<span id="cb19-311">        value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>fmt_number(total_issues),</span>
<span id="cb19-312">        delta<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>delta(total_issues, total_issues_prev),</span>
<span id="cb19-313">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">help</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>total_issues<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb19-314">    )</span>
<span id="cb19-315"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> col4:</span>
<span id="cb19-316">    st.metric(</span>
<span id="cb19-317">        label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GitHub PRs merged"</span>,</span>
<span id="cb19-318">        value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>fmt_number(total_pulls_merged),</span>
<span id="cb19-319">        delta<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>delta(total_pulls_merged, total_pulls_merged_prev),</span>
<span id="cb19-320">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">help</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>total_pulls_merged<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb19-321">    )</span>
<span id="cb19-322">    st.metric(</span>
<span id="cb19-323">        label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GitHub issues closed"</span>,</span>
<span id="cb19-324">        value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>fmt_number(total_issues_closed),</span>
<span id="cb19-325">        delta<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>delta(total_issues_closed, total_issues_closed_prev),</span>
<span id="cb19-326">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">help</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>total_issues_closed<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb19-327">    )</span>
<span id="cb19-328"></span>
<span id="cb19-329"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"""</span></span>
<span id="cb19-330"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">## data (last </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>days<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> days)</span></span>
<span id="cb19-331"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb19-332"></span>
<span id="cb19-333"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb19-334"><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">###</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> downloads by system and version</span></span>
<span id="cb19-335"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb19-336">c0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> px.bar(</span>
<span id="cb19-337">    downloads.group_by([ibis._.system, ibis._.version])</span>
<span id="cb19-338">    .agg(downloads<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> t: t.downloads.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(where<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>t.timestamp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> STOP))</span>
<span id="cb19-339">    .order_by(ibis._.version.desc()),</span>
<span id="cb19-340">    x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"version"</span>,</span>
<span id="cb19-341">    y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"downloads"</span>,</span>
<span id="cb19-342">    color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"system"</span>,</span>
<span id="cb19-343">    title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"downloads by system and version"</span>,</span>
<span id="cb19-344">)</span>
<span id="cb19-345">st.plotly_chart(c0, use_container_width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb19-346"></span>
<span id="cb19-347"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb19-348"><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">###</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> stars by company</span></span>
<span id="cb19-349"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb19-350">st.dataframe(</span>
<span id="cb19-351">    stars.group_by(ibis._.company)</span>
<span id="cb19-352">    .agg(stars<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> t: t.count(where<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>t.starred_at <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> STOP))</span>
<span id="cb19-353">    .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(ibis._.stars <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb19-354">    .order_by(ibis._.stars.desc())</span>
<span id="cb19-355">    .to_pandas(),</span>
<span id="cb19-356">    use_container_width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb19-357">)</span>
<span id="cb19-358"></span>
<span id="cb19-359"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb19-360"><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">###</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> issues by login</span></span>
<span id="cb19-361"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb19-362">c1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> px.bar(</span>
<span id="cb19-363">    issues.group_by([ibis._.login, ibis._.state])</span>
<span id="cb19-364">    .agg(issues<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> t: t.count(where<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>t.created_at <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> STOP))</span>
<span id="cb19-365">    .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(ibis._.issues <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb19-366">    .order_by(ibis._.issues.desc()),</span>
<span id="cb19-367">    x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"login"</span>,</span>
<span id="cb19-368">    y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"issues"</span>,</span>
<span id="cb19-369">    color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"state"</span>,</span>
<span id="cb19-370">    title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"issues by login"</span>,</span>
<span id="cb19-371">)</span>
<span id="cb19-372">st.plotly_chart(c1, use_container_width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb19-373"></span>
<span id="cb19-374"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb19-375"><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">###</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> PRs by login</span></span>
<span id="cb19-376"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb19-377">c2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> px.bar(</span>
<span id="cb19-378">    pulls.group_by([ibis._.login, ibis._.state])</span>
<span id="cb19-379">    .agg(pulls<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> t: t.count(where<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>t.created_at <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> STOP))</span>
<span id="cb19-380">    .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(ibis._.pulls <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb19-381">    .order_by(ibis._.pulls.desc()),</span>
<span id="cb19-382">    x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"login"</span>,</span>
<span id="cb19-383">    y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pulls"</span>,</span>
<span id="cb19-384">    color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"state"</span>,</span>
<span id="cb19-385">    title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PRs by login"</span>,</span>
<span id="cb19-386">)</span>
<span id="cb19-387">st.plotly_chart(c2, use_container_width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span></code></pre></div>
</details>
<p>I can <code>just app</code> to view the dashboard locally in a web browser:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ibis-project.org/posts/ibis-analytics/preview.png" class="img-fluid figure-img"></p>
<figcaption>Dashboard local</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ibis-project.org/posts/ibis-analytics/thumbnail.png" class="img-fluid figure-img"></p>
<figcaption>Dashboard metrics</figcaption>
</figure>
</div>
<p>If I need more detailed analysis, I can always go back to EDA above and iterate.</p>
</section>
<section id="deploy" class="level2">
<h2 class="anchored" data-anchor-id="deploy">Deploy</h2>
<p>To deploy to production, we use MotherDuck for a SaaS database and Streamlit Community Cloud for a SaaS dashboard.</p>
<section id="deploy-the-database-with-motherduck" class="level3">
<h3 class="anchored" data-anchor-id="deploy-the-database-with-motherduck">Deploy the database with MotherDuck</h3>
<p>We <code>just deploy</code> to upload it to the production MotherDuck database.</p>
<p><img src="https://ibis-project.org/posts/ibis-analytics/motherduck.png" class="img-fluid"></p>
<p>This runs some Python code that takes the loaded tables and copies them to MotherDuck:</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb20-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> toml</span>
<span id="cb20-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis</span>
<span id="cb20-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> fnmatch</span>
<span id="cb20-5"></span>
<span id="cb20-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> logging <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> log</span>
<span id="cb20-7"></span>
<span id="cb20-8"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> datetime <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime, timedelta, date</span>
<span id="cb20-9"></span>
<span id="cb20-10"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> functions <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f</span>
<span id="cb20-11"></span>
<span id="cb20-12"></span>
<span id="cb20-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> main():</span>
<span id="cb20-14">    deploy()</span>
<span id="cb20-15"></span>
<span id="cb20-16"></span>
<span id="cb20-17"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> deploy() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb20-18">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb20-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Deploy the data.</span></span>
<span id="cb20-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb20-21">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># constants</span></span>
<span id="cb20-22">    path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/system/duckdb"</span></span>
<span id="cb20-23"></span>
<span id="cb20-24">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># configure logging</span></span>
<span id="cb20-25">    log.basicConfig(</span>
<span id="cb20-26">        level<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>log.INFO,</span>
<span id="cb20-27">    )</span>
<span id="cb20-28"></span>
<span id="cb20-29">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># load config</span></span>
<span id="cb20-30">    config <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> toml.load(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"config.toml"</span>)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"app"</span>]</span>
<span id="cb20-31">    log.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Deploying to </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>config[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'database'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">..."</span>)</span>
<span id="cb20-32"></span>
<span id="cb20-33">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># connect to the database</span></span>
<span id="cb20-34">    target <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.duckdb.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>config[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'database'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb20-35"></span>
<span id="cb20-36">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> root, dirs, files <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> os.walk(path):</span>
<span id="cb20-37">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> files:</span>
<span id="cb20-38">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> fnmatch.fnmatch(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"load_*.ddb"</span>):</span>
<span id="cb20-39">                full_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.path.join(root, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span>)</span>
<span id="cb20-40">                con <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.duckdb.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>(full_path)</span>
<span id="cb20-41">                tablename <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span>.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".ddb"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb20-42">                table <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> con.table(tablename)</span>
<span id="cb20-43">                tablename <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tablename.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"load_"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb20-44"></span>
<span id="cb20-45">                log.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Deploying </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>tablename<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> to </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>config[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'database'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">..."</span>)</span>
<span id="cb20-46">                target.create_table(tablename, table.to_pyarrow(), overwrite<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb20-47"></span>
<span id="cb20-48"></span>
<span id="cb20-49"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">__name__</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"__main__"</span>:</span>
<span id="cb20-50">    main()</span></code></pre></div>
</section>
<section id="deploy-the-dashboard-with-streamlit-community-cloud" class="level3">
<h3 class="anchored" data-anchor-id="deploy-the-dashboard-with-streamlit-community-cloud">Deploy the dashboard with Streamlit Community Cloud</h3>
<p>Then, just deploy a Streamlit app from your GitHub repository (a few clicks in the GUI) and you’re done!</p>
<p><img src="https://ibis-project.org/posts/ibis-analytics/streamlit.png" class="img-fluid"></p>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>The future is now: it’s open-source, modular, composable, and scalable.</p>
<p>An end-to-end analytics pipeline this easy for a product manager to build was not possible just a few years ago. The increasingly modular, composable, and scalable Python data ecosystem has seen an abundance of new libraries that are pushing the limits of what individuals or small teams of data professionals can accomplish, all while efficiently utilizing local and cloud hardware at little to no cost.</p>
<p>I would love any feedback on this project. The best part is if you don’t like any one component (or prefer another), just swap it out! Altair or plotnine or another visualization library for Plotly. The Polars or DataFusion or Snowflake or PySpark or BigQuery backend for Ibis. A different dashboard library. A different cloud service. A different CI/CD service…</p>
<p>While I wouldn’t consider this a good project template for teams of engineers, it could be used to create one or with very little change adapted for other open-source Python projects. I hope you enjoyed!</p>
<p>The source code can be found and stolen from <a href="https://github.com/ibis-project/ibis-analytics">on the <code>ibis-analytics</code> repository</a> – feel free to open an issue, PR, or comment below!</p>
</section>
<section id="next-steps" class="level2">
<h2 class="anchored" data-anchor-id="next-steps">Next steps</h2>
<p>I plan to add some basic ML forecasting and likely a LLM interface to the dashboard. Follow along with the Ibis project to see what’s next!</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>blog</category>
  <category>duckdb</category>
  <category>bigquery</category>
  <category>case study</category>
  <guid>https://ibis-project.org/posts/ibis-analytics/</guid>
  <pubDate>Thu, 25 Jan 2024 05:00:00 GMT</pubDate>
  <media:content url="https://ibis-project.org/posts/ibis-analytics/thumbnail.png" medium="image" type="image/png" height="68" width="144"/>
</item>
<item>
  <title>Using one Python dataframe API to take the billion row challenge with DuckDB, Polars, and DataFusion</title>
  <dc:creator>Cody </dc:creator>
  <link>https://ibis-project.org/posts/1brc/</link>
  <description><![CDATA[ 





<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>This is an implementation of the <a href="https://www.morling.dev/blog/one-billion-row-challenge/">The One Billion Row Challenge</a>:</p>
<blockquote class="blockquote">
<p>Let’s kick off 2024 true coder style—​I’m excited to announce the One Billion Row Challenge (1BRC), running from Jan 1 until Jan 31.</p>
</blockquote>
<blockquote class="blockquote">
<p>Your mission, should you decide to accept it, is deceptively simple: write a Java program for retrieving temperature measurement values from a text file and calculating the min, mean, and max temperature per weather station. There’s just one caveat: the file has 1,000,000,000 rows!</p>
</blockquote>
<p>I haven’t written Java since dropping a computer science course my second year of college that forced us to do functional programming exclusively in Java. However, I’ll gladly take the challenge in Python using Ibis! In fact, I did something like this (generating a billion rows with 26 columns of random numbers and doing basic aggregations) to test out DuckDB and Polars.</p>
<p>In this blog, we’ll demonstrate how Ibis provides a single Python dataframe API to take the billion row challenge with DuckDB, Polars, and DataFusion.</p>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>We need to generate the data from the challenge. First, clone the <a href="https://github.com/gunnarmorling/1brc">repo</a>:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gh</span> repo clone gunnarmorling/1brc</span></code></pre></div>
<p>Then change into the Python directory and run the generation script with the number of rows you want to generate:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> 1brc/src/main/python</span>
<span id="cb2-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">python</span> create_measurements.py 1_000_000_000</span></code></pre></div>
<p>This will generate a file called <code>measurements.txt</code> in the <code>data</code> directory at the root of the repo. It is 15GB on disk:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">venv</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cody@voda</span> 1brc % du 1brc/data/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb3-2"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">15G</span>    1brc/data/measurements.txt</span>
<span id="cb3-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">808K</span>    1brc/data/weather_stations.csv</span></code></pre></div>
<p>And consists of one billion rows with two columns separated by a semicolon:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">venv</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cody@voda</span> 1brc % head 1brc/data/measurements.txt</span>
<span id="cb4-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Kusugal</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-67.2</span></span>
<span id="cb4-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ipil</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-88.6</span></span>
<span id="cb4-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Sohna</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-31.2</span></span>
<span id="cb4-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Lubuagan</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-2.3</span></span>
<span id="cb4-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Szentes</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">29.2</span></span>
<span id="cb4-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Sylvan</span> Lake<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-70.7</span></span>
<span id="cb4-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ambato</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-35.2</span></span>
<span id="cb4-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Berkine</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">97.0</span></span>
<span id="cb4-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Wernau</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">73.4</span></span>
<span id="cb4-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Kennewick</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-19.9</span></span></code></pre></div>
<p>Also, you’ll need to install Ibis with the three backends we’ll use:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ibis-framework[duckdb,polars,datafusion]'</span></span></code></pre></div>
</section>
<section id="understanding-ibis" class="level2">
<h2 class="anchored" data-anchor-id="understanding-ibis">Understanding Ibis</h2>
<p>Ibis provides a standard dataframe API decoupled from the execution engine. It compiles Ibis expressions to a form of intermediary representation (often SQL) that can be executed by different backends.</p>
<p>This allows us to write a single Ibis expression to complete the challenge with many different execution engine backends.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>While Ibis does its best to abstract away the differences between backends, this cannot be done in some areas like data input and output. For example, the <code>read_csv</code> function across various backends (in their SQL and Python forms) have different parameters. We’ll handle that with different <code>kwargs</code> dictionaries for these backends in this post.</p>
<p>In general, besides creating a connection and data input/output, the Ibis API is the same across backends.</p>
</div>
</div>
</section>
<section id="completing-the-challenge-thrice" class="level2">
<h2 class="anchored" data-anchor-id="completing-the-challenge-thrice">Completing the challenge thrice</h2>
<p>We’ll use three great options for local backends – DuckDB, Polars, and DataFusion – to complete the challenge.</p>
<section id="setup-1" class="level3">
<h3 class="anchored" data-anchor-id="setup-1">Setup</h3>
<p>Before we get started, we’ll make some imports, turn on interactive mode, and define the <code>kwargs</code> dictionary for the backends corresponding to their <code>read_csv</code> function:</p>
<div id="91ed66cf" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis</span>
<span id="cb6-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> polars <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pl</span>
<span id="cb6-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pyarrow <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pa</span>
<span id="cb6-4"></span>
<span id="cb6-5">ibis.options.interactive <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb6-6"></span>
<span id="cb6-7">duckdb_kwargs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb6-8">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"delim"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">";"</span>,</span>
<span id="cb6-9">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"header"</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>,</span>
<span id="cb6-10">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"columns"</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"station"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VARCHAR"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"temperature"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DOUBLE"</span>},</span>
<span id="cb6-11">}</span>
<span id="cb6-12"></span>
<span id="cb6-13">polars_kwargs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb6-14">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"separator"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">";"</span>,</span>
<span id="cb6-15">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"has_header"</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>,</span>
<span id="cb6-16">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"new_columns"</span>: [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"station"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"temperature"</span>],</span>
<span id="cb6-17">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"schema"</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"station"</span>: pl.Utf8, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"temperature"</span>: pl.Float64},</span>
<span id="cb6-18">}</span>
<span id="cb6-19"></span>
<span id="cb6-20">datafusion_kwargs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb6-21">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"delimiter"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">";"</span>,</span>
<span id="cb6-22">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"has_header"</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>,</span>
<span id="cb6-23">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"schema"</span>: pa.schema(</span>
<span id="cb6-24">        [</span>
<span id="cb6-25">            (</span>
<span id="cb6-26">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"station"</span>,</span>
<span id="cb6-27">                pa.string(),</span>
<span id="cb6-28">            ),</span>
<span id="cb6-29">            (</span>
<span id="cb6-30">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"temperature"</span>,</span>
<span id="cb6-31">                pa.float64(),</span>
<span id="cb6-32">            ),</span>
<span id="cb6-33">        ]</span>
<span id="cb6-34">    ),</span>
<span id="cb6-35">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"file_extension"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".txt"</span>,</span>
<span id="cb6-36">}</span></code></pre></div>
</div>
<p>Let’s define a function to run the same code with each backend to complete the challenge:</p>
<div id="26752081" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> run_challenge(t):</span>
<span id="cb7-2">    res <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb7-3">        t.group_by(ibis._.station)</span>
<span id="cb7-4">        .agg(</span>
<span id="cb7-5">            min_temp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ibis._.temperature.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>(),</span>
<span id="cb7-6">            mean_temp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ibis._.temperature.mean(),</span>
<span id="cb7-7">            max_temp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ibis._.temperature.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(),</span>
<span id="cb7-8">        )</span>
<span id="cb7-9">        .order_by(ibis._.station.desc())</span>
<span id="cb7-10">    )</span>
<span id="cb7-11">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> res</span></code></pre></div>
</div>
</section>
<section id="completing-the-challenge" class="level3">
<h3 class="anchored" data-anchor-id="completing-the-challenge">Completing the challenge</h3>
<p>Let’s complete the challenge with each backend.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The results are the same across backends but look suspicious. It is noted in the repository that the Python generation code is “unofficial”, so may have some problems. Given this is a contrived example of generated data, I’m not going to worry about it.</p>
<p>The point is that we can easily complete the challenge with the same code across many backends, letting them worry about the details of execution. For this reason, I’m also not providing execution times. Try it out yourself!</p>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" aria-controls="tabset-1-1" aria-selected="true">DuckDB</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" aria-controls="tabset-1-2" aria-selected="false">Polars</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" aria-controls="tabset-1-3" aria-selected="false">DataFusion</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" aria-labelledby="tabset-1-1-tab">
<p>First let’s set the backend to DuckDB (redundantly since it’s the default) and the <code>kwargs</code> dictionary:</p>
<div id="d68879ea" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="annotated-cell-10" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="1">1</button><span id="annotated-cell-10-1" class="code-annotation-target">ibis.set_backend(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"duckdb"</span>)</span>
<span id="annotated-cell-10-2">kwargs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> duckdb_kwargs</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-10" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="1" data-code-annotation="1">Redundant given DuckDB is the default</span>
</dd>
</dl>
</div>
</div>
<p>Next, we’ll read in the data and take a look at the table:</p>
<div id="96c13669" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1brc/data/measurements.txt"</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>kwargs)</span>
<span id="cb8-2">t.limit(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━┳━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> station     </span>┃<span style="font-weight: bold"> temperature </span>┃
┡━━━━━━━━━━━━━╇━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>     │
├─────────────┼─────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">Lívingston </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-21.0</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Annūr      </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-33.4</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Beni Douala</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">16.5</span> │
└─────────────┴─────────────┘
</pre>
</div>
</div>
<p>Then let’s confirm it’s <strong>a billion</strong> rows:</p>
<div id="12713152" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>t<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>count()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>to_pandas()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>'1,000,000,000'</code></pre>
</div>
</div>
<p>Finally, we’ll compute the min, mean, and max temperature per weather station:</p>
<div id="19c3a25d" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">res <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> run_challenge(t)</span>
<span id="cb11-2">res</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━┓
┃<span style="font-weight: bold"> station        </span>┃<span style="font-weight: bold"> min_temp </span>┃<span style="font-weight: bold"> mean_temp </span>┃<span style="font-weight: bold"> max_temp </span>┃
┡━━━━━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>  │
├────────────────┼──────────┼───────────┼──────────┤
│ <span style="color: #008000; text-decoration-color: #008000">’s-Gravendeel </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-99.9</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.112188</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99.9</span> │
│ <span style="color: #008000; text-decoration-color: #008000">’Aïn el Hammam</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-99.9</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.225289</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99.9</span> │
│ <span style="color: #008000; text-decoration-color: #008000">’Aïn Roua     </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-99.9</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.198241</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99.9</span> │
│ <span style="color: #008000; text-decoration-color: #008000">‘Ibrī         </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-99.9</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.009499</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99.9</span> │
│ <span style="color: #008000; text-decoration-color: #008000">‘Ayn al ‘Arab </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-99.9</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.124730</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99.9</span> │
│ <span style="color: #008000; text-decoration-color: #008000">‘Akko         </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-99.9</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.087184</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99.9</span> │
│ <span style="color: #008000; text-decoration-color: #008000">‘Afrīn        </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-99.9</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.013322</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99.9</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Ấp Tân Ngãi   </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-99.9</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.344089</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99.9</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Ẕefat         </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-99.9</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.017767</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99.9</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Ḩīsh          </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-99.9</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.018804</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99.9</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>              │        <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │         <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │        <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└────────────────┴──────────┴───────────┴──────────┘
</pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" aria-labelledby="tabset-1-2-tab">
<p>First let’s set the backend to Polars and the <code>kwargs</code> dictionary:</p>
<div id="f2d18dfd" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="annotated-cell-15" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><button class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="1">1</button><span id="annotated-cell-15-1" class="code-annotation-target">ibis.set_backend(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"polars"</span>)</span>
<span id="annotated-cell-15-2">kwargs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> polars_kwargs</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-15" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="1" data-code-annotation="1">Set Polars as the default backend used</span>
</dd>
</dl>
</div>
</div>
<p>Next, we’ll read in the data and take a look at the table:</p>
<div id="b08560a2" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1">t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1brc/data/measurements.txt"</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>kwargs)</span>
<span id="cb12-2">t.limit(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━┳━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> station     </span>┃<span style="font-weight: bold"> temperature </span>┃
┡━━━━━━━━━━━━━╇━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>     │
├─────────────┼─────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">Lívingston </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-21.0</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Annūr      </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-33.4</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Beni Douala</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">16.5</span> │
└─────────────┴─────────────┘
</pre>
</div>
</div>
<p>Then let’s confirm it’s <strong>a billion</strong> rows:</p>
<div id="228560cf" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>t<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>count()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>to_pandas()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>'1,000,000,000'</code></pre>
</div>
</div>
<p>Finally, we’ll compute the min, mean, and max temperature per weather station:</p>
<div id="43eed898" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1">res <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> run_challenge(t)</span>
<span id="cb15-2">res</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━┓
┃<span style="font-weight: bold"> station        </span>┃<span style="font-weight: bold"> min_temp </span>┃<span style="font-weight: bold"> mean_temp </span>┃<span style="font-weight: bold"> max_temp </span>┃
┡━━━━━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>  │
├────────────────┼──────────┼───────────┼──────────┤
│ <span style="color: #008000; text-decoration-color: #008000">’s-Gravendeel </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-99.9</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.112188</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99.9</span> │
│ <span style="color: #008000; text-decoration-color: #008000">’Aïn el Hammam</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-99.9</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.225289</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99.9</span> │
│ <span style="color: #008000; text-decoration-color: #008000">’Aïn Roua     </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-99.9</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.198241</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99.9</span> │
│ <span style="color: #008000; text-decoration-color: #008000">‘Ibrī         </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-99.9</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.009499</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99.9</span> │
│ <span style="color: #008000; text-decoration-color: #008000">‘Ayn al ‘Arab </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-99.9</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.124730</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99.9</span> │
│ <span style="color: #008000; text-decoration-color: #008000">‘Akko         </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-99.9</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.087184</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99.9</span> │
│ <span style="color: #008000; text-decoration-color: #008000">‘Afrīn        </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-99.9</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.013322</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99.9</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Ấp Tân Ngãi   </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-99.9</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.344089</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99.9</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Ẕefat         </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-99.9</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.017767</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99.9</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Ḩīsh          </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-99.9</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.018804</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99.9</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>              │        <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │         <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │        <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└────────────────┴──────────┴───────────┴──────────┘
</pre>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" aria-labelledby="tabset-1-3-tab">
<p>First let’s set the backend to DataFusion and the <code>kwargs</code> dictionary:</p>
<div id="a8ca1175" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="annotated-cell-20" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><button class="code-annotation-anchor" data-target-cell="annotated-cell-20" data-target-annotation="1">1</button><span id="annotated-cell-20-1" class="code-annotation-target">ibis.set_backend(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"datafusion"</span>)</span>
<span id="annotated-cell-20-2">kwargs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> datafusion_kwargs</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-20" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-20" data-code-lines="1" data-code-annotation="1">Set DataFusion as the default backend used</span>
</dd>
</dl>
</div>
</div>
<p>Next, we’ll read in the data and take a look at the table:</p>
<div id="502f535c" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1">t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1brc/data/measurements.txt"</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>kwargs)</span>
<span id="cb16-2">t.limit(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━┳━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> station     </span>┃<span style="font-weight: bold"> temperature </span>┃
┡━━━━━━━━━━━━━╇━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>     │
├─────────────┼─────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">Lívingston </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-21.0</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Annūr      </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-33.4</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Beni Douala</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">16.5</span> │
└─────────────┴─────────────┘
</pre>
</div>
</div>
<p>Then let’s confirm it’s <strong>a billion</strong> rows:</p>
<div id="2c9c3bc3" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>t<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>count()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>to_pandas()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>'1,000,000,000'</code></pre>
</div>
</div>
<p>Finally, we’ll compute the min, mean, and max temperature per weather station:</p>
<div id="39b461fa" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1">res <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> run_challenge(t)</span>
<span id="cb19-2">res</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━┓
┃<span style="font-weight: bold"> station        </span>┃<span style="font-weight: bold"> min_temp </span>┃<span style="font-weight: bold"> mean_temp </span>┃<span style="font-weight: bold"> max_temp </span>┃
┡━━━━━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>  │
├────────────────┼──────────┼───────────┼──────────┤
│ <span style="color: #008000; text-decoration-color: #008000">’s-Gravendeel </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-99.9</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.112188</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99.9</span> │
│ <span style="color: #008000; text-decoration-color: #008000">’Aïn el Hammam</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-99.9</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.225289</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99.9</span> │
│ <span style="color: #008000; text-decoration-color: #008000">’Aïn Roua     </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-99.9</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.198241</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99.9</span> │
│ <span style="color: #008000; text-decoration-color: #008000">‘Ibrī         </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-99.9</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.009499</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99.9</span> │
│ <span style="color: #008000; text-decoration-color: #008000">‘Ayn al ‘Arab </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-99.9</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.124730</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99.9</span> │
│ <span style="color: #008000; text-decoration-color: #008000">‘Akko         </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-99.9</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.087184</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99.9</span> │
│ <span style="color: #008000; text-decoration-color: #008000">‘Afrīn        </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-99.9</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.013322</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99.9</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Ấp Tân Ngãi   </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-99.9</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.344089</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99.9</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Ẕefat         </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-99.9</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.017767</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99.9</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Ḩīsh          </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-99.9</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.018804</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99.9</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>              │        <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │         <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │        <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└────────────────┴──────────┴───────────┴──────────┘
</pre>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>While the one billion row challenge isn’t a great benchmark, it’s a fun way to demonstrate how Ibis provides a single Python dataframe API to take the billion row challenge with DuckDB, Polars, and DataFusion. Feel free to try it out with other backends!</p>
<p>Happy coding!</p>
</section>
<section id="bonus-more-billion-row-data-generation" class="level2">
<h2 class="anchored" data-anchor-id="bonus-more-billion-row-data-generation">Bonus: more billion row data generation</h2>
<p>While we’re here, I’ll share the code I’ve used in the past to generate a billion rows of random data:</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis</span>
<span id="cb20-2"></span>
<span id="cb20-3">con <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"duckdb://data.ddb"</span>)</span>
<span id="cb20-4"></span>
<span id="cb20-5">ROWS <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1_000_000_000</span></span>
<span id="cb20-6"></span>
<span id="cb20-7">sql_str <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span></span>
<span id="cb20-8">sql_str <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"select</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb20-9"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> c <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">map</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">ord</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>), <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">ord</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"z"</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))):</span>
<span id="cb20-10">    sql_str <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"  random() as </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>c<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">,</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb20-11">sql_str <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"from generate_series(1, </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>ROWS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">)"</span></span>
<span id="cb20-12"></span>
<span id="cb20-13">t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> con.sql(sql_str)</span>
<span id="cb20-14">con.create_table(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"billion"</span>, t, overwrite<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span></code></pre></div>
<p>Nowadays I’d convert that to an Ibis expression:</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is a slightly different result with a monotonic index column, but I prefer it anyway. You could drop that column or adjust the expression.</p>
</div>
</div>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis</span>
<span id="cb21-2"></span>
<span id="cb21-3">con <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"duckdb://data.ddb"</span>)</span>
<span id="cb21-4"></span>
<span id="cb21-5">ROWS <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1_000_000_000</span></span>
<span id="cb21-6"></span>
<span id="cb21-7">t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb21-8">    ibis.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(ROWS)</span>
<span id="cb21-9">    .unnest()</span>
<span id="cb21-10">    .name(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"index"</span>)</span>
<span id="cb21-11">    .as_table()</span>
<span id="cb21-12">    .mutate(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>{c: ibis.random() <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> c <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">map</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">chr</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">ord</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>), <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">ord</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"z"</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)))})</span>
<span id="cb21-13">)</span>
<span id="cb21-14">con.create_table(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"billion"</span>, t, overwrite<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span></code></pre></div>
<p>But if you do need to construct a programmatic SQL string, it’s cool that you can!</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>blog</category>
  <category>duckdb</category>
  <category>polars</category>
  <category>datafusion</category>
  <category>portability</category>
  <guid>https://ibis-project.org/posts/1brc/</guid>
  <pubDate>Mon, 22 Jan 2024 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Backend agnostic arrays</title>
  <dc:creator>Phillip Cloud</dc:creator>
  <link>https://ibis-project.org/posts/backend-agnostic-arrays/</link>
  <description><![CDATA[ 





<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This is a redux of a <a href="../../posts/bigquery-arrays/index.html">previous post</a> showing Ibis’s portability in action.</p>
<p>Ibis is portable across complex operations and backends of very different scales and deployment models!</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Results differ slightly between BigQuery and DuckDB
</div>
</div>
<div class="callout-body-container callout-body">
<p>The datasets used in each backend are slightly different.</p>
<p>I opted to avoid ETL for the BigQuery backend by reusing the Google-provided IMDB dataset.</p>
<p>The tradeoff is the slight discrepancy in results.</p>
</div>
</div>
</section>
<section id="basics" class="level2">
<h2 class="anchored" data-anchor-id="basics">Basics</h2>
<p>We’ll start with <code>from ibis.interactive import *</code> for maximum convenience.</p>
<div id="0b066bd8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="annotated-cell-1" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="1">1</button><span id="annotated-cell-1-1" class="code-annotation-target"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> ibis.interactive <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-1" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="1" data-code-annotation="1"><code>from ibis.interactive import *</code> imports Ibis APIs into the global namespace and enables <a href="../../how-to/configure/basics.html#interactive-mode">interactive mode</a>.</span>
</dd>
</dl>
</div>
</div>
<section id="connect-to-your-database" class="level3">
<h3 class="anchored" data-anchor-id="connect-to-your-database">Connect to your database</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" aria-controls="tabset-1-1" aria-selected="true">DuckDB</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" aria-controls="tabset-1-2" aria-selected="false">BigQuery</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" aria-labelledby="tabset-1-1-tab">
<div id="7caf0298" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="annotated-cell-2" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-2-1">ddb <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"duckdb://"</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="1">1</button><span id="annotated-cell-2-2" class="code-annotation-target">ddb.create_table(</span>
<span id="annotated-cell-2-3">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name_basics"</span>, ex.imdb_name_basics.fetch(backend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ddb).rename(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"snake_case"</span>)</span>
<span id="annotated-cell-2-4">)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="2">2</button><span id="annotated-cell-2-5" class="code-annotation-target">ddb.create_table(</span>
<span id="annotated-cell-2-6">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title_basics"</span>, ex.imdb_title_basics.fetch(backend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ddb).rename(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"snake_case"</span>)</span>
<span id="annotated-cell-2-7">)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-2" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="2,4" data-code-annotation="1">Create a table called <code>name_basics</code> in our DuckDB database using <code>ibis.examples</code> data</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="5,7" data-code-annotation="2">Create a table called <code>title_basics</code> in our DuckDB database using <code>ibis.examples</code> data</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> tconst    </span>┃<span style="font-weight: bold"> title_type </span>┃<span style="font-weight: bold"> primary_title                               </span>┃<span style="font-weight: bold"> original_title                              </span>┃<span style="font-weight: bold"> is_adult </span>┃<span style="font-weight: bold"> start_year </span>┃<span style="font-weight: bold"> end_year </span>┃<span style="font-weight: bold"> runtime_minutes </span>┃<span style="font-weight: bold"> genres                   </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                   │
├───────────┼────────────┼─────────────────────────────────────────────┼─────────────────────────────────────────────┼──────────┼────────────┼──────────┼─────────────────┼──────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">tt0000001</span> │ <span style="color: #008000; text-decoration-color: #008000">short     </span> │ <span style="color: #008000; text-decoration-color: #008000">Carmencita                                 </span> │ <span style="color: #008000; text-decoration-color: #008000">Carmencita                                 </span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1894</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │ <span style="color: #008000; text-decoration-color: #008000">Documentary,Short       </span> │
│ <span style="color: #008000; text-decoration-color: #008000">tt0000002</span> │ <span style="color: #008000; text-decoration-color: #008000">short     </span> │ <span style="color: #008000; text-decoration-color: #008000">Le clown et ses chiens                     </span> │ <span style="color: #008000; text-decoration-color: #008000">Le clown et ses chiens                     </span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1892</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span> │ <span style="color: #008000; text-decoration-color: #008000">Animation,Short         </span> │
│ <span style="color: #008000; text-decoration-color: #008000">tt0000003</span> │ <span style="color: #008000; text-decoration-color: #008000">short     </span> │ <span style="color: #008000; text-decoration-color: #008000">Pauvre Pierrot                             </span> │ <span style="color: #008000; text-decoration-color: #008000">Pauvre Pierrot                             </span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1892</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4</span> │ <span style="color: #008000; text-decoration-color: #008000">Animation,Comedy,Romance</span> │
│ <span style="color: #008000; text-decoration-color: #008000">tt0000004</span> │ <span style="color: #008000; text-decoration-color: #008000">short     </span> │ <span style="color: #008000; text-decoration-color: #008000">Un bon bock                                </span> │ <span style="color: #008000; text-decoration-color: #008000">Un bon bock                                </span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1892</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">12</span> │ <span style="color: #008000; text-decoration-color: #008000">Animation,Short         </span> │
│ <span style="color: #008000; text-decoration-color: #008000">tt0000005</span> │ <span style="color: #008000; text-decoration-color: #008000">short     </span> │ <span style="color: #008000; text-decoration-color: #008000">Blacksmith Scene                           </span> │ <span style="color: #008000; text-decoration-color: #008000">Blacksmith Scene                           </span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1893</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │ <span style="color: #008000; text-decoration-color: #008000">Comedy,Short            </span> │
│ <span style="color: #008000; text-decoration-color: #008000">tt0000006</span> │ <span style="color: #008000; text-decoration-color: #008000">short     </span> │ <span style="color: #008000; text-decoration-color: #008000">Chinese Opium Den                          </span> │ <span style="color: #008000; text-decoration-color: #008000">Chinese Opium Den                          </span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1894</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │ <span style="color: #008000; text-decoration-color: #008000">Short                   </span> │
│ <span style="color: #008000; text-decoration-color: #008000">tt0000007</span> │ <span style="color: #008000; text-decoration-color: #008000">short     </span> │ <span style="color: #008000; text-decoration-color: #008000">Corbett and Courtney Before the Kinetograph</span> │ <span style="color: #008000; text-decoration-color: #008000">Corbett and Courtney Before the Kinetograph</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1894</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │ <span style="color: #008000; text-decoration-color: #008000">Short,Sport             </span> │
│ <span style="color: #008000; text-decoration-color: #008000">tt0000008</span> │ <span style="color: #008000; text-decoration-color: #008000">short     </span> │ <span style="color: #008000; text-decoration-color: #008000">Edison Kinetoscopic Record of a Sneeze     </span> │ <span style="color: #008000; text-decoration-color: #008000">Edison Kinetoscopic Record of a Sneeze     </span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1894</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │ <span style="color: #008000; text-decoration-color: #008000">Documentary,Short       </span> │
│ <span style="color: #008000; text-decoration-color: #008000">tt0000009</span> │ <span style="color: #008000; text-decoration-color: #008000">movie     </span> │ <span style="color: #008000; text-decoration-color: #008000">Miss Jerry                                 </span> │ <span style="color: #008000; text-decoration-color: #008000">Miss Jerry                                 </span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1894</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">45</span> │ <span style="color: #008000; text-decoration-color: #008000">Romance                 </span> │
│ <span style="color: #008000; text-decoration-color: #008000">tt0000010</span> │ <span style="color: #008000; text-decoration-color: #008000">short     </span> │ <span style="color: #008000; text-decoration-color: #008000">Leaving the Factory                        </span> │ <span style="color: #008000; text-decoration-color: #008000">La sortie de l'usine Lumière à Lyon        </span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1895</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │ <span style="color: #008000; text-decoration-color: #008000">Documentary,Short       </span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                           │        <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │          <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>        │               <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                        │
└───────────┴────────────┴─────────────────────────────────────────────┴─────────────────────────────────────────────┴──────────┴────────────┴──────────┴─────────────────┴──────────────────────────┘
</pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" aria-labelledby="tabset-1-2-tab">
<div id="399dd705" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="annotated-cell-3" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-3-1">bq <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bigquery://ibis-gbq"</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="1">1</button><span id="annotated-cell-3-2" class="code-annotation-target">bq.set_database(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bigquery-public-data.imdb"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-3" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="2" data-code-annotation="1">Google provides a public BigQuery dataset for IMDB data.</span>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<p>Let’s pull out the <code>name_basics</code> table, which contains names and metadata about people listed on IMDB. We’ll call this <code>ents</code> (short for <code>entities</code>), and remove some columns we won’t need:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" aria-controls="tabset-2-1" aria-selected="true">DuckDB</a></li><li class="nav-item"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" aria-controls="tabset-2-2" aria-selected="false">BigQuery</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" aria-labelledby="tabset-2-1-tab">
<div id="108c077d" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1">ddb_ents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ddb.tables.name_basics.drop(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"birth_year"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"death_year"</span>)</span>
<span id="cb1-2">ddb_ents.order_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nconst"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> nconst    </span>┃<span style="font-weight: bold"> primary_name    </span>┃<span style="font-weight: bold"> primary_profession                  </span>┃<span style="font-weight: bold"> known_for_titles                        </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                              │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                  │
├───────────┼─────────────────┼─────────────────────────────────────┼─────────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">nm0000001</span> │ <span style="color: #008000; text-decoration-color: #008000">Fred Astaire   </span> │ <span style="color: #008000; text-decoration-color: #008000">soundtrack,actor,miscellaneous     </span> │ <span style="color: #008000; text-decoration-color: #008000">tt0053137,tt0072308,tt0045537,tt0050419</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000002</span> │ <span style="color: #008000; text-decoration-color: #008000">Lauren Bacall  </span> │ <span style="color: #008000; text-decoration-color: #008000">actress,soundtrack                 </span> │ <span style="color: #008000; text-decoration-color: #008000">tt0037382,tt0117057,tt0075213,tt0038355</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000003</span> │ <span style="color: #008000; text-decoration-color: #008000">Brigitte Bardot</span> │ <span style="color: #008000; text-decoration-color: #008000">actress,soundtrack,music_department</span> │ <span style="color: #008000; text-decoration-color: #008000">tt0057345,tt0054452,tt0049189,tt0056404</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000004</span> │ <span style="color: #008000; text-decoration-color: #008000">John Belushi   </span> │ <span style="color: #008000; text-decoration-color: #008000">actor,soundtrack,writer            </span> │ <span style="color: #008000; text-decoration-color: #008000">tt0072562,tt0078723,tt0077975,tt0080455</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000005</span> │ <span style="color: #008000; text-decoration-color: #008000">Ingmar Bergman </span> │ <span style="color: #008000; text-decoration-color: #008000">writer,director,actor              </span> │ <span style="color: #008000; text-decoration-color: #008000">tt0083922,tt0069467,tt0050976,tt0050986</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000006</span> │ <span style="color: #008000; text-decoration-color: #008000">Ingrid Bergman </span> │ <span style="color: #008000; text-decoration-color: #008000">actress,soundtrack,producer        </span> │ <span style="color: #008000; text-decoration-color: #008000">tt0038109,tt0036855,tt0034583,tt0038787</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000007</span> │ <span style="color: #008000; text-decoration-color: #008000">Humphrey Bogart</span> │ <span style="color: #008000; text-decoration-color: #008000">actor,soundtrack,producer          </span> │ <span style="color: #008000; text-decoration-color: #008000">tt0037382,tt0034583,tt0042593,tt0043265</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000008</span> │ <span style="color: #008000; text-decoration-color: #008000">Marlon Brando  </span> │ <span style="color: #008000; text-decoration-color: #008000">actor,soundtrack,director          </span> │ <span style="color: #008000; text-decoration-color: #008000">tt0068646,tt0070849,tt0078788,tt0047296</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000009</span> │ <span style="color: #008000; text-decoration-color: #008000">Richard Burton </span> │ <span style="color: #008000; text-decoration-color: #008000">actor,soundtrack,producer          </span> │ <span style="color: #008000; text-decoration-color: #008000">tt0057877,tt0059749,tt0061184,tt0087803</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000010</span> │ <span style="color: #008000; text-decoration-color: #008000">James Cagney   </span> │ <span style="color: #008000; text-decoration-color: #008000">actor,soundtrack,director          </span> │ <span style="color: #008000; text-decoration-color: #008000">tt0042041,tt0035575,tt0029870,tt0031867</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                       │
└───────────┴─────────────────┴─────────────────────────────────────┴─────────────────────────────────────────┘
</pre>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" aria-labelledby="tabset-2-2-tab">
<div id="9a444397" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">bq_ents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> bq.tables.name_basics.drop(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"birth_year"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"death_year"</span>)</span>
<span id="cb2-2">bq_ents.order_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nconst"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> nconst    </span>┃<span style="font-weight: bold"> primary_name    </span>┃<span style="font-weight: bold"> primary_profession                  </span>┃<span style="font-weight: bold"> known_for_titles                        </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                              │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                  │
├───────────┼─────────────────┼─────────────────────────────────────┼─────────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">nm0000001</span> │ <span style="color: #008000; text-decoration-color: #008000">Fred Astaire   </span> │ <span style="color: #008000; text-decoration-color: #008000">soundtrack,actor,miscellaneous     </span> │ <span style="color: #008000; text-decoration-color: #008000">tt0072308,tt0053137,tt0031983,tt0050419</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000002</span> │ <span style="color: #008000; text-decoration-color: #008000">Lauren Bacall  </span> │ <span style="color: #008000; text-decoration-color: #008000">actress,soundtrack                 </span> │ <span style="color: #008000; text-decoration-color: #008000">tt0038355,tt0075213,tt0117057,tt0037382</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000003</span> │ <span style="color: #008000; text-decoration-color: #008000">Brigitte Bardot</span> │ <span style="color: #008000; text-decoration-color: #008000">actress,soundtrack,music_department</span> │ <span style="color: #008000; text-decoration-color: #008000">tt0049189,tt0054452,tt0056404,tt0057345</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000004</span> │ <span style="color: #008000; text-decoration-color: #008000">John Belushi   </span> │ <span style="color: #008000; text-decoration-color: #008000">actor,soundtrack,writer            </span> │ <span style="color: #008000; text-decoration-color: #008000">tt0072562,tt0078723,tt0080455,tt0077975</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000005</span> │ <span style="color: #008000; text-decoration-color: #008000">Ingmar Bergman </span> │ <span style="color: #008000; text-decoration-color: #008000">writer,director,actor              </span> │ <span style="color: #008000; text-decoration-color: #008000">tt0050976,tt0083922,tt0069467,tt0050986</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000006</span> │ <span style="color: #008000; text-decoration-color: #008000">Ingrid Bergman </span> │ <span style="color: #008000; text-decoration-color: #008000">actress,soundtrack,producer        </span> │ <span style="color: #008000; text-decoration-color: #008000">tt0034583,tt0038787,tt0038109,tt0036855</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000007</span> │ <span style="color: #008000; text-decoration-color: #008000">Humphrey Bogart</span> │ <span style="color: #008000; text-decoration-color: #008000">actor,soundtrack,producer          </span> │ <span style="color: #008000; text-decoration-color: #008000">tt0037382,tt0043265,tt0034583,tt0042593</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000008</span> │ <span style="color: #008000; text-decoration-color: #008000">Marlon Brando  </span> │ <span style="color: #008000; text-decoration-color: #008000">actor,soundtrack,director          </span> │ <span style="color: #008000; text-decoration-color: #008000">tt0068646,tt0070849,tt0047296,tt0078788</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000009</span> │ <span style="color: #008000; text-decoration-color: #008000">Richard Burton </span> │ <span style="color: #008000; text-decoration-color: #008000">actor,soundtrack,producer          </span> │ <span style="color: #008000; text-decoration-color: #008000">tt0061184,tt0087803,tt0057877,tt0059749</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000010</span> │ <span style="color: #008000; text-decoration-color: #008000">James Cagney   </span> │ <span style="color: #008000; text-decoration-color: #008000">actor,soundtrack,director          </span> │ <span style="color: #008000; text-decoration-color: #008000">tt0042041,tt0029870,tt0031867,tt0035575</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                       │
└───────────┴─────────────────┴─────────────────────────────────────┴─────────────────────────────────────────┘
</pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="splitting-strings-into-arrays" class="level3">
<h3 class="anchored" data-anchor-id="splitting-strings-into-arrays">Splitting strings into arrays</h3>
<p>We can see that <code>known_for_titles</code> looks sort of like an array, so let’s call the <a href="../../reference/expression-strings.html#ibis.expr.types.strings.StringValue.split"><code>split</code></a> method on that column and replace the existing column:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" aria-controls="tabset-3-1" aria-selected="true">DuckDB</a></li><li class="nav-item"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" aria-controls="tabset-3-2" aria-selected="false">BigQuery</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" aria-labelledby="tabset-3-1-tab">
<div id="337dbe6a" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">ddb_ents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ddb_ents.mutate(known_for_titles<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.known_for_titles.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>))</span>
<span id="cb3-2">ddb_ents.order_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nconst"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> nconst    </span>┃<span style="font-weight: bold"> primary_name    </span>┃<span style="font-weight: bold"> primary_profession                  </span>┃<span style="font-weight: bold"> known_for_titles                   </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                              │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                      │
├───────────┼─────────────────┼─────────────────────────────────────┼────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">nm0000001</span> │ <span style="color: #008000; text-decoration-color: #008000">Fred Astaire   </span> │ <span style="color: #008000; text-decoration-color: #008000">soundtrack,actor,miscellaneous     </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0053137'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0072308'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000002</span> │ <span style="color: #008000; text-decoration-color: #008000">Lauren Bacall  </span> │ <span style="color: #008000; text-decoration-color: #008000">actress,soundtrack                 </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0037382'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0117057'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000003</span> │ <span style="color: #008000; text-decoration-color: #008000">Brigitte Bardot</span> │ <span style="color: #008000; text-decoration-color: #008000">actress,soundtrack,music_department</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0057345'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0054452'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000004</span> │ <span style="color: #008000; text-decoration-color: #008000">John Belushi   </span> │ <span style="color: #008000; text-decoration-color: #008000">actor,soundtrack,writer            </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0072562'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0078723'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000005</span> │ <span style="color: #008000; text-decoration-color: #008000">Ingmar Bergman </span> │ <span style="color: #008000; text-decoration-color: #008000">writer,director,actor              </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0083922'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0069467'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000006</span> │ <span style="color: #008000; text-decoration-color: #008000">Ingrid Bergman </span> │ <span style="color: #008000; text-decoration-color: #008000">actress,soundtrack,producer        </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0038109'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0036855'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000007</span> │ <span style="color: #008000; text-decoration-color: #008000">Humphrey Bogart</span> │ <span style="color: #008000; text-decoration-color: #008000">actor,soundtrack,producer          </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0037382'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0034583'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000008</span> │ <span style="color: #008000; text-decoration-color: #008000">Marlon Brando  </span> │ <span style="color: #008000; text-decoration-color: #008000">actor,soundtrack,director          </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0068646'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0070849'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000009</span> │ <span style="color: #008000; text-decoration-color: #008000">Richard Burton </span> │ <span style="color: #008000; text-decoration-color: #008000">actor,soundtrack,producer          </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0057877'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0059749'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000010</span> │ <span style="color: #008000; text-decoration-color: #008000">James Cagney   </span> │ <span style="color: #008000; text-decoration-color: #008000">actor,soundtrack,director          </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0042041'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0035575'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                  │
└───────────┴─────────────────┴─────────────────────────────────────┴────────────────────────────────────┘
</pre>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" aria-labelledby="tabset-3-2-tab">
<div id="bb1ea1fe" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">bq_ents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> bq_ents.mutate(known_for_titles<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.known_for_titles.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>))</span>
<span id="cb4-2">bq_ents.order_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nconst"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> nconst    </span>┃<span style="font-weight: bold"> primary_name    </span>┃<span style="font-weight: bold"> primary_profession                  </span>┃<span style="font-weight: bold"> known_for_titles                   </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                              │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                      │
├───────────┼─────────────────┼─────────────────────────────────────┼────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">nm0000001</span> │ <span style="color: #008000; text-decoration-color: #008000">Fred Astaire   </span> │ <span style="color: #008000; text-decoration-color: #008000">soundtrack,actor,miscellaneous     </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0072308'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0053137'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000002</span> │ <span style="color: #008000; text-decoration-color: #008000">Lauren Bacall  </span> │ <span style="color: #008000; text-decoration-color: #008000">actress,soundtrack                 </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0038355'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0075213'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000003</span> │ <span style="color: #008000; text-decoration-color: #008000">Brigitte Bardot</span> │ <span style="color: #008000; text-decoration-color: #008000">actress,soundtrack,music_department</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0049189'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0054452'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000004</span> │ <span style="color: #008000; text-decoration-color: #008000">John Belushi   </span> │ <span style="color: #008000; text-decoration-color: #008000">actor,soundtrack,writer            </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0072562'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0078723'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000005</span> │ <span style="color: #008000; text-decoration-color: #008000">Ingmar Bergman </span> │ <span style="color: #008000; text-decoration-color: #008000">writer,director,actor              </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0050976'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0083922'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000006</span> │ <span style="color: #008000; text-decoration-color: #008000">Ingrid Bergman </span> │ <span style="color: #008000; text-decoration-color: #008000">actress,soundtrack,producer        </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0034583'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0038787'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000007</span> │ <span style="color: #008000; text-decoration-color: #008000">Humphrey Bogart</span> │ <span style="color: #008000; text-decoration-color: #008000">actor,soundtrack,producer          </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0037382'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0043265'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000008</span> │ <span style="color: #008000; text-decoration-color: #008000">Marlon Brando  </span> │ <span style="color: #008000; text-decoration-color: #008000">actor,soundtrack,director          </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0068646'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0070849'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000009</span> │ <span style="color: #008000; text-decoration-color: #008000">Richard Burton </span> │ <span style="color: #008000; text-decoration-color: #008000">actor,soundtrack,producer          </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0061184'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0087803'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000010</span> │ <span style="color: #008000; text-decoration-color: #008000">James Cagney   </span> │ <span style="color: #008000; text-decoration-color: #008000">actor,soundtrack,director          </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0042041'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0029870'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                  │
└───────────┴─────────────────┴─────────────────────────────────────┴────────────────────────────────────┘
</pre>
</div>
</div>
</div>
</div>
</div>
<p>Similarly for <code>primary_profession</code>, since people involved in show business often have more than one responsibility on a project:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" aria-controls="tabset-4-1" aria-selected="true">DuckDB</a></li><li class="nav-item"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" aria-controls="tabset-4-2" aria-selected="false">BigQuery</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" aria-labelledby="tabset-4-1-tab">
<div id="bf33447a" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">ddb_ents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ddb_ents.mutate(primary_profession<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.primary_profession.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>))</span></code></pre></div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" aria-labelledby="tabset-4-2-tab">
<div id="eea20c44" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">bq_ents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> bq_ents.mutate(primary_profession<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.primary_profession.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>))</span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="array-length" class="level3">
<h3 class="anchored" data-anchor-id="array-length">Array length</h3>
<p>Let’s see how many titles each entity is known for, and then show the five people with the largest number of titles they’re known for.</p>
<p>This is computed using the <a href="../../reference/expression-collections.html#ibis.expr.types.arrays.ArrayValue.length"><code>length</code></a> API on array expressions:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" aria-controls="tabset-5-1" aria-selected="true">DuckDB</a></li><li class="nav-item"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" aria-controls="tabset-5-2" aria-selected="false">BigQuery</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" aria-labelledby="tabset-5-1-tab">
<div id="5f0b413d" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">(</span>
<span id="cb7-2">    ddb_ents.select(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"primary_name"</span>, num_titles<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.known_for_titles.length())</span>
<span id="cb7-3">    .order_by(_.num_titles.desc())</span>
<span id="cb7-4">    .limit(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb7-5">)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> primary_name     </span>┃<span style="font-weight: bold"> num_titles </span>┃
┡━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>      │
├──────────────────┼────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">Alex Koenigsmark</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Carrie Schnelker</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Henry Townsend  </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Sally Sun       </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Matthew Kavuma  </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span> │
└──────────────────┴────────────┘
</pre>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" aria-labelledby="tabset-5-2-tab">
<div id="056cde90" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">(</span>
<span id="cb8-2">    bq_ents.select(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"primary_name"</span>, num_titles<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.known_for_titles.length())</span>
<span id="cb8-3">    .order_by(_.num_titles.desc())</span>
<span id="cb8-4">    .limit(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb8-5">)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> primary_name        </span>┃<span style="font-weight: bold"> num_titles </span>┃
┡━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>              │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>      │
├─────────────────────┼────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">José Jaime Espinosa</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Paul Winter        </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Nicolas Bernier    </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Chris Estrada      </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Tsuyotake Matsuda  </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span> │
└─────────────────────┴────────────┘
</pre>
</div>
</div>
</div>
</div>
</div>
<p>It seems like the length of the <code>known_for_titles</code> might be capped at some small number!</p>
</section>
<section id="index" class="level3">
<h3 class="anchored" data-anchor-id="index">Index</h3>
<p>We can see the position of <code>"actor"</code> or <code>"actress"</code> in <code>primary_profession</code>s:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" aria-controls="tabset-6-1" aria-selected="true">DuckDB</a></li><li class="nav-item"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" aria-controls="tabset-6-2" aria-selected="false">BigQuery</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" aria-labelledby="tabset-6-1-tab">
<div id="cbc557e3" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1">ddb_ents.primary_profession.index(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"actor"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> ArrayPosition(primary_profession, 'actor') </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>                                      │
├────────────────────────────────────────────┤
│                                          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │
│                                         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │
│                                          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span> │
│                                         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │
│                                          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │
│                                          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │
│                                          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │
│                                          <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└────────────────────────────────────────────┘
</pre>
</div>
</div>
<div id="3eb36d0b" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">ddb_ents.primary_profession.index(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"actress"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> ArrayPosition(primary_profession, 'actress') </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>                                        │
├──────────────────────────────────────────────┤
│                                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │
│                                            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │
│                                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │
│                                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                            <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└──────────────────────────────────────────────┘
</pre>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" aria-labelledby="tabset-6-2-tab">
<div id="7efe2a42" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">bq_ents.primary_profession.index(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"actor"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> ArrayPosition(primary_profession, 'actor') </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>                                      │
├────────────────────────────────────────────┤
│                                         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                          <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└────────────────────────────────────────────┘
</pre>
</div>
</div>
<div id="909e212d" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1">bq_ents.primary_profession.index(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"actress"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> ArrayPosition(primary_profession, 'actress') </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>                                        │
├──────────────────────────────────────────────┤
│                                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                            <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└──────────────────────────────────────────────┘
</pre>
</div>
</div>
</div>
</div>
</div>
<p>A return value of <code>-1</code> indicates that <code>"actor"</code> is not present in the value.</p>
<p>Let’s look for entities that are not primarily actors.</p>
<p>We can do this using the <a href="../../reference/expression-collections.html#ibis.expr.types.arrays.ArrayValue.index"><code>index</code></a> method by checking whether the positions of the strings <code>"actor"</code> or <code>"actress"</code> are both greater than 0:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" aria-controls="tabset-7-1" aria-selected="true">DuckDB</a></li><li class="nav-item"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" aria-controls="tabset-7-2" aria-selected="false">BigQuery</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" aria-labelledby="tabset-7-1-tab">
<div id="96ef0c2b" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1">actor_index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ddb_ents.primary_profession.index(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"actor"</span>)</span>
<span id="cb13-2">actress_index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ddb_ents.primary_profession.index(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"actress"</span>)</span>
<span id="cb13-3"></span>
<span id="cb13-4">ddb_not_primarily_acting <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (actor_index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> (actress_index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb13-5">ddb_not_primarily_acting.mean()</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div class="ansi-escaped-output">
<pre><span class="ansi-cyan-fg ansi-bold">0.0</span></pre>
</div>
</div>
</div>
</div>
<div id="tabset-7-2" class="tab-pane" aria-labelledby="tabset-7-2-tab">
<div id="e10553cc" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1">actor_index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> bq_ents.primary_profession.index(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"actor"</span>)</span>
<span id="cb14-2">actress_index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> bq_ents.primary_profession.index(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"actress"</span>)</span>
<span id="cb14-3"></span>
<span id="cb14-4">bq_not_primarily_acting <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (actor_index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> (actress_index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb14-5">bq_not_primarily_acting.mean()</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div class="ansi-escaped-output">
<pre><span class="ansi-cyan-fg ansi-bold">0.0</span></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Who are they?</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" aria-controls="tabset-8-1" aria-selected="true">DuckDB</a></li><li class="nav-item"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" aria-controls="tabset-8-2" aria-selected="false">BigQuery</a></li></ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" aria-labelledby="tabset-8-1-tab">
<div id="a4243c7c" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1">ddb_ents[ddb_not_primarily_acting].order_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nconst"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> nconst </span>┃<span style="font-weight: bold"> primary_name </span>┃<span style="font-weight: bold"> primary_profession </span>┃<span style="font-weight: bold"> known_for_titles </span>┃
┡━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>    │
└────────┴──────────────┴────────────────────┴──────────────────┘
</pre>
</div>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" aria-labelledby="tabset-8-2-tab">
<div id="40b5ad2f" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1">bq_ents[bq_not_primarily_acting].order_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nconst"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> nconst </span>┃<span style="font-weight: bold"> primary_name </span>┃<span style="font-weight: bold"> primary_profession </span>┃<span style="font-weight: bold"> known_for_titles </span>┃
┡━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>    │
└────────┴──────────────┴────────────────────┴──────────────────┘
</pre>
</div>
</div>
</div>
</div>
</div>
<p>It’s not 100% clear whether the order of elements in <code>primary_profession</code> matters here.</p>
</section>
<section id="containment" class="level3">
<h3 class="anchored" data-anchor-id="containment">Containment</h3>
<p>We can get people who are listed as actors or actresses using <code>contains</code>:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" aria-controls="tabset-9-1" aria-selected="true">DuckDB</a></li><li class="nav-item"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" aria-controls="tabset-9-2" aria-selected="false">BigQuery</a></li></ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" aria-labelledby="tabset-9-1-tab">
<div id="db2f9479" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1">ddb_non_actors <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> bq_ents[</span>
<span id="cb17-2">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>_.primary_profession.contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"actor"</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>_.primary_profession.contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"actress"</span>)</span>
<span id="cb17-3">]</span>
<span id="cb17-4">ddb_non_actors.order_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nconst"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> nconst    </span>┃<span style="font-weight: bold"> primary_name     </span>┃<span style="font-weight: bold"> primary_profession                         </span>┃<span style="font-weight: bold"> known_for_titles                   </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                              │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                      │
├───────────┼──────────────────┼────────────────────────────────────────────┼────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">nm0000016</span> │ <span style="color: #008000; text-decoration-color: #008000">Georges Delerue </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'composer'</span>, <span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>         │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt8847712'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0091763'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000025</span> │ <span style="color: #008000; text-decoration-color: #008000">Jerry Goldsmith </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'music_department'</span>, <span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0077269'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0117731'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000033</span> │ <span style="color: #008000; text-decoration-color: #008000">Alfred Hitchcock</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'director'</span>, <span style="color: #008000; text-decoration-color: #008000">'producer'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>           │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0054215'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0052357'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000035</span> │ <span style="color: #008000; text-decoration-color: #008000">James Horner    </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'music_department'</span>, <span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0177971'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0120338'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000040</span> │ <span style="color: #008000; text-decoration-color: #008000">Stanley Kubrick </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'director'</span>, <span style="color: #008000; text-decoration-color: #008000">'writer'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>             │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0120663'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0066921'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000041</span> │ <span style="color: #008000; text-decoration-color: #008000">Akira Kurosawa  </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'writer'</span>, <span style="color: #008000; text-decoration-color: #008000">'director'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>             │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0080979'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0089881'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000049</span> │ <span style="color: #008000; text-decoration-color: #008000">Henry Mancini   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'music_department'</span>, <span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0383216'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0054698'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000055</span> │ <span style="color: #008000; text-decoration-color: #008000">Alfred Newman   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'music_department'</span>, <span style="color: #008000; text-decoration-color: #008000">'composer'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>   │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0049408'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0434409'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000065</span> │ <span style="color: #008000; text-decoration-color: #008000">Nino Rota       </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'composer'</span>, <span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>         │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0071562'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0056801'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000067</span> │ <span style="color: #008000; text-decoration-color: #008000">Miklós Rózsa    </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'music_department'</span>, <span style="color: #008000; text-decoration-color: #008000">'composer'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>   │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0052618'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0038109'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                  │
└───────────┴──────────────────┴────────────────────────────────────────────┴────────────────────────────────────┘
</pre>
</div>
</div>
</div>
<div id="tabset-9-2" class="tab-pane" aria-labelledby="tabset-9-2-tab">
<div id="9fb71b70" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1">bq_non_actors <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> bq_ents[</span>
<span id="cb18-2">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>_.primary_profession.contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"actor"</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>_.primary_profession.contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"actress"</span>)</span>
<span id="cb18-3">]</span>
<span id="cb18-4">bq_non_actors.order_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nconst"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> nconst    </span>┃<span style="font-weight: bold"> primary_name     </span>┃<span style="font-weight: bold"> primary_profession                         </span>┃<span style="font-weight: bold"> known_for_titles                   </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                              │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                      │
├───────────┼──────────────────┼────────────────────────────────────────────┼────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">nm0000016</span> │ <span style="color: #008000; text-decoration-color: #008000">Georges Delerue </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'composer'</span>, <span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>         │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt8847712'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0091763'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000025</span> │ <span style="color: #008000; text-decoration-color: #008000">Jerry Goldsmith </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'music_department'</span>, <span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0077269'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0117731'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000033</span> │ <span style="color: #008000; text-decoration-color: #008000">Alfred Hitchcock</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'director'</span>, <span style="color: #008000; text-decoration-color: #008000">'producer'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>           │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0054215'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0052357'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000035</span> │ <span style="color: #008000; text-decoration-color: #008000">James Horner    </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'music_department'</span>, <span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0177971'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0120338'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000040</span> │ <span style="color: #008000; text-decoration-color: #008000">Stanley Kubrick </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'director'</span>, <span style="color: #008000; text-decoration-color: #008000">'writer'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>             │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0120663'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0066921'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000041</span> │ <span style="color: #008000; text-decoration-color: #008000">Akira Kurosawa  </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'writer'</span>, <span style="color: #008000; text-decoration-color: #008000">'director'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>             │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0080979'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0089881'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000049</span> │ <span style="color: #008000; text-decoration-color: #008000">Henry Mancini   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'music_department'</span>, <span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0383216'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0054698'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000055</span> │ <span style="color: #008000; text-decoration-color: #008000">Alfred Newman   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'music_department'</span>, <span style="color: #008000; text-decoration-color: #008000">'composer'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>   │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0049408'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0434409'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000065</span> │ <span style="color: #008000; text-decoration-color: #008000">Nino Rota       </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'composer'</span>, <span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>         │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0071562'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0056801'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000067</span> │ <span style="color: #008000; text-decoration-color: #008000">Miklós Rózsa    </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'music_department'</span>, <span style="color: #008000; text-decoration-color: #008000">'composer'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>   │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0052618'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0038109'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                  │
└───────────┴──────────────────┴────────────────────────────────────────────┴────────────────────────────────────┘
</pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="element-removal" class="level3">
<h3 class="anchored" data-anchor-id="element-removal">Element removal</h3>
<p>We can remove elements from arrays too.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<a href="../../reference/expression-collections.html#ibis.expr.types.arrays.ArrayValue.remove"><code>remove()</code></a> does not mutate the underlying data
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<p>Let’s see who only has “actor” in the list of their primary professions:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" aria-controls="tabset-10-1" aria-selected="true">DuckDB</a></li><li class="nav-item"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" aria-controls="tabset-10-2" aria-selected="false">BigQuery</a></li></ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" aria-labelledby="tabset-10-1-tab">
<div id="551005a1" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1">ddb_ents.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="cb19-2">    [</span>
<span id="cb19-3">        _.primary_profession.length() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb19-4">        _.primary_profession.remove(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"actor"</span>).length() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb19-5">        _.primary_profession.remove(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"actress"</span>).length() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb19-6">    ]</span>
<span id="cb19-7">).order_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nconst"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> nconst </span>┃<span style="font-weight: bold"> primary_name </span>┃<span style="font-weight: bold"> primary_profession </span>┃<span style="font-weight: bold"> known_for_titles </span>┃
┡━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>    │
└────────┴──────────────┴────────────────────┴──────────────────┘
</pre>
</div>
</div>
</div>
<div id="tabset-10-2" class="tab-pane" aria-labelledby="tabset-10-2-tab">
<div id="6b4f941c" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1">bq_ents.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="cb20-2">    [</span>
<span id="cb20-3">        _.primary_profession.length() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb20-4">        _.primary_profession.remove(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"actor"</span>).length() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb20-5">        _.primary_profession.remove(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"actress"</span>).length() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb20-6">    ]</span>
<span id="cb20-7">).order_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nconst"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> nconst </span>┃<span style="font-weight: bold"> primary_name </span>┃<span style="font-weight: bold"> primary_profession </span>┃<span style="font-weight: bold"> known_for_titles </span>┃
┡━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>    │
└────────┴──────────────┴────────────────────┴──────────────────┘
</pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="slicing-with-square-bracket-syntax" class="level3">
<h3 class="anchored" data-anchor-id="slicing-with-square-bracket-syntax">Slicing with square-bracket syntax</h3>
<p>Let’s remove everyone’s first profession from the list, but only if they have more than one profession listed:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" aria-controls="tabset-11-1" aria-selected="true">DuckDB</a></li><li class="nav-item"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" aria-controls="tabset-11-2" aria-selected="false">BigQuery</a></li></ul>
<div class="tab-content">
<div id="tabset-11-1" class="tab-pane active" aria-labelledby="tabset-11-1-tab">
<div id="7751efa4" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1">ddb_ents[_.primary_profession.length() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].mutate(</span>
<span id="cb21-2">    primary_profession<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.primary_profession[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:],</span>
<span id="cb21-3">).order_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nconst"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> nconst    </span>┃<span style="font-weight: bold"> primary_name    </span>┃<span style="font-weight: bold"> primary_profession                 </span>┃<span style="font-weight: bold"> known_for_titles                   </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                      │
├───────────┼─────────────────┼────────────────────────────────────┼────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">nm0000001</span> │ <span style="color: #008000; text-decoration-color: #008000">Fred Astaire   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'actor'</span>, <span style="color: #008000; text-decoration-color: #008000">'miscellaneous'</span><span style="font-weight: bold">]</span>         │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0053137'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0072308'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000002</span> │ <span style="color: #008000; text-decoration-color: #008000">Lauren Bacall  </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span><span style="font-weight: bold">]</span>                     │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0037382'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0117057'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000003</span> │ <span style="color: #008000; text-decoration-color: #008000">Brigitte Bardot</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #008000; text-decoration-color: #008000">'music_department'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0057345'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0054452'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000004</span> │ <span style="color: #008000; text-decoration-color: #008000">John Belushi   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #008000; text-decoration-color: #008000">'writer'</span><span style="font-weight: bold">]</span>           │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0072562'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0078723'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000005</span> │ <span style="color: #008000; text-decoration-color: #008000">Ingmar Bergman </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'director'</span>, <span style="color: #008000; text-decoration-color: #008000">'actor'</span><span style="font-weight: bold">]</span>              │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0083922'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0069467'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000006</span> │ <span style="color: #008000; text-decoration-color: #008000">Ingrid Bergman </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #008000; text-decoration-color: #008000">'producer'</span><span style="font-weight: bold">]</span>         │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0038109'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0036855'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000007</span> │ <span style="color: #008000; text-decoration-color: #008000">Humphrey Bogart</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #008000; text-decoration-color: #008000">'producer'</span><span style="font-weight: bold">]</span>         │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0037382'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0034583'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000008</span> │ <span style="color: #008000; text-decoration-color: #008000">Marlon Brando  </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #008000; text-decoration-color: #008000">'director'</span><span style="font-weight: bold">]</span>         │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0068646'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0070849'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000009</span> │ <span style="color: #008000; text-decoration-color: #008000">Richard Burton </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #008000; text-decoration-color: #008000">'producer'</span><span style="font-weight: bold">]</span>         │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0057877'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0059749'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000010</span> │ <span style="color: #008000; text-decoration-color: #008000">James Cagney   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #008000; text-decoration-color: #008000">'director'</span><span style="font-weight: bold">]</span>         │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0042041'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0035575'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                  │
└───────────┴─────────────────┴────────────────────────────────────┴────────────────────────────────────┘
</pre>
</div>
</div>
</div>
<div id="tabset-11-2" class="tab-pane" aria-labelledby="tabset-11-2-tab">
<div id="295ffc5a" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1">bq_ents[_.primary_profession.length() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].mutate(</span>
<span id="cb22-2">    primary_profession<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.primary_profession[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:],</span>
<span id="cb22-3">).order_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nconst"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> nconst    </span>┃<span style="font-weight: bold"> primary_name    </span>┃<span style="font-weight: bold"> primary_profession                 </span>┃<span style="font-weight: bold"> known_for_titles                   </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                      │
├───────────┼─────────────────┼────────────────────────────────────┼────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">nm0000001</span> │ <span style="color: #008000; text-decoration-color: #008000">Fred Astaire   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'actor'</span>, <span style="color: #008000; text-decoration-color: #008000">'miscellaneous'</span><span style="font-weight: bold">]</span>         │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0072308'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0053137'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000002</span> │ <span style="color: #008000; text-decoration-color: #008000">Lauren Bacall  </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span><span style="font-weight: bold">]</span>                     │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0038355'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0075213'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000003</span> │ <span style="color: #008000; text-decoration-color: #008000">Brigitte Bardot</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #008000; text-decoration-color: #008000">'music_department'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0049189'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0054452'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000004</span> │ <span style="color: #008000; text-decoration-color: #008000">John Belushi   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #008000; text-decoration-color: #008000">'writer'</span><span style="font-weight: bold">]</span>           │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0072562'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0078723'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000005</span> │ <span style="color: #008000; text-decoration-color: #008000">Ingmar Bergman </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'director'</span>, <span style="color: #008000; text-decoration-color: #008000">'actor'</span><span style="font-weight: bold">]</span>              │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0050976'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0083922'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000006</span> │ <span style="color: #008000; text-decoration-color: #008000">Ingrid Bergman </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #008000; text-decoration-color: #008000">'producer'</span><span style="font-weight: bold">]</span>         │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0034583'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0038787'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000007</span> │ <span style="color: #008000; text-decoration-color: #008000">Humphrey Bogart</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #008000; text-decoration-color: #008000">'producer'</span><span style="font-weight: bold">]</span>         │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0037382'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0043265'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000008</span> │ <span style="color: #008000; text-decoration-color: #008000">Marlon Brando  </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #008000; text-decoration-color: #008000">'director'</span><span style="font-weight: bold">]</span>         │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0068646'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0070849'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000009</span> │ <span style="color: #008000; text-decoration-color: #008000">Richard Burton </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #008000; text-decoration-color: #008000">'producer'</span><span style="font-weight: bold">]</span>         │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0061184'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0087803'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000010</span> │ <span style="color: #008000; text-decoration-color: #008000">James Cagney   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #008000; text-decoration-color: #008000">'director'</span><span style="font-weight: bold">]</span>         │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0042041'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0029870'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                  │
└───────────┴─────────────────┴────────────────────────────────────┴────────────────────────────────────┘
</pre>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="set-operations-and-sorting" class="level2">
<h2 class="anchored" data-anchor-id="set-operations-and-sorting">Set operations and sorting</h2>
<p>Treating arrays as sets is possible with the <a href="../../reference/expression-collections.html#ibis.expr.types.arrays.ArrayValue.union"><code>union</code></a> and <a href="../../reference/expression-collections.html#ibis.expr.types.arrays.ArrayValue.intersect"><code>intersect</code></a> APIs.</p>
<p>Let’s take a look at <code>intersect</code>.</p>
<section id="intersection" class="level3">
<h3 class="anchored" data-anchor-id="intersection">Intersection</h3>
<p>Let’s see if we can use array intersection to figure which actors share known-for titles and sort the result:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" aria-controls="tabset-12-1" aria-selected="true">DuckDB</a></li><li class="nav-item"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" aria-controls="tabset-12-2" aria-selected="false">BigQuery</a></li></ul>
<div class="tab-content">
<div id="tabset-12-1" class="tab-pane active" aria-labelledby="tabset-12-1-tab">
<div id="1d68e19a" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1">left <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ddb_ents.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(_.known_for_titles.length() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>).limit(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10_000</span>)</span>
<span id="cb23-2">right <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> left.view()</span>
<span id="cb23-3">shared_titles <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb23-4">    left</span>
<span id="cb23-5">    .join(right, left.nconst <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> right.nconst)</span>
<span id="cb23-6">    .select(</span>
<span id="cb23-7">        s.startswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"known_for_titles"</span>),</span>
<span id="cb23-8">        left_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"primary_name"</span>,</span>
<span id="cb23-9">        right_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"primary_name_right"</span>,</span>
<span id="cb23-10">    )</span>
<span id="cb23-11">    .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(_.known_for_titles.intersect(_.known_for_titles_right).length() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb23-12">    .group_by(name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left_name"</span>)</span>
<span id="cb23-13">    .agg(together_with<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.right_name.collect())</span>
<span id="cb23-14">    .mutate(together_with<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.together_with.unique().sort())</span>
<span id="cb23-15">)</span>
<span id="cb23-16">shared_titles</span></code></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"cb46ead42abf4f4684b5f9b2fa75b2ed","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> name                 </span>┃<span style="font-weight: bold"> together_with                                 </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                                 │
├──────────────────────┼───────────────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">Ava Gardner         </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Ernest Gold'</span>, <span style="color: #008000; text-decoration-color: #008000">'Fred Astaire'</span><span style="font-weight: bold">]</span>               │
│ <span style="color: #008000; text-decoration-color: #008000">Cyd Charisse        </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Fred Astaire'</span><span style="font-weight: bold">]</span>                              │
│ <span style="color: #008000; text-decoration-color: #008000">John Landis         </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Dan Aykroyd'</span>, <span style="color: #008000; text-decoration-color: #008000">'Dick Ziker'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">14</span><span style="font-weight: bold">]</span>        │
│ <span style="color: #008000; text-decoration-color: #008000">Michael Curtiz      </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Alan Hale'</span>, <span style="color: #008000; text-decoration-color: #008000">'Ann Blyth'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">19</span><span style="font-weight: bold">]</span>           │
│ <span style="color: #008000; text-decoration-color: #008000">Francis Ford Coppola</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Abe Vigoda'</span>, <span style="color: #008000; text-decoration-color: #008000">'Al Pacino'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">19</span><span style="font-weight: bold">]</span>          │
│ <span style="color: #008000; text-decoration-color: #008000">Bernardo Bertolucci </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Armand Abplanalp'</span>, <span style="color: #008000; text-decoration-color: #008000">'James Acheson'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Karl Malden         </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Abraxas Aaran'</span>, <span style="color: #008000; text-decoration-color: #008000">'Alex North'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">14</span><span style="font-weight: bold">]</span>      │
│ <span style="color: #008000; text-decoration-color: #008000">Richard Conte       </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Abe Vigoda'</span>, <span style="color: #008000; text-decoration-color: #008000">'Al Pacino'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">9</span><span style="font-weight: bold">]</span>           │
│ <span style="color: #008000; text-decoration-color: #008000">George Orwell       </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'John Hurt'</span>, <span style="color: #008000; text-decoration-color: #008000">'Richard Burton'</span><span style="font-weight: bold">]</span>               │
│ <span style="color: #008000; text-decoration-color: #008000">Joseph L. Mankiewicz</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Alfred Newman'</span>, <span style="color: #008000; text-decoration-color: #008000">'Anne Baxter'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">13</span><span style="font-weight: bold">]</span>     │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                             │
└──────────────────────┴───────────────────────────────────────────────┘
</pre>
</div>
</div>
</div>
<div id="tabset-12-2" class="tab-pane" aria-labelledby="tabset-12-2-tab">
<div id="ecaee965" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1">left <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> bq_ents.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(_.known_for_titles.length() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>).limit(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10_000</span>)</span>
<span id="cb24-2">right <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> left.view()</span>
<span id="cb24-3">shared_titles <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb24-4">    left</span>
<span id="cb24-5">    .join(right, left.nconst <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> right.nconst)</span>
<span id="cb24-6">    .select(</span>
<span id="cb24-7">        s.startswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"known_for_titles"</span>),</span>
<span id="cb24-8">        left_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"primary_name"</span>,</span>
<span id="cb24-9">        right_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"primary_name_right"</span>,</span>
<span id="cb24-10">    )</span>
<span id="cb24-11">    .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(_.known_for_titles.intersect(_.known_for_titles_right).length() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb24-12">    .group_by(name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left_name"</span>)</span>
<span id="cb24-13">    .agg(together_with<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.right_name.collect())</span>
<span id="cb24-14">    .mutate(together_with<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.together_with.unique().sort())</span>
<span id="cb24-15">)</span>
<span id="cb24-16">shared_titles</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> name                    </span>┃<span style="font-weight: bold"> together_with                                       </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                                       │
├─────────────────────────┼─────────────────────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">Pavel Vrba             </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'F.C. Lokomotiv Moscow'</span>, <span style="color: #008000; text-decoration-color: #008000">'Jeffrey Bruma'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4</span><span style="font-weight: bold">]</span>  │
│ <span style="color: #008000; text-decoration-color: #008000">Greg Carrolan          </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Al Cambronne'</span>, <span style="color: #008000; text-decoration-color: #008000">'Alana Tornello'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20</span><span style="font-weight: bold">]</span>         │
│ <span style="color: #008000; text-decoration-color: #008000">Aleksander Parzychowski</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Adam Korszun'</span>, <span style="color: #008000; text-decoration-color: #008000">'Grzegorz Wawrzenczyk'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span><span style="font-weight: bold">]</span>    │
│ <span style="color: #008000; text-decoration-color: #008000">James Walt             </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Anton Testino'</span>, <span style="color: #008000; text-decoration-color: #008000">'Ben Walanka'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10</span><span style="font-weight: bold">]</span>           │
│ <span style="color: #008000; text-decoration-color: #008000">Ellen Dallaglio        </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Antonia Giovanazzi'</span>, <span style="color: #008000; text-decoration-color: #008000">'Fra McCann'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10</span><span style="font-weight: bold">]</span>       │
│ <span style="color: #008000; text-decoration-color: #008000">Catarina Martins       </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Miguel Oliveira'</span>, <span style="color: #008000; text-decoration-color: #008000">'Ricardo Gordon'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>       │
│ <span style="color: #008000; text-decoration-color: #008000">Stanislav Sesták       </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Martin Glenn'</span>, <span style="color: #008000; text-decoration-color: #008000">'Miso Brecko'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6</span><span style="font-weight: bold">]</span>             │
│ <span style="color: #008000; text-decoration-color: #008000">Allison Cabot          </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Brenda Beard'</span>, <span style="color: #008000; text-decoration-color: #008000">'Brian Fenmore'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">16</span><span style="font-weight: bold">]</span>          │
│ <span style="color: #008000; text-decoration-color: #008000">Vasilis Bouzianas      </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Aggelos Kasolas'</span>, <span style="color: #008000; text-decoration-color: #008000">'Christos Patriarheas'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Marie Muldoon          </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Alan Oxley'</span>, <span style="color: #008000; text-decoration-color: #008000">'Andrew Raeber'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39</span><span style="font-weight: bold">]</span>            │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                   │
└─────────────────────────┴─────────────────────────────────────────────────────┘
</pre>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="advanced-operations" class="level2">
<h2 class="anchored" data-anchor-id="advanced-operations">Advanced operations</h2>
<section id="flatten-arrays-into-rows" class="level3">
<h3 class="anchored" data-anchor-id="flatten-arrays-into-rows">Flatten arrays into rows</h3>
<p>Thanks to the <a href="https://github.com/tobymao/sqlglot/commit/06e0869e7aa5714d77e6ec763da38d6a422965fa">tireless efforts</a> of the <a href="https://github.com/tobymao/sqlglot/graphs/contributors">folks</a> working on <a href="https://github.com/tobymao/sqlglot"><code>sqlglot</code></a>, as of version 7.0.0 Ibis supports <a href="../../reference/expression-collections.html#ibis.expr.types.arrays.ArrayValue.unnest"><code>unnest</code></a> for BigQuery!</p>
<p>You can use it standalone on a column expression:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" aria-controls="tabset-13-1" aria-selected="true">DuckDB</a></li><li class="nav-item"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" aria-controls="tabset-13-2" aria-selected="false">BigQuery</a></li></ul>
<div class="tab-content">
<div id="tabset-13-1" class="tab-pane active" aria-labelledby="tabset-13-1-tab">
<div id="e5f62712" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1">ddb_ents.primary_profession.unnest()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> primary_profession </span>┃
┡━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>             │
├────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">soundtrack        </span> │
│ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │
│ <span style="color: #008000; text-decoration-color: #008000">miscellaneous     </span> │
│ <span style="color: #008000; text-decoration-color: #008000">actress           </span> │
│ <span style="color: #008000; text-decoration-color: #008000">soundtrack        </span> │
│ <span style="color: #008000; text-decoration-color: #008000">actress           </span> │
│ <span style="color: #008000; text-decoration-color: #008000">soundtrack        </span> │
│ <span style="color: #008000; text-decoration-color: #008000">music_department  </span> │
│ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │
│ <span style="color: #008000; text-decoration-color: #008000">soundtrack        </span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                  │
└────────────────────┘
</pre>
</div>
</div>
</div>
<div id="tabset-13-2" class="tab-pane" aria-labelledby="tabset-13-2-tab">
<div id="39a19645" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1">bq_ents.primary_profession.unnest()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> primary_profession </span>┃
┡━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>             │
├────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │
│ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │
│ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │
│ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │
│ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │
│ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │
│ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │
│ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │
│ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │
│ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                  │
└────────────────────┘
</pre>
</div>
</div>
</div>
</div>
</div>
<p>You can also use it in <code>select</code>/<code>mutate</code> calls to expand the table accordingly:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" aria-controls="tabset-14-1" aria-selected="true">DuckDB</a></li><li class="nav-item"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" aria-controls="tabset-14-2" aria-selected="false">BigQuery</a></li></ul>
<div class="tab-content">
<div id="tabset-14-1" class="tab-pane active" aria-labelledby="tabset-14-1-tab">
<div id="bd167fb0" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1">ddb_ents.mutate(primary_profession<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.primary_profession.unnest()).order_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nconst"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> nconst    </span>┃<span style="font-weight: bold"> primary_name    </span>┃<span style="font-weight: bold"> primary_profession </span>┃<span style="font-weight: bold"> known_for_titles                   </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                      │
├───────────┼─────────────────┼────────────────────┼────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">nm0000001</span> │ <span style="color: #008000; text-decoration-color: #008000">Fred Astaire   </span> │ <span style="color: #008000; text-decoration-color: #008000">soundtrack        </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0053137'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0072308'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000001</span> │ <span style="color: #008000; text-decoration-color: #008000">Fred Astaire   </span> │ <span style="color: #008000; text-decoration-color: #008000">miscellaneous     </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0053137'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0072308'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000001</span> │ <span style="color: #008000; text-decoration-color: #008000">Fred Astaire   </span> │ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0053137'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0072308'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000002</span> │ <span style="color: #008000; text-decoration-color: #008000">Lauren Bacall  </span> │ <span style="color: #008000; text-decoration-color: #008000">soundtrack        </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0037382'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0117057'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000002</span> │ <span style="color: #008000; text-decoration-color: #008000">Lauren Bacall  </span> │ <span style="color: #008000; text-decoration-color: #008000">actress           </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0037382'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0117057'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000003</span> │ <span style="color: #008000; text-decoration-color: #008000">Brigitte Bardot</span> │ <span style="color: #008000; text-decoration-color: #008000">music_department  </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0057345'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0054452'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000003</span> │ <span style="color: #008000; text-decoration-color: #008000">Brigitte Bardot</span> │ <span style="color: #008000; text-decoration-color: #008000">soundtrack        </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0057345'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0054452'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000003</span> │ <span style="color: #008000; text-decoration-color: #008000">Brigitte Bardot</span> │ <span style="color: #008000; text-decoration-color: #008000">actress           </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0057345'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0054452'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000004</span> │ <span style="color: #008000; text-decoration-color: #008000">John Belushi   </span> │ <span style="color: #008000; text-decoration-color: #008000">soundtrack        </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0072562'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0078723'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000004</span> │ <span style="color: #008000; text-decoration-color: #008000">John Belushi   </span> │ <span style="color: #008000; text-decoration-color: #008000">writer            </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0072562'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0078723'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                  │
└───────────┴─────────────────┴────────────────────┴────────────────────────────────────┘
</pre>
</div>
</div>
</div>
<div id="tabset-14-2" class="tab-pane" aria-labelledby="tabset-14-2-tab">
<div id="419d71fd" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1">bq_ents.mutate(primary_profession<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.primary_profession.unnest()).order_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nconst"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> nconst    </span>┃<span style="font-weight: bold"> primary_name    </span>┃<span style="font-weight: bold"> primary_profession </span>┃<span style="font-weight: bold"> known_for_titles                   </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                      │
├───────────┼─────────────────┼────────────────────┼────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">nm0000001</span> │ <span style="color: #008000; text-decoration-color: #008000">Fred Astaire   </span> │ <span style="color: #008000; text-decoration-color: #008000">miscellaneous     </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0072308'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0053137'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000001</span> │ <span style="color: #008000; text-decoration-color: #008000">Fred Astaire   </span> │ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0072308'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0053137'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000001</span> │ <span style="color: #008000; text-decoration-color: #008000">Fred Astaire   </span> │ <span style="color: #008000; text-decoration-color: #008000">soundtrack        </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0072308'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0053137'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000002</span> │ <span style="color: #008000; text-decoration-color: #008000">Lauren Bacall  </span> │ <span style="color: #008000; text-decoration-color: #008000">actress           </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0038355'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0075213'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000002</span> │ <span style="color: #008000; text-decoration-color: #008000">Lauren Bacall  </span> │ <span style="color: #008000; text-decoration-color: #008000">soundtrack        </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0038355'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0075213'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000003</span> │ <span style="color: #008000; text-decoration-color: #008000">Brigitte Bardot</span> │ <span style="color: #008000; text-decoration-color: #008000">music_department  </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0049189'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0054452'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000003</span> │ <span style="color: #008000; text-decoration-color: #008000">Brigitte Bardot</span> │ <span style="color: #008000; text-decoration-color: #008000">soundtrack        </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0049189'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0054452'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000003</span> │ <span style="color: #008000; text-decoration-color: #008000">Brigitte Bardot</span> │ <span style="color: #008000; text-decoration-color: #008000">actress           </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0049189'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0054452'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000004</span> │ <span style="color: #008000; text-decoration-color: #008000">John Belushi   </span> │ <span style="color: #008000; text-decoration-color: #008000">soundtrack        </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0072562'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0078723'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000004</span> │ <span style="color: #008000; text-decoration-color: #008000">John Belushi   </span> │ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0072562'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0078723'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                  │
└───────────┴─────────────────┴────────────────────┴────────────────────────────────────┘
</pre>
</div>
</div>
</div>
</div>
</div>
<p>Unnesting can be useful when joining nested data.</p>
<p>Here we use unnest to find people known for any of the godfather movies:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-15-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-1" aria-controls="tabset-15-1" aria-selected="true">DuckDB</a></li><li class="nav-item"><a class="nav-link" id="tabset-15-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-2" aria-controls="tabset-15-2" aria-selected="false">BigQuery</a></li></ul>
<div class="tab-content">
<div id="tabset-15-1" class="tab-pane active" aria-labelledby="tabset-15-1-tab">
<div id="3bc2513c" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="annotated-cell-32" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><button class="code-annotation-anchor" data-target-cell="annotated-cell-32" data-target-annotation="1">1</button><span id="annotated-cell-32-1" class="code-annotation-target">basics <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ddb.tables.title_basics.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="annotated-cell-32-2">    [</span>
<span id="annotated-cell-32-3">        _.title_type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"movie"</span>,</span>
<span id="annotated-cell-32-4">        _.original_title.lower().startswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"the godfather"</span>),</span>
<span id="annotated-cell-32-5">        _.genres.lower().contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"crime"</span>),</span>
<span id="annotated-cell-32-6">    ]</span>
<span id="annotated-cell-32-7">)</span>
<span id="annotated-cell-32-8"></span>
<span id="annotated-cell-32-9">ddb_known_for_the_godfather <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-32" data-target-annotation="2">2</button><span id="annotated-cell-32-10" class="code-annotation-target">    ddb_ents.mutate(tconst<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.known_for_titles.unnest())</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-32" data-target-annotation="3">3</button><span id="annotated-cell-32-11" class="code-annotation-target">    .join(basics, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tconst"</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-32" data-target-annotation="4">4</button><span id="annotated-cell-32-12" class="code-annotation-target">    .select(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"primary_title"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"primary_name"</span>)</span>
<span id="annotated-cell-32-13">    .distinct()</span>
<span id="annotated-cell-32-14">    .order_by([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"primary_title"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"primary_name"</span>])</span>
<span id="annotated-cell-32-15">)</span>
<span id="annotated-cell-32-16">ddb_known_for_the_godfather</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-32" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-32" data-code-lines="1,7" data-code-annotation="1">Filter the <code>title_basics</code> data set to only the Godfather movies</span>
</dd>
<dt data-target-cell="annotated-cell-32" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-32" data-code-lines="10" data-code-annotation="2">Unnest the <code>known_for_titles</code> array column</span>
</dd>
<dt data-target-cell="annotated-cell-32" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-32" data-code-lines="11" data-code-annotation="3">Join with <code>basics</code> to get movie titles</span>
</dd>
<dt data-target-cell="annotated-cell-32" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-32" data-code-lines="12,14" data-code-annotation="4">Ensure that each entity is only listed once and sort the results</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> primary_title </span>┃<span style="font-weight: bold"> primary_name        </span>┃
┡━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>              │
├───────────────┼─────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather</span> │ <span style="color: #008000; text-decoration-color: #008000">A. Emmett Adams    </span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather</span> │ <span style="color: #008000; text-decoration-color: #008000">Abe Vigoda         </span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather</span> │ <span style="color: #008000; text-decoration-color: #008000">Al Lettieri        </span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather</span> │ <span style="color: #008000; text-decoration-color: #008000">Al Martino         </span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather</span> │ <span style="color: #008000; text-decoration-color: #008000">Al Pacino          </span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather</span> │ <span style="color: #008000; text-decoration-color: #008000">Albert S. Ruddy    </span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather</span> │ <span style="color: #008000; text-decoration-color: #008000">Alex Rocco         </span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather</span> │ <span style="color: #008000; text-decoration-color: #008000">Andrea Eastman     </span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather</span> │ <span style="color: #008000; text-decoration-color: #008000">Angelo Infanti     </span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather</span> │ <span style="color: #008000; text-decoration-color: #008000">Anna Hill Johnstone</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                   │
└───────────────┴─────────────────────┘
</pre>
</div>
</div>
</div>
<div id="tabset-15-2" class="tab-pane" aria-labelledby="tabset-15-2-tab">
<div id="3f9231e0" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="annotated-cell-33" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><button class="code-annotation-anchor" data-target-cell="annotated-cell-33" data-target-annotation="1">1</button><span id="annotated-cell-33-1" class="code-annotation-target">basics <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> bq.tables.title_basics.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="annotated-cell-33-2">    [</span>
<span id="annotated-cell-33-3">        _.title_type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"movie"</span>,</span>
<span id="annotated-cell-33-4">        _.original_title.lower().startswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"the godfather"</span>),</span>
<span id="annotated-cell-33-5">        _.genres.lower().contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"crime"</span>),</span>
<span id="annotated-cell-33-6">    ]</span>
<span id="annotated-cell-33-7">)</span>
<span id="annotated-cell-33-8"></span>
<span id="annotated-cell-33-9">bq_known_for_the_godfather <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-33" data-target-annotation="2">2</button><span id="annotated-cell-33-10" class="code-annotation-target">    bq_ents.mutate(tconst<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.known_for_titles.unnest())</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-33" data-target-annotation="3">3</button><span id="annotated-cell-33-11" class="code-annotation-target">    .join(basics, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tconst"</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-33" data-target-annotation="4">4</button><span id="annotated-cell-33-12" class="code-annotation-target">    .select(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"primary_title"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"primary_name"</span>)</span>
<span id="annotated-cell-33-13">    .distinct()</span>
<span id="annotated-cell-33-14">    .order_by([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"primary_title"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"primary_name"</span>])</span>
<span id="annotated-cell-33-15">)</span>
<span id="annotated-cell-33-16">bq_known_for_the_godfather</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-33" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-33" data-code-lines="1,7" data-code-annotation="1">Filter the <code>title_basics</code> data set to only the Godfather movies</span>
</dd>
<dt data-target-cell="annotated-cell-33" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-33" data-code-lines="10" data-code-annotation="2">Unnest the <code>known_for_titles</code> array column</span>
</dd>
<dt data-target-cell="annotated-cell-33" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-33" data-code-lines="11" data-code-annotation="3">Join with <code>basics</code> to get movie titles</span>
</dd>
<dt data-target-cell="annotated-cell-33" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-33" data-code-lines="12,14" data-code-annotation="4">Ensure that each entity is only listed once and sort the results</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> primary_title </span>┃<span style="font-weight: bold"> primary_name        </span>┃
┡━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>              │
├───────────────┼─────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather</span> │ <span style="color: #008000; text-decoration-color: #008000">A. Emmett Adams    </span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather</span> │ <span style="color: #008000; text-decoration-color: #008000">Abe Vigoda         </span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather</span> │ <span style="color: #008000; text-decoration-color: #008000">Al Lettieri        </span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather</span> │ <span style="color: #008000; text-decoration-color: #008000">Al Martino         </span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather</span> │ <span style="color: #008000; text-decoration-color: #008000">Al Pacino          </span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather</span> │ <span style="color: #008000; text-decoration-color: #008000">Albert S. Ruddy    </span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather</span> │ <span style="color: #008000; text-decoration-color: #008000">Alex Rocco         </span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather</span> │ <span style="color: #008000; text-decoration-color: #008000">Andrea Eastman     </span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather</span> │ <span style="color: #008000; text-decoration-color: #008000">Angelo Infanti     </span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather</span> │ <span style="color: #008000; text-decoration-color: #008000">Anna Hill Johnstone</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                   │
└───────────────┴─────────────────────┘
</pre>
</div>
</div>
</div>
</div>
</div>
<p>Let’s summarize by showing how many people are known for each Godfather movie:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-16-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-1" aria-controls="tabset-16-1" aria-selected="true">DuckDB</a></li><li class="nav-item"><a class="nav-link" id="tabset-16-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-2" aria-controls="tabset-16-2" aria-selected="false">BigQuery</a></li></ul>
<div class="tab-content">
<div id="tabset-16-1" class="tab-pane active" aria-labelledby="tabset-16-1-tab">
<div id="eb030865" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1">ddb_known_for_the_godfather.primary_title.value_counts()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> primary_title          </span>┃<span style="font-weight: bold"> primary_title_count </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>               │
├────────────────────────┼─────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather Part II </span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">117</span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather         </span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">93</span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather Part III</span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">196</span> │
└────────────────────────┴─────────────────────┘
</pre>
</div>
</div>
</div>
<div id="tabset-16-2" class="tab-pane" aria-labelledby="tabset-16-2-tab">
<div id="4786c6f4" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1">bq_known_for_the_godfather.primary_title.value_counts()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> primary_title          </span>┃<span style="font-weight: bold"> primary_title_count </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>               │
├────────────────────────┼─────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather Part II </span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">114</span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather Part III</span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">202</span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather         </span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">97</span> │
└────────────────────────┴─────────────────────┘
</pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="filtering-array-elements" class="level3">
<h3 class="anchored" data-anchor-id="filtering-array-elements">Filtering array elements</h3>
<p>Filtering array elements can be done with the <a href="../../reference/expression-collections.html#ibis.expr.types.arrays.ArrayValue.filter"><code>filter</code></a> method, which applies a predicate to each array element and returns an array of elements for which the predicate returns <code>True</code>.</p>
<p>This method is similar to Python’s <a href="https://docs.python.org/3.7/library/functions.html#filter"><code>filter</code></a> function.</p>
<p>Let’s show all people who are neither editors nor actors:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-17-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-1" aria-controls="tabset-17-1" aria-selected="true">DuckDB</a></li><li class="nav-item"><a class="nav-link" id="tabset-17-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-2" aria-controls="tabset-17-2" aria-selected="false">BigQuery</a></li></ul>
<div class="tab-content">
<div id="tabset-17-1" class="tab-pane active" aria-labelledby="tabset-17-1-tab">
<div id="d8bdd118" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="annotated-cell-36" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-36-1">ddb_ents.mutate(</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-36" data-target-annotation="1">1</button><span id="annotated-cell-36-2" class="code-annotation-target">    primary_profession<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.primary_profession.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="annotated-cell-36-3">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> pp: <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>pp.isin((<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"actor"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"actress"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"editor"</span>))</span>
<span id="annotated-cell-36-4">    )</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-36" data-target-annotation="2">2</button><span id="annotated-cell-36-5" class="code-annotation-target">).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(_.primary_profession.length() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>).order_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nconst"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-36" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-36" data-code-lines="2" data-code-annotation="1">This <code>filter</code> call is applied to each array element</span>
</dd>
<dt data-target-cell="annotated-cell-36" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-36" data-code-lines="5" data-code-annotation="2">This <code>filter</code> call is applied to the table</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> nconst    </span>┃<span style="font-weight: bold"> primary_name    </span>┃<span style="font-weight: bold"> primary_profession                 </span>┃<span style="font-weight: bold"> known_for_titles                   </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                      │
├───────────┼─────────────────┼────────────────────────────────────┼────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">nm0000001</span> │ <span style="color: #008000; text-decoration-color: #008000">Fred Astaire   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #008000; text-decoration-color: #008000">'miscellaneous'</span><span style="font-weight: bold">]</span>    │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0053137'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0072308'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000002</span> │ <span style="color: #008000; text-decoration-color: #008000">Lauren Bacall  </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span><span style="font-weight: bold">]</span>                     │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0037382'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0117057'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000003</span> │ <span style="color: #008000; text-decoration-color: #008000">Brigitte Bardot</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #008000; text-decoration-color: #008000">'music_department'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0057345'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0054452'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000004</span> │ <span style="color: #008000; text-decoration-color: #008000">John Belushi   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #008000; text-decoration-color: #008000">'writer'</span><span style="font-weight: bold">]</span>           │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0072562'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0078723'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000005</span> │ <span style="color: #008000; text-decoration-color: #008000">Ingmar Bergman </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'writer'</span>, <span style="color: #008000; text-decoration-color: #008000">'director'</span><span style="font-weight: bold">]</span>             │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0083922'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0069467'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000006</span> │ <span style="color: #008000; text-decoration-color: #008000">Ingrid Bergman </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #008000; text-decoration-color: #008000">'producer'</span><span style="font-weight: bold">]</span>         │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0038109'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0036855'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000007</span> │ <span style="color: #008000; text-decoration-color: #008000">Humphrey Bogart</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #008000; text-decoration-color: #008000">'producer'</span><span style="font-weight: bold">]</span>         │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0037382'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0034583'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000008</span> │ <span style="color: #008000; text-decoration-color: #008000">Marlon Brando  </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #008000; text-decoration-color: #008000">'director'</span><span style="font-weight: bold">]</span>         │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0068646'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0070849'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000009</span> │ <span style="color: #008000; text-decoration-color: #008000">Richard Burton </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #008000; text-decoration-color: #008000">'producer'</span><span style="font-weight: bold">]</span>         │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0057877'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0059749'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000010</span> │ <span style="color: #008000; text-decoration-color: #008000">James Cagney   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #008000; text-decoration-color: #008000">'director'</span><span style="font-weight: bold">]</span>         │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0042041'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0035575'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                  │
└───────────┴─────────────────┴────────────────────────────────────┴────────────────────────────────────┘
</pre>
</div>
</div>
</div>
<div id="tabset-17-2" class="tab-pane" aria-labelledby="tabset-17-2-tab">
<div id="1ad9065c" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="annotated-cell-37" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-37-1">bq_ents.mutate(</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-37" data-target-annotation="1">1</button><span id="annotated-cell-37-2" class="code-annotation-target">    primary_profession<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.primary_profession.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="annotated-cell-37-3">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> pp: <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>pp.isin((<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"actor"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"actress"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"editor"</span>))</span>
<span id="annotated-cell-37-4">    )</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-37" data-target-annotation="2">2</button><span id="annotated-cell-37-5" class="code-annotation-target">).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(_.primary_profession.length() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>).order_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nconst"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-37" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-37" data-code-lines="2" data-code-annotation="1">This <code>filter</code> call is applied to each array element</span>
</dd>
<dt data-target-cell="annotated-cell-37" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-37" data-code-lines="5" data-code-annotation="2">This <code>filter</code> call is applied to the table</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> nconst    </span>┃<span style="font-weight: bold"> primary_name    </span>┃<span style="font-weight: bold"> primary_profession                 </span>┃<span style="font-weight: bold"> known_for_titles                   </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                      │
├───────────┼─────────────────┼────────────────────────────────────┼────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">nm0000001</span> │ <span style="color: #008000; text-decoration-color: #008000">Fred Astaire   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #008000; text-decoration-color: #008000">'miscellaneous'</span><span style="font-weight: bold">]</span>    │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0072308'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0053137'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000002</span> │ <span style="color: #008000; text-decoration-color: #008000">Lauren Bacall  </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span><span style="font-weight: bold">]</span>                     │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0038355'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0075213'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000003</span> │ <span style="color: #008000; text-decoration-color: #008000">Brigitte Bardot</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #008000; text-decoration-color: #008000">'music_department'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0049189'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0054452'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000004</span> │ <span style="color: #008000; text-decoration-color: #008000">John Belushi   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #008000; text-decoration-color: #008000">'writer'</span><span style="font-weight: bold">]</span>           │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0072562'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0078723'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000005</span> │ <span style="color: #008000; text-decoration-color: #008000">Ingmar Bergman </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'writer'</span>, <span style="color: #008000; text-decoration-color: #008000">'director'</span><span style="font-weight: bold">]</span>             │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0050976'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0083922'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000006</span> │ <span style="color: #008000; text-decoration-color: #008000">Ingrid Bergman </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #008000; text-decoration-color: #008000">'producer'</span><span style="font-weight: bold">]</span>         │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0034583'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0038787'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000007</span> │ <span style="color: #008000; text-decoration-color: #008000">Humphrey Bogart</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #008000; text-decoration-color: #008000">'producer'</span><span style="font-weight: bold">]</span>         │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0037382'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0043265'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000008</span> │ <span style="color: #008000; text-decoration-color: #008000">Marlon Brando  </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #008000; text-decoration-color: #008000">'director'</span><span style="font-weight: bold">]</span>         │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0068646'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0070849'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000009</span> │ <span style="color: #008000; text-decoration-color: #008000">Richard Burton </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #008000; text-decoration-color: #008000">'producer'</span><span style="font-weight: bold">]</span>         │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0061184'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0087803'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000010</span> │ <span style="color: #008000; text-decoration-color: #008000">James Cagney   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'soundtrack'</span>, <span style="color: #008000; text-decoration-color: #008000">'director'</span><span style="font-weight: bold">]</span>         │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0042041'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0029870'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                  │
└───────────┴─────────────────┴────────────────────────────────────┴────────────────────────────────────┘
</pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="applying-a-function-to-array-elements" class="level3">
<h3 class="anchored" data-anchor-id="applying-a-function-to-array-elements">Applying a function to array elements</h3>
<p>You can apply a function to run an ibis expression on each element of an array using the <a href="../../reference/expression-collections.html#ibis.expr.types.arrays.ArrayValue.map"><code>map</code></a> method.</p>
<p>Let’s normalize the case of primary_profession to upper case:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-18-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-1" aria-controls="tabset-18-1" aria-selected="true">DuckDB</a></li><li class="nav-item"><a class="nav-link" id="tabset-18-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-2" aria-controls="tabset-18-2" aria-selected="false">BigQuery</a></li></ul>
<div class="tab-content">
<div id="tabset-18-1" class="tab-pane active" aria-labelledby="tabset-18-1-tab">
<div id="2935069b" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1">ddb_ents.mutate(</span>
<span id="cb31-2">    primary_profession<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.primary_profession.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">map</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> pp: pp.upper())</span>
<span id="cb31-3">).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(_.primary_profession.length() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>).order_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nconst"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> nconst    </span>┃<span style="font-weight: bold"> primary_name    </span>┃<span style="font-weight: bold"> primary_profession                </span>┃<span style="font-weight: bold"> known_for_titles                   </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                      │
├───────────┼─────────────────┼───────────────────────────────────┼────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">nm0000001</span> │ <span style="color: #008000; text-decoration-color: #008000">Fred Astaire   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'SOUNDTRACK'</span>, <span style="color: #008000; text-decoration-color: #008000">'ACTOR'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>   │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0053137'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0072308'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000002</span> │ <span style="color: #008000; text-decoration-color: #008000">Lauren Bacall  </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'ACTRESS'</span>, <span style="color: #008000; text-decoration-color: #008000">'SOUNDTRACK'</span><span style="font-weight: bold">]</span>         │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0037382'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0117057'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000003</span> │ <span style="color: #008000; text-decoration-color: #008000">Brigitte Bardot</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'ACTRESS'</span>, <span style="color: #008000; text-decoration-color: #008000">'SOUNDTRACK'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0057345'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0054452'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000004</span> │ <span style="color: #008000; text-decoration-color: #008000">John Belushi   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'ACTOR'</span>, <span style="color: #008000; text-decoration-color: #008000">'SOUNDTRACK'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>   │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0072562'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0078723'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000005</span> │ <span style="color: #008000; text-decoration-color: #008000">Ingmar Bergman </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'WRITER'</span>, <span style="color: #008000; text-decoration-color: #008000">'DIRECTOR'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>    │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0083922'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0069467'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000006</span> │ <span style="color: #008000; text-decoration-color: #008000">Ingrid Bergman </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'ACTRESS'</span>, <span style="color: #008000; text-decoration-color: #008000">'SOUNDTRACK'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0038109'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0036855'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000007</span> │ <span style="color: #008000; text-decoration-color: #008000">Humphrey Bogart</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'ACTOR'</span>, <span style="color: #008000; text-decoration-color: #008000">'SOUNDTRACK'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>   │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0037382'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0034583'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000008</span> │ <span style="color: #008000; text-decoration-color: #008000">Marlon Brando  </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'ACTOR'</span>, <span style="color: #008000; text-decoration-color: #008000">'SOUNDTRACK'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>   │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0068646'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0070849'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000009</span> │ <span style="color: #008000; text-decoration-color: #008000">Richard Burton </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'ACTOR'</span>, <span style="color: #008000; text-decoration-color: #008000">'SOUNDTRACK'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>   │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0057877'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0059749'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000010</span> │ <span style="color: #008000; text-decoration-color: #008000">James Cagney   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'ACTOR'</span>, <span style="color: #008000; text-decoration-color: #008000">'SOUNDTRACK'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>   │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0042041'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0035575'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                  │
└───────────┴─────────────────┴───────────────────────────────────┴────────────────────────────────────┘
</pre>
</div>
</div>
</div>
<div id="tabset-18-2" class="tab-pane" aria-labelledby="tabset-18-2-tab">
<div id="33931d68" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1">bq_ents.mutate(</span>
<span id="cb32-2">    primary_profession<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.primary_profession.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">map</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> pp: pp.upper())</span>
<span id="cb32-3">).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(_.primary_profession.length() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>).order_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nconst"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> nconst    </span>┃<span style="font-weight: bold"> primary_name    </span>┃<span style="font-weight: bold"> primary_profession                </span>┃<span style="font-weight: bold"> known_for_titles                   </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                      │
├───────────┼─────────────────┼───────────────────────────────────┼────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">nm0000001</span> │ <span style="color: #008000; text-decoration-color: #008000">Fred Astaire   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'SOUNDTRACK'</span>, <span style="color: #008000; text-decoration-color: #008000">'ACTOR'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>   │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0072308'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0053137'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000002</span> │ <span style="color: #008000; text-decoration-color: #008000">Lauren Bacall  </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'ACTRESS'</span>, <span style="color: #008000; text-decoration-color: #008000">'SOUNDTRACK'</span><span style="font-weight: bold">]</span>         │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0038355'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0075213'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000003</span> │ <span style="color: #008000; text-decoration-color: #008000">Brigitte Bardot</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'ACTRESS'</span>, <span style="color: #008000; text-decoration-color: #008000">'SOUNDTRACK'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0049189'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0054452'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000004</span> │ <span style="color: #008000; text-decoration-color: #008000">John Belushi   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'ACTOR'</span>, <span style="color: #008000; text-decoration-color: #008000">'SOUNDTRACK'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>   │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0072562'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0078723'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000005</span> │ <span style="color: #008000; text-decoration-color: #008000">Ingmar Bergman </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'WRITER'</span>, <span style="color: #008000; text-decoration-color: #008000">'DIRECTOR'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>    │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0050976'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0083922'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000006</span> │ <span style="color: #008000; text-decoration-color: #008000">Ingrid Bergman </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'ACTRESS'</span>, <span style="color: #008000; text-decoration-color: #008000">'SOUNDTRACK'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0034583'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0038787'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000007</span> │ <span style="color: #008000; text-decoration-color: #008000">Humphrey Bogart</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'ACTOR'</span>, <span style="color: #008000; text-decoration-color: #008000">'SOUNDTRACK'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>   │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0037382'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0043265'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000008</span> │ <span style="color: #008000; text-decoration-color: #008000">Marlon Brando  </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'ACTOR'</span>, <span style="color: #008000; text-decoration-color: #008000">'SOUNDTRACK'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>   │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0068646'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0070849'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000009</span> │ <span style="color: #008000; text-decoration-color: #008000">Richard Burton </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'ACTOR'</span>, <span style="color: #008000; text-decoration-color: #008000">'SOUNDTRACK'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>   │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0061184'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0087803'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm0000010</span> │ <span style="color: #008000; text-decoration-color: #008000">James Cagney   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'ACTOR'</span>, <span style="color: #008000; text-decoration-color: #008000">'SOUNDTRACK'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>   │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0042041'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0029870'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                  │
└───────────┴─────────────────┴───────────────────────────────────┴────────────────────────────────────┘
</pre>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Ibis has a sizable collection of array APIs that work with many different backends and as of version 7.0.0, Ibis supports a much larger set of those APIs for BigQuery!</p>
<p>Check out <a href="../../reference/expression-collections.html#ibis.expr.types.arrays.ArrayValue">the API documentation</a> for the full set of available methods.</p>
<p>Try it out, and let us know what you think.</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>arrays</category>
  <category>bigquery</category>
  <category>blog</category>
  <category>cloud</category>
  <category>duckdb</category>
  <category>portability</category>
  <guid>https://ibis-project.org/posts/backend-agnostic-arrays/</guid>
  <pubDate>Fri, 19 Jan 2024 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Geospatial analysis with Ibis and DuckDB (redux)</title>
  <dc:creator>Naty Clementi and Gil Forsyth</dc:creator>
  <link>https://ibis-project.org/posts/ibis-duckdb-geospatial-dev-guru/</link>
  <description><![CDATA[ 





<p>Spatial Dev Guru wrote a great <a href="https://spatial-dev.guru/2023/12/09/geospatial-analysis-using-duckdb/">tutorial</a> that walks you through a step-by-step geospatial analysis of bike sharing data using DuckDB.</p>
<p>Ibis has support for all the geospatial functions used on the tutorial, and we decided to replicate it and share it with you.</p>
<section id="installation" class="level2">
<h2 class="anchored" data-anchor-id="installation">Installation</h2>
<p>Install Ibis with the dependencies needed to work with geospatial data using DuckDB:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> pip install <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ibis-framework[duckdb,geospatial]'</span></span></code></pre></div>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<p>The parquet file used in the original tutorial is available at https://github.com/iamgeoknight/common_datasets/tree/main/parquet. The original data is also available from the citibike <a href="https://s3.amazonaws.com/tripdata/index.html">source</a> but as a <code>.csv</code> file.</p>
<div id="6ac75462" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> pathlib <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Path</span>
<span id="cb2-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> tarfile</span>
<span id="cb2-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> urllib.request <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> urlretrieve</span>
<span id="cb2-4"></span>
<span id="cb2-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Download data</span></span>
<span id="cb2-6">url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://github.com/iamgeoknight/common_datasets/raw/main/parquet/202003-citibike-tripdata.tar.xz"</span></span>
<span id="cb2-7">tar_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Path(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"202003-citibike-tripdata.tar.xz"</span>)</span>
<span id="cb2-8">parquet_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Path(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"202003-citibike-tripdata.parquet"</span>)</span>
<span id="cb2-9"></span>
<span id="cb2-10"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> tar_path.exists():</span>
<span id="cb2-11">    urlretrieve(url, tar_path)</span>
<span id="cb2-12"></span>
<span id="cb2-13"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> parquet_path.exists():</span>
<span id="cb2-14">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> tarfile.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(tar_path, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r:xz"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> t:</span>
<span id="cb2-15">        t.extract(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"202003-citibike-tripdata.parquet"</span>)</span></code></pre></div>
</div>
<p>Now that we have the data, we import Ibis and turn on the interactive mode, to easily explore the output of our queries.</p>
<div id="8daf31ac" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> ibis.interactive <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span></code></pre></div>
</div>
</section>
<section id="lets-get-started" class="level2">
<h2 class="anchored" data-anchor-id="lets-get-started">Let’s get started</h2>
<p>Because this dataset does not contain any geometries, we have to load the spatial extension. If the dataset included any geometry columns, Ibis is smart enough to load the extension for us upon reading the data.</p>
<div id="935350d4" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">con <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.duckdb.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"biketrip.ddb"</span>)</span>
<span id="cb4-2">con.load_extension(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"spatial"</span>)</span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># read data and rename columns to use snake case</span></span>
<span id="cb4-5">biketrip <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> con.read_parquet(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"202003-citibike-tripdata.parquet"</span>).rename(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"snake_case"</span>)</span>
<span id="cb4-6">biketrip</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━┓
┃<span style="font-weight: bold"> tripduration </span>┃<span style="font-weight: bold"> starttime                </span>┃<span style="font-weight: bold"> stoptime                 </span>┃<span style="font-weight: bold"> start_station_id </span>┃<span style="font-weight: bold"> start_station_name            </span>┃<span style="font-weight: bold"> start_station_latitude </span>┃<span style="font-weight: bold"> start_station_longitude </span>┃<span style="font-weight: bold"> end_station_id </span>┃<span style="font-weight: bold"> end_station_name            </span>┃<span style="font-weight: bold"> end_station_latitude </span>┃<span style="font-weight: bold"> end_station_longitude </span>┃<span style="font-weight: bold"> bikeid </span>┃<span style="font-weight: bold"> usertype   </span>┃<span style="font-weight: bold"> birth_year </span>┃<span style="font-weight: bold"> gender </span>┃
┡━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>                │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>              │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>  │
├──────────────┼──────────────────────────┼──────────────────────────┼──────────────────┼───────────────────────────────┼────────────────────────┼─────────────────────────┼────────────────┼─────────────────────────────┼──────────────────────┼───────────────────────┼────────┼────────────┼────────────┼────────┤
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1589</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 00:00:03.6400</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 00:26:32.9860</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">224</span> │ <span style="color: #008000; text-decoration-color: #008000">Spruce St &amp; Nassau St        </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.711464</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-74.005524</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3574</span> │ <span style="color: #008000; text-decoration-color: #008000">Prospect Pl &amp; Underhill Ave</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.676969</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.965790</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">16214</span> │ <span style="color: #008000; text-decoration-color: #008000">Subscriber</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1980</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">389</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 00:00:16.7560</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 00:06:46.0620</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">293</span> │ <span style="color: #008000; text-decoration-color: #008000">Lafayette St &amp; E 8 St        </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.730207</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.991026</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">223</span> │ <span style="color: #008000; text-decoration-color: #008000">W 13 St &amp; 7 Ave            </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.737815</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.999947</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">29994</span> │ <span style="color: #008000; text-decoration-color: #008000">Subscriber</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1991</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">614</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 00:00:20.0580</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 00:10:34.2200</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">379</span> │ <span style="color: #008000; text-decoration-color: #008000">W 31 St &amp; 7 Ave              </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.749156</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.991600</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">515</span> │ <span style="color: #008000; text-decoration-color: #008000">W 43 St &amp; 10 Ave           </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.760094</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.994618</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39853</span> │ <span style="color: #008000; text-decoration-color: #008000">Subscriber</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1991</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">597</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 00:00:24.3510</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 00:10:22.3390</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3739</span> │ <span style="color: #008000; text-decoration-color: #008000">Perry St &amp; Greenwich Ave     </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.735918</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-74.000939</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">325</span> │ <span style="color: #008000; text-decoration-color: #008000">E 19 St &amp; 3 Ave            </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.736245</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.984738</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">42608</span> │ <span style="color: #008000; text-decoration-color: #008000">Subscriber</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1989</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1920</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 00:00:26.1120</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 00:32:26.2680</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">236</span> │ <span style="color: #008000; text-decoration-color: #008000">St Marks Pl &amp; 2 Ave          </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.728419</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.987140</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3124</span> │ <span style="color: #008000; text-decoration-color: #008000">46 Ave &amp; 5 St              </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.747310</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.954510</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">36288</span> │ <span style="color: #008000; text-decoration-color: #008000">Subscriber</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1993</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2055</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 00:00:46.1010</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 00:35:01.2880</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">471</span> │ <span style="color: #008000; text-decoration-color: #008000">Grand St &amp; Havemeyer St      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.712868</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.956981</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">497</span> │ <span style="color: #008000; text-decoration-color: #008000">E 17 St &amp; Broadway         </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.737050</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.990093</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">31313</span> │ <span style="color: #008000; text-decoration-color: #008000">Subscriber</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1985</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">764</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 00:01:04.6650</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 00:13:49.0300</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">83</span> │ <span style="color: #008000; text-decoration-color: #008000">Atlantic Ave &amp; Fort Greene Pl</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.683826</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.976323</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3579</span> │ <span style="color: #008000; text-decoration-color: #008000">Sterling Pl &amp; Bedford Ave  </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.672695</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.954131</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">31216</span> │ <span style="color: #008000; text-decoration-color: #008000">Subscriber</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1980</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span> │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1719</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 00:01:04.9250</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 00:29:44.0140</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3809</span> │ <span style="color: #008000; text-decoration-color: #008000">W 55 St &amp; 6 Ave              </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.763189</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.978434</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3372</span> │ <span style="color: #008000; text-decoration-color: #008000">E 74 St &amp; 1 Ave            </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.768974</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.954823</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">27715</span> │ <span style="color: #008000; text-decoration-color: #008000">Subscriber</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1968</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">441</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 00:01:09.3050</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 00:08:30.8670</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3463</span> │ <span style="color: #008000; text-decoration-color: #008000">E 16 St &amp; Irving Pl          </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.735367</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.987974</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">174</span> │ <span style="color: #008000; text-decoration-color: #008000">E 25 St &amp; 1 Ave            </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.738177</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.977387</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">42015</span> │ <span style="color: #008000; text-decoration-color: #008000">Subscriber</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1970</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">601</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 00:01:09.4420</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 00:11:11.2240</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">406</span> │ <span style="color: #008000; text-decoration-color: #008000">Hicks St &amp; Montague St       </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.695128</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.995951</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">421</span> │ <span style="color: #008000; text-decoration-color: #008000">Clermont Ave &amp; Park Ave    </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.695734</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.971297</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">27592</span> │ <span style="color: #008000; text-decoration-color: #008000">Subscriber</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1985</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │
│            <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                        │                <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                             │                      <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                       <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                           │                    <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                     <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │      <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>          │          <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │      <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└──────────────┴──────────────────────────┴──────────────────────────┴──────────────────┴───────────────────────────────┴────────────────────────┴─────────────────────────┴────────────────┴─────────────────────────────┴──────────────────────┴───────────────────────┴────────┴────────────┴────────────┴────────┘
</pre>
</div>
</div>
<p>We have the information about the longitude and latitude for start and end stations, to create geometry points and put the spatial features to use.</p>
</section>
<section id="create-bike-trip-table" class="level2">
<h2 class="anchored" data-anchor-id="create-bike-trip-table">Create bike trip table</h2>
<p>In the original tutorial, Spatial Dev Guru creates a table with transformed “Pickup” and “Dropoff” points. In DuckDB the <code>st_transform</code> function takes by default points as <code>YX</code> (latitude/longitude) while in Ibis, we assume data in the form <code>XY</code> (longitude/latitude) to be consistent with PostGIS and Geopandas.</p>
<div id="fcf9248f" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Notice longitude/latitude order</span></span>
<span id="cb5-2">pickup <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> _.start_station_longitude.point(_.start_station_latitude)</span>
<span id="cb5-3">dropoff <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> _.end_station_longitude.point(_.end_station_latitude)</span>
<span id="cb5-4"></span>
<span id="cb5-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert is the equivalent of `st_transform`</span></span>
<span id="cb5-6">biketrip <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> biketrip.mutate(</span>
<span id="cb5-7">    pickup_point<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pickup.convert(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"EPSG:4326"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"EPSG:3857"</span>),</span>
<span id="cb5-8">    dropoff_point<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>dropoff.convert(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"EPSG:4326"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"EPSG:3857"</span>),</span>
<span id="cb5-9">)</span>
<span id="cb5-10"></span>
<span id="cb5-11">biketrip[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pickup_point"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dropoff_point"</span>]]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> pickup_point                       </span>┃<span style="font-weight: bold"> dropoff_point                      </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">geospatial:geometry</span>                │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">geospatial:geometry</span>                │
├────────────────────────────────────┼────────────────────────────────────┤
│ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8238257.278</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4969875.321</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8233834.079</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4964810.852</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │
│ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8236643.369</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4972628.277</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8237636.375</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4973746.028</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │
│ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8236707.235</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4975412.341</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8237043.245</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4977019.779</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │
│ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8237746.848</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4973467.317</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8235943.322</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4973515.398</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │
│ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8236210.701</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4972365.622</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8232578.395</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4975141.09</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span>  │
│ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8232853.487</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4970081.63</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span>  │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8236539.472</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4973633.6</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span>   │
│ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8235006.638</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4965817.34</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span>  │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8232536.205</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4964183.464</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │
│ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8235241.603</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4977474.595</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8232613.208</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4978324.842</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │
│ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8236303.583</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4973386.377</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8235125.009</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4973799.125</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │
│ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8237191.547</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4967476.65</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span>  │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8234447.08</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4967565.556</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span>  │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                  │
└────────────────────────────────────┴────────────────────────────────────┘
</pre>
</div>
</div>
<p>Using <code>mutate</code> we add two new columns to our <code>biketrip</code> table with transformed spatial points for pickup and dropoff locations, that are in the Web Mercator projection (<a href="https://epsg.io/3857">EPSG:3857</a>).</p>
</section>
<section id="identify-popular-starts-and-end-stations" class="level2">
<h2 class="anchored" data-anchor-id="identify-popular-starts-and-end-stations">Identify popular starts and end stations</h2>
<p>The following queries retrieve a list of bike start and end stations with their respective trip count in descending order.</p>
<p><strong>Top 10 start stations by trip count</strong></p>
<div id="f9d5a4df" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">biketrip.group_by(biketrip.start_station_name).agg(trips<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ibis._.count()).order_by(</span>
<span id="cb6-2">    ibis.desc(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trips"</span>)</span>
<span id="cb6-3">)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━┓
┃<span style="font-weight: bold"> start_station_name            </span>┃<span style="font-weight: bold"> trips </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span> │
├───────────────────────────────┼───────┤
│ <span style="color: #008000; text-decoration-color: #008000">Pershing Square North        </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6679</span> │
│ <span style="color: #008000; text-decoration-color: #008000">W 21 St &amp; 6 Ave              </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6058</span> │
│ <span style="color: #008000; text-decoration-color: #008000">West St &amp; Chambers St        </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5808</span> │
│ <span style="color: #008000; text-decoration-color: #008000">E 17 St &amp; Broadway           </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5585</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Broadway &amp; W 60 St           </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5361</span> │
│ <span style="color: #008000; text-decoration-color: #008000">8 Ave &amp; W 31 St              </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5287</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Broadway &amp; E 22 St           </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5201</span> │
│ <span style="color: #008000; text-decoration-color: #008000">12 Ave &amp; W 40 St             </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5029</span> │
│ <span style="color: #008000; text-decoration-color: #008000">W 41 St &amp; 8 Ave              </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4809</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Christopher St &amp; Greenwich St</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4786</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                             │     <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└───────────────────────────────┴───────┘
</pre>
</div>
</div>
<p>Similarly, in Ibis you can use the <a href="https://ibis-project.org/tutorials/ibis-for-sql-users#top-k-operations"><code>topk</code></a> operation:</p>
<div id="1e409a2f" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">biketrip.start_station_name.topk(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> start_station_name            </span>┃<span style="font-weight: bold"> Count(start_station_name) </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>                     │
├───────────────────────────────┼───────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">Pershing Square North        </span> │                      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6679</span> │
│ <span style="color: #008000; text-decoration-color: #008000">W 21 St &amp; 6 Ave              </span> │                      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6058</span> │
│ <span style="color: #008000; text-decoration-color: #008000">West St &amp; Chambers St        </span> │                      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5808</span> │
│ <span style="color: #008000; text-decoration-color: #008000">E 17 St &amp; Broadway           </span> │                      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5585</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Broadway &amp; W 60 St           </span> │                      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5361</span> │
│ <span style="color: #008000; text-decoration-color: #008000">8 Ave &amp; W 31 St              </span> │                      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5287</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Broadway &amp; E 22 St           </span> │                      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5201</span> │
│ <span style="color: #008000; text-decoration-color: #008000">12 Ave &amp; W 40 St             </span> │                      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5029</span> │
│ <span style="color: #008000; text-decoration-color: #008000">W 41 St &amp; 8 Ave              </span> │                      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4809</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Christopher St &amp; Greenwich St</span> │                      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4786</span> │
└───────────────────────────────┴───────────────────────────┘
</pre>
</div>
</div>
<p><strong>Top 10 end stations by trip count</strong></p>
<div id="08804e6c" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">biketrip.end_station_name.topk(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> end_station_name              </span>┃<span style="font-weight: bold"> Count(end_station_name) </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>                   │
├───────────────────────────────┼─────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">Pershing Square North        </span> │                    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6584</span> │
│ <span style="color: #008000; text-decoration-color: #008000">E 17 St &amp; Broadway           </span> │                    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6179</span> │
│ <span style="color: #008000; text-decoration-color: #008000">W 21 St &amp; 6 Ave              </span> │                    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6108</span> │
│ <span style="color: #008000; text-decoration-color: #008000">West St &amp; Chambers St        </span> │                    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5857</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Broadway &amp; E 22 St           </span> │                    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5751</span> │
│ <span style="color: #008000; text-decoration-color: #008000">8 Ave &amp; W 31 St              </span> │                    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5436</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Broadway &amp; W 60 St           </span> │                    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5231</span> │
│ <span style="color: #008000; text-decoration-color: #008000">12 Ave &amp; W 40 St             </span> │                    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5180</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Christopher St &amp; Greenwich St</span> │                    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4849</span> │
│ <span style="color: #008000; text-decoration-color: #008000">E 13 St &amp; Avenue A           </span> │                    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4827</span> │
└───────────────────────────────┴─────────────────────────┘
</pre>
</div>
</div>
</section>
<section id="explore-trip-patterns-by-user-type" class="level2">
<h2 class="anchored" data-anchor-id="explore-trip-patterns-by-user-type">Explore trip patterns by user type</h2>
<p>We can also calculate the average trip duration and distance traveled for each user type. According to the <a href="https://ride.citibikenyc.com/system-data">data dictionary</a>, user type can be “customer” or “subscriber” where:</p>
<ul>
<li>Customer = 24-hour pass or 3-day pass user</li>
<li>Subscriber = Annual Member</li>
</ul>
<div id="5263493e" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1">biketrip.group_by(_.usertype).aggregate(</span>
<span id="cb9-2">    avg_duration<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.tripduration.mean(),</span>
<span id="cb9-3">    avg_distance<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.pickup_point.distance(_.dropoff_point).mean()</span>
<span id="cb9-4">)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> usertype   </span>┃<span style="font-weight: bold"> avg_duration </span>┃<span style="font-weight: bold"> avg_distance </span>┃
┡━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>      │
├────────────┼──────────────┼──────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">Customer  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2619.627797</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3017.728172</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Subscriber</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">914.437774</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2457.477582</span> │
└────────────┴──────────────┴──────────────┘
</pre>
</div>
</div>
</section>
<section id="analyzing-efficiency-trip-duration-vs-linear-distance" class="level2">
<h2 class="anchored" data-anchor-id="analyzing-efficiency-trip-duration-vs-linear-distance">Analyzing efficiency: trip duration vs linear distance</h2>
<p>The original tutorial defines <code>efficiency_ratio</code> as the <code>trip_duration</code> / <code>linear_distance</code>, where a higher efficiency ratio could mean a more direct route or faster travel times.</p>
<div id="db951cdc" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># linear distance</span></span>
<span id="cb10-2">trip_distance <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> biketrip.pickup_point.distance(biketrip.dropoff_point)</span>
<span id="cb10-3"></span>
<span id="cb10-4">biketrip <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> biketrip.mutate(</span>
<span id="cb10-5">    linear_distance<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>trip_distance,</span>
<span id="cb10-6">    efficiency_ratio<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.tripduration <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> trip_distance,</span>
<span id="cb10-7">)</span>
<span id="cb10-8"></span>
<span id="cb10-9">biketrip[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pickup_point"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dropoff_point"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"linear_distance"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"efficiency_ratio"</span>]]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> pickup_point                       </span>┃<span style="font-weight: bold"> dropoff_point                      </span>┃<span style="font-weight: bold"> linear_distance </span>┃<span style="font-weight: bold"> efficiency_ratio </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">geospatial:geometry</span>                │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">geospatial:geometry</span>                │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>          │
├────────────────────────────────────┼────────────────────────────────────┼─────────────────┼──────────────────┤
│ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8238257.278</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4969875.321</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8233834.079</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4964810.852</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6724.101099</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.236314</span> │
│ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8236643.369</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4972628.277</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8237636.375</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4973746.028</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1495.135118</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.260177</span> │
│ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8236707.235</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4975412.341</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8237043.245</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4977019.779</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1642.181058</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.373893</span> │
│ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8237746.848</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4973467.317</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8235943.322</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4973515.398</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1804.166804</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.330901</span> │
│ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8236210.701</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4972365.622</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8232578.395</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4975141.09</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span>  │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4571.309382</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.420011</span> │
│ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8232853.487</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4970081.63</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span>  │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8236539.472</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4973633.6</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span>   │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5118.884569</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.401455</span> │
│ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8235006.638</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4965817.34</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span>  │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8232536.205</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4964183.464</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2961.856125</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.257946</span> │
│ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8235241.603</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4977474.595</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8232613.208</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4978324.842</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2762.494638</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.622264</span> │
│ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8236303.583</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4973386.377</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8235125.009</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4973799.125</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1248.758342</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.353151</span> │
│ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8237191.547</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4967476.65</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span>  │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8234447.08</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4967565.556</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span>  │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2745.907046</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.218871</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                  │               <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└────────────────────────────────────┴────────────────────────────────────┴─────────────────┴──────────────────┘
</pre>
</div>
</div>
<p>Let’s take take a look at the table in descending order for the <code>linear_distance</code>, for trips that are longer than 0 meters.</p>
<div id="8196cbc7" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">biketrip.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(_.linear_distance <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>).order_by(ibis.desc(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"linear_distance"</span>))</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> tripduration </span>┃<span style="font-weight: bold"> starttime                </span>┃<span style="font-weight: bold"> stoptime                 </span>┃<span style="font-weight: bold"> start_station_id </span>┃<span style="font-weight: bold"> start_station_name                 </span>┃<span style="font-weight: bold"> start_station_latitude </span>┃<span style="font-weight: bold"> start_station_longitude </span>┃<span style="font-weight: bold"> end_station_id </span>┃<span style="font-weight: bold"> end_station_name                    </span>┃<span style="font-weight: bold"> end_station_latitude </span>┃<span style="font-weight: bold"> end_station_longitude </span>┃<span style="font-weight: bold"> bikeid </span>┃<span style="font-weight: bold"> usertype   </span>┃<span style="font-weight: bold"> birth_year </span>┃<span style="font-weight: bold"> gender </span>┃<span style="font-weight: bold"> pickup_point                       </span>┃<span style="font-weight: bold"> dropoff_point                      </span>┃<span style="font-weight: bold"> linear_distance </span>┃<span style="font-weight: bold"> efficiency_ratio </span>┃
┡━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>                │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                              │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>              │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">geospatial:geometry</span>                │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">geospatial:geometry</span>                │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>          │
├──────────────┼──────────────────────────┼──────────────────────────┼──────────────────┼────────────────────────────────────┼────────────────────────┼─────────────────────────┼────────────────┼─────────────────────────────────────┼──────────────────────┼───────────────────────┼────────┼────────────┼────────────┼────────┼────────────────────────────────────┼────────────────────────────────────┼─────────────────┼──────────────────┤
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">7660</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-20 19:12:59.0210</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-20 21:20:39.5060</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3403</span> │ <span style="color: #008000; text-decoration-color: #008000">4 Ave &amp; 9 St                      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.670513</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.988766</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3881</span> │ <span style="color: #008000; text-decoration-color: #008000">12 Ave &amp; W 125 St                  </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.818299</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.960405</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">30277</span> │ <span style="color: #008000; text-decoration-color: #008000">Customer  </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1968</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8236391.739</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4963863.283</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8233234.623</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4985577.637</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21942.664921</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.349092</span> │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">9536</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-07 07:16:42.8100</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-07 09:55:39.1630</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3545</span> │ <span style="color: #008000; text-decoration-color: #008000">Broadway &amp; W 122 St               </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.812056</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.961255</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3661</span> │ <span style="color: #008000; text-decoration-color: #008000">Montgomery St &amp; Franklin Ave       </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.666439</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.960556</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">33590</span> │ <span style="color: #008000; text-decoration-color: #008000">Customer  </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1998</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8233329.212</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4984659.395</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8233251.476</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4963265.338</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21394.198653</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.445728</span> │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">9541</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-07 07:16:42.9730</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-07 09:55:44.7680</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3545</span> │ <span style="color: #008000; text-decoration-color: #008000">Broadway &amp; W 122 St               </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.812056</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.961255</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3661</span> │ <span style="color: #008000; text-decoration-color: #008000">Montgomery St &amp; Franklin Ave       </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.666439</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.960556</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">30524</span> │ <span style="color: #008000; text-decoration-color: #008000">Customer  </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2000</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8233329.212</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4984659.395</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8233251.476</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4963265.338</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21394.198653</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.445962</span> │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6557</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-18 12:43:05.5510</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-18 14:32:22.5670</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3543</span> │ <span style="color: #008000; text-decoration-color: #008000">Morningside Dr &amp; Amsterdam Ave    </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.810285</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.957365</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3317</span> │ <span style="color: #008000; text-decoration-color: #008000">10 St &amp; 5 Ave                      </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.668627</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.987001</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">36139</span> │ <span style="color: #008000; text-decoration-color: #008000">Subscriber</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1994</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8232896.163</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4984398.898</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8236195.224</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4963586.452</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21072.297158</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.311167</span> │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5361</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-27 15:32:39.0650</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-27 17:02:00.8680</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3881</span> │ <span style="color: #008000; text-decoration-color: #008000">12 Ave &amp; W 125 St                 </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.818299</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.960405</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3384</span> │ <span style="color: #008000; text-decoration-color: #008000">Smith St &amp; 3 St                    </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.678724</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.995991</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">27737</span> │ <span style="color: #008000; text-decoration-color: #008000">Customer  </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1982</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8233234.623</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4985577.637</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8237196.038</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4965068.429</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20888.283661</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.256651</span> │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">9164</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-07 07:23:19.9250</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-07 09:56:04.2370</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3536</span> │ <span style="color: #008000; text-decoration-color: #008000">W 116 St &amp; Broadway               </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.808200</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.964100</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3661</span> │ <span style="color: #008000; text-decoration-color: #008000">Montgomery St &amp; Franklin Ave       </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.666439</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.960556</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">38264</span> │ <span style="color: #008000; text-decoration-color: #008000">Customer  </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1998</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8233645.949</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4984092.238</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8233251.476</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4963265.338</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20830.634948</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.439929</span> │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">8898</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-07 07:27:08.5700</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-07 09:55:27.5190</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3536</span> │ <span style="color: #008000; text-decoration-color: #008000">W 116 St &amp; Broadway               </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.808200</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.964100</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3661</span> │ <span style="color: #008000; text-decoration-color: #008000">Montgomery St &amp; Franklin Ave       </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.666439</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.960556</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21194</span> │ <span style="color: #008000; text-decoration-color: #008000">Customer  </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1999</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8233645.949</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4984092.238</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8233251.476</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4963265.338</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20830.634948</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.427159</span> │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5504</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-10 20:45:55.0120</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-10 22:17:39.2290</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3405</span> │ <span style="color: #008000; text-decoration-color: #008000">5 St &amp; 6 Ave                      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.670484</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.982090</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3629</span> │ <span style="color: #008000; text-decoration-color: #008000">Adam Clayton Powell Blvd &amp; W 126 St</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.809495</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.947765</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">37653</span> │ <span style="color: #008000; text-decoration-color: #008000">Customer  </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1979</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8235648.551</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4963858.895</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8231827.538</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4984282.75</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span>  │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20778.209576</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.264893</span> │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5915</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-10 15:59:38.5130</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-10 17:38:13.8720</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3534</span> │ <span style="color: #008000; text-decoration-color: #008000">Frederick Douglass Blvd &amp; W 117 St</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.805159</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.954692</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3596</span> │ <span style="color: #008000; text-decoration-color: #008000">Sullivan Pl &amp; Bedford Ave          </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.664241</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.957469</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">37257</span> │ <span style="color: #008000; text-decoration-color: #008000">Customer  </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1969</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8232598.655</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4983645</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span>     │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8232907.745</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4962942.662</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20704.645089</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.285685</span> │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4755</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-24 07:41:42.1440</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-24 09:00:58.0820</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3349</span> │ <span style="color: #008000; text-decoration-color: #008000">Grand Army Plaza &amp; Plaza St West  </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.672968</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.970880</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3529</span> │ <span style="color: #008000; text-decoration-color: #008000">Lenox Ave &amp; W 130 St               </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.810792</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.943068</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">36100</span> │ <span style="color: #008000; text-decoration-color: #008000">Subscriber</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1965</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8234400.677</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4964223.518</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8231304.689</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4984473.487</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20485.271859</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.232118</span> │
│            <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                        │                <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                  │                      <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                       <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                   │                    <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                     <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │      <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>          │          <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │      <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                  │               <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└──────────────┴──────────────────────────┴──────────────────────────┴──────────────────┴────────────────────────────────────┴────────────────────────┴─────────────────────────┴────────────────┴─────────────────────────────────────┴──────────────────────┴───────────────────────┴────────┴────────────┴────────────┴────────┴────────────────────────────────────┴────────────────────────────────────┴─────────────────┴──────────────────┘
</pre>
</div>
</div>
</section>
<section id="analyzing-bike-trips-within-a-500-meters-radius" class="level2">
<h2 class="anchored" data-anchor-id="analyzing-bike-trips-within-a-500-meters-radius">Analyzing bike trips within a 500 meters radius</h2>
<p>In the original tutorial, the author choses a point (first point on the table), and it creates a buffer of 500 m radius around it. In our table we already have the point in meters, since we converted them in a previous query.</p>
<p>The following query shows all the bike trips whose pickup point falls within a 500 meter radius of the first point of the table with <code>long=-74.00552427</code> and <code>lat=40.71146364</code>.</p>
<div id="05d8032a" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># grab the first row of the data</span></span>
<span id="cb12-2">first_point <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> biketrip.limit(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb12-3"></span>
<span id="cb12-4">trips_within_500 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> biketrip.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="cb12-5">    _.pickup_point.within(first_point.select(_.pickup_point.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">buffer</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>)).to_array())</span>
<span id="cb12-6">)</span>
<span id="cb12-7"></span>
<span id="cb12-8">trips_within_500</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> tripduration </span>┃<span style="font-weight: bold"> starttime                </span>┃<span style="font-weight: bold"> stoptime                 </span>┃<span style="font-weight: bold"> start_station_id </span>┃<span style="font-weight: bold"> start_station_name    </span>┃<span style="font-weight: bold"> start_station_latitude </span>┃<span style="font-weight: bold"> start_station_longitude </span>┃<span style="font-weight: bold"> end_station_id </span>┃<span style="font-weight: bold"> end_station_name            </span>┃<span style="font-weight: bold"> end_station_latitude </span>┃<span style="font-weight: bold"> end_station_longitude </span>┃<span style="font-weight: bold"> bikeid </span>┃<span style="font-weight: bold"> usertype   </span>┃<span style="font-weight: bold"> birth_year </span>┃<span style="font-weight: bold"> gender </span>┃<span style="font-weight: bold"> pickup_point                       </span>┃<span style="font-weight: bold"> dropoff_point                      </span>┃<span style="font-weight: bold"> linear_distance </span>┃<span style="font-weight: bold"> efficiency_ratio </span>┃
┡━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>                │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>              │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">geospatial:geometry</span>                │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">geospatial:geometry</span>                │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>          │
├──────────────┼──────────────────────────┼──────────────────────────┼──────────────────┼───────────────────────┼────────────────────────┼─────────────────────────┼────────────────┼─────────────────────────────┼──────────────────────┼───────────────────────┼────────┼────────────┼────────────┼────────┼────────────────────────────────────┼────────────────────────────────────┼─────────────────┼──────────────────┤
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1589</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 00:00:03.6400</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 00:26:32.9860</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">224</span> │ <span style="color: #008000; text-decoration-color: #008000">Spruce St &amp; Nassau St</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.711464</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-74.005524</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3574</span> │ <span style="color: #008000; text-decoration-color: #008000">Prospect Pl &amp; Underhill Ave</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.676969</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.965790</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">16214</span> │ <span style="color: #008000; text-decoration-color: #008000">Subscriber</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1980</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8238257.278</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4969875.321</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8233834.079</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4964810.852</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6724.101099</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.236314</span> │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1813</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 00:09:02.6260</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 00:39:16.4950</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3783</span> │ <span style="color: #008000; text-decoration-color: #008000">Cliff St &amp; Fulton St </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.708380</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-74.004950</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">410</span> │ <span style="color: #008000; text-decoration-color: #008000">Suffolk St &amp; Stanton St    </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.720664</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.985180</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">41200</span> │ <span style="color: #008000; text-decoration-color: #008000">Subscriber</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1995</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8238193.35</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4969422.472</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span>  │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8235992.538</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4971226.629</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2845.796350</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.637080</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">463</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 00:24:52.7870</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 00:32:36.6160</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">330</span> │ <span style="color: #008000; text-decoration-color: #008000">Reade St &amp; Broadway  </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.714505</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-74.005628</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">311</span> │ <span style="color: #008000; text-decoration-color: #008000">Norfolk St &amp; Broome St     </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.717227</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.988021</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">27788</span> │ <span style="color: #008000; text-decoration-color: #008000">Subscriber</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1999</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8238268.813</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4970321.91</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span>  │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8236308.805</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4970721.816</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2000.388975</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.231455</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">454</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 00:25:06.9590</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 00:32:41.9440</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">330</span> │ <span style="color: #008000; text-decoration-color: #008000">Reade St &amp; Broadway  </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.714505</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-74.005628</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">311</span> │ <span style="color: #008000; text-decoration-color: #008000">Norfolk St &amp; Broome St     </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.717227</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.988021</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">34083</span> │ <span style="color: #008000; text-decoration-color: #008000">Subscriber</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1968</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8238268.813</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4970321.91</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span>  │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8236308.805</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4970721.816</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2000.388975</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.226956</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">492</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 00:40:27.3060</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 00:48:40.2190</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">330</span> │ <span style="color: #008000; text-decoration-color: #008000">Reade St &amp; Broadway  </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.714505</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-74.005628</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">309</span> │ <span style="color: #008000; text-decoration-color: #008000">Murray St &amp; West St        </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.714979</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-74.013012</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">37858</span> │ <span style="color: #008000; text-decoration-color: #008000">Subscriber</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1975</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8238268.813</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4970321.91</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span>  │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8239090.808</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4970391.552</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">824.940265</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.596407</span> │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2020</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 01:14:59.0300</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 01:48:39.4420</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">224</span> │ <span style="color: #008000; text-decoration-color: #008000">Spruce St &amp; Nassau St</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.711464</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-74.005524</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">236</span> │ <span style="color: #008000; text-decoration-color: #008000">St Marks Pl &amp; 2 Ave        </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.728419</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-73.987140</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">36388</span> │ <span style="color: #008000; text-decoration-color: #008000">Subscriber</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1986</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8238257.278</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4969875.321</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8236210.701</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4972365.622</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3223.364013</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.626674</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">794</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 01:15:33.0460</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 01:28:47.6180</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">376</span> │ <span style="color: #008000; text-decoration-color: #008000">John St &amp; William St </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.708621</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-74.007222</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3746</span> │ <span style="color: #008000; text-decoration-color: #008000">6 Ave &amp; Broome St          </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.724308</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-74.004730</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">37334</span> │ <span style="color: #008000; text-decoration-color: #008000">Subscriber</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1998</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8238446.219</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4969457.928</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8238168.9</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4971761.857</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span>   │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2320.558910</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.342159</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">816</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 01:16:07.4430</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 01:29:43.7260</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">376</span> │ <span style="color: #008000; text-decoration-color: #008000">John St &amp; William St </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.708621</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-74.007222</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3746</span> │ <span style="color: #008000; text-decoration-color: #008000">6 Ave &amp; Broome St          </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.724308</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-74.004730</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18888</span> │ <span style="color: #008000; text-decoration-color: #008000">Customer  </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1969</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8238446.219</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4969457.928</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8238168.9</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4971761.857</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span>   │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2320.558910</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.351639</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">238</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 01:28:46.2460</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 01:32:44.7130</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">376</span> │ <span style="color: #008000; text-decoration-color: #008000">John St &amp; William St </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.708621</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-74.007222</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">415</span> │ <span style="color: #008000; text-decoration-color: #008000">Pearl St &amp; Hanover Square  </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.704718</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-74.009260</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">29327</span> │ <span style="color: #008000; text-decoration-color: #008000">Subscriber</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1960</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8238446.219</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4969457.928</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8238673.167</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4968884.671</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">616.546132</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.386021</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">120</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 01:33:37.7920</span> │ <span style="color: #008000; text-decoration-color: #008000">2020-03-01 01:35:38.2580</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">330</span> │ <span style="color: #008000; text-decoration-color: #008000">Reade St &amp; Broadway  </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.714505</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-74.005628</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">146</span> │ <span style="color: #008000; text-decoration-color: #008000">Hudson St &amp; Reade St       </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.716250</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-74.009106</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">28153</span> │ <span style="color: #008000; text-decoration-color: #008000">Subscriber</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1988</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8238268.813</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4970321.91</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span>  │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8238655.983</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4970578.277</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">464.354418</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.258423</span> │
│            <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                        │                <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                     │                      <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                       <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                           │                    <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                     <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │      <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>          │          <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │      <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                  │               <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└──────────────┴──────────────────────────┴──────────────────────────┴──────────────────┴───────────────────────┴────────────────────────┴─────────────────────────┴────────────────┴─────────────────────────────┴──────────────────────┴───────────────────────┴────────┴────────────┴────────────┴────────┴────────────────────────────────────┴────────────────────────────────────┴─────────────────┴──────────────────┘
</pre>
</div>
</div>
</section>
<section id="acknowledgements-and-resources" class="level2">
<h2 class="anchored" data-anchor-id="acknowledgements-and-resources">Acknowledgements and resources</h2>
<p>Thank you to <a href="https://spatial-dev.guru/">Spatial Dev Guru</a>, for the amazing tutorial showcasing DuckDB spatial features. It was fun to replicate the tutorial using Ibis.</p>
<p>If you are interested in learning more about Ibis-DuckDB geospatial support, here is another blog post <a href="https://ibis-project.org/posts/ibis-duckdb-geospatial/">bis + DuckDB geospatial: a match made on Earth</a>.</p>
<p>Here are some resources to learn more about Ibis:</p>
<ul>
<li><a href="https://ibis-project.org/">Ibis Docs</a></li>
<li><a href="https://github.com/ibis-project/ibis">Ibis GitHub</a></li>
</ul>
<p>Chat with us on Zulip:</p>
<ul>
<li><a href="https://ibis-project.zulipchat.com/">Ibis Zulip Chat</a></li>
</ul>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>blog</category>
  <category>duckdb</category>
  <category>geospatial</category>
  <guid>https://ibis-project.org/posts/ibis-duckdb-geospatial-dev-guru/</guid>
  <pubDate>Tue, 16 Jan 2024 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Announcing Zulip for Ibis community chat</title>
  <dc:creator>Ibis team</dc:creator>
  <link>https://ibis-project.org/posts/zulip/</link>
  <description><![CDATA[ 





<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>The Ibis project has moved to Zulip for its community chat! We’ve been testing it out for a few months and are happy with the results. From the <a href="https://github.com/zulip/zulip">Zulip repository’s README</a>:</p>
<blockquote class="blockquote">
<p>Zulip is an open-source team collaboration tool with unique topic-based threading that combines the best of email and chat to make remote work productive and delightful. Fortune 500 companies, leading open source projects, and thousands of other organizations use Zulip every day. Zulip is the only modern team chat app that is designed for both live and asynchronous conversations.</p>
<p>Zulip is built by a distributed community of developers from all around the world, with 74+ people who have each contributed 100+ commits. With over 1000 contributors merging over 500 commits a month, Zulip is the largest and fastest growing open source team chat project.</p>
</blockquote>
</section>
<section id="benefits-for-ibis-users" class="level2">
<h2 class="anchored" data-anchor-id="benefits-for-ibis-users">Benefits for Ibis users</h2>
<p>GitHub issues remain the source of truth for work item tracking and bug reports, while Zulip offers a more interactive chat experience. This is useful when you’re not sure if you’ve found a bug or just need help with something. It’s also a great place to ask questions about Ibis or get help with your code.</p>
<p>Zulip splits conversations into streams (like channels in Slack or Teams), but uniquely requires each individual conversation to also have a topic. This makes it easy to follow along with conversations that are relevant to you, and to find conversations that you’ve participated in.</p>
</section>
<section id="next-steps" class="level2">
<h2 class="anchored" data-anchor-id="next-steps">Next steps</h2>
<p><a href="https://ibis-project.zulipchat.com/">Join us on Zulip and introduce yourself!</a></p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>blog</category>
  <category>chat</category>
  <category>community</category>
  <guid>https://ibis-project.org/posts/zulip/</guid>
  <pubDate>Thu, 04 Jan 2024 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Ibis versus X: Performance across the ecosystem part 2</title>
  <dc:creator>Phillip Cloud</dc:creator>
  <link>https://ibis-project.org/posts/pydata-performance-part2/</link>
  <description><![CDATA[ 





<p><strong>TL; DR</strong>: Ibis supports both Polars and DataFusion. Both backends are have about the same runtime performance, and lag far behind DuckDB on this workload. There’s negligible performance difference between Ibis and the backend native APIs.</p>
<section id="motivation" class="level2">
<h2 class="anchored" data-anchor-id="motivation">Motivation</h2>
<p>This is part 2 of a series of posts showing performance across various backends that Ibis supports.</p>
<p>Check out <a href="../pydata-performance/">part 1</a> if you haven’t already!</p>
<p>In this post, I’ll continue with the <a href="../../backends/polars.html">Polars</a> and <a href="../../backends/datafusion.html">DataFusion</a> backends.</p>
<p>I show each tool using both the Ibis API and the tool’s native API. We’ll see that the performance difference between these approaches is negligible.</p>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>I ran all of the code in this blog post on a machine with these specs.</p>
<table class="table">
<thead>
<tr class="header">
<th>Component</th>
<th>Specification</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>CPU</td>
<td>AMD EPYC 7B12 (64 threads)</td>
</tr>
<tr class="even">
<td>RAM</td>
<td>94 GiB</td>
</tr>
<tr class="odd">
<td>Disk</td>
<td>1.5 TiB SSD</td>
</tr>
<tr class="even">
<td>OS</td>
<td>NixOS (Linux 6.1.66)</td>
</tr>
</tbody>
</table>
<section id="library-versions" class="level3">
<h3 class="anchored" data-anchor-id="library-versions">Library versions</h3>
<p>Here are the versions I used to run this experiment at the time of writing.</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">Dependency</th>
<th style="text-align: left;">Version</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Python</td>
<td style="text-align: left;">3.10.13 (main, Aug 24 2023, 12:59:26) [GCC 12.3.0]</td>
</tr>
<tr class="even">
<td style="text-align: left;">datafusion</td>
<td style="text-align: left;">33.0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ibis</td>
<td style="text-align: left;"><a href="https://github.com/ibis-project/ibis/tree/2b54b9800"><code>2b54b9800</code></a></td>
</tr>
<tr class="even">
<td style="text-align: left;">pandas</td>
<td style="text-align: left;">2.1.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">polars</td>
<td style="text-align: left;">0.19.19</td>
</tr>
<tr class="even">
<td style="text-align: left;">pyarrow</td>
<td style="text-align: left;">14.0.1</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="running-the-query-across-backends" class="level2">
<h2 class="anchored" data-anchor-id="running-the-query-across-backends">Running the query across backends</h2>
<p>Here are the different Ibis expressions for each backend as well as the same query with native APIs, along with timed executions of the query.</p>
<section id="duckdb" class="level3">
<h3 class="anchored" data-anchor-id="duckdb">DuckDB</h3>
<p>First, let’s run the Ibis + DuckDB version of the query from the original post:</p>
<div class="sourceCode" id="annotated-cell-1" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy"><code class="sourceCode python"><span id="annotated-cell-1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> __future__ <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> annotations</span>
<span id="annotated-cell-1-2"></span>
<span id="annotated-cell-1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis</span>
<span id="annotated-cell-1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> ibis <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> _</span>
<span id="annotated-cell-1-5"></span>
<span id="annotated-cell-1-6">expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="annotated-cell-1-7">    ibis.read_parquet(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/data/pypi-parquet/*.parquet"</span>)</span>
<span id="annotated-cell-1-8">    .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="annotated-cell-1-9">        [</span>
<span id="annotated-cell-1-10">            _.path.re_search(</span>
<span id="annotated-cell-1-11">                <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"\.(asm|c|cc|cpp|cxx|h|hpp|rs|[Ff][0-9]{0,2}(?:or)?|go)$"</span></span>
<span id="annotated-cell-1-12">            ),</span>
<span id="annotated-cell-1-13">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>_.path.re_search(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"(^|/)test(|s|ing)"</span>),</span>
<span id="annotated-cell-1-14">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>_.path.contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/site-packages/"</span>),</span>
<span id="annotated-cell-1-15">        ]</span>
<span id="annotated-cell-1-16">    )</span>
<span id="annotated-cell-1-17">    .group_by(</span>
<span id="annotated-cell-1-18">        month<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.uploaded_on.truncate(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>),</span>
<span id="annotated-cell-1-19">        ext<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.path.re_extract(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"\.([a-z0-9]+)$"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="annotated-cell-1-20">        .re_replace(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"cxx|cpp|cc|c|hpp|h"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C/C++"</span>)</span>
<span id="annotated-cell-1-21">        .re_replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^f.*$"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fortran"</span>)</span>
<span id="annotated-cell-1-22">        .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rs"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rust"</span>)</span>
<span id="annotated-cell-1-23">        .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"go"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Go"</span>)</span>
<span id="annotated-cell-1-24">        .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"asm"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Assembly"</span>)</span>
<span id="annotated-cell-1-25">        .nullif(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>),</span>
<span id="annotated-cell-1-26">    )</span>
<span id="annotated-cell-1-27">    .aggregate(project_count<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.project_name.nunique())</span>
<span id="annotated-cell-1-28">    .dropna(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ext"</span>)</span>
<span id="annotated-cell-1-29">    .order_by([_.month.desc(), _.project_count.desc()])</span>
<span id="annotated-cell-1-30">)</span>
<span id="annotated-cell-1-31">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expr.to_pandas()</span></code></pre></div>
<div id="0eb66682" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1">duckdb_ibis_results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>timeit <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>n1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>o <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>run duckdb_ibis.py</span>
<span id="cb1-2">df.head()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>33.9 s ± 0 ns per loop (mean ± std. dev. of 1 run, 1 loop each)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">ext</th>
<th data-quarto-table-cell-role="th">project_count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2023-11-01</td>
<td>C/C++</td>
<td>836</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2023-11-01</td>
<td>Rust</td>
<td>190</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2023-11-01</td>
<td>Fortran</td>
<td>48</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2023-11-01</td>
<td>Go</td>
<td>33</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2023-11-01</td>
<td>Assembly</td>
<td>10</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="datafusion-and-polars" class="level3">
<h3 class="anchored" data-anchor-id="datafusion-and-polars">DataFusion and Polars</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" aria-controls="tabset-3-1" aria-selected="true">DataFusion</a></li><li class="nav-item"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" aria-controls="tabset-3-2" aria-selected="false">Polars</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" aria-labelledby="tabset-3-1-tab">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" aria-controls="tabset-1-1" aria-selected="true">Ibis</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" aria-controls="tabset-1-2" aria-selected="false">DataFusion native</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" aria-labelledby="tabset-1-1-tab">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> __future__ <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> annotations</span>
<span id="cb3-2"></span>
<span id="cb3-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis</span>
<span id="cb3-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> ibis <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> _</span>
<span id="cb3-5"></span>
<span id="cb3-6">ibis.set_backend(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"datafusion"</span>)</span>
<span id="cb3-7"></span>
<span id="cb3-8">expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb3-9">    ibis.read_parquet(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/data/pypi-parquet/*.parquet"</span>)</span>
<span id="cb3-10">    .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="cb3-11">        [</span>
<span id="cb3-12">            _.path.re_search(</span>
<span id="cb3-13">                <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"\.(asm|c|cc|cpp|cxx|h|hpp|rs|[Ff][0-9]{0,2}(?:or)?|go)$"</span></span>
<span id="cb3-14">            ),</span>
<span id="cb3-15">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>_.path.re_search(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"(^|/)test(|s|ing)"</span>),</span>
<span id="cb3-16">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>_.path.contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/site-packages/"</span>),</span>
<span id="cb3-17">        ]</span>
<span id="cb3-18">    )</span>
<span id="cb3-19">    .group_by(</span>
<span id="cb3-20">        month<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.uploaded_on.truncate(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>),</span>
<span id="cb3-21">        ext<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.path.re_extract(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"\.([a-z0-9]+)$"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb3-22">        .re_replace(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"cxx|cpp|cc|c|hpp|h"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C/C++"</span>)</span>
<span id="cb3-23">        .re_replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^f.*$"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fortran"</span>)</span>
<span id="cb3-24">        .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rs"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rust"</span>)</span>
<span id="cb3-25">        .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"go"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Go"</span>)</span>
<span id="cb3-26">        .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"asm"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Assembly"</span>)</span>
<span id="cb3-27">        .nullif(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>),</span>
<span id="cb3-28">    )</span>
<span id="cb3-29">    .aggregate(project_count<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.project_name.nunique())</span>
<span id="cb3-30">    .dropna(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ext"</span>)</span>
<span id="cb3-31">    .order_by([_.month.desc(), _.project_count.desc()])</span>
<span id="cb3-32">)</span>
<span id="cb3-33">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expr.to_pandas()</span></code></pre></div>
<div id="f2cf6d58" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">datafusion_ibis_results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>timeit <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>n1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>o <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>run datafusion_ibis.py</span>
<span id="cb4-2">df.head()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>8min 54s ± 0 ns per loop (mean ± std. dev. of 1 run, 1 loop each)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">ext</th>
<th data-quarto-table-cell-role="th">project_count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2023-11-01</td>
<td>C/C++</td>
<td>836</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2023-11-01</td>
<td>Rust</td>
<td>190</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2023-11-01</td>
<td>Fortran</td>
<td>48</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2023-11-01</td>
<td>Go</td>
<td>33</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2023-11-01</td>
<td>Assembly</td>
<td>10</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" aria-labelledby="tabset-1-2-tab">
<details open="">
<summary>
DataFusion SQL
</summary>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb6-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span></span>
<span id="cb6-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">month</span>,</span>
<span id="cb6-3">  ext,</span>
<span id="cb6-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">COUNT</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">DISTINCT</span> project_name) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> project_count</span>
<span id="cb6-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> (</span>
<span id="cb6-6">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span></span>
<span id="cb6-7">    project_name,</span>
<span id="cb6-8">    DATE_TRUNC(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'month'</span>, uploaded_on) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">month</span>,</span>
<span id="cb6-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">NULLIF</span>(</span>
<span id="cb6-10">      <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">REPLACE</span>(</span>
<span id="cb6-11">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">REPLACE</span>(</span>
<span id="cb6-12">          <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">REPLACE</span>(</span>
<span id="cb6-13">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">REGEXP_REPLACE</span>(</span>
<span id="cb6-14">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">REGEXP_REPLACE</span>(</span>
<span id="cb6-15">                REGEXP_MATCH(path, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">CONCAT</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'('</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'\.([a-z0-9]+)$'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">')'</span>))[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>],</span>
<span id="cb6-16">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cxx|cpp|cc|c|hpp|h'</span>,</span>
<span id="cb6-17">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'C/C++'</span>,</span>
<span id="cb6-18">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'g'</span></span>
<span id="cb6-19">              ),</span>
<span id="cb6-20">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'^f.*$'</span>,</span>
<span id="cb6-21">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Fortran'</span>,</span>
<span id="cb6-22">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'g'</span></span>
<span id="cb6-23">            ),</span>
<span id="cb6-24">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'rs'</span>,</span>
<span id="cb6-25">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Rust'</span></span>
<span id="cb6-26">          ),</span>
<span id="cb6-27">          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'go'</span>,</span>
<span id="cb6-28">          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Go'</span></span>
<span id="cb6-29">        ),</span>
<span id="cb6-30">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'asm'</span>,</span>
<span id="cb6-31">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Assembly'</span></span>
<span id="cb6-32">      ),</span>
<span id="cb6-33">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span></span>
<span id="cb6-34">    ) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> ext</span>
<span id="cb6-35">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> pypi</span>
<span id="cb6-36">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">WHERE</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">COALESCE</span>(</span>
<span id="cb6-37">      ARRAY_LENGTH(</span>
<span id="cb6-38">        REGEXP_MATCH(path, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'\.(asm|c|cc|cpp|cxx|h|hpp|rs|[Ff][0-9]{0,2}(?:or)?|go)$'</span>)</span>
<span id="cb6-39">      ) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb6-40">      <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb6-41">    )</span>
<span id="cb6-42">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AND</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">NOT</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">COALESCE</span>(ARRAY_LENGTH(REGEXP_MATCH(path, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'(^|/)test(|s|ing)'</span>)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb6-43">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AND</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">NOT</span> STRPOS(path, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/site-packages/'</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb6-44">)</span>
<span id="cb6-45"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">WHERE</span> ext <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">IS</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">NOT</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">NULL</span></span>
<span id="cb6-46"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">GROUP</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">BY</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">month</span>, ext</span>
<span id="cb6-47"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">ORDER</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">BY</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">month</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">DESC</span>, project_count <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">DESC</span></span></code></pre></div>
</details>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> __future__ <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> annotations</span>
<span id="cb7-2"></span>
<span id="cb7-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datafusion</span>
<span id="cb7-4"></span>
<span id="cb7-5"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./datafusion_native.sql"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb7-6">    query <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f.read()</span>
<span id="cb7-7"></span>
<span id="cb7-8">ctx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> datafusion.SessionContext()</span>
<span id="cb7-9">ctx.register_parquet(name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pypi"</span>, path<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/data/pypi-parquet/*.parquet"</span>)</span>
<span id="cb7-10">expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ctx.sql(query)</span>
<span id="cb7-11"></span>
<span id="cb7-12">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expr.to_pandas()</span></code></pre></div>
<div id="6c62ff04" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">datafusion_native_results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>timeit <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>n1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>o <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>run datafusion_native.py</span>
<span id="cb8-2">df.head()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>9min 4s ± 0 ns per loop (mean ± std. dev. of 1 run, 1 loop each)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">ext</th>
<th data-quarto-table-cell-role="th">project_count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2023-11-01</td>
<td>C/C++</td>
<td>836</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2023-11-01</td>
<td>Rust</td>
<td>190</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2023-11-01</td>
<td>Fortran</td>
<td>48</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2023-11-01</td>
<td>Go</td>
<td>33</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2023-11-01</td>
<td>Assembly</td>
<td>10</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" aria-labelledby="tabset-3-2-tab">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" aria-controls="tabset-2-1" aria-selected="true">Ibis</a></li><li class="nav-item"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" aria-controls="tabset-2-2" aria-selected="false">Polars native</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" aria-labelledby="tabset-2-1-tab">
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> __future__ <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> annotations</span>
<span id="cb10-2"></span>
<span id="cb10-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis</span>
<span id="cb10-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> ibis <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> _</span>
<span id="cb10-5"></span>
<span id="cb10-6">ibis.set_backend(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"polars"</span>)</span>
<span id="cb10-7"></span>
<span id="cb10-8">expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb10-9">    ibis.read_parquet(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/data/pypi-parquet/*.parquet"</span>)</span>
<span id="cb10-10">    .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="cb10-11">        [</span>
<span id="cb10-12">            _.path.re_search(</span>
<span id="cb10-13">                <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"\.(asm|c|cc|cpp|cxx|h|hpp|rs|[Ff][0-9]{0,2}(?:or)?|go)$"</span></span>
<span id="cb10-14">            ),</span>
<span id="cb10-15">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>_.path.re_search(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"(^|/)test(|s|ing)"</span>),</span>
<span id="cb10-16">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>_.path.contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/site-packages/"</span>),</span>
<span id="cb10-17">        ]</span>
<span id="cb10-18">    )</span>
<span id="cb10-19">    .group_by(</span>
<span id="cb10-20">        month<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.uploaded_on.truncate(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>),</span>
<span id="cb10-21">        ext<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.path.re_extract(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"\.([a-z0-9]+)$"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb10-22">        .re_replace(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"cxx|cpp|cc|c|hpp|h"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C/C++"</span>)</span>
<span id="cb10-23">        .re_replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^f.*$"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fortran"</span>)</span>
<span id="cb10-24">        .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rs"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rust"</span>)</span>
<span id="cb10-25">        .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"go"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Go"</span>)</span>
<span id="cb10-26">        .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"asm"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Assembly"</span>)</span>
<span id="cb10-27">        .nullif(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>),</span>
<span id="cb10-28">    )</span>
<span id="cb10-29">    .aggregate(project_count<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.project_name.nunique())</span>
<span id="cb10-30">    .dropna(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ext"</span>)</span>
<span id="cb10-31">    .order_by([_.month.desc(), _.project_count.desc()])</span>
<span id="cb10-32">)</span>
<span id="cb10-33">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expr.to_pandas(streaming<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span></code></pre></div>
<div id="cab318c2" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">polars_ibis_results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>timeit <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>n1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>o <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>run polars_ibis.py</span>
<span id="cb11-2">df.head()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>6min 32s ± 0 ns per loop (mean ± std. dev. of 1 run, 1 loop each)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">ext</th>
<th data-quarto-table-cell-role="th">project_count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2023-11-01</td>
<td>C/C++</td>
<td>836</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2023-11-01</td>
<td>Rust</td>
<td>190</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2023-11-01</td>
<td>Fortran</td>
<td>48</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2023-11-01</td>
<td>Go</td>
<td>33</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2023-11-01</td>
<td>Assembly</td>
<td>10</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" aria-labelledby="tabset-2-2-tab">
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> __future__ <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> annotations</span>
<span id="cb13-2"></span>
<span id="cb13-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> polars <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pl</span>
<span id="cb13-4"></span>
<span id="cb13-5">expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb13-6">    pl.scan_parquet(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/data/pypi-parquet/*.parquet"</span>)</span>
<span id="cb13-7">    .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="cb13-8">        [</span>
<span id="cb13-9">            pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"path"</span>).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.contains(</span>
<span id="cb13-10">                <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"\.(asm|c|cc|cpp|cxx|h|hpp|rs|[Ff][0-9]{0,2}(?:or)?|go)$"</span></span>
<span id="cb13-11">            ),</span>
<span id="cb13-12">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"path"</span>).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.contains(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"(^|/)test(|s|ing)"</span>),</span>
<span id="cb13-13">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"path"</span>).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/site-packages/"</span>, literal<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>),</span>
<span id="cb13-14">        ]</span>
<span id="cb13-15">    )</span>
<span id="cb13-16">    .with_columns(</span>
<span id="cb13-17">        month<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uploaded_on"</span>).dt.truncate(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1mo"</span>),</span>
<span id="cb13-18">        ext<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"path"</span>)</span>
<span id="cb13-19">        .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.extract(pattern<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"\.([a-z0-9]+)$"</span>, group_index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb13-20">        .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.replace_all(pattern<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"cxx|cpp|cc|c|hpp|h"</span>, value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C/C++"</span>)</span>
<span id="cb13-21">        .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.replace_all(pattern<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^f.*$"</span>, value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fortran"</span>)</span>
<span id="cb13-22">        .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rs"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rust"</span>, literal<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb13-23">        .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"go"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Go"</span>, literal<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb13-24">        .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"asm"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Assembly"</span>, literal<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb13-25">        .replace({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>}),</span>
<span id="cb13-26">    )</span>
<span id="cb13-27">    .group_by([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ext"</span>])</span>
<span id="cb13-28">    .agg(project_count<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pl.col(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"project_name"</span>).n_unique())</span>
<span id="cb13-29">    .drop_nulls([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ext"</span>])</span>
<span id="cb13-30">    .sort([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"project_count"</span>], descending<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb13-31">)</span>
<span id="cb13-32"></span>
<span id="cb13-33">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expr.collect(streaming<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>).to_pandas()</span></code></pre></div>
<div id="92d6341d" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1">polars_native_results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>timeit <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>n1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>o <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>run polars_native.py</span>
<span id="cb14-2">df.head()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>6min 54s ± 0 ns per loop (mean ± std. dev. of 1 run, 1 loop each)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">ext</th>
<th data-quarto-table-cell-role="th">project_count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2023-11-01</td>
<td>C/C++</td>
<td>836</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2023-11-01</td>
<td>Rust</td>
<td>190</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2023-11-01</td>
<td>Fortran</td>
<td>48</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2023-11-01</td>
<td>Go</td>
<td>33</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2023-11-01</td>
<td>Assembly</td>
<td>10</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="takeaways" class="level2">
<h2 class="anchored" data-anchor-id="takeaways">Takeaways</h2>
<p><strong>Ibis + DuckDB is the only system tested that handles this workload well out of the box</strong></p>
<ul>
<li>Both Polars and DataFusion are much slower than DuckDB and Dask on this workload.</li>
<li>Polars memory use fluctuates quite bit, while DataFusion’s memory profile is similar to DuckDB.</li>
</ul>
<p>Let’s recap the results with some numbers:</p>
<section id="numbers" class="level3">
<h3 class="anchored" data-anchor-id="numbers">Numbers</h3>
<table class="table">
<thead>
<tr class="header">
<th>Toolset</th>
<th style="text-align: right;">Data size</th>
<th style="text-align: right;">Duration</th>
<th style="text-align: right;">Throughput</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Ibis + DuckDB</td>
<td style="text-align: right;">25,825 MiB</td>
<td style="text-align: right;">34 seconds</td>
<td style="text-align: right;">763 MiB/s</td>
</tr>
<tr class="even">
<td>Ibis + Polars</td>
<td style="text-align: right;">25,825 MiB</td>
<td style="text-align: right;">393 seconds</td>
<td style="text-align: right;">66 MiB/s</td>
</tr>
<tr class="odd">
<td>Polars native API</td>
<td style="text-align: right;">25,825 MiB</td>
<td style="text-align: right;">415 seconds</td>
<td style="text-align: right;">62 MiB/s</td>
</tr>
<tr class="even">
<td>Ibis + DataFusion</td>
<td style="text-align: right;">25,825 MiB</td>
<td style="text-align: right;">535 seconds</td>
<td style="text-align: right;">48 MiB/s</td>
</tr>
<tr class="odd">
<td>DataFusion native API</td>
<td style="text-align: right;">25,825 MiB</td>
<td style="text-align: right;">545 seconds</td>
<td style="text-align: right;">47 MiB/s</td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The Polars run durations were highly variable
</div>
</div>
<div class="callout-body-container callout-body">
<p>I couldn’t figure out how to get consistent run times.</p>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>If you’re considering Polars for new code, give Ibis a try with the <a href="../../backends/duckdb.html">DuckDB backend</a>.</p>
<p>You’ll get better performance than Polars on some workloads, and with a broader cross-backend API that helps you scale from development to production.</p>
<p>If you find that Polars has better performance than DuckDB on a particular workload you can always switch to the Polars backend for that workload.</p>
<p>Everyone wins!</p>
<p>In the next post in this series we’ll cover the cloud backends: Snowflake, BigQuery, Trino and ClickHouse.</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>blog</category>
  <category>case study</category>
  <category>ecosystem</category>
  <category>performance</category>
  <guid>https://ibis-project.org/posts/pydata-performance-part2/</guid>
  <pubDate>Mon, 11 Dec 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Ibis + DuckDB geospatial: a match made on Earth</title>
  <dc:creator>Naty Clementi</dc:creator>
  <link>https://ibis-project.org/posts/ibis-duckdb-geospatial/</link>
  <description><![CDATA[ 





<p>Ibis now has support for <a href="https://gist.github.com/ncclementi/fbc5564af709e2d7f8882821e3a8649f">DuckDB geospatial functions</a>!</p>
<p>This blogpost showcases some examples of the geospatial API for the DuckDB backend. The material is inspired by the <a href="https://geog-414.gishub.org/book/duckdb/07_spatial_relationships.html">“DuckDB: Spatial Relationships”</a> lesson from <a href="https://geog-414.gishub.org/book/preface/instructor.html">Dr.&nbsp;Qiusheng Wu</a>’s course “Spatial Data Management” from the Department of Geography &amp; Sustainability at the University of Tennessee, Knoxville.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can check Dr.&nbsp;Qiusheng Wu’s full Spatial Data Management course material on its <a href="https://geog-414.gishub.org/index.html">website</a>, and the classes are also on <a href="https://www.youtube.com/watch?v=A4TOAdsXsEs&amp;list=PLAxJ4-o7ZoPe9SkgnophygyLjTDBzIEbi">YouTube</a>.</p>
</div>
</div>
<section id="installation" class="level2">
<h2 class="anchored" data-anchor-id="installation">Installation</h2>
<p>Install Ibis with the dependencies needed to work with geospatial data using DuckDB:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> pip install <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ibis-framework[duckdb,geospatial]'</span></span></code></pre></div>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<p>We are going to be working with data from New York City. The database contains multiple tables with information about subway stations, streets, neighborhood, census data and, homicides. The datasets in the database are in NAD83 / UTM zone 18N projection, EPSG:26918.</p>
<div id="2c0697ed" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> pathlib <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Path</span>
<span id="cb2-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> zipfile <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ZipFile</span>
<span id="cb2-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> urllib.request <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> urlretrieve</span>
<span id="cb2-4"></span>
<span id="cb2-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Download and unzip</span></span>
<span id="cb2-6">url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://open.gishub.org/data/duckdb/nyc_data.db.zip"</span></span>
<span id="cb2-7">zip_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Path(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nyc_data.db.zip"</span>)</span>
<span id="cb2-8">db_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Path(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nyc_data.db"</span>)</span>
<span id="cb2-9"></span>
<span id="cb2-10"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> zip_path.exists():</span>
<span id="cb2-11">    urlretrieve(url, zip_path)</span>
<span id="cb2-12"></span>
<span id="cb2-13"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> db_path.exists():</span>
<span id="cb2-14">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> ZipFile(zip_path) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> zip_file:</span>
<span id="cb2-15">        zip_file.extract(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nyc_data.db"</span>)</span></code></pre></div>
</div>
</section>
<section id="lets-get-started" class="level2">
<h2 class="anchored" data-anchor-id="lets-get-started">Let’s get started</h2>
<p>The beauty of spatial databases is that they allow us to both store <em>and</em> compute over geometries.</p>
<div id="bc8f522f" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis</span>
<span id="cb3-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> ibis <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> _</span>
<span id="cb3-3"></span>
<span id="cb3-4">ibis.options.interactive <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb3-5"></span>
<span id="cb3-6">con <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.duckdb.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nyc_data.db"</span>)</span>
<span id="cb3-7">con.list_tables()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>['nyc_census_blocks',
 'nyc_homicides',
 'nyc_neighborhoods',
 'nyc_streets',
 'nyc_subway_stations']</code></pre>
</div>
</div>
<p>We have multiple tables with information about New York City. Following Dr.&nbsp;Wu’s class, we’ll take a look at some spatial relations.</p>
<p>We can start by taking a peek at the <code>nyc_subway_stations</code> table.</p>
<div id="91083220" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">subway_stations <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> con.table(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nyc_subway_stations"</span>)</span>
<span id="cb5-2">subway_stations</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> OBJECTID </span>┃<span style="font-weight: bold"> ID      </span>┃<span style="font-weight: bold"> NAME         </span>┃<span style="font-weight: bold"> ALT_NAME        </span>┃<span style="font-weight: bold"> CROSS_ST        </span>┃<span style="font-weight: bold"> LONG_NAME                               </span>┃<span style="font-weight: bold"> LABEL                             </span>┃<span style="font-weight: bold"> BOROUGH   </span>┃<span style="font-weight: bold"> NGHBHD </span>┃<span style="font-weight: bold"> ROUTES </span>┃<span style="font-weight: bold"> TRANSFERS </span>┃<span style="font-weight: bold"> COLOR        </span>┃<span style="font-weight: bold"> EXPRESS </span>┃<span style="font-weight: bold"> CLOSED </span>┃<span style="font-weight: bold"> geom                             </span>┃
┡━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">geospatial:geometry</span>              │
├──────────┼─────────┼──────────────┼─────────────────┼─────────────────┼─────────────────────────────────────────┼───────────────────────────────────┼───────────┼────────┼────────┼───────────┼──────────────┼─────────┼────────┼──────────────────────────────────┤
│      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.0</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">376.0</span> │ <span style="color: #008000; text-decoration-color: #008000">Cortlandt St</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>            │ <span style="color: #008000; text-decoration-color: #008000">Church St      </span> │ <span style="color: #008000; text-decoration-color: #008000">Cortlandt St (R,W) Manhattan           </span> │ <span style="color: #008000; text-decoration-color: #008000">Cortlandt St (R,W)               </span> │ <span style="color: #008000; text-decoration-color: #008000">Manhattan</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">R,W   </span> │ <span style="color: #008000; text-decoration-color: #008000">R,W      </span> │ <span style="color: #008000; text-decoration-color: #008000">YELLOW      </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">583521.854</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4507077.863</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │
│      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.0</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.0</span> │ <span style="color: #008000; text-decoration-color: #008000">Rector St   </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>            │ <span style="color: #008000; text-decoration-color: #008000">Rector St (1) Manhattan                </span> │ <span style="color: #008000; text-decoration-color: #008000">Rector St (1)                    </span> │ <span style="color: #008000; text-decoration-color: #008000">Manhattan</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">1     </span> │ <span style="color: #008000; text-decoration-color: #008000">1        </span> │ <span style="color: #008000; text-decoration-color: #008000">RED         </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">583324.487</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4506805.373</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │
│      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.0</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.0</span> │ <span style="color: #008000; text-decoration-color: #008000">South Ferry </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>            │ <span style="color: #008000; text-decoration-color: #008000">South Ferry (1) Manhattan              </span> │ <span style="color: #008000; text-decoration-color: #008000">South Ferry (1)                  </span> │ <span style="color: #008000; text-decoration-color: #008000">Manhattan</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">1     </span> │ <span style="color: #008000; text-decoration-color: #008000">1        </span> │ <span style="color: #008000; text-decoration-color: #008000">RED         </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">583304.182</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4506069.654</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │
│      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.0</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">125.0</span> │ <span style="color: #008000; text-decoration-color: #008000">138th St    </span> │ <span style="color: #008000; text-decoration-color: #008000">Grand Concourse</span> │ <span style="color: #008000; text-decoration-color: #008000">Grand Concourse</span> │ <span style="color: #008000; text-decoration-color: #008000">138th St / Grand Concourse (4,5) Bronx </span> │ <span style="color: #008000; text-decoration-color: #008000">138th St / Grand Concourse (4,5) </span> │ <span style="color: #008000; text-decoration-color: #008000">Bronx    </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">4,5   </span> │ <span style="color: #008000; text-decoration-color: #008000">4,5      </span> │ <span style="color: #008000; text-decoration-color: #008000">GREEN       </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">590250.106</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4518558.02</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span>  │
│      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5.0</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">126.0</span> │ <span style="color: #008000; text-decoration-color: #008000">149th St    </span> │ <span style="color: #008000; text-decoration-color: #008000">Grand Concourse</span> │ <span style="color: #008000; text-decoration-color: #008000">Grand Concourse</span> │ <span style="color: #008000; text-decoration-color: #008000">149th St / Grand Concourse (4) Bronx   </span> │ <span style="color: #008000; text-decoration-color: #008000">149th St / Grand Concourse (4)   </span> │ <span style="color: #008000; text-decoration-color: #008000">Bronx    </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">4     </span> │ <span style="color: #008000; text-decoration-color: #008000">2,4,5    </span> │ <span style="color: #008000; text-decoration-color: #008000">GREEN       </span> │ <span style="color: #008000; text-decoration-color: #008000">express</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">590454.74</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4519145.72</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span>   │
│      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6.0</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">45.0</span> │ <span style="color: #008000; text-decoration-color: #008000">149th St    </span> │ <span style="color: #008000; text-decoration-color: #008000">Grand Concourse</span> │ <span style="color: #008000; text-decoration-color: #008000">Grand Concourse</span> │ <span style="color: #008000; text-decoration-color: #008000">149th St / Grand Concourse (2,5) Bronx </span> │ <span style="color: #008000; text-decoration-color: #008000">149th St / Grand Concourse (2,5) </span> │ <span style="color: #008000; text-decoration-color: #008000">Bronx    </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">2,5   </span> │ <span style="color: #008000; text-decoration-color: #008000">2,4,5    </span> │ <span style="color: #008000; text-decoration-color: #008000">RED-GREEN   </span> │ <span style="color: #008000; text-decoration-color: #008000">express</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">590465.893</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4519168.697</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │
│      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">7.0</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">127.0</span> │ <span style="color: #008000; text-decoration-color: #008000">161st St    </span> │ <span style="color: #008000; text-decoration-color: #008000">Yankee Stadium </span> │ <span style="color: #008000; text-decoration-color: #008000">River Ave      </span> │ <span style="color: #008000; text-decoration-color: #008000">161st St / Yankee Stadium (B,D,4) Bronx</span> │ <span style="color: #008000; text-decoration-color: #008000">161st St / Yankee Stadium (B,D,4)</span> │ <span style="color: #008000; text-decoration-color: #008000">Bronx    </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">B,D,4 </span> │ <span style="color: #008000; text-decoration-color: #008000">B,D,4    </span> │ <span style="color: #008000; text-decoration-color: #008000">GREEN-ORANGE</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">590573.169</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4520214.766</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │
│      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">8.0</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">208.0</span> │ <span style="color: #008000; text-decoration-color: #008000">167th St    </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>            │ <span style="color: #008000; text-decoration-color: #008000">Grand Concourse</span> │ <span style="color: #008000; text-decoration-color: #008000">167th St (B,D) Bronx                   </span> │ <span style="color: #008000; text-decoration-color: #008000">167th St (B,D)                   </span> │ <span style="color: #008000; text-decoration-color: #008000">Bronx    </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">B,D   </span> │ <span style="color: #008000; text-decoration-color: #008000">B,D      </span> │ <span style="color: #008000; text-decoration-color: #008000">ORANGE      </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">591252.831</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4520950.353</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │
│      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">9.0</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">128.0</span> │ <span style="color: #008000; text-decoration-color: #008000">167th St    </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>            │ <span style="color: #008000; text-decoration-color: #008000">River Ave      </span> │ <span style="color: #008000; text-decoration-color: #008000">167th St (4) Bronx                     </span> │ <span style="color: #008000; text-decoration-color: #008000">167th St (4)                     </span> │ <span style="color: #008000; text-decoration-color: #008000">Bronx    </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">4     </span> │ <span style="color: #008000; text-decoration-color: #008000">4        </span> │ <span style="color: #008000; text-decoration-color: #008000">GREEN       </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">590946.397</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4521077.319</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │
│     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10.0</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">209.0</span> │ <span style="color: #008000; text-decoration-color: #008000">170th St    </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>            │ <span style="color: #008000; text-decoration-color: #008000">Grand Concourse</span> │ <span style="color: #008000; text-decoration-color: #008000">170th St (B,D) Bronx                   </span> │ <span style="color: #008000; text-decoration-color: #008000">170th St (B,D)                   </span> │ <span style="color: #008000; text-decoration-color: #008000">Bronx    </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">B,D   </span> │ <span style="color: #008000; text-decoration-color: #008000">B,D      </span> │ <span style="color: #008000; text-decoration-color: #008000">ORANGE      </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">591583.611</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4521434.847</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │
│        <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │       <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                │
└──────────┴─────────┴──────────────┴─────────────────┴─────────────────┴─────────────────────────────────────────┴───────────────────────────────────┴───────────┴────────┴────────┴───────────┴──────────────┴─────────┴────────┴──────────────────────────────────┘
</pre>
</div>
</div>
<p>Notice that the last column has a <code>geometry</code> type, and in this case it contains points that represent the location of each subway station. Let’s grab the entry for the Broad St subway station.</p>
<div id="d55308f6" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">broad_station <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> subway_stations.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(subway_stations.NAME <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Broad St"</span>)</span>
<span id="cb6-2">broad_station</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> OBJECTID </span>┃<span style="font-weight: bold"> ID      </span>┃<span style="font-weight: bold"> NAME     </span>┃<span style="font-weight: bold"> ALT_NAME </span>┃<span style="font-weight: bold"> CROSS_ST </span>┃<span style="font-weight: bold"> LONG_NAME                  </span>┃<span style="font-weight: bold"> LABEL            </span>┃<span style="font-weight: bold"> BOROUGH   </span>┃<span style="font-weight: bold"> NGHBHD </span>┃<span style="font-weight: bold"> ROUTES </span>┃<span style="font-weight: bold"> TRANSFERS </span>┃<span style="font-weight: bold"> COLOR  </span>┃<span style="font-weight: bold"> EXPRESS </span>┃<span style="font-weight: bold"> CLOSED </span>┃<span style="font-weight: bold"> geom                             </span>┃
┡━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">geospatial:geometry</span>              │
├──────────┼─────────┼──────────┼──────────┼──────────┼────────────────────────────┼──────────────────┼───────────┼────────┼────────┼───────────┼────────┼─────────┼────────┼──────────────────────────────────┤
│    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">332.0</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">304.0</span> │ <span style="color: #008000; text-decoration-color: #008000">Broad St</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │ <span style="color: #008000; text-decoration-color: #008000">Wall St </span> │ <span style="color: #008000; text-decoration-color: #008000">Broad St (J,M,Z) Manhattan</span> │ <span style="color: #008000; text-decoration-color: #008000">Broad St (J,M,Z)</span> │ <span style="color: #008000; text-decoration-color: #008000">Manhattan</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">J,M,Z </span> │ <span style="color: #008000; text-decoration-color: #008000">J,M,Z    </span> │ <span style="color: #008000; text-decoration-color: #008000">BROWN </span> │ <span style="color: #008000; text-decoration-color: #008000">express</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">583571.906</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4506714.341</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │
└──────────┴─────────┴──────────┴──────────┴──────────┴────────────────────────────┴──────────────────┴───────────┴────────┴────────┴───────────┴────────┴─────────┴────────┴──────────────────────────────────┘
</pre>
</div>
</div>
<section id="geo_equals-st_equals" class="level3">
<h3 class="anchored" data-anchor-id="geo_equals-st_equals"><code>geo_equals</code> (<code>ST_Equals</code>)</h3>
<p>In DuckDB <code>ST_Equals</code> returns <code>True</code> if two geometries are topologically equal. This means that they have the same dimension and identical coordinate values, although the order of the vertices may be different.</p>
<p>The following is a bit redundant but we can check if our <code>"Broad St"</code> point matches only one point in our data using <code>geo_equals</code></p>
<div id="1294de47" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">subway_stations.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(subway_stations.geom.geo_equals(broad_station.geom))</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> OBJECTID </span>┃<span style="font-weight: bold"> ID      </span>┃<span style="font-weight: bold"> NAME     </span>┃<span style="font-weight: bold"> ALT_NAME </span>┃<span style="font-weight: bold"> CROSS_ST </span>┃<span style="font-weight: bold"> LONG_NAME                  </span>┃<span style="font-weight: bold"> LABEL            </span>┃<span style="font-weight: bold"> BOROUGH   </span>┃<span style="font-weight: bold"> NGHBHD </span>┃<span style="font-weight: bold"> ROUTES </span>┃<span style="font-weight: bold"> TRANSFERS </span>┃<span style="font-weight: bold"> COLOR  </span>┃<span style="font-weight: bold"> EXPRESS </span>┃<span style="font-weight: bold"> CLOSED </span>┃<span style="font-weight: bold"> geom                             </span>┃
┡━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">geospatial:geometry</span>              │
├──────────┼─────────┼──────────┼──────────┼──────────┼────────────────────────────┼──────────────────┼───────────┼────────┼────────┼───────────┼────────┼─────────┼────────┼──────────────────────────────────┤
│    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">332.0</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">304.0</span> │ <span style="color: #008000; text-decoration-color: #008000">Broad St</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │ <span style="color: #008000; text-decoration-color: #008000">Wall St </span> │ <span style="color: #008000; text-decoration-color: #008000">Broad St (J,M,Z) Manhattan</span> │ <span style="color: #008000; text-decoration-color: #008000">Broad St (J,M,Z)</span> │ <span style="color: #008000; text-decoration-color: #008000">Manhattan</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">J,M,Z </span> │ <span style="color: #008000; text-decoration-color: #008000">J,M,Z    </span> │ <span style="color: #008000; text-decoration-color: #008000">BROWN </span> │ <span style="color: #008000; text-decoration-color: #008000">express</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">583571.906</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4506714.341</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │
└──────────┴─────────┴──────────┴──────────┴──────────┴────────────────────────────┴──────────────────┴───────────┴────────┴────────┴───────────┴────────┴─────────┴────────┴──────────────────────────────────┘
</pre>
</div>
</div>
<p>We can also write this query without using <code>broad_station</code> as a variable, and with the help of the deferred expressions API, also known as <a href="../../how-to/analytics/chain_expressions.html">the underscore API</a>.</p>
<div id="1b486459" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">subway_stations.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(_.geom.geo_equals(_.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(_.NAME <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Broad St"</span>).geom))</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> OBJECTID </span>┃<span style="font-weight: bold"> ID      </span>┃<span style="font-weight: bold"> NAME     </span>┃<span style="font-weight: bold"> ALT_NAME </span>┃<span style="font-weight: bold"> CROSS_ST </span>┃<span style="font-weight: bold"> LONG_NAME                  </span>┃<span style="font-weight: bold"> LABEL            </span>┃<span style="font-weight: bold"> BOROUGH   </span>┃<span style="font-weight: bold"> NGHBHD </span>┃<span style="font-weight: bold"> ROUTES </span>┃<span style="font-weight: bold"> TRANSFERS </span>┃<span style="font-weight: bold"> COLOR  </span>┃<span style="font-weight: bold"> EXPRESS </span>┃<span style="font-weight: bold"> CLOSED </span>┃<span style="font-weight: bold"> geom                             </span>┃
┡━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">geospatial:geometry</span>              │
├──────────┼─────────┼──────────┼──────────┼──────────┼────────────────────────────┼──────────────────┼───────────┼────────┼────────┼───────────┼────────┼─────────┼────────┼──────────────────────────────────┤
│    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">332.0</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">304.0</span> │ <span style="color: #008000; text-decoration-color: #008000">Broad St</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │ <span style="color: #008000; text-decoration-color: #008000">Wall St </span> │ <span style="color: #008000; text-decoration-color: #008000">Broad St (J,M,Z) Manhattan</span> │ <span style="color: #008000; text-decoration-color: #008000">Broad St (J,M,Z)</span> │ <span style="color: #008000; text-decoration-color: #008000">Manhattan</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">J,M,Z </span> │ <span style="color: #008000; text-decoration-color: #008000">J,M,Z    </span> │ <span style="color: #008000; text-decoration-color: #008000">BROWN </span> │ <span style="color: #008000; text-decoration-color: #008000">express</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">583571.906</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4506714.341</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │
└──────────┴─────────┴──────────┴──────────┴──────────┴────────────────────────────┴──────────────────┴───────────┴────────┴────────┴───────────┴────────┴─────────┴────────┴──────────────────────────────────┘
</pre>
</div>
</div>
</section>
<section id="intersect-st_intersect" class="level3">
<h3 class="anchored" data-anchor-id="intersect-st_intersect"><code>intersect</code> (ST_Intersect)</h3>
<p>Let’s locate the neighborhood of the “Broad Street” subway station using the geospatial <code>intersect</code> function. The <code>intersect</code> function returns <code>True</code> if two geometries have any points in common.</p>
<div id="b8e02487" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1">boroughs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> con.table(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nyc_neighborhoods"</span>)</span>
<span id="cb9-2">boroughs</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> BORONAME      </span>┃<span style="font-weight: bold"> NAME                     </span>┃<span style="font-weight: bold"> geom                                                                             </span>┃
┡━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">geospatial:geometry</span>                                                              │
├───────────────┼──────────────────────────┼──────────────────────────────────────────────────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">Brooklyn     </span> │ <span style="color: #008000; text-decoration-color: #008000">Bensonhurst             </span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">MULTIPOLYGON</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(((</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">582771.426</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4495167.427</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">584651.294</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4497541.643</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">585422.281</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">&gt;</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Manhattan    </span> │ <span style="color: #008000; text-decoration-color: #008000">East Village            </span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">MULTIPOLYGON</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(((</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">585508.753</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4509691.267</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">586826.357</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4508984.188</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">586726.827</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">&gt;</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Manhattan    </span> │ <span style="color: #008000; text-decoration-color: #008000">West Village            </span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">MULTIPOLYGON</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(((</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">583263.278</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4509242.626</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">583276.82</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4509378.825</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">583473.971</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">&gt;</span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Bronx    </span> │ <span style="color: #008000; text-decoration-color: #008000">Throggs Neck            </span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">MULTIPOLYGON</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(((</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">597640.009</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4520272.72</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">597647.746</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4520617.824</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">597805.462</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">&gt;</span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Bronx    </span> │ <span style="color: #008000; text-decoration-color: #008000">Wakefield-Williamsbridge</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">MULTIPOLYGON</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(((</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">595285.205</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4525938.798</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">595348.545</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4526158.777</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">595672</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4527</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">&gt;</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Queens       </span> │ <span style="color: #008000; text-decoration-color: #008000">Auburndale              </span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">MULTIPOLYGON</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(((</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">600973.009</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4510338.857</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">601002.162</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4510743.044</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">601131.315</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">&gt;</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Manhattan    </span> │ <span style="color: #008000; text-decoration-color: #008000">Battery Park            </span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">MULTIPOLYGON</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(((</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">583408.101</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4508093.111</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">583356.048</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4507665.145</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">583260.947</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">&gt;</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Manhattan    </span> │ <span style="color: #008000; text-decoration-color: #008000">Carnegie Hill           </span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">MULTIPOLYGON</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(((</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">588501.208</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4515525.88</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">588125.03</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4514806.77</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">587702.963</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">451</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">&gt;</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Staten Island</span> │ <span style="color: #008000; text-decoration-color: #008000">Mariners Harbor         </span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">MULTIPOLYGON</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(((</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">570300.108</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4497031.156</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">570393.836</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4497227.426</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">570478.075</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">&gt;</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Staten Island</span> │ <span style="color: #008000; text-decoration-color: #008000">Rossville               </span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">MULTIPOLYGON</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(((</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">564664.957</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4489358.427</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">564771.457</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4489415.865</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">564783.746</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">&gt;</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                                                │
└───────────────┴──────────────────────────┴──────────────────────────────────────────────────────────────────────────────────┘
</pre>
</div>
</div>
<div id="c46ddb76" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">boroughs.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(_.geom.intersects(broad_station.geom))</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> BORONAME  </span>┃<span style="font-weight: bold"> NAME               </span>┃<span style="font-weight: bold"> geom                                                                             </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">geospatial:geometry</span>                                                              │
├───────────┼────────────────────┼──────────────────────────────────────────────────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">Manhattan</span> │ <span style="color: #008000; text-decoration-color: #008000">Financial District</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">MULTIPOLYGON</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(((</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">583356.048</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4507665.145</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">583505.038</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4507562.36</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">583828.604</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">&gt;</span> │
└───────────┴────────────────────┴──────────────────────────────────────────────────────────────────────────────────┘
</pre>
</div>
</div>
</section>
<section id="d_within-st_dwithin" class="level3">
<h3 class="anchored" data-anchor-id="d_within-st_dwithin"><code>d_within</code> (ST_DWithin)</h3>
<p>We can also find the streets near (say, within 10 meters) the Broad St subway station using the <code>d_within</code> function. The <code>d_within</code> function returns True if the geometries are within a given distance.</p>
<div id="b4076098" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">streets <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> con.table(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nyc_streets"</span>)</span>
<span id="cb11-2">streets</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> ID    </span>┃<span style="font-weight: bold"> NAME            </span>┃<span style="font-weight: bold"> ONEWAY </span>┃<span style="font-weight: bold"> TYPE          </span>┃<span style="font-weight: bold"> geom                                                                             </span>┃
┡━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int32</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">geospatial:geometry</span>                                                              │
├───────┼─────────────────┼────────┼───────────────┼──────────────────────────────────────────────────────────────────────────────────┤
│     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │ <span style="color: #008000; text-decoration-color: #008000">Shore Pky S    </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">residential  </span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">MULTILINESTRING</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">((</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">586785.477</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4492901.001</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">586898.232</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4492943.725</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">587118.98</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">&gt;</span> │
│     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">footway      </span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">MULTILINESTRING</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">((</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">586645.007</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4504977.75</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">586664.225</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4504988.544</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">586672.151</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">&gt;</span> │
│     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3</span> │ <span style="color: #008000; text-decoration-color: #008000">Avenue O       </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">residential  </span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">MULTILINESTRING</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">((</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">586750.302</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4496109.722</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">586837.373</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4496123.393</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">586929.08</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">&gt;</span> │
│     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4</span> │ <span style="color: #008000; text-decoration-color: #008000">Walsh Ct       </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">residential  </span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">MULTILINESTRING</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">((</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">586728.696</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4497971.053</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">586886.358</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4498000.536</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">))</span><span style="font-weight: bold">&gt;</span>             │
│     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">motorway_link</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">MULTILINESTRING</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">((</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">586587.053</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4510088.25</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">586641.734</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4510156.835</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">))</span><span style="font-weight: bold">&gt;</span>              │
│     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6</span> │ <span style="color: #008000; text-decoration-color: #008000">Avenue Z       </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">residential  </span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">MULTILINESTRING</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">((</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">586792.159</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4493279.322</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">586978.534</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4493308.473</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">587056.76</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">&gt;</span> │
│     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">7</span> │ <span style="color: #008000; text-decoration-color: #008000">Dank Ct        </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">residential  </span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">MULTILINESTRING</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">((</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">586794.754</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4493361.729</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">586966.095</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4493387.928</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">))</span><span style="font-weight: bold">&gt;</span>             │
│     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">8</span> │ <span style="color: #008000; text-decoration-color: #008000">Cumberland Walk</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">footway      </span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">MULTILINESTRING</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">((</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">586657.468</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4505324.904</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">586692.489</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4505320.983</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">586707.76</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">&gt;</span> │
│     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">9</span> │ <span style="color: #008000; text-decoration-color: #008000">Cumberland Walk</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">footway      </span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">MULTILINESTRING</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">((</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">586670.712</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4505521.567</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">586667.915</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4505500.551</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">586657.46</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">&gt;</span> │
│    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">residential  </span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">MULTILINESTRING</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">((</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">586598.326</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4510424.446</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">586602.314</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4510430.044</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">586604.94</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">&gt;</span> │
│     <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                                                │
└───────┴─────────────────┴────────┴───────────────┴──────────────────────────────────────────────────────────────────────────────────┘
</pre>
</div>
</div>
<p>Using the deferred API, we can check which streets are within <code>d=10</code> meters of distance.</p>
<div id="4ac671e1" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1">sts_near_broad <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> streets.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(_.geom.d_within(broad_station.geom, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span>
<span id="cb12-2">sts_near_broad</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> ID    </span>┃<span style="font-weight: bold"> NAME      </span>┃<span style="font-weight: bold"> ONEWAY </span>┃<span style="font-weight: bold"> TYPE         </span>┃<span style="font-weight: bold"> geom                                                                             </span>┃
┡━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int32</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">geospatial:geometry</span>                                                              │
├───────┼───────────┼────────┼──────────────┼──────────────────────────────────────────────────────────────────────────────────┤
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17394</span> │ <span style="color: #008000; text-decoration-color: #008000">Wall St  </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">unclassified</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">MULTILINESTRING</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">((</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">583483.954</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4506785.646</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">583522.11</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4506758.431</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">583571.509</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">&gt;</span> │
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17399</span> │ <span style="color: #008000; text-decoration-color: #008000">Broad St </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">unclassified</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">MULTILINESTRING</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">((</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">583571.509</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4506715.578</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">583529.136</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4506622.066</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">583509.85</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">&gt;</span> │
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17445</span> │ <span style="color: #008000; text-decoration-color: #008000">Nassau St</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">unclassified</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">MULTILINESTRING</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">((</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">583571.509</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4506715.578</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">583610.912</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4506780.181</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">583641.80</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">&gt;</span> │
└───────┴───────────┴────────┴──────────────┴──────────────────────────────────────────────────────────────────────────────────┘
</pre>
</div>
</div>
<p>To visualize the findings, we will convert the tables to GeoPandas DataFrames.</p>
<div id="4072e894" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1">broad_station_gdf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> broad_station.to_pandas()</span>
<span id="cb13-2">broad_station_gdf.crs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"EPSG:26918"</span></span>
<span id="cb13-3"></span>
<span id="cb13-4">sts_near_broad_gdf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sts_near_broad.to_pandas()</span>
<span id="cb13-5">sts_near_broad_gdf.crs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"EPSG:26918"</span></span>
<span id="cb13-6"></span>
<span id="cb13-7">streets_gdf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> streets.to_pandas()</span>
<span id="cb13-8">streets_gdf.crs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"EPSG:26918"</span></span></code></pre></div>
</div>
<div id="07092d5c" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="annotated-cell-13" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><button class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="1">1</button><span id="annotated-cell-13-1" class="code-annotation-target"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> leafmap.deckgl <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> leafmap</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-13" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="1" data-code-annotation="1"><code>leafmap.deckgl</code> allows us to visualize multiple layers</span>
</dd>
</dl>
</div>
</div>
<div id="dbb7cbc4" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1">m <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> leafmap.Map()</span>
<span id="cb14-2"></span>
<span id="cb14-3">m.add_vector(broad_station_gdf, get_fill_color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>)</span>
<span id="cb14-4">m.add_vector(sts_near_broad_gdf, get_color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb14-5">m.add_vector(streets_gdf, get_color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey"</span>, zoom_to_layer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>, opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>)</span>
<span id="cb14-6">m</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"2de7bbc6208f485f800dbf8e9b23efba","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<p>You can zoom in and out, and hover over the map to check on the street names.</p>
</section>
<section id="buffer-st_buffer" class="level3">
<h3 class="anchored" data-anchor-id="buffer-st_buffer"><code>buffer</code> (ST_Buffer)</h3>
<p>Next, we’ll take a look at the homicides table and showcase some additional functionality related to polygon handling.</p>
<div id="68b35a69" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1">homicides <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> con.table(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nyc_homicides"</span>)</span>
<span id="cb15-2">homicides</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> INCIDENT_D </span>┃<span style="font-weight: bold"> BORONAME      </span>┃<span style="font-weight: bold"> NUM_VICTIM </span>┃<span style="font-weight: bold"> PRIMARY_MO </span>┃<span style="font-weight: bold"> ID    </span>┃<span style="font-weight: bold"> WEAPON </span>┃<span style="font-weight: bold"> LIGHT_DARK </span>┃<span style="font-weight: bold"> YEAR  </span>┃<span style="font-weight: bold"> geom                             </span>┃
┡━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">date</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int32</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int32</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">geospatial:geometry</span>              │
├────────────┼───────────────┼────────────┼────────────┼───────┼────────┼────────────┼───────┼──────────────────────────────────┤
│ <span style="color: #800080; text-decoration-color: #800080">2008-01-01</span> │ <span style="color: #008000; text-decoration-color: #008000">Brooklyn     </span> │ <span style="color: #008000; text-decoration-color: #008000">1         </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>       │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">7</span> │ <span style="color: #008000; text-decoration-color: #008000">gun   </span> │ <span style="color: #008000; text-decoration-color: #008000">D         </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2008</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">592158.666</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4502210.892</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2008-01-04</span> │ <span style="color: #008000; text-decoration-color: #008000">Manhattan    </span> │ <span style="color: #008000; text-decoration-color: #008000">1         </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>       │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">14</span> │ <span style="color: #008000; text-decoration-color: #008000">gun   </span> │ <span style="color: #008000; text-decoration-color: #008000">D         </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2008</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">588654.952</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4517855.383</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2008-01-05</span> │ <span style="color: #008000; text-decoration-color: #008000">Queens       </span> │ <span style="color: #008000; text-decoration-color: #008000">1         </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>       │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">15</span> │ <span style="color: #008000; text-decoration-color: #008000">gun   </span> │ <span style="color: #008000; text-decoration-color: #008000">D         </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2008</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">605800.815</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4505730.608</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2008-01-04</span> │ <span style="color: #008000; text-decoration-color: #008000">Queens       </span> │ <span style="color: #008000; text-decoration-color: #008000">1         </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>       │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">16</span> │ <span style="color: #008000; text-decoration-color: #008000">knife </span> │ <span style="color: #008000; text-decoration-color: #008000">D         </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2008</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">594255.157</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4512250.378</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2008-01-05</span> │ <span style="color: #008000; text-decoration-color: #008000">Queens       </span> │ <span style="color: #008000; text-decoration-color: #008000">1         </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>       │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18</span> │ <span style="color: #008000; text-decoration-color: #008000">gun   </span> │ <span style="color: #008000; text-decoration-color: #008000">D         </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2008</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">605498.135</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4496052.64</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span>  │
│ <span style="color: #800080; text-decoration-color: #800080">2008-01-07</span> │ <span style="color: #008000; text-decoration-color: #008000">Brooklyn     </span> │ <span style="color: #008000; text-decoration-color: #008000">1         </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>       │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20</span> │ <span style="color: #008000; text-decoration-color: #008000">gun   </span> │ <span style="color: #008000; text-decoration-color: #008000">D         </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2008</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">592020.999</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4505733.647</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2008-01-10</span> │ <span style="color: #008000; text-decoration-color: #008000">Manhattan    </span> │ <span style="color: #008000; text-decoration-color: #008000">1         </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>       │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">22</span> │ <span style="color: #008000; text-decoration-color: #008000">gun   </span> │ <span style="color: #008000; text-decoration-color: #008000">D         </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2008</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">584055.518</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4511774.724</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2008-01-10</span> │ <span style="color: #008000; text-decoration-color: #008000">Manhattan    </span> │ <span style="color: #008000; text-decoration-color: #008000">1         </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>       │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">23</span> │ <span style="color: #008000; text-decoration-color: #008000">gun   </span> │ <span style="color: #008000; text-decoration-color: #008000">D         </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2008</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">587283.748</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4516908.39</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span>  │
│ <span style="color: #800080; text-decoration-color: #800080">2008-01-13</span> │ <span style="color: #008000; text-decoration-color: #008000">Staten Island</span> │ <span style="color: #008000; text-decoration-color: #008000">1         </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>       │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">25</span> │ <span style="color: #008000; text-decoration-color: #008000">gun   </span> │ <span style="color: #008000; text-decoration-color: #008000">D         </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2008</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">570593.125</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4498222.78</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span>  │
│ <span style="color: #800080; text-decoration-color: #800080">2008-01-16</span> │ <span style="color: #008000; text-decoration-color: #008000">Queens       </span> │ <span style="color: #008000; text-decoration-color: #008000">1         </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>       │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">27</span> │ <span style="color: #008000; text-decoration-color: #008000">gun   </span> │ <span style="color: #008000; text-decoration-color: #008000">D         </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2008</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">607385.969</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4501506.717</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>          │     <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>          │     <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                │
└────────────┴───────────────┴────────────┴────────────┴───────┴────────┴────────────┴───────┴──────────────────────────────────┘
</pre>
</div>
</div>
<p>Let’s use the <code>buffer</code> method to find homicides near our <code>"Broad St"</code> station point.</p>
<p>The <code>buffer</code> method computes a polygon or multipolygon that represents all points whose distance from a geometry is less than or equal to a given distance.</p>
<div id="7f258231" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1">broad_station.geom.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">buffer</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> GeoBuffer(geom, 200.0)                                                           </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">geospatial:geometry</span>                                                              │
├──────────────────────────────────────────────────────────────────────────────────┤
│ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POLYGON</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">((</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">583771.906</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4506714.341</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">583768.063</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4506675.323</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">583756.682</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">450663</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">&gt;</span> │
└──────────────────────────────────────────────────────────────────────────────────┘
</pre>
</div>
</div>
<p>We can check the area using the <code>area</code> (<code>ST_Area</code>) function, and see that is <img src="https://latex.codecogs.com/png.latex?~%20%5Cpi%20r%5E%7B2%7D=125664"></p>
<div id="f37756c7" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1">broad_station.geom.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">buffer</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>).area()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> GeoArea(GeoBuffer(geom, 200.0)) </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>                         │
├─────────────────────────────────┤
│                    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">124857.80609</span> │
└─────────────────────────────────┘
</pre>
</div>
</div>
<p>To find if there were any homicides in that area, we can find where the polygon resulting from adding the 200 meters buffer to our “Broad St” station point intersects with the geometry column in our homicides table.</p>
<div id="47c09926" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1">h_near_broad <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> homicides.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(_.geom.intersects(broad_station.geom.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">buffer</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>)))</span>
<span id="cb18-2">h_near_broad</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> INCIDENT_D </span>┃<span style="font-weight: bold"> BORONAME  </span>┃<span style="font-weight: bold"> NUM_VICTIM </span>┃<span style="font-weight: bold"> PRIMARY_MO </span>┃<span style="font-weight: bold"> ID    </span>┃<span style="font-weight: bold"> WEAPON </span>┃<span style="font-weight: bold"> LIGHT_DARK </span>┃<span style="font-weight: bold"> YEAR  </span>┃<span style="font-weight: bold"> geom                             </span>┃
┡━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">date</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int32</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int32</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">geospatial:geometry</span>              │
├────────────┼───────────┼────────────┼────────────┼───────┼────────┼────────────┼───────┼──────────────────────────────────┤
│ <span style="color: #800080; text-decoration-color: #800080">2009-07-07</span> │ <span style="color: #008000; text-decoration-color: #008000">Manhattan</span> │ <span style="color: #008000; text-decoration-color: #008000">1         </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>       │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3544</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>       │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2009</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">POINT</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">583443.249</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4506757.877</span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">)</span><span style="font-weight: bold">&gt;</span> │
└────────────┴───────────┴────────────┴────────────┴───────┴────────┴────────────┴───────┴──────────────────────────────────┘
</pre>
</div>
</div>
<p>It looks like there was one homicide within 200 meters from the “Broad St” station, but from this data we can’t tell the street near which it happened. However, we can check if the homicide point is within a small distance of a street.</p>
<div id="daef4021" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1">h_street <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> streets.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(_.geom.d_within(h_near_broad.geom, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb19-2">h_street</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> ID    </span>┃<span style="font-weight: bold"> NAME      </span>┃<span style="font-weight: bold"> ONEWAY </span>┃<span style="font-weight: bold"> TYPE         </span>┃<span style="font-weight: bold"> geom                                                                             </span>┃
┡━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int32</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">geospatial:geometry</span>                                                              │
├───────┼───────────┼────────┼──────────────┼──────────────────────────────────────────────────────────────────────────────────┤
│ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17296</span> │ <span style="color: #008000; text-decoration-color: #008000">Rector St</span> │ <span style="color: #008000; text-decoration-color: #008000">yes   </span> │ <span style="color: #008000; text-decoration-color: #008000">unclassified</span> │ <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">MULTILINESTRING</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">((</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">583184.691</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4506868.803</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">583257.066</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4506835.054</span><span style="color: #000000; text-decoration-color: #000000">, </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">583324.11</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">&gt;</span> │
└───────┴───────────┴────────┴──────────────┴──────────────────────────────────────────────────────────────────────────────────┘
</pre>
</div>
</div>
<p>Let’s plot this:</p>
<div id="ce68040f" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1">broad_station_zone <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> broad_station.mutate(geom<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>broad_station.geom.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">buffer</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>))</span>
<span id="cb20-2">broad_station_zone <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> broad_station_zone.to_pandas()</span>
<span id="cb20-3">broad_station_zone.crs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"EPSG:26918"</span></span>
<span id="cb20-4"></span>
<span id="cb20-5">h_near_broad_gdf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> h_near_broad.to_pandas()</span>
<span id="cb20-6">h_near_broad_gdf.crs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"EPSG:26918"</span></span>
<span id="cb20-7"></span>
<span id="cb20-8">h_street_gdf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> h_street.to_pandas()</span>
<span id="cb20-9">h_street_gdf.crs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"EPSG:26918"</span></span>
<span id="cb20-10"></span>
<span id="cb20-11"></span>
<span id="cb20-12">mh <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> leafmap.Map()</span>
<span id="cb20-13">mh.add_vector(broad_station_gdf, get_fill_color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"orange"</span>)</span>
<span id="cb20-14">mh.add_vector(broad_station_zone, get_fill_color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"orange"</span>, opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)</span>
<span id="cb20-15">mh.add_vector(h_near_broad_gdf, get_fill_color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb20-16">mh.add_vector(h_street_gdf, get_color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>)</span>
<span id="cb20-17">mh.add_vector(streets_gdf, get_color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey"</span>, zoom_to_layer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>, opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)</span>
<span id="cb20-18"></span>
<span id="cb20-19">mh</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"c895c74f166447c3a2c5af686b91a518","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
</section>
</section>
<section id="functions-supported-and-next-steps" class="level2">
<h2 class="anchored" data-anchor-id="functions-supported-and-next-steps">Functions supported and next steps</h2>
<p>At the moment in Ibis we have support for around thirty geospatial functions in DuckDB and we will add some more (see list <a href="https://gist.github.com/ncclementi/fbc5564af709e2d7f8882821e3a8649f">here</a>).</p>
<p>We also support reading multiple geospatial formats via <a href="../../backends/duckdb.html#ibis.backends.duckdb.Backend.read_geo"><code>read_geo()</code></a>.</p>
<p>Here are some resources to learn more about Ibis:</p>
<ul>
<li><a href="https://ibis-project.org/">Ibis Docs</a></li>
<li><a href="https://github.com/ibis-project/ibis">Ibis GitHub</a></li>
</ul>
<p>Chat with us on Zulip:</p>
<ul>
<li><a href="https://ibis-project.zulipchat.com/">Ibis Zulip Chat</a></li>
</ul>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>blog</category>
  <category>duckdb</category>
  <category>geospatial</category>
  <guid>https://ibis-project.org/posts/ibis-duckdb-geospatial/</guid>
  <pubDate>Thu, 07 Dec 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Ibis versus X: Performance across the ecosystem part 1</title>
  <dc:creator>Phillip Cloud</dc:creator>
  <link>https://ibis-project.org/posts/pydata-performance/</link>
  <description><![CDATA[ 





<p><strong>TL; DR</strong>: Ibis has a lot of great backends. They’re all good at different things. For working with local data, it’s hard to beat DuckDB on feature set and performance.</p>
<p>Buckle up, it’s going to be a long one.</p>
<section id="motivation" class="level2">
<h2 class="anchored" data-anchor-id="motivation">Motivation</h2>
<p>Ibis maintainer <a href="https://github.com/gforsyth">Gil Forsyth</a> recently wrote a <a href="https://ibis-project.org/posts/querying-pypi-metadata-compiled-languages/">post on our blog</a> replicating <a href="https://sethmlarson.dev/security-developer-in-residence-weekly-report-18"><strong>another</strong> blog post</a> but using Ibis instead of raw SQL.</p>
<p>I thought it would be interesting to see how other tools compare to this setup, so I decided I’d try to do the same workflow on the same machine using a few tools from across the ecosystem.</p>
<p>I chose two incumbents–<a href="https://pandas.pydata.org/">pandas</a> and <a href="https://www.dask.org/">dask</a>–to see how they compare to Ibis + DuckDB on this workload. In part 2 of this series I will compare two newer engines–Polars and DataFusion–to Ibis + DuckDB.</p>
<p>I’ve worked on both pandas and Dask in the past but it’s been such a long time since I’ve used these tools for data analysis that I consider myself rather naive about how to best use them today.</p>
<p>Initially I was interested in API comparisons since usability is really where Ibis shines, but as I started to explore things, I was unable to complete my analysis in some cases due to running out of memory.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
This is not a forum to trash the work of others.
</div>
</div>
<div class="callout-body-container callout-body">
<p>I’m not interested in tearing down other tools.</p>
<p>Ibis has backends for each of these tools and it’s in everyone’s best interest that all of the tools discussed here work to their full potential.</p>
</div>
</div>
<p>I show each tool using its native API, in an attempt to compare ease-of-use out of the box and maximize each library’s ability to complete the workload.</p>
<p>Let’s dig in.</p>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>I ran all of the code in this blog post on a machine with these specs.</p>
<p>All OS caches were cleared before running this document with</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> sudo sysctl <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w</span> vm.drop_caches=3</span></code></pre></div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Clearing operating system caches <strong>does not represent a realistic usage scenario</strong>
</div>
</div>
<div class="callout-body-container callout-body">
<p>It is a method for putting the tools here on more equal footing. When you’re in the thick of an analysis you’re not going to artificially limit any OS optimizations.</p>
</div>
</div>
<table class="table">
<thead>
<tr class="header">
<th>Component</th>
<th>Specification</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>CPU</td>
<td>AMD EPYC 7B12 (64 threads)</td>
</tr>
<tr class="even">
<td>RAM</td>
<td>94 GiB</td>
</tr>
<tr class="odd">
<td>Disk</td>
<td>1.5 TiB SSD</td>
</tr>
<tr class="even">
<td>OS</td>
<td>NixOS (Linux 6.1.69)</td>
</tr>
</tbody>
</table>
<section id="soft-constraints" class="level3">
<h3 class="anchored" data-anchor-id="soft-constraints">Soft constraints</h3>
<p>I’ll introduce some soft UX constraints on the problem, that I think help convey the perspective of someone who wants to get started quickly with a data set:</p>
<ol type="1">
<li><strong>I don’t want to get another computer</strong> to run this workload.</li>
<li><strong>I want to use the data as is</strong>, that is, without altering the files I already have.</li>
<li><strong>I’d like to run this computation with the default configuration</strong>. Ideally configuration isn’t required to complete this workload out of the box.</li>
</ol>
</section>
<section id="library-versions" class="level3">
<h3 class="anchored" data-anchor-id="library-versions">Library versions</h3>
<p>Here are the versions I used to run this experiment at the time of writing.</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">Dependency</th>
<th style="text-align: left;">Version</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Python</td>
<td style="text-align: left;">3.10.13 (main, Aug 24 2023, 12:59:26) [GCC 12.3.0]</td>
</tr>
<tr class="even">
<td style="text-align: left;">dask</td>
<td style="text-align: left;">2023.12.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">distributed</td>
<td style="text-align: left;">2023.12.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">duckdb</td>
<td style="text-align: left;">0.9.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ibis</td>
<td style="text-align: left;"><a href="https://github.com/ibis-project/ibis/tree/1a5a42081"><code>1a5a42081</code></a></td>
</tr>
<tr class="even">
<td style="text-align: left;">pandas</td>
<td style="text-align: left;">2.1.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pyarrow</td>
<td style="text-align: left;">14.0.2</td>
</tr>
</tbody>
</table>
</section>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<p>I used the files <a href="https://raw.githubusercontent.com/pypi-data/data/20135ed214be9d6bb9c316121e5ccdaf29c6b9b1/links/dataset.txt">here</a> in this link to run my experiment.</p>
<p>Here’s a summary of the data set’s file sizes:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> du <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-h</span> /data/pypi-parquet/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>.parquet</span></code></pre></div>
<pre><code>1.8G    /data/pypi-parquet/index-12.parquet
1.7G    /data/pypi-parquet/index-10.parquet
1.9G    /data/pypi-parquet/index-2.parquet
1.9G    /data/pypi-parquet/index-0.parquet
1.8G    /data/pypi-parquet/index-5.parquet
1.7G    /data/pypi-parquet/index-13.parquet
1.7G    /data/pypi-parquet/index-9.parquet
1.8G    /data/pypi-parquet/index-6.parquet
1.7G    /data/pypi-parquet/index-7.parquet
1.7G    /data/pypi-parquet/index-8.parquet
800M    /data/pypi-parquet/index-14.parquet
1.8G    /data/pypi-parquet/index-4.parquet
1.8G    /data/pypi-parquet/index-11.parquet
1.9G    /data/pypi-parquet/index-3.parquet
1.9G    /data/pypi-parquet/index-1.parquet
</code></pre>
</section>
</section>
<section id="recapping-the-original-ibis-post" class="level2">
<h2 class="anchored" data-anchor-id="recapping-the-original-ibis-post">Recapping the original Ibis post</h2>
<p>Check out <a href="https://ibis-project.org/posts/querying-pypi-metadata-compiled-languages/">the original blog post</a> if you haven’t already!</p>
<p>Here’s the Ibis + DuckDB code, along with a timed execution of the query:</p>
<div class="sourceCode" id="annotated-cell-4" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-4-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> __future__ <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> annotations</span>
<span id="annotated-cell-4-2"></span>
<span id="annotated-cell-4-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis</span>
<span id="annotated-cell-4-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> ibis <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> _, udf</span>
<span id="annotated-cell-4-5"></span>
<span id="annotated-cell-4-6"></span>
<span id="annotated-cell-4-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@udf.scalar.builtin</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="1">1</button><span id="annotated-cell-4-8" class="code-annotation-target"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> flatten(x: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]:</span>
<span id="annotated-cell-4-9">    ...</span>
<span id="annotated-cell-4-10"></span>
<span id="annotated-cell-4-11"></span>
<span id="annotated-cell-4-12">expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="annotated-cell-4-13">    ibis.read_parquet(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/data/pypi-parquet/*.parquet"</span>)</span>
<span id="annotated-cell-4-14">    .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="annotated-cell-4-15">        [</span>
<span id="annotated-cell-4-16">            _.path.re_search(</span>
<span id="annotated-cell-4-17">                <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"\.(asm|c|cc|cpp|cxx|h|hpp|rs|[Ff][0-9]{0,2}(?:or)?|go)$"</span></span>
<span id="annotated-cell-4-18">            ),</span>
<span id="annotated-cell-4-19">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>_.path.re_search(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"(^|/)test(|s|ing)"</span>),</span>
<span id="annotated-cell-4-20">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>_.path.contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/site-packages/"</span>),</span>
<span id="annotated-cell-4-21">        ]</span>
<span id="annotated-cell-4-22">    )</span>
<span id="annotated-cell-4-23">    .group_by(</span>
<span id="annotated-cell-4-24">        month<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.uploaded_on.truncate(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>),</span>
<span id="annotated-cell-4-25">        ext<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.path.re_extract(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"\.([a-z0-9]+)$"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="annotated-cell-4-26">    )</span>
<span id="annotated-cell-4-27">    .aggregate(projects<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.project_name.collect().unique())</span>
<span id="annotated-cell-4-28">    .order_by(_.month.desc())</span>
<span id="annotated-cell-4-29">    .mutate(</span>
<span id="annotated-cell-4-30">        ext<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.ext.re_replace(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"cxx|cpp|cc|c|hpp|h"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C/C++"</span>)</span>
<span id="annotated-cell-4-31">        .re_replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^f.*$"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fortran"</span>)</span>
<span id="annotated-cell-4-32">        .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rs"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rust"</span>)</span>
<span id="annotated-cell-4-33">        .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"go"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Go"</span>)</span>
<span id="annotated-cell-4-34">        .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"asm"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Assembly"</span>)</span>
<span id="annotated-cell-4-35">        .nullif(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>),</span>
<span id="annotated-cell-4-36">    )</span>
<span id="annotated-cell-4-37">    .group_by([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ext"</span>])</span>
<span id="annotated-cell-4-38">    .aggregate(project_count<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>flatten(_.projects.collect()).unique().length())</span>
<span id="annotated-cell-4-39">    .dropna(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ext"</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="2">2</button><span id="annotated-cell-4-40" class="code-annotation-target">    .order_by([_.month.desc(), _.project_count.desc()])</span>
<span id="annotated-cell-4-41">)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-4" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="8" data-code-annotation="1">We’ve since implemented <a href="../../reference/expression-collections.html#ibis.expr.types.arrays.ArrayValue.flatten">a <code>flatten</code> method</a> on array expressions so it’s no longer necessary to define a UDF here. I’ll leave this code unchanged for this post. <strong>This has no effect on the performance of the query</strong>. In both cases the generated code contains a DuckDB-native call to <a href="https://duckdb.org/docs/sql/functions/nested.html">its <code>flatten</code> function</a>.</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="40" data-code-annotation="2">This is a small change from the original query that adds a final sort key to make the results deterministic.</span>
</dd>
</dl>
<div id="f191f8db" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>time df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expr.to_pandas()</span>
<span id="cb4-2">df</span></code></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"8f1bc232d95146dabe7f9c0ac503032e","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 19min 17s, sys: 1min 9s, total: 20min 26s
Wall time: 27 s</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">ext</th>
<th data-quarto-table-cell-role="th">project_count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2023-11-01</td>
<td>C/C++</td>
<td>836</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2023-11-01</td>
<td>Rust</td>
<td>190</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2023-11-01</td>
<td>Fortran</td>
<td>48</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2023-11-01</td>
<td>Go</td>
<td>33</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2023-11-01</td>
<td>Assembly</td>
<td>10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">794</td>
<td>2005-08-01</td>
<td>C/C++</td>
<td>7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">795</td>
<td>2005-07-01</td>
<td>C/C++</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">796</td>
<td>2005-05-01</td>
<td>C/C++</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">797</td>
<td>2005-04-01</td>
<td>C/C++</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">798</td>
<td>2005-03-01</td>
<td>C/C++</td>
<td>1</td>
</tr>
</tbody>
</table>

<p>799 rows × 3 columns</p>
</div>
</div>
</div>
<p>Let’s show peak memory usage in GB as reported by the <a href="https://docs.python.org/3/library/resource.html#module-resource"><code>resource</code></a> module:</p>
<div id="f5526688" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> resource</span>
<span id="cb6-2"></span>
<span id="cb6-3">rss_kb <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> resource.getrusage(resource.RUSAGE_SELF).ru_maxrss</span>
<span id="cb6-4">rss_mb <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rss_kb <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e3</span></span>
<span id="cb6-5">rss_gb <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rss_mb <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e3</span></span>
<span id="cb6-6"></span>
<span id="cb6-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">round</span>(rss_gb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GB"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>8.6 GB</code></pre>
</div>
</div>
</section>
<section id="pandas" class="level2">
<h2 class="anchored" data-anchor-id="pandas">Pandas</h2>
<p>Let’s try to replicate this workflow using pandas.</p>
<p>I started with this code:</p>
<div id="6b77a0b1" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb8-2"></span>
<span id="cb8-3">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_parquet(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/data/pypi-parquet/*.parquet"</span>)</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>FileNotFoundError: [Errno 2] No such file or directory: '/data/pypi-parquet/*.parquet'</code></pre>
</div>
</div>
<p>Looks like pandas doesn’t support globs. That’s fine, we can use the builtin <code>glob</code> module.</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> glob</span>
<span id="cb10-2"></span>
<span id="cb10-3">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_parquet(glob.glob(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/data/pypi-parquet/*.parquet"</span>))</span></code></pre></div>
<p>This eventually triggers the <a href="https://lwn.net/Kernel/Index/#Memory_management-Out-of-memory_handling">Linux OOM killer</a> after some minutes, so I can’t run the code.</p>
<p>Let’s try again with just a single file. I’ll pick the smallest file, to avoid any potential issues with memory and give pandas the best possible shot.</p>
<div id="6f79211e" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb11-2"></span>
<span id="cb11-3">smallest_file <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>(glob.glob(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/data/pypi-parquet/*.parquet"</span>), key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.path.getsize)</span></code></pre></div>
</div>
<p>The smallest file is 799 MiB on disk.</p>
<div id="37341bb4" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>time df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_parquet(smallest_file)</span>
<span id="cb12-2">df</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 25.6 s, sys: 12.6 s, total: 38.1 s
Wall time: 26.6 s</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">project_name</th>
<th data-quarto-table-cell-role="th">project_version</th>
<th data-quarto-table-cell-role="th">project_release</th>
<th data-quarto-table-cell-role="th">uploaded_on</th>
<th data-quarto-table-cell-role="th">path</th>
<th data-quarto-table-cell-role="th">archive_path</th>
<th data-quarto-table-cell-role="th">size</th>
<th data-quarto-table-cell-role="th">hash</th>
<th data-quarto-table-cell-role="th">skip_reason</th>
<th data-quarto-table-cell-role="th">lines</th>
<th data-quarto-table-cell-role="th">repository</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>zyte-spider-templates</td>
<td>0.1.0</td>
<td>zyte_spider_templates-0.1.0-py3-none-any.whl</td>
<td>2023-10-26 07:29:49.894</td>
<td>packages/zyte-spider-templates/zyte_spider_tem...</td>
<td>zyte_spider_templates/spiders/ecommerce.py</td>
<td>5748</td>
<td>b'\xe0\xa6\x9bd\xc0+\xe0\xf8$J2\xb3\xf8\x8c\x9...</td>
<td></td>
<td>160</td>
<td>237</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>zyte-spider-templates</td>
<td>0.1.0</td>
<td>zyte_spider_templates-0.1.0-py3-none-any.whl</td>
<td>2023-10-26 07:29:49.894</td>
<td>packages/zyte-spider-templates/zyte_spider_tem...</td>
<td>zyte_spider_templates/spiders/base.py</td>
<td>4160</td>
<td>b'\x1ck\xd46={\x7f`\xbe\xfaIg*&amp;\x977T\xdb\x8fJ'</td>
<td></td>
<td>122</td>
<td>237</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>zyte-spider-templates</td>
<td>0.1.0</td>
<td>zyte_spider_templates-0.1.0-py3-none-any.whl</td>
<td>2023-10-26 07:29:49.894</td>
<td>packages/zyte-spider-templates/zyte_spider_tem...</td>
<td>zyte_spider_templates/spiders/__init__.py</td>
<td>0</td>
<td>b'\xe6\x9d\xe2\x9b\xb2\xd1\xd6CK\x8b)\xaewZ\xd...</td>
<td>empty</td>
<td>0</td>
<td>237</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>zyte-spider-templates</td>
<td>0.1.0</td>
<td>zyte_spider_templates-0.1.0-py3-none-any.whl</td>
<td>2023-10-26 07:29:49.894</td>
<td>packages/zyte-spider-templates/zyte_spider_tem...</td>
<td>zyte_spider_templates/page_objects/product_nav...</td>
<td>3528</td>
<td>b'\xcd\xc9\xfc[\xda\xcf!\x94\x1b\x92\xffbJC\xf...</td>
<td></td>
<td>106</td>
<td>237</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>zyte-spider-templates</td>
<td>0.1.0</td>
<td>zyte_spider_templates-0.1.0-py3-none-any.whl</td>
<td>2023-10-26 07:29:49.894</td>
<td>packages/zyte-spider-templates/zyte_spider_tem...</td>
<td>zyte_spider_templates/page_objects/__init__.py</td>
<td>75</td>
<td>b'r\xb9\xc1\xcf2\xa7\xdc?\xd1\xa8\xfcc+`\xf3\x...</td>
<td></td>
<td>1</td>
<td>237</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35468828</td>
<td>1AH22CS174</td>
<td>1.81.11</td>
<td>1AH22CS174-1.81.11.tar.gz</td>
<td>2023-11-19 13:30:00.113</td>
<td>packages/1AH22CS174/1AH22CS174-1.81.11.tar.gz/...</td>
<td>1AH22CS174-1.81.11/1AH22CS174.egg-info/top_lev...</td>
<td>1</td>
<td>b"\x8b\x13x\x91y\x1f\xe9i'\xadx\xe6K\n\xad{\xd...</td>
<td></td>
<td>1</td>
<td>242</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35468829</td>
<td>1AH22CS174</td>
<td>1.81.11</td>
<td>1AH22CS174-1.81.11.tar.gz</td>
<td>2023-11-19 13:30:00.113</td>
<td>packages/1AH22CS174/1AH22CS174-1.81.11.tar.gz/...</td>
<td>1AH22CS174-1.81.11/1AH22CS174.egg-info/require...</td>
<td>16</td>
<td>b"qG\xad\xc3:.'q\xde\xaa\xac\x91\x89\xf7S\xcb\...</td>
<td></td>
<td>2</td>
<td>242</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35468830</td>
<td>1AH22CS174</td>
<td>1.81.11</td>
<td>1AH22CS174-1.81.11.tar.gz</td>
<td>2023-11-19 13:30:00.113</td>
<td>packages/1AH22CS174/1AH22CS174-1.81.11.tar.gz/...</td>
<td>1AH22CS174-1.81.11/1AH22CS174.egg-info/depende...</td>
<td>1</td>
<td>b"\x8b\x13x\x91y\x1f\xe9i'\xadx\xe6K\n\xad{\xd...</td>
<td></td>
<td>1</td>
<td>242</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35468831</td>
<td>1AH22CS174</td>
<td>1.81.11</td>
<td>1AH22CS174-1.81.11.tar.gz</td>
<td>2023-11-19 13:30:00.113</td>
<td>packages/1AH22CS174/1AH22CS174-1.81.11.tar.gz/...</td>
<td>1AH22CS174-1.81.11/1AH22CS174.egg-info/SOURCES...</td>
<td>187</td>
<td>b'\xa2O$4|X\x15,\xb0\x9a\x07\xe6\x81[\x15\x1f|...</td>
<td></td>
<td>7</td>
<td>242</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35468832</td>
<td>1AH22CS174</td>
<td>1.81.11</td>
<td>1AH22CS174-1.81.11.tar.gz</td>
<td>2023-11-19 13:30:00.113</td>
<td>packages/1AH22CS174/1AH22CS174-1.81.11.tar.gz/...</td>
<td>1AH22CS174-1.81.11/1AH22CS174.egg-info/PKG-INFO</td>
<td>509</td>
<td>b'\xee\xbe\xbaoh*\xacA\xb0\x8a}\xb5\x00\xcbpz\...</td>
<td></td>
<td>16</td>
<td>242</td>
</tr>
</tbody>
</table>

<p>35468833 rows × 11 columns</p>
</div>
</div>
</div>
<p>Loading the smallest file from the dataset is already pretty close to the time it took Ibis and DuckDB to execute the <em>entire query</em>.</p>
<p>Let’s give pandas a leg up and tell it what columns to use to avoid reading in a bunch of data we’re not going to use.</p>
<p>We can determine what these columns are by inspecting the Ibis code above.</p>
<div id="68f02e7b" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1">columns <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"path"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uploaded_on"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"project_name"</span>]</span>
<span id="cb14-2"></span>
<span id="cb14-3"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>time df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_parquet(smallest_file, columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>columns)</span>
<span id="cb14-4">df</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 13.3 s, sys: 7.21 s, total: 20.5 s
Wall time: 16.2 s</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">path</th>
<th data-quarto-table-cell-role="th">uploaded_on</th>
<th data-quarto-table-cell-role="th">project_name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>packages/zyte-spider-templates/zyte_spider_tem...</td>
<td>2023-10-26 07:29:49.894</td>
<td>zyte-spider-templates</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>packages/zyte-spider-templates/zyte_spider_tem...</td>
<td>2023-10-26 07:29:49.894</td>
<td>zyte-spider-templates</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>packages/zyte-spider-templates/zyte_spider_tem...</td>
<td>2023-10-26 07:29:49.894</td>
<td>zyte-spider-templates</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>packages/zyte-spider-templates/zyte_spider_tem...</td>
<td>2023-10-26 07:29:49.894</td>
<td>zyte-spider-templates</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>packages/zyte-spider-templates/zyte_spider_tem...</td>
<td>2023-10-26 07:29:49.894</td>
<td>zyte-spider-templates</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35468828</td>
<td>packages/1AH22CS174/1AH22CS174-1.81.11.tar.gz/...</td>
<td>2023-11-19 13:30:00.113</td>
<td>1AH22CS174</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35468829</td>
<td>packages/1AH22CS174/1AH22CS174-1.81.11.tar.gz/...</td>
<td>2023-11-19 13:30:00.113</td>
<td>1AH22CS174</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35468830</td>
<td>packages/1AH22CS174/1AH22CS174-1.81.11.tar.gz/...</td>
<td>2023-11-19 13:30:00.113</td>
<td>1AH22CS174</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35468831</td>
<td>packages/1AH22CS174/1AH22CS174-1.81.11.tar.gz/...</td>
<td>2023-11-19 13:30:00.113</td>
<td>1AH22CS174</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35468832</td>
<td>packages/1AH22CS174/1AH22CS174-1.81.11.tar.gz/...</td>
<td>2023-11-19 13:30:00.113</td>
<td>1AH22CS174</td>
</tr>
</tbody>
</table>

<p>35468833 rows × 3 columns</p>
</div>
</div>
</div>
<p>Sweet, read times improved!</p>
<p>Let’s peek at the memory usage of the DataFrame.</p>
<div id="b366dbbb" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">round</span>(df.memory_usage(deep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GiB"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>8.7 GiB</code></pre>
</div>
</div>
<p>I still have plenty of space to do my analysis, nice!</p>
<p>First, filter the data:</p>
<div id="a51a349b" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="annotated-cell-13" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-13-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%</span>time</span>
<span id="annotated-cell-13-2">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[</span>
<span id="annotated-cell-13-3">    (</span>
<span id="annotated-cell-13-4">        df.path.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.contains(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"\.(?:asm|c|cc|cpp|cxx|h|hpp|rs|[Ff][0-9]{0,2}(?:or)?|go)$"</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="1">1</button><span id="annotated-cell-13-5" class="code-annotation-target">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>df.path.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.contains(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"(?:^|/)test(?:|s|ing)|/site-packages/"</span>)</span>
<span id="annotated-cell-13-6">    )</span>
<span id="annotated-cell-13-7">]</span>
<span id="annotated-cell-13-8">df</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-13" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="5" data-code-annotation="1">I altered the original query here to avoid creating an unnecessary intermediate <code>Series</code> object.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 2min 22s, sys: 288 ms, total: 2min 23s
Wall time: 2min 23s</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">path</th>
<th data-quarto-table-cell-role="th">uploaded_on</th>
<th data-quarto-table-cell-role="th">project_name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1462</td>
<td>packages/zipline-tej/zipline_tej-0.0.50-cp38-c...</td>
<td>2023-10-27 02:23:07.153</td>
<td>zipline-tej</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1470</td>
<td>packages/zipline-tej/zipline_tej-0.0.50-cp38-c...</td>
<td>2023-10-27 02:23:07.153</td>
<td>zipline-tej</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1477</td>
<td>packages/zipline-tej/zipline_tej-0.0.50-cp38-c...</td>
<td>2023-10-27 02:23:07.153</td>
<td>zipline-tej</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1481</td>
<td>packages/zipline-tej/zipline_tej-0.0.50-cp38-c...</td>
<td>2023-10-27 02:23:07.153</td>
<td>zipline-tej</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1485</td>
<td>packages/zipline-tej/zipline_tej-0.0.50-cp38-c...</td>
<td>2023-10-27 02:23:07.153</td>
<td>zipline-tej</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35460320</td>
<td>packages/atomicshop/atomicshop-2.5.12-py3-none...</td>
<td>2023-11-19 14:29:22.109</td>
<td>atomicshop</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35460515</td>
<td>packages/atomicshop/atomicshop-2.5.11-py3-none...</td>
<td>2023-11-19 11:58:09.589</td>
<td>atomicshop</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35460710</td>
<td>packages/atomicshop/atomicshop-2.5.10-py3-none...</td>
<td>2023-11-19 11:48:16.980</td>
<td>atomicshop</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35463761</td>
<td>packages/ai-flow-nightly/ai_flow_nightly-2023....</td>
<td>2023-11-19 16:06:36.819</td>
<td>ai-flow-nightly</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35464036</td>
<td>packages/ai-flow-nightly/ai_flow_nightly-2023....</td>
<td>2023-11-19 16:06:33.327</td>
<td>ai-flow-nightly</td>
</tr>
</tbody>
</table>

<p>7166291 rows × 3 columns</p>
</div>
</div>
</div>
<p>We’ve blown <strong>way</strong> past our Ibis + DuckDB latency budget.</p>
<p>Let’s keep going!</p>
<p>Next, group by and aggregate:</p>
<div id="c9c153aa" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%</span>time</span>
<span id="cb19-2">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb19-3">    df.groupby(</span>
<span id="cb19-4">        [</span>
<span id="cb19-5">            df.uploaded_on.dt.floor(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>).rename(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month"</span>),</span>
<span id="cb19-6">            df.path.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.extract(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"\.([a-z0-9]+)$"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, expand<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>).rename(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ext"</span>),</span>
<span id="cb19-7">        ]</span>
<span id="cb19-8">    )</span>
<span id="cb19-9">    .agg({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"project_name"</span>: <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> s: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">set</span>(s))})</span>
<span id="cb19-10">    .sort_index(level<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month"</span>, ascending<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb19-11">)</span>
<span id="cb19-12">df</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>ValueError: &lt;MonthEnd&gt; is a non-fixed frequency</code></pre>
</div>
</div>
<p>Here we hit the first API issue going back to an <a href="https://github.com/pandas-dev/pandas/issues/15303">old pandas issue</a>: we can’t truncate a timestamp column to month frequency.</p>
<p>Let’s try the solution recommended in that issue.</p>
<div id="ddf7602a" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%</span>time</span>
<span id="cb21-2">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb21-3">    df.groupby(</span>
<span id="cb21-4">        [</span>
<span id="cb21-5">            df.uploaded_on.dt.to_period(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>).dt.to_timestamp().rename(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month"</span>),</span>
<span id="cb21-6">            df.path.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.extract(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"\.([a-z0-9]+)$"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, expand<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>).rename(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ext"</span>),</span>
<span id="cb21-7">        ]</span>
<span id="cb21-8">    )</span>
<span id="cb21-9">    .agg({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"project_name"</span>: <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> s: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">set</span>(s))})</span>
<span id="cb21-10">    .rename(columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"project_name"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"projects"</span>})</span>
<span id="cb21-11">    .sort_index(level<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month"</span>, ascending<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb21-12">)</span>
<span id="cb21-13">df</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 8.48 s, sys: 189 ms, total: 8.67 s
Wall time: 8.67 s</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">projects</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">ext</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="14" data-quarto-table-cell-role="th" data-valign="top">2023-11-01</td>
<td data-quarto-table-cell-role="th">rs</td>
<td>[ast-grep-pyo3, dora-rs, qiskit-terra, kuzu, p...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">hpp</td>
<td>[mqt.ddsim, kuzu, tensorflow-cpu-aws, pycuda, ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">h</td>
<td>[mqt.ddsim, cmeel-gmp, aesim.simba, nx-work-lo...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">go</td>
<td>[jina, ai-flow-nightly, tdewolff-minify, aws-i...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">for</td>
<td>[iricore]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">f95</td>
<td>[scikit-digital-health, dioptas, easychem, PyG...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">f90</td>
<td>[Clawpack, dropkick, sisl, c4p, iricore, fmodp...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">f03</td>
<td>[mkl-include]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">f</td>
<td>[Clawpack, gnssrefl, mqt.ddsim, scikit-build-c...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">cxx</td>
<td>[mqt.ddsim, SimpleITK, ndicapi, cmeel-eigen, a...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">cpp</td>
<td>[mqt.ddsim, petljapub, perun-toolsuite, epipol...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">cc</td>
<td>[mqt.ddsim, stim, pytensor, tensorflow-cpu-aws...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">c</td>
<td>[mqt.ddsim, aesim.simba, albopictus, odoo13-ad...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">asm</td>
<td>[mqt.ddsim, pwntools, grpcio, cmeel-assimp, hr...</td>
</tr>
<tr class="odd">
<td rowspan="11" data-quarto-table-cell-role="th" data-valign="top">2023-10-01</td>
<td data-quarto-table-cell-role="th">rs</td>
<td>[summa-embed, sqloxide, qiskit-terra, kuzu, st...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">hpp</td>
<td>[pydjinni, kuzu, tensorflow-cpu-aws, greenlet,...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">h</td>
<td>[greenlet, aesim.simba, confluent-kafka, Analy...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">go</td>
<td>[odoo14-addon-dms, micro-editor, jina, ai-flow...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">f90</td>
<td>[petsc, macauff, wiptools, pypestutils, petsc4...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">f</td>
<td>[gnssrefl, LightSim2Grid, odoo14-addon-dms, od...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">cxx</td>
<td>[petsc, cars, solarwinds-apm, chalc, wxPython-...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">cpp</td>
<td>[python-ucto, akida, pydjinni, pylcs, ParmEd, ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">cc</td>
<td>[duckdb, codecov-cli, odoo14-addon-dms, habana...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">c</td>
<td>[odoo14-addon-dms, kuzu, tensorflow-cpu-aws, c...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">asm</td>
<td>[chipsec, apache-flink-libraries, fibers-ddtes...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Sort the values, add a new column and do the final aggregation:</p>
<div id="cf4ecf71" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%</span>time</span>
<span id="cb23-2">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb23-3">    df.reset_index()</span>
<span id="cb23-4">    .assign(</span>
<span id="cb23-5">        ext<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> t: t.ext.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.replace(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"cxx|cpp|cc|c|hpp|h"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C/C++"</span>, regex<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb23-6">        .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^f.*$"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fortran"</span>, regex<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb23-7">        .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rs"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rust"</span>)</span>
<span id="cb23-8">        .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"go"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Go"</span>)</span>
<span id="cb23-9">        .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"asm"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Assembly"</span>)</span>
<span id="cb23-10">        .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>)</span>
<span id="cb23-11">    )</span>
<span id="cb23-12">    .groupby([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ext"</span>])</span>
<span id="cb23-13">    .agg({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"projects"</span>: <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> s: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">set</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(s, [])))})</span>
<span id="cb23-14">)</span>
<span id="cb23-15">df</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 5.36 ms, sys: 25 µs, total: 5.38 ms
Wall time: 5.28 ms</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">projects</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">ext</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">2023-10-01</td>
<td data-quarto-table-cell-role="th">Assembly</td>
<td>14</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">C/C++</td>
<td>484</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Fortran</td>
<td>23</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Go</td>
<td>25</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Rust</td>
<td>99</td>
</tr>
<tr class="even">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">2023-11-01</td>
<td data-quarto-table-cell-role="th">Assembly</td>
<td>10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">C/C++</td>
<td>836</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Fortran</td>
<td>48</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Go</td>
<td>33</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Rust</td>
<td>190</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Remember, all of the previous code is executing on <strong>a single file</strong> and still takes minutes to run.</p>
<section id="conclusion" class="level4">
<h4 class="anchored" data-anchor-id="conclusion">Conclusion</h4>
<p>If I only have pandas at my disposal, I’m unsure of how I can avoid getting a bigger computer to run this query over the entire data set.</p>
</section>
<section id="rewriting-the-query-to-be-fair" class="level3">
<h3 class="anchored" data-anchor-id="rewriting-the-query-to-be-fair">Rewriting the query to be fair</h3>
<p>At this point I wondered whether this was a fair query to run with pandas.</p>
<p>After all, the downsides of pandas’ use of object arrays to hold nested data structures like lists are well-known.</p>
<p>The original query uses a lot of nested array types, which are very performant in DuckDB, but in this case <strong>we’re throwing away all of our arrays</strong> and we don’t need to use them.</p>
<p>Additionally, I’m using lambda functions instead of taking advantage of pandas’ fast built-in methods like <code>count</code>, <code>nunique</code> and others.</p>
<p>Let’s see if we can alter the original query to give pandas a leg up.</p>
<section id="a-story-of-two-group-bys" class="level4">
<h4 class="anchored" data-anchor-id="a-story-of-two-group-bys">A story of two <code>GROUP BY</code>s</h4>
<p>Here’s the first Ibis expression:</p>
<div class="sourceCode" id="annotated-cell-17" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy"><code class="sourceCode python"><span id="annotated-cell-17-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> __future__ <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> annotations</span>
<span id="annotated-cell-17-2"></span>
<span id="annotated-cell-17-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis</span>
<span id="annotated-cell-17-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> ibis <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> _, udf</span>
<span id="annotated-cell-17-5"></span>
<span id="annotated-cell-17-6"></span>
<span id="annotated-cell-17-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@udf.scalar.builtin</span></span>
<span id="annotated-cell-17-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> flatten(x: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]:</span>
<span id="annotated-cell-17-9">    ...</span>
<span id="annotated-cell-17-10"></span>
<span id="annotated-cell-17-11"></span>
<span id="annotated-cell-17-12">expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="annotated-cell-17-13">    ibis.read_parquet(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/data/pypi-parquet/*.parquet"</span>)</span>
<span id="annotated-cell-17-14">    .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="annotated-cell-17-15">        [</span>
<span id="annotated-cell-17-16">            _.path.re_search(</span>
<span id="annotated-cell-17-17">                <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"\.(asm|c|cc|cpp|cxx|h|hpp|rs|[Ff][0-9]{0,2}(?:or)?|go)$"</span></span>
<span id="annotated-cell-17-18">            ),</span>
<span id="annotated-cell-17-19">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>_.path.re_search(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"(^|/)test(|s|ing)"</span>),</span>
<span id="annotated-cell-17-20">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>_.path.contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/site-packages/"</span>),</span>
<span id="annotated-cell-17-21">        ]</span>
<span id="annotated-cell-17-22">    )</span>
<span id="annotated-cell-17-23">    .group_by(</span>
<span id="annotated-cell-17-24">        month<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.uploaded_on.truncate(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>),</span>
<span id="annotated-cell-17-25">        ext<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.path.re_extract(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"\.([a-z0-9]+)$"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="annotated-cell-17-26">    )</span>
<span id="annotated-cell-17-27">    .aggregate(projects<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.project_name.collect().unique())</span>
<span id="annotated-cell-17-28">    .order_by(_.month.desc())</span>
<span id="annotated-cell-17-29">    .mutate(</span>
<span id="annotated-cell-17-30">        ext<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.ext.re_replace(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"cxx|cpp|cc|c|hpp|h"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C/C++"</span>)</span>
<span id="annotated-cell-17-31">        .re_replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^f.*$"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fortran"</span>)</span>
<span id="annotated-cell-17-32">        .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rs"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rust"</span>)</span>
<span id="annotated-cell-17-33">        .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"go"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Go"</span>)</span>
<span id="annotated-cell-17-34">        .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"asm"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Assembly"</span>)</span>
<span id="annotated-cell-17-35">        .nullif(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>),</span>
<span id="annotated-cell-17-36">    )</span>
<span id="annotated-cell-17-37">    .group_by([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ext"</span>])</span>
<span id="annotated-cell-17-38">    .aggregate(project_count<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>flatten(_.projects.collect()).unique().length())</span>
<span id="annotated-cell-17-39">    .dropna(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ext"</span>)</span>
<span id="annotated-cell-17-40">    .order_by([_.month.desc(), _.project_count.desc()])</span>
<span id="annotated-cell-17-41">)</span></code></pre></div>
<p>It looks like we can remove the double <code>group_by</code> by moving the second <code>mutate</code> expression directly into the first <code>group_by</code> call.</p>
<p>Applying these changes:</p>
<div class="sourceCode" id="annotated-cell-18" style="background: #f1f3f5;"><pre class="sourceCode diff code-annotation-code code-with-copy"><code class="sourceCode diff"><span id="annotated-cell-18-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">--- step0.py    2023-12-12 05:20:01.712513949 -0500</span></span>
<span id="annotated-cell-18-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">+++ step1.py    2023-12-12 05:20:01.712513949 -0500</span></span>
<span id="annotated-cell-18-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">@@ -5,7 +5,7 @@</span></span>
<span id="annotated-cell-18-4"> </span>
<span id="annotated-cell-18-5"> </span>
<span id="annotated-cell-18-6"> @udf.scalar.builtin</span>
<span id="annotated-cell-18-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-def flatten(x: list[list[str]]) -&gt; list[str]:</span></span>
<span id="annotated-cell-18-8"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">+def flatten(x: list[list[str]]) -&gt; list[str]:</span></span>
<span id="annotated-cell-18-9">     ...</span>
<span id="annotated-cell-18-10"> </span>
<span id="annotated-cell-18-11"> </span>
<span id="annotated-cell-18-12"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">@@ -22,20 +22,16 @@</span></span>
<span id="annotated-cell-18-13">     )</span>
<span id="annotated-cell-18-14">     .group_by(</span>
<span id="annotated-cell-18-15">         month=_.uploaded_on.truncate("M"),</span>
<span id="annotated-cell-18-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-        ext=_.path.re_extract(r"\.([a-z0-9]+)$", 1),</span></span>
<span id="annotated-cell-18-17"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-    )</span></span>
<span id="annotated-cell-18-18"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-    .aggregate(projects=_.project_name.collect().unique())</span></span>
<span id="annotated-cell-18-19"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-    .order_by(_.month.desc())</span></span>
<span id="annotated-cell-18-20"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-    .mutate(</span></span>
<span id="annotated-cell-18-21"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-        ext=_.ext.re_replace(r"cxx|cpp|cc|c|hpp|h", "C/C++")</span></span>
<span id="annotated-cell-18-22"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">+        ext=_.path.re_extract(r"\.([a-z0-9]+)$", 1)</span></span>
<span id="annotated-cell-18-23"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">+        .re_replace(r"cxx|cpp|cc|c|hpp|h", "C/C++")</span></span>
<span id="annotated-cell-18-24">         .re_replace("^f.*$", "Fortran")</span>
<span id="annotated-cell-18-25">         .replace("rs", "Rust")</span>
<span id="annotated-cell-18-26">         .replace("go", "Go")</span>
<span id="annotated-cell-18-27">         .replace("asm", "Assembly")</span>
<span id="annotated-cell-18-28">         .nullif(""),</span>
<span id="annotated-cell-18-29">     )</span>
<span id="annotated-cell-18-30"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">+    .aggregate(projects=_.project_name.collect().unique())</span></span>
<span id="annotated-cell-18-31"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">+    .order_by(_.month.desc())</span></span>
<span id="annotated-cell-18-32">     .group_by(["month", "ext"])</span>
<span id="annotated-cell-18-33">     .aggregate(project_count=flatten(_.projects.collect()).unique().length())</span>
<span id="annotated-cell-18-34"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-    .dropna("ext")</span></span>
<span id="annotated-cell-18-35"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-    .order_by([_.month.desc(), _.project_count.desc()])</span></span>
<span id="annotated-cell-18-36"> )</span></code></pre></div>
<p>We get:</p>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> __future__ <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> annotations</span>
<span id="cb25-2"></span>
<span id="cb25-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis</span>
<span id="cb25-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> ibis <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> _, udf</span>
<span id="cb25-5"></span>
<span id="cb25-6"></span>
<span id="cb25-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@udf.scalar.builtin</span></span>
<span id="cb25-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> flatten(x: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]:</span>
<span id="cb25-9">    ...</span>
<span id="cb25-10"></span>
<span id="cb25-11"></span>
<span id="cb25-12">expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb25-13">    ibis.read_parquet(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/data/pypi-parquet/*.parquet"</span>)</span>
<span id="cb25-14">    .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="cb25-15">        [</span>
<span id="cb25-16">            _.path.re_search(</span>
<span id="cb25-17">                <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"\.(asm|c|cc|cpp|cxx|h|hpp|rs|[Ff][0-9]{0,2}(?:or)?|go)$"</span></span>
<span id="cb25-18">            ),</span>
<span id="cb25-19">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>_.path.re_search(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"(^|/)test(|s|ing)"</span>),</span>
<span id="cb25-20">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>_.path.contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/site-packages/"</span>),</span>
<span id="cb25-21">        ]</span>
<span id="cb25-22">    )</span>
<span id="cb25-23">    .group_by(</span>
<span id="cb25-24">        month<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.uploaded_on.truncate(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>),</span>
<span id="cb25-25">        ext<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.path.re_extract(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"\.([a-z0-9]+)$"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb25-26">        .re_replace(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"cxx|cpp|cc|c|hpp|h"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C/C++"</span>)</span>
<span id="cb25-27">        .re_replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^f.*$"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fortran"</span>)</span>
<span id="cb25-28">        .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rs"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rust"</span>)</span>
<span id="cb25-29">        .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"go"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Go"</span>)</span>
<span id="cb25-30">        .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"asm"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Assembly"</span>)</span>
<span id="cb25-31">        .nullif(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>),</span>
<span id="cb25-32">    )</span>
<span id="cb25-33">    .aggregate(projects<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.project_name.collect().unique())</span>
<span id="cb25-34">    .order_by(_.month.desc())</span>
<span id="cb25-35">    .group_by([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ext"</span>])</span>
<span id="cb25-36">    .aggregate(project_count<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>flatten(_.projects.collect()).unique().length())</span>
<span id="cb25-37">)</span></code></pre></div>
</section>
<section id="dont-sort-unnecessarily" class="level4">
<h4 class="anchored" data-anchor-id="dont-sort-unnecessarily">Don’t sort unnecessarily</h4>
<p>Notice this <code>order_by</code> call just before a <code>group_by</code> call. Ordering before grouping is somewhat useless here; we should probably sort after we’ve reduced our data. Let’s stick the ordering at the end of the query.</p>
<p>Applying these changes:</p>
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode diff code-with-copy"><code class="sourceCode diff"><span id="cb26-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">--- step1.py    2023-12-12 05:20:01.712513949 -0500</span></span>
<span id="cb26-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">+++ step2.py    2023-12-12 05:20:01.712513949 -0500</span></span>
<span id="cb26-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">@@ -31,7 +31,7 @@</span></span>
<span id="cb26-4">         .nullif(""),</span>
<span id="cb26-5">     )</span>
<span id="cb26-6">     .aggregate(projects=_.project_name.collect().unique())</span>
<span id="cb26-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-    .order_by(_.month.desc())</span></span>
<span id="cb26-8">     .group_by(["month", "ext"])</span>
<span id="cb26-9">     .aggregate(project_count=flatten(_.projects.collect()).unique().length())</span>
<span id="cb26-10"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">+    .order_by(_.month.desc())</span></span>
<span id="cb26-11"> )</span></code></pre></div>
<p>We get:</p>
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> __future__ <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> annotations</span>
<span id="cb27-2"></span>
<span id="cb27-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis</span>
<span id="cb27-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> ibis <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> _, udf</span>
<span id="cb27-5"></span>
<span id="cb27-6"></span>
<span id="cb27-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@udf.scalar.builtin</span></span>
<span id="cb27-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> flatten(x: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]:</span>
<span id="cb27-9">    ...</span>
<span id="cb27-10"></span>
<span id="cb27-11"></span>
<span id="cb27-12">expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb27-13">    ibis.read_parquet(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/data/pypi-parquet/*.parquet"</span>)</span>
<span id="cb27-14">    .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="cb27-15">        [</span>
<span id="cb27-16">            _.path.re_search(</span>
<span id="cb27-17">                <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"\.(asm|c|cc|cpp|cxx|h|hpp|rs|[Ff][0-9]{0,2}(?:or)?|go)$"</span></span>
<span id="cb27-18">            ),</span>
<span id="cb27-19">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>_.path.re_search(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"(^|/)test(|s|ing)"</span>),</span>
<span id="cb27-20">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>_.path.contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/site-packages/"</span>),</span>
<span id="cb27-21">        ]</span>
<span id="cb27-22">    )</span>
<span id="cb27-23">    .group_by(</span>
<span id="cb27-24">        month<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.uploaded_on.truncate(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>),</span>
<span id="cb27-25">        ext<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.path.re_extract(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"\.([a-z0-9]+)$"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb27-26">        .re_replace(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"cxx|cpp|cc|c|hpp|h"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C/C++"</span>)</span>
<span id="cb27-27">        .re_replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^f.*$"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fortran"</span>)</span>
<span id="cb27-28">        .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rs"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rust"</span>)</span>
<span id="cb27-29">        .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"go"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Go"</span>)</span>
<span id="cb27-30">        .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"asm"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Assembly"</span>)</span>
<span id="cb27-31">        .nullif(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>),</span>
<span id="cb27-32">    )</span>
<span id="cb27-33">    .aggregate(projects<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.project_name.collect().unique())</span>
<span id="cb27-34">    .group_by([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ext"</span>])</span>
<span id="cb27-35">    .aggregate(project_count<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>flatten(_.projects.collect()).unique().length())</span>
<span id="cb27-36">    .order_by(_.month.desc())</span>
<span id="cb27-37">)</span></code></pre></div>
</section>
<section id="dont-repeat-yourself" class="level4">
<h4 class="anchored" data-anchor-id="dont-repeat-yourself">Don’t repeat yourself</h4>
<p>Notice that we are now:</p>
<ul>
<li>grouping</li>
<li>aggregating</li>
<li>grouping again by the <strong>same keys</strong></li>
<li>aggregating</li>
</ul>
<p>This is less optimal than it could be. We are also flattening an array, computing its distinct values and then computing its length.</p>
<p>We are computing the grouped number of distinct values, and we likely don’t need to collect values into an array to do that.</p>
<p>Let’s try using a <code>COUNT(DISTINCT ...)</code> query instead, to avoid wasting cycles collecting arrays.</p>
<p>We’ll remove the second group by and then call <code>nunique()</code> to get the final query.</p>
<p>Applying these changes:</p>
<div class="sourceCode" id="annotated-cell-22" style="background: #f1f3f5;"><pre class="sourceCode diff code-annotation-code code-with-copy"><code class="sourceCode diff"><span id="annotated-cell-22-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">--- step2.py    2023-12-12 05:20:01.712513949 -0500</span></span>
<span id="annotated-cell-22-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">+++ step3.py    2023-12-12 05:20:01.712513949 -0500</span></span>
<span id="annotated-cell-22-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">@@ -1,13 +1,7 @@</span></span>
<span id="annotated-cell-22-4"> from __future__ import annotations</span>
<span id="annotated-cell-22-5"> </span>
<span id="annotated-cell-22-6"> import ibis</span>
<span id="annotated-cell-22-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-from ibis import _, udf</span></span>
<span id="annotated-cell-22-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-</span></span>
<span id="annotated-cell-22-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-</span></span>
<span id="annotated-cell-22-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-@udf.scalar.builtin</span></span>
<span id="annotated-cell-22-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-def flatten(x: list[list[str]]) -&gt; list[str]:</span></span>
<span id="annotated-cell-22-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-    ...</span></span>
<span id="annotated-cell-22-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-</span></span>
<span id="annotated-cell-22-14"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">+from ibis import _</span></span>
<span id="annotated-cell-22-15"> </span>
<span id="annotated-cell-22-16"> expr = (</span>
<span id="annotated-cell-22-17">     ibis.read_parquet("/data/pypi-parquet/*.parquet")</span>
<span id="annotated-cell-22-18"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">@@ -30,8 +24,7 @@</span></span>
<span id="annotated-cell-22-19">         .replace("asm", "Assembly")</span>
<span id="annotated-cell-22-20">         .nullif(""),</span>
<span id="annotated-cell-22-21">     )</span>
<span id="annotated-cell-22-22"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-    .aggregate(projects=_.project_name.collect().unique())</span></span>
<span id="annotated-cell-22-23"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-    .group_by(["month", "ext"])</span></span>
<span id="annotated-cell-22-24"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-    .aggregate(project_count=flatten(_.projects.collect()).unique().length())</span></span>
<span id="annotated-cell-22-25"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-    .order_by(_.month.desc())</span></span>
<span id="annotated-cell-22-26"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">+    .aggregate(project_count=_.project_name.nunique())</span></span>
<span id="annotated-cell-22-27"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">+    .dropna("ext")</span></span>
<span id="annotated-cell-22-28"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">+    .order_by([_.month.desc(), _.project_count.desc()])</span></span>
<span id="annotated-cell-22-29"> )</span></code></pre></div>
<p>We get:</p>
<div class="sourceCode" id="annotated-cell-23" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-23-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> __future__ <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> annotations</span>
<span id="annotated-cell-23-2"></span>
<span id="annotated-cell-23-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis</span>
<span id="annotated-cell-23-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> ibis <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> _</span>
<span id="annotated-cell-23-5"></span>
<span id="annotated-cell-23-6">expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="annotated-cell-23-7">    ibis.read_parquet(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/data/pypi-parquet/*.parquet"</span>)</span>
<span id="annotated-cell-23-8">    .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="annotated-cell-23-9">        [</span>
<span id="annotated-cell-23-10">            _.path.re_search(</span>
<span id="annotated-cell-23-11">                <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"\.(asm|c|cc|cpp|cxx|h|hpp|rs|[Ff][0-9]{0,2}(?:or)?|go)$"</span></span>
<span id="annotated-cell-23-12">            ),</span>
<span id="annotated-cell-23-13">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>_.path.re_search(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"(^|/)test(|s|ing)"</span>),</span>
<span id="annotated-cell-23-14">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>_.path.contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/site-packages/"</span>),</span>
<span id="annotated-cell-23-15">        ]</span>
<span id="annotated-cell-23-16">    )</span>
<span id="annotated-cell-23-17">    .group_by(</span>
<span id="annotated-cell-23-18">        month<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.uploaded_on.truncate(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>),</span>
<span id="annotated-cell-23-19">        ext<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.path.re_extract(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"\.([a-z0-9]+)$"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="annotated-cell-23-20">        .re_replace(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"cxx|cpp|cc|c|hpp|h"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C/C++"</span>)</span>
<span id="annotated-cell-23-21">        .re_replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^f.*$"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fortran"</span>)</span>
<span id="annotated-cell-23-22">        .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rs"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rust"</span>)</span>
<span id="annotated-cell-23-23">        .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"go"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Go"</span>)</span>
<span id="annotated-cell-23-24">        .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"asm"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Assembly"</span>)</span>
<span id="annotated-cell-23-25">        .nullif(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>),</span>
<span id="annotated-cell-23-26">    )</span>
<span id="annotated-cell-23-27">    .aggregate(project_count<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.project_name.nunique())</span>
<span id="annotated-cell-23-28">    .dropna(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ext"</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-23" data-target-annotation="1">1</button><span id="annotated-cell-23-29" class="code-annotation-target">    .order_by([_.month.desc(), _.project_count.desc()])</span>
<span id="annotated-cell-23-30">)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-23" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-23" data-code-lines="29" data-code-annotation="1">I added a second sort key (<code>project_count</code>) for deterministic output.</span>
</dd>
</dl>
<p>Let’s run it to make sure the results are as expected:</p>
<div id="04c5b749" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1">duckdb_results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>timeit <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>n1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>o expr.to_pandas()</span></code></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"0ef50d9d4fa642b696882705605abfec","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>29.9 s ± 0 ns per loop (mean ± std. dev. of 1 run, 1 loop each)</code></pre>
</div>
</div>
<p>It looks like the new query might be a bit slower even though we’re ostensibly doing less computation. Since we’re still pretty close to the original duration, let’s keep going.</p>
</section>
</section>
<section id="final-pandas-run-with-the-new-query" class="level3">
<h3 class="anchored" data-anchor-id="final-pandas-run-with-the-new-query">Final pandas run with the new query</h3>
<p>Rewriting the pandas code we get:</p>
<div class="sourceCode" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> __future__ <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> annotations</span>
<span id="cb30-2"></span>
<span id="cb30-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> glob</span>
<span id="cb30-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb30-5"></span>
<span id="cb30-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb30-7"></span>
<span id="cb30-8">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_parquet(</span>
<span id="cb30-9">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>(glob.glob(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/data/pypi-parquet/*.parquet"</span>), key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.path.getsize),</span>
<span id="cb30-10">    columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"path"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uploaded_on"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"project_name"</span>],</span>
<span id="cb30-11">)</span>
<span id="cb30-12">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[</span>
<span id="cb30-13">    df.path.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.contains(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"\.(?:asm|c|cc|cpp|cxx|h|hpp|rs|[Ff][0-9]{0,2}(?:or)?|go)$"</span>)</span>
<span id="cb30-14">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>df.path.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.contains(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"(?:(?:^|/)test(?:|s|ing)|/site-packages/)"</span>)</span>
<span id="cb30-15">]</span>
<span id="cb30-16"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(</span>
<span id="cb30-17">    df.assign(</span>
<span id="cb30-18">        month<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df.uploaded_on.dt.to_period(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>).dt.to_timestamp(),</span>
<span id="cb30-19">        ext<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df.path.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.extract(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"\.([a-z0-9]+)$"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb30-20">        .iloc[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb30-21">        .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.replace(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"cxx|cpp|cc|c|hpp|h"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C/C++"</span>, regex<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb30-22">        .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^f.*$"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fortran"</span>, regex<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb30-23">        .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rs"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rust"</span>)</span>
<span id="cb30-24">        .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"go"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Go"</span>)</span>
<span id="cb30-25">        .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"asm"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Assembly"</span>),</span>
<span id="cb30-26">    )</span>
<span id="cb30-27">    .groupby([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ext"</span>])</span>
<span id="cb30-28">    .project_name.nunique()</span>
<span id="cb30-29">    .rename(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"project_count"</span>)</span>
<span id="cb30-30">    .reset_index()</span>
<span id="cb30-31">    .sort_values([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"project_count"</span>], ascending<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb30-32">)</span></code></pre></div>
<p>Running it we get:</p>
<div id="f2013996" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1">pandas_results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>timeit <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>n1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>o <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>run pandas_impl.py</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       month       ext  project_count
6 2023-11-01     C/C++            836
9 2023-11-01      Rust            190
7 2023-11-01   Fortran             48
8 2023-11-01        Go             33
5 2023-11-01  Assembly             10
1 2023-10-01     C/C++            484
4 2023-10-01      Rust             99
3 2023-10-01        Go             25
2 2023-10-01   Fortran             23
0 2023-10-01  Assembly             14
2min 58s ± 0 ns per loop (mean ± std. dev. of 1 run, 1 loop each)</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Remember, this is the time it took pandas to run the query for a <strong>single</strong> file.
</div>
</div>
<div class="callout-body-container callout-body">
<p>DuckDB runs the query over the <strong>entire</strong> dataset about 4x faster than that!</p>
</div>
</div>
<p>Let’s try a tool that nominally scales to our problem: <a href="https://dask.org">Dask</a>.</p>
</section>
</section>
<section id="dask" class="level2">
<h2 class="anchored" data-anchor-id="dask">Dask</h2>
<p>One really nice component of Dask is <a href="https://docs.dask.org/en/stable/dataframe.html"><code>dask.dataframe</code></a>.</p>
<p>Dask DataFrame implements a <a href="https://docs.dask.org/en/stable/dataframe.html#scope">good chunk of the pandas API</a> and can be a drop-in replacement for pandas.</p>
<p>I am happy that this turned out to be the case here.</p>
<p>My first attempt was somewhat naive and was effectively a one line change from <code>import pandas as pd</code> to <code>import dask.dataframe as pd</code>.</p>
<p>This worked and the workload completed. However, after talking to Dask expert and Ibis contributor <a href="https://github.com/ncclementi">Naty Clementi</a> she suggested I try a few things:</p>
<ul>
<li>Use <a href="https://distributed.dask.org/en/stable/">the distributed scheduler</a>.</li>
<li>Ensure that <a href="https://docs.dask.org/en/latest/configuration.html#dask"><code>pyarrow</code> string arrays are used</a> instead of NumPy object arrays. This required <strong>no changes</strong> to my Dask code because PyArrow strings have been the default since version 2023.7.1, hooray!</li>
<li>Explore some of the options to <code>read_parquet</code>. It turned that without setting <code>split_row_groups=True</code> I ran out of memory.</li>
</ul>
<p>Let’s look at the Dask implementation:</p>
<div class="sourceCode" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> __future__ <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> annotations</span>
<span id="cb33-2"></span>
<span id="cb33-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> logging</span>
<span id="cb33-4"></span>
<span id="cb33-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> dask.dataframe <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> dd</span>
<span id="cb33-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dask.distributed <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Client</span>
<span id="cb33-7"></span>
<span id="cb33-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">__name__</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"__main__"</span>:</span>
<span id="cb33-9">    client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Client(silence_logs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>logging.ERROR)</span>
<span id="cb33-10">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dd.read_parquet(</span>
<span id="cb33-11">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/data/pypi-parquet/*.parquet"</span>,</span>
<span id="cb33-12">        columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"path"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uploaded_on"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"project_name"</span>],</span>
<span id="cb33-13">        split_row_groups<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb33-14">    )</span>
<span id="cb33-15">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[</span>
<span id="cb33-16">        df.path.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.contains(</span>
<span id="cb33-17">            <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"\.(?:asm|c|cc|cpp|cxx|h|hpp|rs|[Ff][0-9]{0,2}(?:or)?|go)$"</span></span>
<span id="cb33-18">        )</span>
<span id="cb33-19">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>df.path.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.contains(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"(?:^|/)test(?:|s|ing)"</span>)</span>
<span id="cb33-20">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>df.path.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/site-packages/"</span>)</span>
<span id="cb33-21">    ]</span>
<span id="cb33-22">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(</span>
<span id="cb33-23">        df.assign(</span>
<span id="cb33-24">            month<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df.uploaded_on.dt.to_period(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>).dt.to_timestamp(),</span>
<span id="cb33-25">            ext<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df.path.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.extract(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"\.([a-z0-9]+)$"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, expand<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb33-26">            .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.replace(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"cxx|cpp|cc|c|hpp|h"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C/C++"</span>, regex<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb33-27">            .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^f.*$"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fortran"</span>, regex<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb33-28">            .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rs"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rust"</span>)</span>
<span id="cb33-29">            .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"go"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Go"</span>)</span>
<span id="cb33-30">            .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"asm"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Assembly"</span>),</span>
<span id="cb33-31">        )</span>
<span id="cb33-32">        .groupby([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ext"</span>])</span>
<span id="cb33-33">        .project_name.nunique()</span>
<span id="cb33-34">        .rename(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"project_count"</span>)</span>
<span id="cb33-35">        .compute()</span>
<span id="cb33-36">        .reset_index()</span>
<span id="cb33-37">        .sort_values([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"project_count"</span>], ascending<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb33-38">    )</span>
<span id="cb33-39">    client.shutdown()</span></code></pre></div>
<p>Let’s run the code:</p>
<div id="f5e7a22f" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1">dask_results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>timeit <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>n1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>o <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>run dask_impl.py</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         month       ext  project_count
794 2023-11-01     C/C++            836
796 2023-11-01      Rust            190
797 2023-11-01   Fortran             48
795 2023-11-01        Go             33
798 2023-11-01  Assembly             10
..         ...       ...            ...
2   2005-08-01     C/C++              7
1   2005-07-01     C/C++              4
83  2005-05-01     C/C++              1
82  2005-04-01     C/C++              1
0   2005-03-01     C/C++              1

[799 rows x 3 columns]
52.5 s ± 0 ns per loop (mean ± std. dev. of 1 run, 1 loop each)</code></pre>
</div>
</div>
<p>That’s a great improvement over pandas: we finished the workload and our running time is pretty close to DuckDB.</p>
</section>
<section id="takeaways" class="level2">
<h2 class="anchored" data-anchor-id="takeaways">Takeaways</h2>
<p><strong>Ibis + DuckDB is the only system tested that handles this workload well out of the box</strong></p>
<ul>
<li>Pandas couldn’t handle the workload due to memory constraints.</li>
<li>Dask required its <a href="https://docs.dask.org/en/stable/deploying.html#deploy-dask-clusters">recommended distributed scheduler</a> to achieve maximum performance and still used a lot of memory.</li>
</ul>
<p>Let’s recap the results with some numbers:</p>
<section id="numbers" class="level3">
<h3 class="anchored" data-anchor-id="numbers">Numbers</h3>
<table class="table">
<thead>
<tr class="header">
<th>Toolset</th>
<th style="text-align: right;">Data size</th>
<th style="text-align: right;">Duration</th>
<th style="text-align: right;">Throughput</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Ibis + DuckDB</td>
<td style="text-align: right;">25,825 MiB</td>
<td style="text-align: right;">30 seconds</td>
<td style="text-align: right;">863 MiB/s</td>
</tr>
<tr class="even">
<td>Dask + Distributed</td>
<td style="text-align: right;">25,825 MiB</td>
<td style="text-align: right;">53 seconds</td>
<td style="text-align: right;">492 MiB/s</td>
</tr>
</tbody>
</table>
<p>With Ibis + DuckDB, I was able to write the query the way I wanted to without running out of memory, using the default configuration provided by Ibis.</p>
<p>I was able run this computation around <strong>193x faster</strong> than you can expect with pandas using this hardware setup.</p>
<p>In contrast, pandas ran out of memory <strong>on a single file</strong> without some hand holding and while Dask didn’t cause my program to run out of memory it still used quite a bit more than DuckDB.</p>
</section>
<section id="pandas-is-untenable-for-this-workload" class="level3">
<h3 class="anchored" data-anchor-id="pandas-is-untenable-for-this-workload">Pandas is untenable for this workload</h3>
<p>Pandas requires me to load everything into memory, and my machine doesn’t have enough memory to do that.</p>
<p>Given that Ibis + DuckDB runs this workload on my machine it doesn’t seem worth the effort to write any additional code to make pandas scale to the whole dataset.</p>
</section>
<section id="dask-finishes-in-a-similar-amount-of-time-as-ibis-duckdb-within-2x" class="level3">
<h3 class="anchored" data-anchor-id="dask-finishes-in-a-similar-amount-of-time-as-ibis-duckdb-within-2x">Dask finishes in a similar amount of time as Ibis + DuckDB (within 2x)</h3>
<p>Out of the box I had quite a bit of difficulty figuring out how to maximize performance and not run out of memory.</p>
<p>Please get in touch if you think my Dask code can be improved!</p>
<p>I know the Dask community is hard at work building <a href="https://github.com/dask-contrib/dask-expr"><code>dask-expr</code></a> which might improve the performance of this workload when it lands.</p>
</section>
</section>
<section id="next-steps" class="level2">
<h2 class="anchored" data-anchor-id="next-steps">Next steps</h2>
<section id="please-get-in-touch" class="level3">
<h3 class="anchored" data-anchor-id="please-get-in-touch">Please get in touch!</h3>
<p>If you have ideas about how to speed up my use of the tools I’ve discussed here please get in touch by opening a <a href="https://github.com/ibis-project/ibis/discussions">GitHub discussion</a>!</p>
<p>We would love it if more backends handled this workload!</p>
</section>
<section id="look-out-for-part-2" class="level3">
<h3 class="anchored" data-anchor-id="look-out-for-part-2">Look out for part 2</h3>
<p>In part 2 of this series we’ll explore how Polars and DataFusion perform on this query. Stay tuned!</p>


</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>blog</category>
  <category>case study</category>
  <category>ecosystem</category>
  <category>performance</category>
  <guid>https://ibis-project.org/posts/pydata-performance/</guid>
  <pubDate>Wed, 06 Dec 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>dbt-ibis: Write your dbt models using Ibis</title>
  <dc:creator>Stefan Binder</dc:creator>
  <link>https://ibis-project.org/posts/dbt-ibis/</link>
  <description><![CDATA[ 





<section id="introduction-to-dbt" class="level1">
<h1>Introduction to dbt</h1>
<p><a href="https://github.com/dbt-labs/dbt-core">dbt</a> has revolutionized how transformations are orchestrated and managed within modern data warehouses. Initially released in 2016, dbt quickly gained traction within the data analytics community due to its focus on bringing software engineering best practices to analytics code like modularity, portability, CI/CD, and documentation.</p>
<p>At the heart of dbt are so called “models” which are just simple SQL SELECT statements (see further below for an example). dbt removes the need to write any DDL/DML, allowing users to focus on writing SELECT statements. Depending on how you configure it, the queries are materialized as tables, views, or custom materializations. dbt also infers dependencies between models and runs them in order. The following is a dbt model which selects from two other models called <code>stg_orders</code> and <code>stg_customers</code>:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb1-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">WITH</span> customer_orders <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">as</span> (</span>
<span id="cb1-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span></span>
<span id="cb1-3">        customer_id <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> customer_id,</span>
<span id="cb1-4">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">MIN</span>(order_date) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> first_order,</span>
<span id="cb1-5">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">MAX</span>(order_date) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> most_recent_order,</span>
<span id="cb1-6">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">COUNT</span>(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> number_of_orders</span>
<span id="cb1-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> {{ <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ref</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'stg_orders'</span>) }} <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> orders</span>
<span id="cb1-8">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">GROUP</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">BY</span></span>
<span id="cb1-9">        customer_id</span>
<span id="cb1-10">), customer_orders_info <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">as</span> (</span>
<span id="cb1-11">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span></span>
<span id="cb1-12">        customers.customer_id <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> customer_id,</span>
<span id="cb1-13">        customers.first_name <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> first_name,</span>
<span id="cb1-14">        customers.last_name <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> last_name,</span>
<span id="cb1-15">        customer_orders.customer_id <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> customer_id_right,</span>
<span id="cb1-16">        customer_orders.first_order <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> first_order,</span>
<span id="cb1-17">        customer_orders.most_recent_order <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> most_recent_order,</span>
<span id="cb1-18">        customer_orders.number_of_orders <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> number_of_orders</span>
<span id="cb1-19">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> {{ <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ref</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'stg_customers'</span>) }} <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> customers</span>
<span id="cb1-20">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">LEFT</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">OUTER</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">JOIN</span> customer_orders</span>
<span id="cb1-21">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">ON</span> customers.customer_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> customer_orders.customer_id</span>
<span id="cb1-22">)</span>
<span id="cb1-23"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span></span>
<span id="cb1-24">    customer_id,</span>
<span id="cb1-25">    first_name,</span>
<span id="cb1-26">    last_name,</span>
<span id="cb1-27">    first_order,</span>
<span id="cb1-28">    most_recent_order,</span>
<span id="cb1-29">    number_of_orders</span>
<span id="cb1-30"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> customer_orders_info</span></code></pre></div>
<p>dbt will make sure that the resulting table will be created after <code>stg_orders</code> and <code>stg_customers</code>. This model is inspired by the <a href="https://github.com/dbt-labs/jaffle_shop">jaffle shop demo project by dbt Labs</a> where you can find more example queries.</p>
<p>At the end of 2022, dbt added support for <a href="https://docs.getdbt.com/docs/build/python-models">Python models</a> on specific platforms (Snowflake, Databricks, Google Cloud Platform). This can be useful for complex transformations such as using a machine learning model and storing the results. However, it also requires that your Python code is run in a cloud data warehouse and often, that data is moved into a Python process which can be slower than leveraging the power of modern SQL engines.</p>
</section>
<section id="why-dbt-and-ibis-go-great-together" class="level1">
<h1>Why dbt and Ibis go great together</h1>
<p><a href="https://github.com/binste/dbt-ibis">dbt-ibis</a> offers a lightweight and compatible alternative, which allows you to write dbt models using Ibis. dbt-ibis transparently converts your Ibis statements into SQL and then hands it over to dbt. Your database does not need to have Python support for this as everything is executed in the same process as dbt. Hence, this allows for working in Python for all dbt adapters with supported Ibis backends. Rewriting the above SQL model in Ibis we get:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dbt_ibis <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> depends_on, ref</span>
<span id="cb2-2"></span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@depends_on</span>(ref(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stg_customers"</span>), ref(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stg_orders"</span>))</span>
<span id="cb2-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> model(customers, orders):</span>
<span id="cb2-6">    customer_orders <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> orders.group_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"customer_id"</span>).aggregate(</span>
<span id="cb2-7">        first_order<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>orders[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"order_date"</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>(),</span>
<span id="cb2-8">        most_recent_order<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>orders[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"order_date"</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(),</span>
<span id="cb2-9">        number_of_orders<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>orders.count(),</span>
<span id="cb2-10">    )</span>
<span id="cb2-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add first_name and last_name</span></span>
<span id="cb2-12">    customer_orders <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> customers.join(customer_orders, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"customer_id"</span>, how<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>)</span>
<span id="cb2-13">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> customer_orders.select(</span>
<span id="cb2-14">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"customer_id"</span>,</span>
<span id="cb2-15">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"first_name"</span>,</span>
<span id="cb2-16">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"last_name"</span>,</span>
<span id="cb2-17">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"first_order"</span>,</span>
<span id="cb2-18">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"most_recent_order"</span>,</span>
<span id="cb2-19">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"number_of_orders"</span>,</span>
<span id="cb2-20">        )</span></code></pre></div>
<p>Using Ibis instead of SQL for dbt models brings you many advantages:</p>
<ul>
<li>Type checks and validation before your code is executed in a database.</li>
<li>More composable as you can break down complex queries into smaller pieces.</li>
<li>Better reusability of code. Although dbt allows you to use <a href="https://docs.getdbt.com/docs/build/jinja-macros">Jinja and macros</a>, which is an improvement over plain SQL, this gets you only so far. String manipulation is inherently fragile. With dbt-ibis, you can easily share common code between models.</li>
<li>Your dbt models become backend agnostic which reduces lock-in to a specific database. Furthermore, you get the possibility of building a <a href="https://juhache.substack.com/p/n-engines-1-language?publication_id=1211981&amp;post_id=137718100">multi-engine data stack</a>. For example, you could use DuckDB for small to medium workloads and Snowflake for heavy workloads and as an end-user and BI layer leveraging its governance features. Depending on the size of your warehouse, this can result in significant cost savings.</li>
<li>Unit test your code with your favorite Python testing frameworks such as pytest.</li>
</ul>
<p>In addition, you can stick to the tool (Ibis) you like, no matter if you’re writing an ingestion pipeline, a dbt model to transform the data in your data warehouse, or conduct an ad-hoc analysis in a Jupyter notebook.</p>
<p>Be aware that a current limitation of dbt-ibis is that you cannot connect to the database from within your dbt models, i.e.&nbsp;you purely use Ibis to construct a SELECT statement. You cannot execute statements and act based on the results.</p>
</section>
<section id="further-readings" class="level1">
<h1>Further readings</h1>
<p>If you want to give dbt-ibis a try, head over to the <a href="https://github.com/binste/dbt-ibis/blob/main/README.md">GitHub repo</a> for more information on how to get up and running in no time!</p>
<p>For more details on the future of the integration of Ibis within dbt, you can check out <a href="https://github.com/dbt-labs/dbt-core/pull/5274#issuecomment-1132772028">this PR</a> and <a href="https://github.com/dbt-labs/dbt-core/issues/6184">this GitHub issue</a> on adding an official plugin system to dbt which could be used to provide first-class support for modeling languages in general and which might allow dbt-ibis to provide an even better user experience and more features. See also this <a href="https://github.com/dbt-labs/dbt-core/discussions/5738">discussion on Ibis as a dataframe API in the dbt GitHub repo</a>.</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>blog</category>
  <category>dbt</category>
  <category>data engineering</category>
  <guid>https://ibis-project.org/posts/dbt-ibis/</guid>
  <pubDate>Fri, 24 Nov 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Querying every file in every release on the Python Package Index (redux)</title>
  <dc:creator>Gil Forsyth</dc:creator>
  <link>https://ibis-project.org/posts/querying-pypi-metadata-compiled-languages/</link>
  <description><![CDATA[ 





<p>Seth Larson wrote a great <a href="https://sethmlarson.dev/security-developer-in-residence-weekly-report-18">blog post</a> on querying a PyPI dataset to look for trends in the use of memory-safe languages in Python.</p>
<p>Check out Seth’s article for more information on the dataset (and it’s a good read!). It caught our eye because it makes use of <a href="https://duckdb.org/">DuckDB</a> to clean the data for analysis.</p>
<p>That’s right up our alley here in Ibis land, so let’s see if we can duplicate Seth’s results (and then continue on to plot them!)</p>
<section id="grab-the-data-locations" class="level2">
<h2 class="anchored" data-anchor-id="grab-the-data-locations">Grab the data (locations)</h2>
<p>Seth showed (and then safely decomposed) a nested <code>curl</code> statement and that’s always viable – we’re in Python land so why not grab the filenames using <code>urllib3</code>?</p>
<div id="81f38c7a" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> urllib3</span>
<span id="cb1-2"></span>
<span id="cb1-3">url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://raw.githubusercontent.com/pypi-data/data/main/links/dataset.txt"</span></span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> urllib3.PoolManager() <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> http:</span>
<span id="cb1-6">    resp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> http.request(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GET"</span>, url)</span>
<span id="cb1-7"></span>
<span id="cb1-8">parquet_files <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> resp.data.decode().split()</span>
<span id="cb1-9">parquet_files</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>['https://github.com/pypi-data/data/releases/download/2023-11-27-03-06/index-0.parquet',
 'https://github.com/pypi-data/data/releases/download/2023-11-27-03-06/index-1.parquet',
 'https://github.com/pypi-data/data/releases/download/2023-11-27-03-06/index-10.parquet',
 'https://github.com/pypi-data/data/releases/download/2023-11-27-03-06/index-11.parquet',
 'https://github.com/pypi-data/data/releases/download/2023-11-27-03-06/index-12.parquet',
 'https://github.com/pypi-data/data/releases/download/2023-11-27-03-06/index-13.parquet',
 'https://github.com/pypi-data/data/releases/download/2023-11-27-03-06/index-14.parquet',
 'https://github.com/pypi-data/data/releases/download/2023-11-27-03-06/index-2.parquet',
 'https://github.com/pypi-data/data/releases/download/2023-11-27-03-06/index-3.parquet',
 'https://github.com/pypi-data/data/releases/download/2023-11-27-03-06/index-4.parquet',
 'https://github.com/pypi-data/data/releases/download/2023-11-27-03-06/index-5.parquet',
 'https://github.com/pypi-data/data/releases/download/2023-11-27-03-06/index-6.parquet',
 'https://github.com/pypi-data/data/releases/download/2023-11-27-03-06/index-7.parquet',
 'https://github.com/pypi-data/data/releases/download/2023-11-27-03-06/index-8.parquet',
 'https://github.com/pypi-data/data/releases/download/2023-11-27-03-06/index-9.parquet']</code></pre>
</div>
</div>
</section>
<section id="grab-the-data" class="level2">
<h2 class="anchored" data-anchor-id="grab-the-data">Grab the data</h2>
<p>Now we’re ready to get started with Ibis!</p>
<p>DuckDB is clever enough to grab only the parquet metadata. This means we can use <code>read_parquet</code> to create a lazy view of the parquet files and then build up our expression without downloading everything beforehand!</p>
<div id="f593faf1" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="annotated-cell-2" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-2-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="1">1</button><span id="annotated-cell-2-2" class="code-annotation-target"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> ibis <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> _</span>
<span id="annotated-cell-2-3"></span>
<span id="annotated-cell-2-4">ibis.options.interactive <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-2" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="2" data-code-annotation="1">See https://ibis-project.org/how-to/analytics/chain_expressions.html for docs on the deferred operator!</span>
</dd>
</dl>
</div>
</div>
<p>Create a DuckDB connection:</p>
<div id="2c0c0fab" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">con <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.duckdb.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>()</span></code></pre></div>
</div>
<p>And load up one of the files (we can run the full query after)!</p>
<div id="1237bd7c" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">pypi <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> con.read_parquet(parquet_files[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], table_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pypi"</span>)</span></code></pre></div>
</div>
<div id="1f81de21" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">pypi.schema()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>ibis.Schema {
  project_name     string
  project_version  string
  project_release  string
  uploaded_on      timestamp
  path             string
  archive_path     string
  size             uint64
  hash             binary
  skip_reason      string
  lines            uint64
  repository       uint32
}</code></pre>
</div>
</div>
</section>
<section id="query-crafting" class="level2">
<h2 class="anchored" data-anchor-id="query-crafting">Query crafting</h2>
<p>Let’s break down what we’re looking for. As a high-level view of the use of compiled languages, Seth is using file extensions as an indicator that a given filetype is used in a Python project.</p>
<p>The dataset we’re using has <em>every file in every project</em> – what criteria should we use?</p>
<p>We can follow Seth’s lead and look for things:</p>
<ol type="1">
<li>A file extension that is one of: <code>asm</code>, <code>cc</code>, <code>cpp</code>, <code>cxx</code>, <code>h</code>, <code>hpp</code>, <code>rs</code>, <code>go</code>, and variants of <code>F90</code>, <code>f90</code>, etc… That is, C, C++, Assembly, Rust, Go, and Fortran.</li>
<li>We exclude matches where the file path is within the <code>site-packages/</code> directory.</li>
<li>We exclude matches that are in directories used for testing.</li>
</ol>
<div id="7e8640fd" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pypi.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="cb7-2">    [</span>
<span id="cb7-3">        _.path.re_search(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"\.(asm|c|cc|cpp|cxx|h|hpp|rs|[Ff][0-9]{0,2}(?:or)?|go)$"</span>),</span>
<span id="cb7-4">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>_.path.re_search(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"(^|/)test(|s|ing)"</span>),</span>
<span id="cb7-5">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>_.path.contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/site-packages/"</span>),</span>
<span id="cb7-6">    ]</span>
<span id="cb7-7">)</span>
<span id="cb7-8">expr</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> project_name    </span>┃<span style="font-weight: bold"> project_version </span>┃<span style="font-weight: bold"> project_release              </span>┃<span style="font-weight: bold"> uploaded_on             </span>┃<span style="font-weight: bold"> path                                                                             </span>┃<span style="font-weight: bold"> archive_path                                                                     </span>┃<span style="font-weight: bold"> size   </span>┃<span style="font-weight: bold"> hash                                                                 </span>┃<span style="font-weight: bold"> skip_reason </span>┃<span style="font-weight: bold"> lines  </span>┃<span style="font-weight: bold"> repository </span>┃
┡━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">timestamp</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                                                           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                                                           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">uint64</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">binary</span>                                                               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">uint64</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">uint32</span>     │
├─────────────────┼─────────────────┼──────────────────────────────┼─────────────────────────┼──────────────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────────────┼────────┼──────────────────────────────────────────────────────────────────────┼─────────────┼────────┼────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">zopyx.txng3.ext</span> │ <span style="color: #008000; text-decoration-color: #008000">3.3.2          </span> │ <span style="color: #008000; text-decoration-color: #008000">zopyx.txng3.ext-3.3.2.tar.gz</span> │ <span style="color: #800080; text-decoration-color: #800080">2010-03-06 16:09:43.735</span> │ <span style="color: #008000; text-decoration-color: #008000">packages/zopyx.txng3.ext/zopyx.txng3.ext-3.3.2.tar.gz/zopyx.txng3.ext-3.3.2/zop…</span> │ <span style="color: #008000; text-decoration-color: #008000">zopyx.txng3.ext-3.3.2/zopyx/txng3/ext/support.c                                 </span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1607</span> │ <span style="color: #008000; text-decoration-color: #008000">b'\xca\x0c\xf2\\R\x83\xefS\x0c\xe4\x0c\x15`\x1fM\x16"\x93\x88\x08'</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">~</span>           │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">66</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │
│ <span style="color: #008000; text-decoration-color: #008000">zopyx.txng3.ext</span> │ <span style="color: #008000; text-decoration-color: #008000">3.3.2          </span> │ <span style="color: #008000; text-decoration-color: #008000">zopyx.txng3.ext-3.3.2.tar.gz</span> │ <span style="color: #800080; text-decoration-color: #800080">2010-03-06 16:09:43.735</span> │ <span style="color: #008000; text-decoration-color: #008000">packages/zopyx.txng3.ext/zopyx.txng3.ext-3.3.2.tar.gz/zopyx.txng3.ext-3.3.2/zop…</span> │ <span style="color: #008000; text-decoration-color: #008000">zopyx.txng3.ext-3.3.2/zopyx/txng3/ext/stemmer_src/stemmer.c                     </span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5054</span> │ <span style="color: #008000; text-decoration-color: #008000">b'y\xc3A\x12\x17\xd4\xeb\xbb\xcfan\xfd\x80\xbac\x18\xcf\xc0W\x9a'</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">~</span>           │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">230</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │
│ <span style="color: #008000; text-decoration-color: #008000">zopyx.txng3.ext</span> │ <span style="color: #008000; text-decoration-color: #008000">3.3.2          </span> │ <span style="color: #008000; text-decoration-color: #008000">zopyx.txng3.ext-3.3.2.tar.gz</span> │ <span style="color: #800080; text-decoration-color: #800080">2010-03-06 16:09:43.735</span> │ <span style="color: #008000; text-decoration-color: #008000">packages/zopyx.txng3.ext/zopyx.txng3.ext-3.3.2.tar.gz/zopyx.txng3.ext-3.3.2/zop…</span> │ <span style="color: #008000; text-decoration-color: #008000">zopyx.txng3.ext-3.3.2/zopyx/txng3/ext/stemmer_src/libstemmer_c/src_c/stem_UTF_8…</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">313</span> │ <span style="color: #008000; text-decoration-color: #008000">b'\x81s\xa1t\x86}\xf9\xe5\xb5Zt\xcb\xd3\xae\nHfe\x8c\x9d'</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">~</span>           │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">16</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │
│ <span style="color: #008000; text-decoration-color: #008000">zopyx.txng3.ext</span> │ <span style="color: #008000; text-decoration-color: #008000">3.3.2          </span> │ <span style="color: #008000; text-decoration-color: #008000">zopyx.txng3.ext-3.3.2.tar.gz</span> │ <span style="color: #800080; text-decoration-color: #800080">2010-03-06 16:09:43.735</span> │ <span style="color: #008000; text-decoration-color: #008000">packages/zopyx.txng3.ext/zopyx.txng3.ext-3.3.2.tar.gz/zopyx.txng3.ext-3.3.2/zop…</span> │ <span style="color: #008000; text-decoration-color: #008000">zopyx.txng3.ext-3.3.2/zopyx/txng3/ext/stemmer_src/libstemmer_c/src_c/stem_UTF_8…</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">80922</span> │ <span style="color: #008000; text-decoration-color: #008000">b'\xae&lt;\xc7f\x02\xc5{\xc50\xf4\xdc\x8fa\x1a\t..k\xd5\x9d'</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">~</span>           │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2205</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │
│ <span style="color: #008000; text-decoration-color: #008000">zopyx.txng3.ext</span> │ <span style="color: #008000; text-decoration-color: #008000">3.3.2          </span> │ <span style="color: #008000; text-decoration-color: #008000">zopyx.txng3.ext-3.3.2.tar.gz</span> │ <span style="color: #800080; text-decoration-color: #800080">2010-03-06 16:09:43.735</span> │ <span style="color: #008000; text-decoration-color: #008000">packages/zopyx.txng3.ext/zopyx.txng3.ext-3.3.2.tar.gz/zopyx.txng3.ext-3.3.2/zop…</span> │ <span style="color: #008000; text-decoration-color: #008000">zopyx.txng3.ext-3.3.2/zopyx/txng3/ext/stemmer_src/libstemmer_c/src_c/stem_UTF_8…</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">313</span> │ <span style="color: #008000; text-decoration-color: #008000">b'\x14D\xeb\xb4\x9ac\xab\x14:b\xa4\xba\xa5\x9f\x1f\x06\xce\x0bj\xf2'</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">~</span>           │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">16</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │
│ <span style="color: #008000; text-decoration-color: #008000">zopyx.txng3.ext</span> │ <span style="color: #008000; text-decoration-color: #008000">3.3.2          </span> │ <span style="color: #008000; text-decoration-color: #008000">zopyx.txng3.ext-3.3.2.tar.gz</span> │ <span style="color: #800080; text-decoration-color: #800080">2010-03-06 16:09:43.735</span> │ <span style="color: #008000; text-decoration-color: #008000">packages/zopyx.txng3.ext/zopyx.txng3.ext-3.3.2.tar.gz/zopyx.txng3.ext-3.3.2/zop…</span> │ <span style="color: #008000; text-decoration-color: #008000">zopyx.txng3.ext-3.3.2/zopyx/txng3/ext/stemmer_src/libstemmer_c/src_c/stem_UTF_8…</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10684</span> │ <span style="color: #008000; text-decoration-color: #008000">b"!\xa259'\x94\xc7.\x16\x0b\x08\x95J\x0e\xef\x86{\x0e\xd6\x8f"</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">~</span>           │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">309</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │
│ <span style="color: #008000; text-decoration-color: #008000">zopyx.txng3.ext</span> │ <span style="color: #008000; text-decoration-color: #008000">3.3.2          </span> │ <span style="color: #008000; text-decoration-color: #008000">zopyx.txng3.ext-3.3.2.tar.gz</span> │ <span style="color: #800080; text-decoration-color: #800080">2010-03-06 16:09:43.735</span> │ <span style="color: #008000; text-decoration-color: #008000">packages/zopyx.txng3.ext/zopyx.txng3.ext-3.3.2.tar.gz/zopyx.txng3.ext-3.3.2/zop…</span> │ <span style="color: #008000; text-decoration-color: #008000">zopyx.txng3.ext-3.3.2/zopyx/txng3/ext/stemmer_src/libstemmer_c/src_c/stem_UTF_8…</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">313</span> │ <span style="color: #008000; text-decoration-color: #008000">b'\x10W.\xcc7\x08=WV\xde\x1bP9\x03w\x03\xa2\x8c\xe7\xec'</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">~</span>           │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">16</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │
│ <span style="color: #008000; text-decoration-color: #008000">zopyx.txng3.ext</span> │ <span style="color: #008000; text-decoration-color: #008000">3.3.2          </span> │ <span style="color: #008000; text-decoration-color: #008000">zopyx.txng3.ext-3.3.2.tar.gz</span> │ <span style="color: #800080; text-decoration-color: #800080">2010-03-06 16:09:43.735</span> │ <span style="color: #008000; text-decoration-color: #008000">packages/zopyx.txng3.ext/zopyx.txng3.ext-3.3.2.tar.gz/zopyx.txng3.ext-3.3.2/zop…</span> │ <span style="color: #008000; text-decoration-color: #008000">zopyx.txng3.ext-3.3.2/zopyx/txng3/ext/stemmer_src/libstemmer_c/src_c/stem_UTF_8…</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">41620</span> │ <span style="color: #008000; text-decoration-color: #008000">b'\x95P\xd6|\x85\x97\xb2H\x14\xa0d&lt;q-iu\xc1\x98h\xbb'</span>                │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">~</span>           │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1097</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │
│ <span style="color: #008000; text-decoration-color: #008000">zopyx.txng3.ext</span> │ <span style="color: #008000; text-decoration-color: #008000">3.3.2          </span> │ <span style="color: #008000; text-decoration-color: #008000">zopyx.txng3.ext-3.3.2.tar.gz</span> │ <span style="color: #800080; text-decoration-color: #800080">2010-03-06 16:09:43.735</span> │ <span style="color: #008000; text-decoration-color: #008000">packages/zopyx.txng3.ext/zopyx.txng3.ext-3.3.2.tar.gz/zopyx.txng3.ext-3.3.2/zop…</span> │ <span style="color: #008000; text-decoration-color: #008000">zopyx.txng3.ext-3.3.2/zopyx/txng3/ext/stemmer_src/libstemmer_c/src_c/stem_UTF_8…</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">313</span> │ <span style="color: #008000; text-decoration-color: #008000">b'N\xf7t\xdd\xcc\xbb8Y\x0b\xbc\xd5No_\x8d\xc7\xf2\x80\x10\xd0'</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">~</span>           │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">16</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │
│ <span style="color: #008000; text-decoration-color: #008000">zopyx.txng3.ext</span> │ <span style="color: #008000; text-decoration-color: #008000">3.3.2          </span> │ <span style="color: #008000; text-decoration-color: #008000">zopyx.txng3.ext-3.3.2.tar.gz</span> │ <span style="color: #800080; text-decoration-color: #800080">2010-03-06 16:09:43.735</span> │ <span style="color: #008000; text-decoration-color: #008000">packages/zopyx.txng3.ext/zopyx.txng3.ext-3.3.2.tar.gz/zopyx.txng3.ext-3.3.2/zop…</span> │ <span style="color: #008000; text-decoration-color: #008000">zopyx.txng3.ext-3.3.2/zopyx/txng3/ext/stemmer_src/libstemmer_c/src_c/stem_UTF_8…</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">25440</span> │ <span style="color: #008000; text-decoration-color: #008000">b'o\n\x96M+\xb0\xfbV\xaa6&lt;*\xc8\xb0B\x03\x8a\xa9\xc3\x10'</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">~</span>           │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">694</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                                                │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                                                │      <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                                    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>           │      <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │          <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└─────────────────┴─────────────────┴──────────────────────────────┴─────────────────────────┴──────────────────────────────────────────────────────────────────────────────────┴──────────────────────────────────────────────────────────────────────────────────┴────────┴──────────────────────────────────────────────────────────────────────┴─────────────┴────────┴────────────┘
</pre>
</div>
</div>
<p>That <em>could</em> be right – we can peak at the filename at the end of the <code>path</code> column to do a quick check:</p>
<div id="d8a4bc9b" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">expr.path.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/"</span>)[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> ArrayIndex(StringSplit(path, '/'), -1) </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                 │
├────────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">support.c                             </span> │
│ <span style="color: #008000; text-decoration-color: #008000">stemmer.c                             </span> │
│ <span style="color: #008000; text-decoration-color: #008000">stem_UTF_8_turkish.h                  </span> │
│ <span style="color: #008000; text-decoration-color: #008000">stem_UTF_8_turkish.c                  </span> │
│ <span style="color: #008000; text-decoration-color: #008000">stem_UTF_8_swedish.h                  </span> │
│ <span style="color: #008000; text-decoration-color: #008000">stem_UTF_8_swedish.c                  </span> │
│ <span style="color: #008000; text-decoration-color: #008000">stem_UTF_8_spanish.h                  </span> │
│ <span style="color: #008000; text-decoration-color: #008000">stem_UTF_8_spanish.c                  </span> │
│ <span style="color: #008000; text-decoration-color: #008000">stem_UTF_8_russian.h                  </span> │
│ <span style="color: #008000; text-decoration-color: #008000">stem_UTF_8_russian.c                  </span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                      │
└────────────────────────────────────────┘
</pre>
</div>
</div>
<p>Ok! Next up, we want to group the matches by:</p>
<ol type="1">
<li>The month that the package / file was published For this, we can use the <code>truncate</code> method and ask for month as our truncation window.</li>
<li>The file extension of the file used</li>
</ol>
<div id="edc6d70f" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1">expr.group_by(</span>
<span id="cb9-2">    month<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.uploaded_on.truncate(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>),</span>
<span id="cb9-3">    ext<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.path.re_extract(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"\.([a-z0-9]+)$"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb9-4">).aggregate()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃<span style="font-weight: bold"> month               </span>┃<span style="font-weight: bold"> ext    </span>┃
┡━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">timestamp</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │
├─────────────────────┼────────┤
│ <span style="color: #800080; text-decoration-color: #800080">2015-12-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">cpp   </span> │
│ <span style="color: #800080; text-decoration-color: #800080">2015-11-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">h     </span> │
│ <span style="color: #800080; text-decoration-color: #800080">2015-12-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">f90   </span> │
│ <span style="color: #800080; text-decoration-color: #800080">2015-11-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">hpp   </span> │
│ <span style="color: #800080; text-decoration-color: #800080">2010-11-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">c     </span> │
│ <span style="color: #800080; text-decoration-color: #800080">2010-07-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">h     </span> │
│ <span style="color: #800080; text-decoration-color: #800080">2010-12-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">cpp   </span> │
│ <span style="color: #800080; text-decoration-color: #800080">2010-03-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">h     </span> │
│ <span style="color: #800080; text-decoration-color: #800080">2011-08-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">cpp   </span> │
│ <span style="color: #800080; text-decoration-color: #800080">2010-05-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">h     </span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │
└─────────────────────┴────────┘
</pre>
</div>
</div>
<p>That looks promising. Now we need to grab the package names that correspond to a given file extension in a given month and deduplicate it. And to match Seth’s results, we’ll also sort by the month in descending order:</p>
<div id="02d5af05" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb10-2">    expr.group_by(</span>
<span id="cb10-3">        month<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.uploaded_on.truncate(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>),</span>
<span id="cb10-4">        ext<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.path.re_extract(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"\.([a-z0-9]+)$"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb10-5">    )</span>
<span id="cb10-6">    .aggregate(projects<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.project_name.collect().unique())</span>
<span id="cb10-7">    .order_by(_.month.desc())</span>
<span id="cb10-8">)</span>
<span id="cb10-9"></span>
<span id="cb10-10">expr</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> month               </span>┃<span style="font-weight: bold"> ext    </span>┃<span style="font-weight: bold"> projects                                            </span>┃
┡━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">timestamp</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                                       │
├─────────────────────┼────────┼─────────────────────────────────────────────────────┤
│ <span style="color: #800080; text-decoration-color: #800080">2017-07-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">c     </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'newrelic'</span>, <span style="color: #008000; text-decoration-color: #008000">'nuclitrack'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">262</span><span style="font-weight: bold">]</span>                │
│ <span style="color: #800080; text-decoration-color: #800080">2017-07-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">asm   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'pwntools'</span>, <span style="color: #008000; text-decoration-color: #008000">'fibers'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6</span><span style="font-weight: bold">]</span>                      │
│ <span style="color: #800080; text-decoration-color: #800080">2017-07-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">rs    </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'rust-pypi-example'</span>, <span style="color: #008000; text-decoration-color: #008000">'tokio'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span>              │
│ <span style="color: #800080; text-decoration-color: #800080">2017-07-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">f     </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'okada-wrapper'</span>, <span style="color: #008000; text-decoration-color: #008000">'numpy'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6</span><span style="font-weight: bold">]</span>                  │
│ <span style="color: #800080; text-decoration-color: #800080">2017-07-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">cpp   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'pipcudemo'</span>, <span style="color: #008000; text-decoration-color: #008000">'pyDEM'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">108</span><span style="font-weight: bold">]</span>                    │
│ <span style="color: #800080; text-decoration-color: #800080">2017-07-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">f90   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'pySpecData'</span>, <span style="color: #008000; text-decoration-color: #008000">'numpy'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">8</span><span style="font-weight: bold">]</span>                     │
│ <span style="color: #800080; text-decoration-color: #800080">2017-07-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">cxx   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'pytetgen'</span>, <span style="color: #008000; text-decoration-color: #008000">'python-libsbml-experimental'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">8</span><span style="font-weight: bold">]</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2017-07-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">go    </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'pre-commit'</span>, <span style="color: #008000; text-decoration-color: #008000">'django-instant'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span><span style="font-weight: bold">]</span>            │
│ <span style="color: #800080; text-decoration-color: #800080">2017-07-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">cc    </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'nixio'</span>, <span style="color: #008000; text-decoration-color: #008000">'pogeo'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">14</span><span style="font-weight: bold">]</span>                         │
│ <span style="color: #800080; text-decoration-color: #800080">2017-07-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">h     </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'numba'</span>, <span style="color: #008000; text-decoration-color: #008000">'p4d'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">222</span><span style="font-weight: bold">]</span>                          │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                   │
└─────────────────────┴────────┴─────────────────────────────────────────────────────┘
</pre>
</div>
</div>
</section>
<section id="massage-and-plot" class="level2">
<h2 class="anchored" data-anchor-id="massage-and-plot">Massage and plot</h2>
<p>Let’s continue and see what our results look like.</p>
<p>We’ll do a few things:</p>
<ol type="1">
<li>Combine all of the C and C++ extensions into a single group by renaming them all.</li>
<li>Count the number of distinct entries in each group</li>
<li>Plot the results!</li>
</ol>
<div id="e8f84935" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">collapse_names <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expr.mutate(</span>
<span id="cb11-2">    ext<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.ext.re_replace(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"cxx|cpp|cc|c|hpp|h"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C/C++"</span>)</span>
<span id="cb11-3">    .re_replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^f.*$"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fortran"</span>)</span>
<span id="cb11-4">    .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rs"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rust"</span>)</span>
<span id="cb11-5">    .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"go"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Go"</span>)</span>
<span id="cb11-6">    .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"asm"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Assembly"</span>)</span>
<span id="cb11-7">    .nullif(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>),</span>
<span id="cb11-8">).dropna(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ext"</span>)</span>
<span id="cb11-9"></span>
<span id="cb11-10">collapse_names</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> month               </span>┃<span style="font-weight: bold"> ext      </span>┃<span style="font-weight: bold"> projects                                            </span>┃
┡━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">timestamp</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                                       │
├─────────────────────┼──────────┼─────────────────────────────────────────────────────┤
│ <span style="color: #800080; text-decoration-color: #800080">2017-07-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">C/C++   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'pipcudemo'</span>, <span style="color: #008000; text-decoration-color: #008000">'pyDEM'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">108</span><span style="font-weight: bold">]</span>                    │
│ <span style="color: #800080; text-decoration-color: #800080">2017-07-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">Fortran </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'numpy'</span>, <span style="color: #008000; text-decoration-color: #008000">'pySpecData'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">8</span><span style="font-weight: bold">]</span>                     │
│ <span style="color: #800080; text-decoration-color: #800080">2017-07-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">Go      </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'pre-commit'</span>, <span style="color: #008000; text-decoration-color: #008000">'ronin'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span><span style="font-weight: bold">]</span>                     │
│ <span style="color: #800080; text-decoration-color: #800080">2017-07-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">C/C++   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'pytetgen'</span>, <span style="color: #008000; text-decoration-color: #008000">'python-libsbml-experimental'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">8</span><span style="font-weight: bold">]</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2017-07-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">C/C++   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'newrelic'</span>, <span style="color: #008000; text-decoration-color: #008000">'nuclitrack'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">262</span><span style="font-weight: bold">]</span>                │
│ <span style="color: #800080; text-decoration-color: #800080">2017-07-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">Fortran </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'okada-wrapper'</span>, <span style="color: #008000; text-decoration-color: #008000">'numpy'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6</span><span style="font-weight: bold">]</span>                  │
│ <span style="color: #800080; text-decoration-color: #800080">2017-07-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">Assembly</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'pwntools'</span>, <span style="color: #008000; text-decoration-color: #008000">'xmldirector.plonecore'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6</span><span style="font-weight: bold">]</span>       │
│ <span style="color: #800080; text-decoration-color: #800080">2017-07-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">Rust    </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'rust-pypi-example'</span>, <span style="color: #008000; text-decoration-color: #008000">'tokio'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span>              │
│ <span style="color: #800080; text-decoration-color: #800080">2017-07-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">C/C++   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'numba'</span>, <span style="color: #008000; text-decoration-color: #008000">'numpythia'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">222</span><span style="font-weight: bold">]</span>                    │
│ <span style="color: #800080; text-decoration-color: #800080">2017-07-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">C/C++   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'pyemd'</span>, <span style="color: #008000; text-decoration-color: #008000">'pogeo'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">19</span><span style="font-weight: bold">]</span>                         │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                   │
└─────────────────────┴──────────┴─────────────────────────────────────────────────────┘
</pre>
</div>
</div>
<p>Note that now we need to de-duplicate again, since we might’ve had separate unique entries for both an <code>h</code> and <code>c</code> file extension, and we don’t want to double-count!</p>
<p>We could rewrite our original query and include the renames in the original <code>group_by</code> (this would be the smart thing to do), but let’s push on and see if we can make this work.</p>
<p>The <code>projects</code> column is now a column of string arrays, so we want to collect all of the arrays in each group, this will give us a “list of lists”, then we’ll <code>flatten</code> that list and call <code>unique().length()</code> as before.</p>
<p>DuckDB has a <code>flatten</code> function, but it isn’t exposed in Ibis (yet!).</p>
<p>We’ll use a handy bit of Ibis magic to define a <code>builtin</code> <code>UDF</code> that will map directly onto the underlying DuckDB function (what!? See <a href="https://ibis-project.org/how-to/extending/builtin.html#duckdb">here</a> for more info):</p>
<div id="42a08cd7" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@ibis.udf.scalar.builtin</span></span>
<span id="cb12-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> flatten(x: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]:</span>
<span id="cb12-3">    ...</span>
<span id="cb12-4"></span>
<span id="cb12-5"></span>
<span id="cb12-6">collapse_names <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> collapse_names.group_by([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ext"</span>]).aggregate(</span>
<span id="cb12-7">    projects<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>flatten(_.projects.collect())</span>
<span id="cb12-8">)</span>
<span id="cb12-9"></span>
<span id="cb12-10">collapse_names</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> month               </span>┃<span style="font-weight: bold"> ext      </span>┃<span style="font-weight: bold"> projects                                    </span>┃
┡━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">timestamp</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                               │
├─────────────────────┼──────────┼─────────────────────────────────────────────┤
│ <span style="color: #800080; text-decoration-color: #800080">2009-07-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">C/C++   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'gevent'</span>, <span style="color: #008000; text-decoration-color: #008000">'hashlib'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">52</span><span style="font-weight: bold">]</span>              │
│ <span style="color: #800080; text-decoration-color: #800080">2009-07-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">Assembly</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'pycryptopp'</span><span style="font-weight: bold">]</span>                              │
│ <span style="color: #800080; text-decoration-color: #800080">2008-10-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">Fortran </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'numscons'</span><span style="font-weight: bold">]</span>                                │
│ <span style="color: #800080; text-decoration-color: #800080">2008-08-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">Fortran </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'numscons'</span><span style="font-weight: bold">]</span>                                │
│ <span style="color: #800080; text-decoration-color: #800080">2008-06-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">C/C++   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'dm.incrementalsearch'</span>, <span style="color: #008000; text-decoration-color: #008000">'Cython'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">45</span><span style="font-weight: bold">]</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2008-05-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">Fortran </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'numscons'</span><span style="font-weight: bold">]</span>                                │
│ <span style="color: #800080; text-decoration-color: #800080">2007-03-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">Fortran </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Model-Builder'</span><span style="font-weight: bold">]</span>                           │
│ <span style="color: #800080; text-decoration-color: #800080">2005-05-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">C/C++   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'ll-xist'</span>, <span style="color: #008000; text-decoration-color: #008000">'ll-xist'</span><span style="font-weight: bold">]</span>                      │
│ <span style="color: #800080; text-decoration-color: #800080">2005-03-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">C/C++   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'pygenx'</span>, <span style="color: #008000; text-decoration-color: #008000">'pygenx'</span><span style="font-weight: bold">]</span>                        │
│ <span style="color: #800080; text-decoration-color: #800080">2011-08-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">Fortran </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'pysces'</span>, <span style="color: #008000; text-decoration-color: #008000">'ffnet'</span><span style="font-weight: bold">]</span>                         │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                           │
└─────────────────────┴──────────┴─────────────────────────────────────────────┘
</pre>
</div>
</div>
<p>We could have included the <code>unique().length()</code> in the <code>aggregate</code> call, but sometimes it’s good to check that your slightly off-kilter idea has worked (and it has!).</p>
<div id="ec05bdc8" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1">collapse_names <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> collapse_names.select(</span>
<span id="cb13-2">    _.month, _.ext, project_count<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.projects.unique().length()</span>
<span id="cb13-3">)</span>
<span id="cb13-4"></span>
<span id="cb13-5">collapse_names</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> month               </span>┃<span style="font-weight: bold"> ext     </span>┃<span style="font-weight: bold"> project_count </span>┃
┡━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">timestamp</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>         │
├─────────────────────┼─────────┼───────────────┤
│ <span style="color: #800080; text-decoration-color: #800080">2007-03-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">C/C++  </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2006-01-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">C/C++  </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2005-10-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">C/C++  </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2011-08-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">C/C++  </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">57</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2011-03-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">C/C++  </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">63</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2011-01-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">Fortran</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2010-12-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">C/C++  </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">48</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2010-08-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">Fortran</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2010-07-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">Fortran</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3</span> │
│ <span style="color: #800080; text-decoration-color: #800080">2010-03-01 00:00:00</span> │ <span style="color: #008000; text-decoration-color: #008000">Fortran</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>       │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└─────────────────────┴─────────┴───────────────┘
</pre>
</div>
</div>
<p>Now that the data are tidied, we can pass our expression directly to Altair and see what it looks like!</p>
<div id="c5073a65" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> altair <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> alt</span>
<span id="cb14-2"></span>
<span id="cb14-3">chart <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb14-4">    alt.Chart(collapse_names.to_pandas())</span>
<span id="cb14-5">    .mark_line()</span>
<span id="cb14-6">    .encode(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month"</span>, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"project_count"</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ext"</span>)</span>
<span id="cb14-7">    .properties(width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">600</span>, height<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>)</span>
<span id="cb14-8">)</span>
<span id="cb14-9">chart</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">

<style>
  #altair-viz-37b02474d27645f0a2da21047dc985f1.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-37b02474d27645f0a2da21047dc985f1.vega-embed details,
  #altair-viz-37b02474d27645f0a2da21047dc985f1.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-37b02474d27645f0a2da21047dc985f1"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-37b02474d27645f0a2da21047dc985f1") {
      outputDiv = document.getElementById("altair-viz-37b02474d27645f0a2da21047dc985f1");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.15.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.15.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-b0d332105300c6467d81fb356d16d5a4"}, "mark": {"type": "line"}, "encoding": {"color": {"field": "ext", "type": "nominal"}, "x": {"field": "month", "type": "temporal"}, "y": {"field": "project_count", "type": "quantitative"}}, "height": 300, "width": 600, "$schema": "https://vega.github.io/schema/vega-lite/v5.15.1.json", "datasets": {"data-b0d332105300c6467d81fb356d16d5a4": [{"month": "2009-07-01T00:00:00", "ext": "C/C++", "project_count": 35}, {"month": "2009-07-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2008-10-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2008-08-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2008-06-01T00:00:00", "ext": "C/C++", "project_count": 28}, {"month": "2008-05-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2011-08-01T00:00:00", "ext": "Fortran", "project_count": 2}, {"month": "2011-03-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2011-01-01T00:00:00", "ext": "C/C++", "project_count": 49}, {"month": "2011-01-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2010-08-01T00:00:00", "ext": "C/C++", "project_count": 51}, {"month": "2010-07-01T00:00:00", "ext": "C/C++", "project_count": 64}, {"month": "2010-05-01T00:00:00", "ext": "C/C++", "project_count": 46}, {"month": "2010-03-01T00:00:00", "ext": "C/C++", "project_count": 59}, {"month": "2014-05-01T00:00:00", "ext": "Fortran", "project_count": 11}, {"month": "2014-02-01T00:00:00", "ext": "C/C++", "project_count": 146}, {"month": "2013-12-01T00:00:00", "ext": "Fortran", "project_count": 6}, {"month": "2013-10-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2013-09-01T00:00:00", "ext": "C/C++", "project_count": 109}, {"month": "2013-09-01T00:00:00", "ext": "Assembly", "project_count": 2}, {"month": "2013-05-01T00:00:00", "ext": "C/C++", "project_count": 131}, {"month": "2013-05-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2016-07-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2016-05-01T00:00:00", "ext": "Rust", "project_count": 3}, {"month": "2016-04-01T00:00:00", "ext": "Fortran", "project_count": 12}, {"month": "2015-12-01T00:00:00", "ext": "Fortran", "project_count": 5}, {"month": "2015-11-01T00:00:00", "ext": "C/C++", "project_count": 325}, {"month": "2015-11-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2015-10-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2015-09-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2015-07-01T00:00:00", "ext": "Go", "project_count": 6}, {"month": "2017-07-01T00:00:00", "ext": "Rust", "project_count": 4}, {"month": "2017-03-01T00:00:00", "ext": "Rust", "project_count": 2}, {"month": "2017-02-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2017-01-01T00:00:00", "ext": "C/C++", "project_count": 411}, {"month": "2017-01-01T00:00:00", "ext": "Assembly", "project_count": 6}, {"month": "2016-11-01T00:00:00", "ext": "Go", "project_count": 7}, {"month": "2016-08-01T00:00:00", "ext": "Go", "project_count": 6}, {"month": "2013-02-01T00:00:00", "ext": "Go", "project_count": 2}, {"month": "2012-12-01T00:00:00", "ext": "C/C++", "project_count": 85}, {"month": "2012-09-01T00:00:00", "ext": "C/C++", "project_count": 88}, {"month": "2012-07-01T00:00:00", "ext": "C/C++", "project_count": 64}, {"month": "2012-07-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2007-03-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2005-05-01T00:00:00", "ext": "C/C++", "project_count": 1}, {"month": "2005-03-01T00:00:00", "ext": "C/C++", "project_count": 1}, {"month": "2015-03-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2015-01-01T00:00:00", "ext": "C/C++", "project_count": 227}, {"month": "2015-01-01T00:00:00", "ext": "Assembly", "project_count": 4}, {"month": "2014-10-01T00:00:00", "ext": "C/C++", "project_count": 207}, {"month": "2014-10-01T00:00:00", "ext": "Assembly", "project_count": 4}, {"month": "2014-08-01T00:00:00", "ext": "Fortran", "project_count": 8}, {"month": "2008-10-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2008-10-01T00:00:00", "ext": "C/C++", "project_count": 31}, {"month": "2008-08-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2008-08-01T00:00:00", "ext": "C/C++", "project_count": 44}, {"month": "2008-06-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2008-05-01T00:00:00", "ext": "C/C++", "project_count": 24}, {"month": "2007-12-01T00:00:00", "ext": "C/C++", "project_count": 22}, {"month": "2011-08-01T00:00:00", "ext": "C/C++", "project_count": 57}, {"month": "2011-03-01T00:00:00", "ext": "C/C++", "project_count": 63}, {"month": "2011-01-01T00:00:00", "ext": "Fortran", "project_count": 2}, {"month": "2010-12-01T00:00:00", "ext": "C/C++", "project_count": 48}, {"month": "2010-08-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2010-07-01T00:00:00", "ext": "Fortran", "project_count": 3}, {"month": "2010-03-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2014-05-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2014-05-01T00:00:00", "ext": "C/C++", "project_count": 174}, {"month": "2014-04-01T00:00:00", "ext": "Go", "project_count": 2}, {"month": "2014-03-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2014-02-01T00:00:00", "ext": "Fortran", "project_count": 12}, {"month": "2013-12-01T00:00:00", "ext": "Assembly", "project_count": 2}, {"month": "2013-12-01T00:00:00", "ext": "C/C++", "project_count": 134}, {"month": "2013-09-01T00:00:00", "ext": "Fortran", "project_count": 2}, {"month": "2013-05-01T00:00:00", "ext": "Fortran", "project_count": 6}, {"month": "2016-05-01T00:00:00", "ext": "Go", "project_count": 5}, {"month": "2016-04-01T00:00:00", "ext": "Assembly", "project_count": 4}, {"month": "2016-04-01T00:00:00", "ext": "C/C++", "project_count": 340}, {"month": "2015-12-01T00:00:00", "ext": "Assembly", "project_count": 4}, {"month": "2015-12-01T00:00:00", "ext": "C/C++", "project_count": 261}, {"month": "2015-11-01T00:00:00", "ext": "Fortran", "project_count": 6}, {"month": "2015-10-01T00:00:00", "ext": "Go", "project_count": 9}, {"month": "2015-09-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2015-07-01T00:00:00", "ext": "Rust", "project_count": 2}, {"month": "2017-07-01T00:00:00", "ext": "Go", "project_count": 7}, {"month": "2017-03-01T00:00:00", "ext": "Go", "project_count": 8}, {"month": "2017-02-01T00:00:00", "ext": "Go", "project_count": 6}, {"month": "2017-01-01T00:00:00", "ext": "Fortran", "project_count": 17}, {"month": "2016-08-01T00:00:00", "ext": "Rust", "project_count": 2}, {"month": "2016-07-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2012-12-01T00:00:00", "ext": "Fortran", "project_count": 5}, {"month": "2012-09-01T00:00:00", "ext": "Fortran", "project_count": 5}, {"month": "2012-07-01T00:00:00", "ext": "Fortran", "project_count": 2}, {"month": "2007-03-01T00:00:00", "ext": "C/C++", "project_count": 6}, {"month": "2006-01-01T00:00:00", "ext": "C/C++", "project_count": 5}, {"month": "2005-10-01T00:00:00", "ext": "C/C++", "project_count": 2}, {"month": "2015-01-01T00:00:00", "ext": "Fortran", "project_count": 9}, {"month": "2014-10-01T00:00:00", "ext": "Fortran", "project_count": 4}, {"month": "2014-08-01T00:00:00", "ext": "Assembly", "project_count": 4}, {"month": "2014-08-01T00:00:00", "ext": "C/C++", "project_count": 196}, {"month": "2009-12-01T00:00:00", "ext": "C/C++", "project_count": 52}, {"month": "2009-11-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2009-09-01T00:00:00", "ext": "C/C++", "project_count": 41}, {"month": "2009-09-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2009-02-01T00:00:00", "ext": "C/C++", "project_count": 45}, {"month": "2009-01-01T00:00:00", "ext": "C/C++", "project_count": 39}, {"month": "2008-09-01T00:00:00", "ext": "C/C++", "project_count": 30}, {"month": "2008-09-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2007-10-01T00:00:00", "ext": "C/C++", "project_count": 17}, {"month": "2011-04-01T00:00:00", "ext": "C/C++", "project_count": 64}, {"month": "2010-02-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2014-01-01T00:00:00", "ext": "Fortran", "project_count": 8}, {"month": "2013-08-01T00:00:00", "ext": "Go", "project_count": 4}, {"month": "2013-06-01T00:00:00", "ext": "Fortran", "project_count": 5}, {"month": "2013-04-01T00:00:00", "ext": "C/C++", "project_count": 118}, {"month": "2013-04-01T00:00:00", "ext": "Assembly", "project_count": 2}, {"month": "2013-03-01T00:00:00", "ext": "Fortran", "project_count": 4}, {"month": "2016-06-01T00:00:00", "ext": "Go", "project_count": 5}, {"month": "2016-03-01T00:00:00", "ext": "C/C++", "project_count": 336}, {"month": "2016-03-01T00:00:00", "ext": "Assembly", "project_count": 5}, {"month": "2016-02-01T00:00:00", "ext": "Fortran", "project_count": 9}, {"month": "2016-01-01T00:00:00", "ext": "Fortran", "project_count": 12}, {"month": "2015-08-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2017-06-01T00:00:00", "ext": "Fortran", "project_count": 22}, {"month": "2017-05-01T00:00:00", "ext": "Fortran", "project_count": 19}, {"month": "2017-04-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2016-12-01T00:00:00", "ext": "Rust", "project_count": 2}, {"month": "2016-10-01T00:00:00", "ext": "Go", "project_count": 7}, {"month": "2016-09-01T00:00:00", "ext": "Fortran", "project_count": 9}, {"month": "2013-01-01T00:00:00", "ext": "Fortran", "project_count": 5}, {"month": "2012-04-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2011-11-01T00:00:00", "ext": "C/C++", "project_count": 51}, {"month": "2007-04-01T00:00:00", "ext": "C/C++", "project_count": 12}, {"month": "2006-09-01T00:00:00", "ext": "C/C++", "project_count": 12}, {"month": "2006-06-01T00:00:00", "ext": "C/C++", "project_count": 5}, {"month": "2005-11-01T00:00:00", "ext": "C/C++", "project_count": 6}, {"month": "2005-09-01T00:00:00", "ext": "C/C++", "project_count": 2}, {"month": "2005-07-01T00:00:00", "ext": "C/C++", "project_count": 4}, {"month": "2015-06-01T00:00:00", "ext": "Rust", "project_count": 2}, {"month": "2015-05-01T00:00:00", "ext": "Fortran", "project_count": 13}, {"month": "2015-04-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2015-02-01T00:00:00", "ext": "C/C++", "project_count": 230}, {"month": "2015-02-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2014-12-01T00:00:00", "ext": "C/C++", "project_count": 228}, {"month": "2014-12-01T00:00:00", "ext": "Assembly", "project_count": 2}, {"month": "2014-11-01T00:00:00", "ext": "C/C++", "project_count": 241}, {"month": "2014-11-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2014-09-01T00:00:00", "ext": "Go", "project_count": 4}, {"month": "2014-07-01T00:00:00", "ext": "Go", "project_count": 6}, {"month": "2014-06-01T00:00:00", "ext": "C/C++", "project_count": 201}, {"month": "2014-06-01T00:00:00", "ext": "Assembly", "project_count": 2}, {"month": "2009-11-01T00:00:00", "ext": "C/C++", "project_count": 67}, {"month": "2009-09-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2009-03-01T00:00:00", "ext": "C/C++", "project_count": 50}, {"month": "2009-01-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2010-02-01T00:00:00", "ext": "C/C++", "project_count": 42}, {"month": "2009-12-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2014-01-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2014-01-01T00:00:00", "ext": "C/C++", "project_count": 160}, {"month": "2013-11-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2013-07-01T00:00:00", "ext": "Go", "project_count": 2}, {"month": "2013-06-01T00:00:00", "ext": "Assembly", "project_count": 2}, {"month": "2013-06-01T00:00:00", "ext": "C/C++", "project_count": 112}, {"month": "2013-04-01T00:00:00", "ext": "Fortran", "project_count": 6}, {"month": "2013-03-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2013-03-01T00:00:00", "ext": "C/C++", "project_count": 118}, {"month": "2016-06-01T00:00:00", "ext": "Rust", "project_count": 2}, {"month": "2016-03-01T00:00:00", "ext": "Fortran", "project_count": 13}, {"month": "2016-02-01T00:00:00", "ext": "Assembly", "project_count": 6}, {"month": "2016-02-01T00:00:00", "ext": "C/C++", "project_count": 326}, {"month": "2016-01-01T00:00:00", "ext": "Assembly", "project_count": 2}, {"month": "2016-01-01T00:00:00", "ext": "C/C++", "project_count": 317}, {"month": "2015-08-01T00:00:00", "ext": "Rust", "project_count": 2}, {"month": "2015-06-01T00:00:00", "ext": "Go", "project_count": 5}, {"month": "2017-06-01T00:00:00", "ext": "Assembly", "project_count": 8}, {"month": "2017-06-01T00:00:00", "ext": "C/C++", "project_count": 417}, {"month": "2017-05-01T00:00:00", "ext": "Assembly", "project_count": 6}, {"month": "2017-05-01T00:00:00", "ext": "C/C++", "project_count": 391}, {"month": "2017-04-01T00:00:00", "ext": "Go", "project_count": 6}, {"month": "2016-12-01T00:00:00", "ext": "Go", "project_count": 8}, {"month": "2016-10-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2016-09-01T00:00:00", "ext": "Assembly", "project_count": 8}, {"month": "2016-09-01T00:00:00", "ext": "C/C++", "project_count": 327}, {"month": "2013-01-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2013-01-01T00:00:00", "ext": "C/C++", "project_count": 111}, {"month": "2012-04-01T00:00:00", "ext": "C/C++", "project_count": 77}, {"month": "2011-11-01T00:00:00", "ext": "Fortran", "project_count": 4}, {"month": "2011-10-01T00:00:00", "ext": "C/C++", "project_count": 50}, {"month": "2007-08-01T00:00:00", "ext": "C/C++", "project_count": 20}, {"month": "2007-06-01T00:00:00", "ext": "C/C++", "project_count": 10}, {"month": "2006-07-01T00:00:00", "ext": "C/C++", "project_count": 10}, {"month": "2005-12-01T00:00:00", "ext": "C/C++", "project_count": 5}, {"month": "2005-08-01T00:00:00", "ext": "C/C++", "project_count": 7}, {"month": "2015-05-01T00:00:00", "ext": "Assembly", "project_count": 4}, {"month": "2015-05-01T00:00:00", "ext": "C/C++", "project_count": 225}, {"month": "2015-04-01T00:00:00", "ext": "Go", "project_count": 4}, {"month": "2015-02-01T00:00:00", "ext": "Fortran", "project_count": 14}, {"month": "2014-12-01T00:00:00", "ext": "Fortran", "project_count": 17}, {"month": "2014-11-01T00:00:00", "ext": "Fortran", "project_count": 6}, {"month": "2014-09-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2014-07-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2014-06-01T00:00:00", "ext": "Fortran", "project_count": 12}, {"month": "2009-05-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2009-04-01T00:00:00", "ext": "C/C++", "project_count": 36}, {"month": "2008-12-01T00:00:00", "ext": "C/C++", "project_count": 38}, {"month": "2008-04-01T00:00:00", "ext": "C/C++", "project_count": 27}, {"month": "2008-04-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2008-03-01T00:00:00", "ext": "C/C++", "project_count": 25}, {"month": "2008-01-01T00:00:00", "ext": "C/C++", "project_count": 19}, {"month": "2007-11-01T00:00:00", "ext": "C/C++", "project_count": 19}, {"month": "2011-05-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2011-02-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2010-11-01T00:00:00", "ext": "C/C++", "project_count": 42}, {"month": "2010-01-01T00:00:00", "ext": "C/C++", "project_count": 37}, {"month": "2014-04-01T00:00:00", "ext": "Fortran", "project_count": 6}, {"month": "2014-03-01T00:00:00", "ext": "Fortran", "project_count": 14}, {"month": "2014-02-01T00:00:00", "ext": "Go", "project_count": 2}, {"month": "2013-10-01T00:00:00", "ext": "C/C++", "project_count": 138}, {"month": "2013-10-01T00:00:00", "ext": "Assembly", "project_count": 4}, {"month": "2013-09-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2013-05-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2016-05-01T00:00:00", "ext": "Fortran", "project_count": 15}, {"month": "2016-04-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2015-12-01T00:00:00", "ext": "Rust", "project_count": 2}, {"month": "2015-11-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2015-10-01T00:00:00", "ext": "Fortran", "project_count": 13}, {"month": "2015-09-01T00:00:00", "ext": "C/C++", "project_count": 327}, {"month": "2015-09-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2015-07-01T00:00:00", "ext": "C/C++", "project_count": 272}, {"month": "2015-07-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2017-07-01T00:00:00", "ext": "Fortran", "project_count": 16}, {"month": "2017-03-01T00:00:00", "ext": "Fortran", "project_count": 18}, {"month": "2017-02-01T00:00:00", "ext": "Fortran", "project_count": 14}, {"month": "2017-01-01T00:00:00", "ext": "Go", "project_count": 5}, {"month": "2016-11-01T00:00:00", "ext": "C/C++", "project_count": 368}, {"month": "2016-11-01T00:00:00", "ext": "Assembly", "project_count": 5}, {"month": "2016-08-01T00:00:00", "ext": "C/C++", "project_count": 325}, {"month": "2016-08-01T00:00:00", "ext": "Assembly", "project_count": 5}, {"month": "2016-07-01T00:00:00", "ext": "Fortran", "project_count": 12}, {"month": "2013-02-01T00:00:00", "ext": "C/C++", "project_count": 102}, {"month": "2013-02-01T00:00:00", "ext": "Assembly", "project_count": 2}, {"month": "2012-12-01T00:00:00", "ext": "Go", "project_count": 1}, {"month": "2012-08-01T00:00:00", "ext": "Fortran", "project_count": 3}, {"month": "2012-03-01T00:00:00", "ext": "C/C++", "project_count": 82}, {"month": "2012-03-01T00:00:00", "ext": "Assembly", "project_count": 2}, {"month": "2012-02-01T00:00:00", "ext": "C/C++", "project_count": 74}, {"month": "2012-02-01T00:00:00", "ext": "Assembly", "project_count": 2}, {"month": "2007-07-01T00:00:00", "ext": "C/C++", "project_count": 20}, {"month": "2007-02-01T00:00:00", "ext": "C/C++", "project_count": 10}, {"month": "2006-05-01T00:00:00", "ext": "C/C++", "project_count": 4}, {"month": "2006-03-01T00:00:00", "ext": "C/C++", "project_count": 8}, {"month": "2005-04-01T00:00:00", "ext": "C/C++", "project_count": 1}, {"month": "2015-03-01T00:00:00", "ext": "C/C++", "project_count": 260}, {"month": "2015-03-01T00:00:00", "ext": "Assembly", "project_count": 5}, {"month": "2015-01-01T00:00:00", "ext": "Go", "project_count": 4}, {"month": "2014-10-01T00:00:00", "ext": "Go", "project_count": 6}, {"month": "2014-08-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2009-05-01T00:00:00", "ext": "C/C++", "project_count": 42}, {"month": "2009-04-01T00:00:00", "ext": "Fortran", "project_count": 2}, {"month": "2008-04-01T00:00:00", "ext": "Fortran", "project_count": 2}, {"month": "2008-03-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2008-01-01T00:00:00", "ext": "Fortran", "project_count": 2}, {"month": "2007-09-01T00:00:00", "ext": "C/C++", "project_count": 14}, {"month": "2011-06-01T00:00:00", "ext": "C/C++", "project_count": 49}, {"month": "2011-05-01T00:00:00", "ext": "C/C++", "project_count": 76}, {"month": "2011-02-01T00:00:00", "ext": "C/C++", "project_count": 48}, {"month": "2010-11-01T00:00:00", "ext": "Fortran", "project_count": 2}, {"month": "2010-01-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2014-05-01T00:00:00", "ext": "Go", "project_count": 2}, {"month": "2014-04-01T00:00:00", "ext": "C/C++", "project_count": 181}, {"month": "2014-04-01T00:00:00", "ext": "Assembly", "project_count": 2}, {"month": "2014-03-01T00:00:00", "ext": "C/C++", "project_count": 182}, {"month": "2014-03-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2013-12-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2013-10-01T00:00:00", "ext": "Fortran", "project_count": 5}, {"month": "2013-05-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2016-07-01T00:00:00", "ext": "C/C++", "project_count": 333}, {"month": "2016-05-01T00:00:00", "ext": "C/C++", "project_count": 310}, {"month": "2016-05-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2016-04-01T00:00:00", "ext": "Go", "project_count": 4}, {"month": "2015-12-01T00:00:00", "ext": "Go", "project_count": 7}, {"month": "2015-10-01T00:00:00", "ext": "C/C++", "project_count": 306}, {"month": "2015-10-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2015-09-01T00:00:00", "ext": "Fortran", "project_count": 8}, {"month": "2015-07-01T00:00:00", "ext": "Fortran", "project_count": 10}, {"month": "2017-07-01T00:00:00", "ext": "C/C++", "project_count": 363}, {"month": "2017-07-01T00:00:00", "ext": "Assembly", "project_count": 8}, {"month": "2017-03-01T00:00:00", "ext": "C/C++", "project_count": 386}, {"month": "2017-03-01T00:00:00", "ext": "Assembly", "project_count": 7}, {"month": "2017-02-01T00:00:00", "ext": "C/C++", "project_count": 378}, {"month": "2017-02-01T00:00:00", "ext": "Assembly", "project_count": 5}, {"month": "2016-11-01T00:00:00", "ext": "Fortran", "project_count": 13}, {"month": "2016-08-01T00:00:00", "ext": "Fortran", "project_count": 10}, {"month": "2016-07-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2013-02-01T00:00:00", "ext": "Fortran", "project_count": 3}, {"month": "2012-08-01T00:00:00", "ext": "C/C++", "project_count": 84}, {"month": "2012-08-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2012-03-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2012-02-01T00:00:00", "ext": "Fortran", "project_count": 3}, {"month": "2007-05-01T00:00:00", "ext": "C/C++", "project_count": 13}, {"month": "2006-04-01T00:00:00", "ext": "C/C++", "project_count": 4}, {"month": "2006-02-01T00:00:00", "ext": "C/C++", "project_count": 3}, {"month": "2015-03-01T00:00:00", "ext": "Fortran", "project_count": 14}, {"month": "2015-01-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2014-10-01T00:00:00", "ext": "Rust", "project_count": 2}, {"month": "2014-08-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2009-10-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2009-08-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2009-06-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2008-11-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2008-07-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2008-02-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2011-07-01T00:00:00", "ext": "C/C++", "project_count": 64}, {"month": "2010-10-01T00:00:00", "ext": "C/C++", "project_count": 60}, {"month": "2010-09-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2010-06-01T00:00:00", "ext": "C/C++", "project_count": 73}, {"month": "2010-06-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2010-04-01T00:00:00", "ext": "C/C++", "project_count": 70}, {"month": "2013-11-01T00:00:00", "ext": "Fortran", "project_count": 9}, {"month": "2013-08-01T00:00:00", "ext": "C/C++", "project_count": 135}, {"month": "2013-08-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2013-07-01T00:00:00", "ext": "Fortran", "project_count": 7}, {"month": "2013-04-01T00:00:00", "ext": "Go", "project_count": 4}, {"month": "2016-06-01T00:00:00", "ext": "C/C++", "project_count": 319}, {"month": "2016-06-01T00:00:00", "ext": "Assembly", "project_count": 9}, {"month": "2016-03-01T00:00:00", "ext": "Go", "project_count": 8}, {"month": "2016-02-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2016-01-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2015-08-01T00:00:00", "ext": "C/C++", "project_count": 257}, {"month": "2015-08-01T00:00:00", "ext": "Assembly", "project_count": 4}, {"month": "2017-06-01T00:00:00", "ext": "Rust", "project_count": 6}, {"month": "2017-05-01T00:00:00", "ext": "Rust", "project_count": 3}, {"month": "2017-04-01T00:00:00", "ext": "Fortran", "project_count": 16}, {"month": "2016-12-01T00:00:00", "ext": "Fortran", "project_count": 7}, {"month": "2016-10-01T00:00:00", "ext": "C/C++", "project_count": 370}, {"month": "2016-10-01T00:00:00", "ext": "Assembly", "project_count": 4}, {"month": "2016-09-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2012-11-01T00:00:00", "ext": "C/C++", "project_count": 106}, {"month": "2012-11-01T00:00:00", "ext": "Assembly", "project_count": 2}, {"month": "2012-10-01T00:00:00", "ext": "C/C++", "project_count": 86}, {"month": "2012-06-01T00:00:00", "ext": "C/C++", "project_count": 81}, {"month": "2012-06-01T00:00:00", "ext": "Assembly", "project_count": 2}, {"month": "2012-05-01T00:00:00", "ext": "C/C++", "project_count": 83}, {"month": "2012-01-01T00:00:00", "ext": "Fortran", "project_count": 4}, {"month": "2011-12-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2011-09-01T00:00:00", "ext": "C/C++", "project_count": 55}, {"month": "2007-01-01T00:00:00", "ext": "C/C++", "project_count": 12}, {"month": "2006-11-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2006-10-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2006-08-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2015-06-01T00:00:00", "ext": "Fortran", "project_count": 11}, {"month": "2015-05-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2015-04-01T00:00:00", "ext": "Fortran", "project_count": 14}, {"month": "2015-02-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2014-12-01T00:00:00", "ext": "Go", "project_count": 4}, {"month": "2014-11-01T00:00:00", "ext": "Go", "project_count": 5}, {"month": "2014-09-01T00:00:00", "ext": "C/C++", "project_count": 191}, {"month": "2014-09-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2014-07-01T00:00:00", "ext": "C/C++", "project_count": 198}, {"month": "2014-07-01T00:00:00", "ext": "Assembly", "project_count": 4}, {"month": "2014-06-01T00:00:00", "ext": "Go", "project_count": 4}, {"month": "2009-10-01T00:00:00", "ext": "C/C++", "project_count": 40}, {"month": "2009-08-01T00:00:00", "ext": "C/C++", "project_count": 38}, {"month": "2009-06-01T00:00:00", "ext": "C/C++", "project_count": 44}, {"month": "2009-06-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2008-11-01T00:00:00", "ext": "C/C++", "project_count": 30}, {"month": "2008-11-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2008-07-01T00:00:00", "ext": "C/C++", "project_count": 21}, {"month": "2008-02-01T00:00:00", "ext": "C/C++", "project_count": 24}, {"month": "2011-07-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2010-10-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2010-09-01T00:00:00", "ext": "C/C++", "project_count": 73}, {"month": "2010-09-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2010-06-01T00:00:00", "ext": "Fortran", "project_count": 2}, {"month": "2010-04-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2014-01-01T00:00:00", "ext": "Go", "project_count": 2}, {"month": "2013-11-01T00:00:00", "ext": "C/C++", "project_count": 151}, {"month": "2013-11-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2013-08-01T00:00:00", "ext": "Fortran", "project_count": 4}, {"month": "2013-07-01T00:00:00", "ext": "C/C++", "project_count": 113}, {"month": "2013-07-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2013-06-01T00:00:00", "ext": "Go", "project_count": 2}, {"month": "2013-03-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2016-06-01T00:00:00", "ext": "Fortran", "project_count": 16}, {"month": "2016-03-01T00:00:00", "ext": "Rust", "project_count": 2}, {"month": "2016-02-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2016-01-01T00:00:00", "ext": "Go", "project_count": 4}, {"month": "2015-08-01T00:00:00", "ext": "Fortran", "project_count": 16}, {"month": "2015-06-01T00:00:00", "ext": "C/C++", "project_count": 279}, {"month": "2017-06-01T00:00:00", "ext": "Go", "project_count": 4}, {"month": "2017-05-01T00:00:00", "ext": "Go", "project_count": 7}, {"month": "2017-04-01T00:00:00", "ext": "C/C++", "project_count": 376}, {"month": "2017-04-01T00:00:00", "ext": "Assembly", "project_count": 6}, {"month": "2016-12-01T00:00:00", "ext": "C/C++", "project_count": 401}, {"month": "2016-12-01T00:00:00", "ext": "Assembly", "project_count": 9}, {"month": "2016-10-01T00:00:00", "ext": "Fortran", "project_count": 11}, {"month": "2016-09-01T00:00:00", "ext": "Go", "project_count": 8}, {"month": "2013-01-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2012-11-01T00:00:00", "ext": "Fortran", "project_count": 4}, {"month": "2012-10-01T00:00:00", "ext": "Fortran", "project_count": 4}, {"month": "2012-06-01T00:00:00", "ext": "Fortran", "project_count": 5}, {"month": "2012-05-01T00:00:00", "ext": "Fortran", "project_count": 2}, {"month": "2012-01-01T00:00:00", "ext": "C/C++", "project_count": 68}, {"month": "2012-01-01T00:00:00", "ext": "Assembly", "project_count": 2}, {"month": "2011-12-01T00:00:00", "ext": "C/C++", "project_count": 63}, {"month": "2006-12-01T00:00:00", "ext": "C/C++", "project_count": 11}, {"month": "2006-11-01T00:00:00", "ext": "C/C++", "project_count": 8}, {"month": "2006-10-01T00:00:00", "ext": "C/C++", "project_count": 8}, {"month": "2006-08-01T00:00:00", "ext": "C/C++", "project_count": 8}, {"month": "2015-06-01T00:00:00", "ext": "Assembly", "project_count": 4}, {"month": "2015-05-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2015-04-01T00:00:00", "ext": "C/C++", "project_count": 253}, {"month": "2015-04-01T00:00:00", "ext": "Assembly", "project_count": 2}, {"month": "2015-02-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2014-12-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2014-11-01T00:00:00", "ext": "Rust", "project_count": 3}, {"month": "2014-09-01T00:00:00", "ext": "Fortran", "project_count": 9}, {"month": "2014-07-01T00:00:00", "ext": "Fortran", "project_count": 13}, {"month": "2014-06-01T00:00:00", "ext": "Rust", "project_count": 1}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<p>That looks good, but it definitely doesn’t match the plot from Seth’s post:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ibis-project.org/posts/querying-pypi-metadata-compiled-languages/upstream_plot.png" class="img-fluid figure-img"></p>
<figcaption>upstream plot</figcaption>
</figure>
</div>
<p>Our current plot is only showing the results from a subset of the available data. Now that our expression is complete, we can re-run on the full dataset and compare.</p>
</section>
<section id="the-full-run" class="level2">
<h2 class="anchored" data-anchor-id="the-full-run">The full run</h2>
<p>To recap – we pulled a lazy view of a single parquet file from the <code>pypi-data</code> repo, filtered for all the files that contain file extensions we care about, then grouped them all together to get counts of the various filetypes used across projects by month.</p>
<p>Here’s the entire query chained together into a single command, now running on all of the <code>parquet</code> files we have access to:</p>
<div id="859879c8" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1">pypi <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> con.read_parquet(parquet_files, table_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pypi"</span>)</span>
<span id="cb15-2"></span>
<span id="cb15-3">full_query <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb15-4">    pypi.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="cb15-5">        [</span>
<span id="cb15-6">            _.path.re_search(</span>
<span id="cb15-7">                <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"\.(asm|c|cc|cpp|cxx|h|hpp|rs|[Ff][0-9]{0,2}(?:or)?|go)$"</span></span>
<span id="cb15-8">            ),</span>
<span id="cb15-9">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>_.path.re_search(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"(^|/)test(|s|ing)"</span>),</span>
<span id="cb15-10">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>_.path.contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/site-packages/"</span>),</span>
<span id="cb15-11">        ]</span>
<span id="cb15-12">    )</span>
<span id="cb15-13">    .group_by(</span>
<span id="cb15-14">        month<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.uploaded_on.truncate(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>),</span>
<span id="cb15-15">        ext<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.path.re_extract(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"\.([a-z0-9]+)$"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb15-16">    )</span>
<span id="cb15-17">    .aggregate(projects<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.project_name.collect().unique())</span>
<span id="cb15-18">    .order_by(_.month.desc())</span>
<span id="cb15-19">    .mutate(</span>
<span id="cb15-20">        ext<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.ext.re_replace(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"cxx|cpp|cc|c|hpp|h"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C/C++"</span>)</span>
<span id="cb15-21">        .re_replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^f.*$"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fortran"</span>)</span>
<span id="cb15-22">        .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rs"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rust"</span>)</span>
<span id="cb15-23">        .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"go"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Go"</span>)</span>
<span id="cb15-24">        .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"asm"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Assembly"</span>)</span>
<span id="cb15-25">        .nullif(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>),</span>
<span id="cb15-26">    )</span>
<span id="cb15-27">    .dropna(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ext"</span>)</span>
<span id="cb15-28">    .group_by([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ext"</span>])</span>
<span id="cb15-29">    .aggregate(project_count<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>flatten(_.projects.collect()).unique().length())</span>
<span id="cb15-30">)</span>
<span id="cb15-31">chart <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb15-32">    alt.Chart(full_query.to_pandas())</span>
<span id="cb15-33">    .mark_line()</span>
<span id="cb15-34">    .encode(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month"</span>, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"project_count"</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ext"</span>)</span>
<span id="cb15-35">    .properties(width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">600</span>, height<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>)</span>
<span id="cb15-36">)</span>
<span id="cb15-37">chart</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">

<style>
  #altair-viz-efcaf09b53af4eed9254cfc92780346a.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-efcaf09b53af4eed9254cfc92780346a.vega-embed details,
  #altair-viz-efcaf09b53af4eed9254cfc92780346a.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-efcaf09b53af4eed9254cfc92780346a"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-efcaf09b53af4eed9254cfc92780346a") {
      outputDiv = document.getElementById("altair-viz-efcaf09b53af4eed9254cfc92780346a");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.15.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.15.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-0c3879f92a02b7bf904fc63f0e3f19a6"}, "mark": {"type": "line"}, "encoding": {"color": {"field": "ext", "type": "nominal"}, "x": {"field": "month", "type": "temporal"}, "y": {"field": "project_count", "type": "quantitative"}}, "height": 300, "width": 600, "$schema": "https://vega.github.io/schema/vega-lite/v5.15.1.json", "datasets": {"data-0c3879f92a02b7bf904fc63f0e3f19a6": [{"month": "2008-10-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2008-08-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2008-06-01T00:00:00", "ext": "C/C++", "project_count": 28}, {"month": "2008-05-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2007-03-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2005-05-01T00:00:00", "ext": "C/C++", "project_count": 1}, {"month": "2005-03-01T00:00:00", "ext": "C/C++", "project_count": 1}, {"month": "2013-02-01T00:00:00", "ext": "Go", "project_count": 2}, {"month": "2012-12-01T00:00:00", "ext": "C/C++", "project_count": 85}, {"month": "2012-09-01T00:00:00", "ext": "C/C++", "project_count": 88}, {"month": "2012-07-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2012-07-01T00:00:00", "ext": "C/C++", "project_count": 64}, {"month": "2011-08-01T00:00:00", "ext": "Fortran", "project_count": 2}, {"month": "2011-03-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2011-01-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2011-01-01T00:00:00", "ext": "C/C++", "project_count": 49}, {"month": "2010-08-01T00:00:00", "ext": "C/C++", "project_count": 51}, {"month": "2010-07-01T00:00:00", "ext": "C/C++", "project_count": 64}, {"month": "2010-05-01T00:00:00", "ext": "C/C++", "project_count": 46}, {"month": "2010-03-01T00:00:00", "ext": "C/C++", "project_count": 59}, {"month": "2009-07-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2009-07-01T00:00:00", "ext": "C/C++", "project_count": 35}, {"month": "2019-12-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2019-12-01T00:00:00", "ext": "C/C++", "project_count": 647}, {"month": "2019-11-01T00:00:00", "ext": "Assembly", "project_count": 7}, {"month": "2019-11-01T00:00:00", "ext": "C/C++", "project_count": 803}, {"month": "2019-07-01T00:00:00", "ext": "Assembly", "project_count": 6}, {"month": "2019-07-01T00:00:00", "ext": "C/C++", "project_count": 620}, {"month": "2019-02-01T00:00:00", "ext": "Assembly", "project_count": 4}, {"month": "2019-02-01T00:00:00", "ext": "C/C++", "project_count": 591}, {"month": "2019-01-01T00:00:00", "ext": "Go", "project_count": 10}, {"month": "2018-11-01T00:00:00", "ext": "Go", "project_count": 9}, {"month": "2018-08-01T00:00:00", "ext": "Fortran", "project_count": 29}, {"month": "2015-11-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2015-11-01T00:00:00", "ext": "C/C++", "project_count": 325}, {"month": "2015-10-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2015-09-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2015-07-01T00:00:00", "ext": "Go", "project_count": 6}, {"month": "2015-03-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2015-01-01T00:00:00", "ext": "Assembly", "project_count": 4}, {"month": "2015-01-01T00:00:00", "ext": "C/C++", "project_count": 227}, {"month": "2014-10-01T00:00:00", "ext": "Assembly", "project_count": 4}, {"month": "2014-10-01T00:00:00", "ext": "C/C++", "project_count": 207}, {"month": "2014-08-01T00:00:00", "ext": "Fortran", "project_count": 8}, {"month": "2014-05-01T00:00:00", "ext": "Fortran", "project_count": 11}, {"month": "2014-02-01T00:00:00", "ext": "C/C++", "project_count": 146}, {"month": "2013-12-01T00:00:00", "ext": "Fortran", "project_count": 6}, {"month": "2013-10-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2013-09-01T00:00:00", "ext": "Assembly", "project_count": 2}, {"month": "2013-09-01T00:00:00", "ext": "C/C++", "project_count": 109}, {"month": "2013-05-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2013-05-01T00:00:00", "ext": "C/C++", "project_count": 131}, {"month": "2021-03-01T00:00:00", "ext": "Fortran", "project_count": 77}, {"month": "2020-12-01T00:00:00", "ext": "Go", "project_count": 17}, {"month": "2020-09-01T00:00:00", "ext": "Go", "project_count": 16}, {"month": "2020-07-01T00:00:00", "ext": "Go", "project_count": 13}, {"month": "2020-04-01T00:00:00", "ext": "Rust", "project_count": 26}, {"month": "2020-03-01T00:00:00", "ext": "Assembly", "project_count": 2}, {"month": "2020-03-01T00:00:00", "ext": "C/C++", "project_count": 768}, {"month": "2020-02-01T00:00:00", "ext": "Fortran", "project_count": 45}, {"month": "2020-01-01T00:00:00", "ext": "Assembly", "project_count": 4}, {"month": "2020-01-01T00:00:00", "ext": "C/C++", "project_count": 694}, {"month": "2022-09-01T00:00:00", "ext": "Fortran", "project_count": 61}, {"month": "2022-05-01T00:00:00", "ext": "Rust", "project_count": 106}, {"month": "2022-04-01T00:00:00", "ext": "Fortran", "project_count": 55}, {"month": "2022-03-01T00:00:00", "ext": "Fortran", "project_count": 69}, {"month": "2022-02-01T00:00:00", "ext": "Go", "project_count": 20}, {"month": "2021-09-01T00:00:00", "ext": "Rust", "project_count": 54}, {"month": "2021-08-01T00:00:00", "ext": "Assembly", "project_count": 16}, {"month": "2021-08-01T00:00:00", "ext": "C/C++", "project_count": 782}, {"month": "2018-02-01T00:00:00", "ext": "Rust", "project_count": 6}, {"month": "2018-01-01T00:00:00", "ext": "Assembly", "project_count": 6}, {"month": "2018-01-01T00:00:00", "ext": "C/C++", "project_count": 423}, {"month": "2017-11-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2017-08-01T00:00:00", "ext": "Go", "project_count": 7}, {"month": "2017-07-01T00:00:00", "ext": "Rust", "project_count": 4}, {"month": "2017-03-01T00:00:00", "ext": "Rust", "project_count": 2}, {"month": "2017-02-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2017-01-01T00:00:00", "ext": "Assembly", "project_count": 6}, {"month": "2017-01-01T00:00:00", "ext": "C/C++", "project_count": 411}, {"month": "2016-11-01T00:00:00", "ext": "Go", "project_count": 7}, {"month": "2016-08-01T00:00:00", "ext": "Go", "project_count": 6}, {"month": "2016-07-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2016-05-01T00:00:00", "ext": "Rust", "project_count": 3}, {"month": "2016-04-01T00:00:00", "ext": "Fortran", "project_count": 12}, {"month": "2015-12-01T00:00:00", "ext": "Fortran", "project_count": 5}, {"month": "2023-11-01T00:00:00", "ext": "Assembly", "project_count": 13}, {"month": "2023-11-01T00:00:00", "ext": "C/C++", "project_count": 1090}, {"month": "2023-10-01T00:00:00", "ext": "Go", "project_count": 46}, {"month": "2023-08-01T00:00:00", "ext": "Assembly", "project_count": 15}, {"month": "2023-08-01T00:00:00", "ext": "C/C++", "project_count": 1088}, {"month": "2023-05-01T00:00:00", "ext": "Go", "project_count": 34}, {"month": "2023-01-01T00:00:00", "ext": "Rust", "project_count": 188}, {"month": "2022-11-01T00:00:00", "ext": "Rust", "project_count": 140}, {"month": "2008-10-01T00:00:00", "ext": "C/C++", "project_count": 31}, {"month": "2008-10-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2008-08-01T00:00:00", "ext": "C/C++", "project_count": 44}, {"month": "2008-08-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2008-06-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2008-05-01T00:00:00", "ext": "C/C++", "project_count": 24}, {"month": "2007-12-01T00:00:00", "ext": "C/C++", "project_count": 22}, {"month": "2007-03-01T00:00:00", "ext": "C/C++", "project_count": 6}, {"month": "2006-01-01T00:00:00", "ext": "C/C++", "project_count": 5}, {"month": "2005-10-01T00:00:00", "ext": "C/C++", "project_count": 2}, {"month": "2012-12-01T00:00:00", "ext": "Fortran", "project_count": 5}, {"month": "2012-09-01T00:00:00", "ext": "Fortran", "project_count": 5}, {"month": "2012-07-01T00:00:00", "ext": "Fortran", "project_count": 2}, {"month": "2011-08-01T00:00:00", "ext": "C/C++", "project_count": 57}, {"month": "2011-03-01T00:00:00", "ext": "C/C++", "project_count": 63}, {"month": "2011-01-01T00:00:00", "ext": "Fortran", "project_count": 2}, {"month": "2010-12-01T00:00:00", "ext": "C/C++", "project_count": 48}, {"month": "2010-08-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2010-07-01T00:00:00", "ext": "Fortran", "project_count": 3}, {"month": "2010-03-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2019-12-01T00:00:00", "ext": "Fortran", "project_count": 32}, {"month": "2019-11-01T00:00:00", "ext": "Fortran", "project_count": 59}, {"month": "2019-07-01T00:00:00", "ext": "Fortran", "project_count": 30}, {"month": "2019-02-01T00:00:00", "ext": "Fortran", "project_count": 29}, {"month": "2019-01-01T00:00:00", "ext": "Rust", "project_count": 5}, {"month": "2018-11-01T00:00:00", "ext": "Rust", "project_count": 3}, {"month": "2018-08-01T00:00:00", "ext": "C/C++", "project_count": 566}, {"month": "2018-08-01T00:00:00", "ext": "Assembly", "project_count": 5}, {"month": "2015-11-01T00:00:00", "ext": "Fortran", "project_count": 6}, {"month": "2015-10-01T00:00:00", "ext": "Go", "project_count": 9}, {"month": "2015-09-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2015-07-01T00:00:00", "ext": "Rust", "project_count": 2}, {"month": "2015-01-01T00:00:00", "ext": "Fortran", "project_count": 9}, {"month": "2014-10-01T00:00:00", "ext": "Fortran", "project_count": 4}, {"month": "2014-08-01T00:00:00", "ext": "C/C++", "project_count": 196}, {"month": "2014-08-01T00:00:00", "ext": "Assembly", "project_count": 4}, {"month": "2014-05-01T00:00:00", "ext": "C/C++", "project_count": 174}, {"month": "2014-05-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2014-04-01T00:00:00", "ext": "Go", "project_count": 2}, {"month": "2014-03-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2014-02-01T00:00:00", "ext": "Fortran", "project_count": 12}, {"month": "2013-12-01T00:00:00", "ext": "C/C++", "project_count": 134}, {"month": "2013-12-01T00:00:00", "ext": "Assembly", "project_count": 2}, {"month": "2013-09-01T00:00:00", "ext": "Fortran", "project_count": 2}, {"month": "2013-05-01T00:00:00", "ext": "Fortran", "project_count": 6}, {"month": "2021-03-01T00:00:00", "ext": "C/C++", "project_count": 941}, {"month": "2021-03-01T00:00:00", "ext": "Assembly", "project_count": 13}, {"month": "2020-12-01T00:00:00", "ext": "Rust", "project_count": 38}, {"month": "2020-09-01T00:00:00", "ext": "Rust", "project_count": 31}, {"month": "2020-07-01T00:00:00", "ext": "Rust", "project_count": 33}, {"month": "2020-04-01T00:00:00", "ext": "Go", "project_count": 12}, {"month": "2020-03-01T00:00:00", "ext": "Fortran", "project_count": 43}, {"month": "2020-02-01T00:00:00", "ext": "C/C++", "project_count": 740}, {"month": "2020-02-01T00:00:00", "ext": "Assembly", "project_count": 6}, {"month": "2020-01-01T00:00:00", "ext": "Fortran", "project_count": 39}, {"month": "2022-09-01T00:00:00", "ext": "C/C++", "project_count": 1020}, {"month": "2022-09-01T00:00:00", "ext": "Assembly", "project_count": 14}, {"month": "2022-05-01T00:00:00", "ext": "Go", "project_count": 22}, {"month": "2022-04-01T00:00:00", "ext": "C/C++", "project_count": 961}, {"month": "2022-04-01T00:00:00", "ext": "Assembly", "project_count": 9}, {"month": "2022-03-01T00:00:00", "ext": "C/C++", "project_count": 1126}, {"month": "2022-03-01T00:00:00", "ext": "Assembly", "project_count": 12}, {"month": "2022-02-01T00:00:00", "ext": "Rust", "project_count": 92}, {"month": "2021-09-01T00:00:00", "ext": "Go", "project_count": 25}, {"month": "2021-08-01T00:00:00", "ext": "Fortran", "project_count": 46}, {"month": "2018-02-01T00:00:00", "ext": "Go", "project_count": 6}, {"month": "2018-01-01T00:00:00", "ext": "Fortran", "project_count": 16}, {"month": "2017-11-01T00:00:00", "ext": "Go", "project_count": 12}, {"month": "2017-08-01T00:00:00", "ext": "Rust", "project_count": 3}, {"month": "2017-07-01T00:00:00", "ext": "Go", "project_count": 8}, {"month": "2017-03-01T00:00:00", "ext": "Go", "project_count": 8}, {"month": "2017-02-01T00:00:00", "ext": "Go", "project_count": 6}, {"month": "2017-01-01T00:00:00", "ext": "Fortran", "project_count": 17}, {"month": "2016-08-01T00:00:00", "ext": "Rust", "project_count": 2}, {"month": "2016-07-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2016-05-01T00:00:00", "ext": "Go", "project_count": 5}, {"month": "2016-04-01T00:00:00", "ext": "C/C++", "project_count": 340}, {"month": "2016-04-01T00:00:00", "ext": "Assembly", "project_count": 4}, {"month": "2015-12-01T00:00:00", "ext": "C/C++", "project_count": 261}, {"month": "2015-12-01T00:00:00", "ext": "Assembly", "project_count": 4}, {"month": "2023-11-01T00:00:00", "ext": "Fortran", "project_count": 85}, {"month": "2023-10-01T00:00:00", "ext": "Rust", "project_count": 250}, {"month": "2023-08-01T00:00:00", "ext": "Fortran", "project_count": 57}, {"month": "2023-05-01T00:00:00", "ext": "Rust", "project_count": 203}, {"month": "2023-01-01T00:00:00", "ext": "Go", "project_count": 33}, {"month": "2022-11-01T00:00:00", "ext": "Go", "project_count": 24}, {"month": "2009-02-01T00:00:00", "ext": "C/C++", "project_count": 45}, {"month": "2009-01-01T00:00:00", "ext": "C/C++", "project_count": 39}, {"month": "2008-09-01T00:00:00", "ext": "C/C++", "project_count": 30}, {"month": "2008-09-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2007-10-01T00:00:00", "ext": "C/C++", "project_count": 17}, {"month": "2007-04-01T00:00:00", "ext": "C/C++", "project_count": 12}, {"month": "2006-09-01T00:00:00", "ext": "C/C++", "project_count": 12}, {"month": "2006-06-01T00:00:00", "ext": "C/C++", "project_count": 5}, {"month": "2005-11-01T00:00:00", "ext": "C/C++", "project_count": 6}, {"month": "2005-09-01T00:00:00", "ext": "C/C++", "project_count": 2}, {"month": "2005-07-01T00:00:00", "ext": "C/C++", "project_count": 4}, {"month": "2013-01-01T00:00:00", "ext": "Fortran", "project_count": 5}, {"month": "2012-04-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2011-11-01T00:00:00", "ext": "C/C++", "project_count": 51}, {"month": "2011-04-01T00:00:00", "ext": "C/C++", "project_count": 64}, {"month": "2010-02-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2009-12-01T00:00:00", "ext": "C/C++", "project_count": 52}, {"month": "2009-11-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2009-09-01T00:00:00", "ext": "C/C++", "project_count": 41}, {"month": "2009-09-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2019-10-01T00:00:00", "ext": "C/C++", "project_count": 825}, {"month": "2019-10-01T00:00:00", "ext": "Assembly", "project_count": 6}, {"month": "2019-09-01T00:00:00", "ext": "C/C++", "project_count": 591}, {"month": "2019-09-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2019-08-01T00:00:00", "ext": "C/C++", "project_count": 606}, {"month": "2019-08-01T00:00:00", "ext": "Assembly", "project_count": 5}, {"month": "2019-06-01T00:00:00", "ext": "C/C++", "project_count": 633}, {"month": "2019-06-01T00:00:00", "ext": "Assembly", "project_count": 8}, {"month": "2019-05-01T00:00:00", "ext": "Go", "project_count": 9}, {"month": "2019-04-01T00:00:00", "ext": "C/C++", "project_count": 670}, {"month": "2019-04-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2019-03-01T00:00:00", "ext": "Rust", "project_count": 10}, {"month": "2018-12-01T00:00:00", "ext": "Fortran", "project_count": 25}, {"month": "2018-10-01T00:00:00", "ext": "Rust", "project_count": 4}, {"month": "2018-09-01T00:00:00", "ext": "Rust", "project_count": 4}, {"month": "2018-07-01T00:00:00", "ext": "Go", "project_count": 12}, {"month": "2018-06-01T00:00:00", "ext": "Rust", "project_count": 8}, {"month": "2018-05-01T00:00:00", "ext": "Rust", "project_count": 9}, {"month": "2015-08-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2015-06-01T00:00:00", "ext": "Rust", "project_count": 2}, {"month": "2015-05-01T00:00:00", "ext": "Fortran", "project_count": 13}, {"month": "2015-04-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2015-02-01T00:00:00", "ext": "C/C++", "project_count": 230}, {"month": "2015-02-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2014-12-01T00:00:00", "ext": "C/C++", "project_count": 228}, {"month": "2014-12-01T00:00:00", "ext": "Assembly", "project_count": 2}, {"month": "2014-11-01T00:00:00", "ext": "C/C++", "project_count": 241}, {"month": "2014-11-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2014-09-01T00:00:00", "ext": "Go", "project_count": 4}, {"month": "2014-07-01T00:00:00", "ext": "Go", "project_count": 6}, {"month": "2014-06-01T00:00:00", "ext": "C/C++", "project_count": 201}, {"month": "2014-06-01T00:00:00", "ext": "Assembly", "project_count": 2}, {"month": "2014-01-01T00:00:00", "ext": "Fortran", "project_count": 8}, {"month": "2013-08-01T00:00:00", "ext": "Go", "project_count": 4}, {"month": "2013-06-01T00:00:00", "ext": "Fortran", "project_count": 5}, {"month": "2013-04-01T00:00:00", "ext": "C/C++", "project_count": 118}, {"month": "2013-04-01T00:00:00", "ext": "Assembly", "project_count": 2}, {"month": "2013-03-01T00:00:00", "ext": "Fortran", "project_count": 4}, {"month": "2021-07-01T00:00:00", "ext": "Rust", "project_count": 56}, {"month": "2021-06-01T00:00:00", "ext": "Fortran", "project_count": 70}, {"month": "2021-05-01T00:00:00", "ext": "Rust", "project_count": 48}, {"month": "2021-04-01T00:00:00", "ext": "Fortran", "project_count": 73}, {"month": "2021-02-01T00:00:00", "ext": "Rust", "project_count": 45}, {"month": "2021-01-01T00:00:00", "ext": "Rust", "project_count": 34}, {"month": "2020-11-01T00:00:00", "ext": "Rust", "project_count": 37}, {"month": "2020-10-01T00:00:00", "ext": "Go", "project_count": 19}, {"month": "2020-08-01T00:00:00", "ext": "Go", "project_count": 10}, {"month": "2020-06-01T00:00:00", "ext": "Fortran", "project_count": 67}, {"month": "2020-05-01T00:00:00", "ext": "Fortran", "project_count": 56}, {"month": "2022-08-01T00:00:00", "ext": "Rust", "project_count": 114}, {"month": "2022-07-01T00:00:00", "ext": "Fortran", "project_count": 54}, {"month": "2022-06-01T00:00:00", "ext": "C/C++", "project_count": 934}, {"month": "2022-06-01T00:00:00", "ext": "Assembly", "project_count": 10}, {"month": "2022-01-01T00:00:00", "ext": "Fortran", "project_count": 56}, {"month": "2021-12-01T00:00:00", "ext": "Rust", "project_count": 80}, {"month": "2021-11-01T00:00:00", "ext": "C/C++", "project_count": 973}, {"month": "2021-11-01T00:00:00", "ext": "Assembly", "project_count": 16}, {"month": "2021-10-01T00:00:00", "ext": "Go", "project_count": 30}, {"month": "2018-04-01T00:00:00", "ext": "Rust", "project_count": 7}, {"month": "2018-03-01T00:00:00", "ext": "Fortran", "project_count": 27}, {"month": "2017-12-01T00:00:00", "ext": "Rust", "project_count": 3}, {"month": "2017-10-01T00:00:00", "ext": "Fortran", "project_count": 18}, {"month": "2017-09-01T00:00:00", "ext": "Go", "project_count": 7}, {"month": "2017-06-01T00:00:00", "ext": "Fortran", "project_count": 22}, {"month": "2017-05-01T00:00:00", "ext": "Fortran", "project_count": 19}, {"month": "2017-04-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2016-12-01T00:00:00", "ext": "Rust", "project_count": 2}, {"month": "2016-10-01T00:00:00", "ext": "Go", "project_count": 7}, {"month": "2016-09-01T00:00:00", "ext": "Fortran", "project_count": 9}, {"month": "2016-06-01T00:00:00", "ext": "Go", "project_count": 5}, {"month": "2016-03-01T00:00:00", "ext": "C/C++", "project_count": 336}, {"month": "2016-03-01T00:00:00", "ext": "Assembly", "project_count": 5}, {"month": "2016-02-01T00:00:00", "ext": "Fortran", "project_count": 9}, {"month": "2016-01-01T00:00:00", "ext": "Fortran", "project_count": 12}, {"month": "2023-09-01T00:00:00", "ext": "Fortran", "project_count": 60}, {"month": "2023-07-01T00:00:00", "ext": "C/C++", "project_count": 1056}, {"month": "2023-07-01T00:00:00", "ext": "Assembly", "project_count": 10}, {"month": "2023-06-01T00:00:00", "ext": "Fortran", "project_count": 63}, {"month": "2023-04-01T00:00:00", "ext": "C/C++", "project_count": 1122}, {"month": "2023-04-01T00:00:00", "ext": "Assembly", "project_count": 8}, {"month": "2023-03-01T00:00:00", "ext": "Rust", "project_count": 189}, {"month": "2023-02-01T00:00:00", "ext": "Go", "project_count": 35}, {"month": "2022-12-01T00:00:00", "ext": "C/C++", "project_count": 1064}, {"month": "2022-12-01T00:00:00", "ext": "Assembly", "project_count": 16}, {"month": "2022-10-01T00:00:00", "ext": "C/C++", "project_count": 1102}, {"month": "2022-10-01T00:00:00", "ext": "Assembly", "project_count": 15}, {"month": "2009-01-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2007-08-01T00:00:00", "ext": "C/C++", "project_count": 20}, {"month": "2007-06-01T00:00:00", "ext": "C/C++", "project_count": 10}, {"month": "2006-07-01T00:00:00", "ext": "C/C++", "project_count": 10}, {"month": "2005-12-01T00:00:00", "ext": "C/C++", "project_count": 5}, {"month": "2005-08-01T00:00:00", "ext": "C/C++", "project_count": 7}, {"month": "2013-03-01T00:00:00", "ext": "C/C++", "project_count": 118}, {"month": "2013-01-01T00:00:00", "ext": "C/C++", "project_count": 111}, {"month": "2013-01-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2012-04-01T00:00:00", "ext": "C/C++", "project_count": 77}, {"month": "2011-11-01T00:00:00", "ext": "Fortran", "project_count": 4}, {"month": "2011-10-01T00:00:00", "ext": "C/C++", "project_count": 50}, {"month": "2010-02-01T00:00:00", "ext": "C/C++", "project_count": 42}, {"month": "2009-12-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2009-11-01T00:00:00", "ext": "C/C++", "project_count": 67}, {"month": "2009-09-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2009-03-01T00:00:00", "ext": "C/C++", "project_count": 50}, {"month": "2019-10-01T00:00:00", "ext": "Fortran", "project_count": 50}, {"month": "2019-09-01T00:00:00", "ext": "Fortran", "project_count": 28}, {"month": "2019-08-01T00:00:00", "ext": "Fortran", "project_count": 35}, {"month": "2019-06-01T00:00:00", "ext": "Fortran", "project_count": 48}, {"month": "2019-05-01T00:00:00", "ext": "Rust", "project_count": 9}, {"month": "2019-04-01T00:00:00", "ext": "Fortran", "project_count": 34}, {"month": "2019-03-01T00:00:00", "ext": "Go", "project_count": 14}, {"month": "2018-12-01T00:00:00", "ext": "C/C++", "project_count": 596}, {"month": "2018-12-01T00:00:00", "ext": "Assembly", "project_count": 5}, {"month": "2018-10-01T00:00:00", "ext": "Go", "project_count": 10}, {"month": "2018-09-01T00:00:00", "ext": "Go", "project_count": 7}, {"month": "2018-07-01T00:00:00", "ext": "Rust", "project_count": 4}, {"month": "2018-06-01T00:00:00", "ext": "Go", "project_count": 11}, {"month": "2018-05-01T00:00:00", "ext": "Go", "project_count": 7}, {"month": "2015-08-01T00:00:00", "ext": "Rust", "project_count": 2}, {"month": "2015-06-01T00:00:00", "ext": "Go", "project_count": 5}, {"month": "2015-05-01T00:00:00", "ext": "C/C++", "project_count": 225}, {"month": "2015-05-01T00:00:00", "ext": "Assembly", "project_count": 4}, {"month": "2015-04-01T00:00:00", "ext": "Go", "project_count": 4}, {"month": "2015-02-01T00:00:00", "ext": "Fortran", "project_count": 14}, {"month": "2014-12-01T00:00:00", "ext": "Fortran", "project_count": 17}, {"month": "2014-11-01T00:00:00", "ext": "Fortran", "project_count": 6}, {"month": "2014-09-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2014-07-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2014-06-01T00:00:00", "ext": "Fortran", "project_count": 12}, {"month": "2014-01-01T00:00:00", "ext": "C/C++", "project_count": 160}, {"month": "2014-01-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2013-11-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2013-07-01T00:00:00", "ext": "Go", "project_count": 2}, {"month": "2013-06-01T00:00:00", "ext": "C/C++", "project_count": 112}, {"month": "2013-06-01T00:00:00", "ext": "Assembly", "project_count": 2}, {"month": "2013-04-01T00:00:00", "ext": "Fortran", "project_count": 6}, {"month": "2013-03-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2021-06-01T00:00:00", "ext": "C/C++", "project_count": 931}, {"month": "2021-06-01T00:00:00", "ext": "Assembly", "project_count": 9}, {"month": "2021-05-01T00:00:00", "ext": "Go", "project_count": 16}, {"month": "2021-04-01T00:00:00", "ext": "C/C++", "project_count": 911}, {"month": "2021-04-01T00:00:00", "ext": "Assembly", "project_count": 10}, {"month": "2021-02-01T00:00:00", "ext": "Go", "project_count": 15}, {"month": "2021-01-01T00:00:00", "ext": "Go", "project_count": 14}, {"month": "2020-11-01T00:00:00", "ext": "Go", "project_count": 14}, {"month": "2020-10-01T00:00:00", "ext": "Rust", "project_count": 22}, {"month": "2020-08-01T00:00:00", "ext": "Rust", "project_count": 31}, {"month": "2020-06-01T00:00:00", "ext": "C/C++", "project_count": 923}, {"month": "2020-06-01T00:00:00", "ext": "Assembly", "project_count": 8}, {"month": "2020-05-01T00:00:00", "ext": "C/C++", "project_count": 803}, {"month": "2020-05-01T00:00:00", "ext": "Assembly", "project_count": 7}, {"month": "2022-10-01T00:00:00", "ext": "Fortran", "project_count": 90}, {"month": "2022-08-01T00:00:00", "ext": "Go", "project_count": 25}, {"month": "2022-07-01T00:00:00", "ext": "C/C++", "project_count": 866}, {"month": "2022-07-01T00:00:00", "ext": "Assembly", "project_count": 10}, {"month": "2022-06-01T00:00:00", "ext": "Fortran", "project_count": 67}, {"month": "2022-01-01T00:00:00", "ext": "C/C++", "project_count": 1045}, {"month": "2022-01-01T00:00:00", "ext": "Assembly", "project_count": 14}, {"month": "2021-12-01T00:00:00", "ext": "Go", "project_count": 11}, {"month": "2021-11-01T00:00:00", "ext": "Fortran", "project_count": 55}, {"month": "2021-10-01T00:00:00", "ext": "Rust", "project_count": 68}, {"month": "2021-07-01T00:00:00", "ext": "Go", "project_count": 17}, {"month": "2018-04-01T00:00:00", "ext": "Go", "project_count": 5}, {"month": "2018-03-01T00:00:00", "ext": "C/C++", "project_count": 475}, {"month": "2018-03-01T00:00:00", "ext": "Assembly", "project_count": 4}, {"month": "2017-12-01T00:00:00", "ext": "Go", "project_count": 5}, {"month": "2017-10-01T00:00:00", "ext": "C/C++", "project_count": 448}, {"month": "2017-10-01T00:00:00", "ext": "Assembly", "project_count": 5}, {"month": "2017-09-01T00:00:00", "ext": "Rust", "project_count": 2}, {"month": "2017-06-01T00:00:00", "ext": "C/C++", "project_count": 417}, {"month": "2017-06-01T00:00:00", "ext": "Assembly", "project_count": 8}, {"month": "2017-05-01T00:00:00", "ext": "C/C++", "project_count": 391}, {"month": "2017-05-01T00:00:00", "ext": "Assembly", "project_count": 6}, {"month": "2017-04-01T00:00:00", "ext": "Go", "project_count": 6}, {"month": "2016-12-01T00:00:00", "ext": "Go", "project_count": 8}, {"month": "2016-10-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2016-09-01T00:00:00", "ext": "C/C++", "project_count": 327}, {"month": "2016-09-01T00:00:00", "ext": "Assembly", "project_count": 8}, {"month": "2016-06-01T00:00:00", "ext": "Rust", "project_count": 2}, {"month": "2016-03-01T00:00:00", "ext": "Fortran", "project_count": 13}, {"month": "2016-02-01T00:00:00", "ext": "C/C++", "project_count": 326}, {"month": "2016-02-01T00:00:00", "ext": "Assembly", "project_count": 6}, {"month": "2016-01-01T00:00:00", "ext": "C/C++", "project_count": 317}, {"month": "2016-01-01T00:00:00", "ext": "Assembly", "project_count": 2}, {"month": "2023-09-01T00:00:00", "ext": "C/C++", "project_count": 1456}, {"month": "2023-09-01T00:00:00", "ext": "Assembly", "project_count": 18}, {"month": "2023-07-01T00:00:00", "ext": "Fortran", "project_count": 63}, {"month": "2023-06-01T00:00:00", "ext": "C/C++", "project_count": 1120}, {"month": "2023-06-01T00:00:00", "ext": "Assembly", "project_count": 15}, {"month": "2023-04-01T00:00:00", "ext": "Fortran", "project_count": 83}, {"month": "2023-03-01T00:00:00", "ext": "Go", "project_count": 37}, {"month": "2023-02-01T00:00:00", "ext": "Rust", "project_count": 176}, {"month": "2022-12-01T00:00:00", "ext": "Fortran", "project_count": 66}, {"month": "2008-12-01T00:00:00", "ext": "C/C++", "project_count": 38}, {"month": "2008-04-01T00:00:00", "ext": "C/C++", "project_count": 27}, {"month": "2008-04-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2008-03-01T00:00:00", "ext": "C/C++", "project_count": 25}, {"month": "2008-01-01T00:00:00", "ext": "C/C++", "project_count": 19}, {"month": "2007-11-01T00:00:00", "ext": "C/C++", "project_count": 19}, {"month": "2007-07-01T00:00:00", "ext": "C/C++", "project_count": 20}, {"month": "2007-02-01T00:00:00", "ext": "C/C++", "project_count": 10}, {"month": "2006-05-01T00:00:00", "ext": "C/C++", "project_count": 4}, {"month": "2006-03-01T00:00:00", "ext": "C/C++", "project_count": 8}, {"month": "2005-04-01T00:00:00", "ext": "C/C++", "project_count": 1}, {"month": "2013-02-01T00:00:00", "ext": "C/C++", "project_count": 102}, {"month": "2013-02-01T00:00:00", "ext": "Assembly", "project_count": 2}, {"month": "2012-12-01T00:00:00", "ext": "Go", "project_count": 1}, {"month": "2012-08-01T00:00:00", "ext": "Fortran", "project_count": 3}, {"month": "2012-03-01T00:00:00", "ext": "C/C++", "project_count": 82}, {"month": "2012-03-01T00:00:00", "ext": "Assembly", "project_count": 2}, {"month": "2012-02-01T00:00:00", "ext": "C/C++", "project_count": 74}, {"month": "2012-02-01T00:00:00", "ext": "Assembly", "project_count": 2}, {"month": "2011-05-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2011-02-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2010-11-01T00:00:00", "ext": "C/C++", "project_count": 42}, {"month": "2010-01-01T00:00:00", "ext": "C/C++", "project_count": 37}, {"month": "2009-05-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2009-04-01T00:00:00", "ext": "C/C++", "project_count": 36}, {"month": "2019-11-01T00:00:00", "ext": "Go", "project_count": 8}, {"month": "2019-07-01T00:00:00", "ext": "Go", "project_count": 8}, {"month": "2019-02-01T00:00:00", "ext": "Go", "project_count": 8}, {"month": "2019-01-01T00:00:00", "ext": "C/C++", "project_count": 515}, {"month": "2019-01-01T00:00:00", "ext": "Assembly", "project_count": 5}, {"month": "2018-11-01T00:00:00", "ext": "C/C++", "project_count": 572}, {"month": "2018-11-01T00:00:00", "ext": "Assembly", "project_count": 4}, {"month": "2018-08-01T00:00:00", "ext": "Rust", "project_count": 5}, {"month": "2015-11-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2015-10-01T00:00:00", "ext": "Fortran", "project_count": 13}, {"month": "2015-09-01T00:00:00", "ext": "C/C++", "project_count": 327}, {"month": "2015-09-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2015-07-01T00:00:00", "ext": "C/C++", "project_count": 272}, {"month": "2015-07-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2015-03-01T00:00:00", "ext": "C/C++", "project_count": 260}, {"month": "2015-03-01T00:00:00", "ext": "Assembly", "project_count": 5}, {"month": "2015-01-01T00:00:00", "ext": "Go", "project_count": 4}, {"month": "2014-10-01T00:00:00", "ext": "Go", "project_count": 6}, {"month": "2014-08-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2014-04-01T00:00:00", "ext": "Fortran", "project_count": 6}, {"month": "2014-03-01T00:00:00", "ext": "Fortran", "project_count": 14}, {"month": "2014-02-01T00:00:00", "ext": "Go", "project_count": 2}, {"month": "2013-10-01T00:00:00", "ext": "C/C++", "project_count": 138}, {"month": "2013-10-01T00:00:00", "ext": "Assembly", "project_count": 4}, {"month": "2013-09-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2013-05-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2021-03-01T00:00:00", "ext": "Rust", "project_count": 46}, {"month": "2020-12-01T00:00:00", "ext": "C/C++", "project_count": 861}, {"month": "2020-12-01T00:00:00", "ext": "Assembly", "project_count": 6}, {"month": "2020-09-01T00:00:00", "ext": "C/C++", "project_count": 790}, {"month": "2020-09-01T00:00:00", "ext": "Assembly", "project_count": 11}, {"month": "2020-07-01T00:00:00", "ext": "C/C++", "project_count": 823}, {"month": "2020-07-01T00:00:00", "ext": "Assembly", "project_count": 11}, {"month": "2020-04-01T00:00:00", "ext": "Fortran", "project_count": 53}, {"month": "2020-03-01T00:00:00", "ext": "Go", "project_count": 10}, {"month": "2020-02-01T00:00:00", "ext": "Rust", "project_count": 24}, {"month": "2020-01-01T00:00:00", "ext": "Go", "project_count": 8}, {"month": "2019-12-01T00:00:00", "ext": "Go", "project_count": 12}, {"month": "2022-09-01T00:00:00", "ext": "Rust", "project_count": 123}, {"month": "2022-05-01T00:00:00", "ext": "Fortran", "project_count": 47}, {"month": "2022-04-01T00:00:00", "ext": "Rust", "project_count": 112}, {"month": "2022-03-01T00:00:00", "ext": "Rust", "project_count": 103}, {"month": "2022-02-01T00:00:00", "ext": "C/C++", "project_count": 1025}, {"month": "2022-02-01T00:00:00", "ext": "Assembly", "project_count": 10}, {"month": "2021-09-01T00:00:00", "ext": "Fortran", "project_count": 50}, {"month": "2021-08-01T00:00:00", "ext": "Go", "project_count": 16}, {"month": "2018-02-01T00:00:00", "ext": "Fortran", "project_count": 23}, {"month": "2018-01-01T00:00:00", "ext": "Go", "project_count": 9}, {"month": "2017-11-01T00:00:00", "ext": "Fortran", "project_count": 20}, {"month": "2017-08-01T00:00:00", "ext": "C/C++", "project_count": 450}, {"month": "2017-08-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2017-07-01T00:00:00", "ext": "Fortran", "project_count": 19}, {"month": "2017-03-01T00:00:00", "ext": "Fortran", "project_count": 18}, {"month": "2017-02-01T00:00:00", "ext": "Fortran", "project_count": 14}, {"month": "2017-01-01T00:00:00", "ext": "Go", "project_count": 5}, {"month": "2016-11-01T00:00:00", "ext": "C/C++", "project_count": 368}, {"month": "2016-11-01T00:00:00", "ext": "Assembly", "project_count": 5}, {"month": "2016-08-01T00:00:00", "ext": "C/C++", "project_count": 325}, {"month": "2016-08-01T00:00:00", "ext": "Assembly", "project_count": 5}, {"month": "2016-07-01T00:00:00", "ext": "Fortran", "project_count": 12}, {"month": "2016-05-01T00:00:00", "ext": "Fortran", "project_count": 15}, {"month": "2016-04-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2015-12-01T00:00:00", "ext": "Rust", "project_count": 2}, {"month": "2023-11-01T00:00:00", "ext": "Go", "project_count": 38}, {"month": "2023-10-01T00:00:00", "ext": "C/C++", "project_count": 1331}, {"month": "2023-10-01T00:00:00", "ext": "Assembly", "project_count": 23}, {"month": "2023-08-01T00:00:00", "ext": "Go", "project_count": 34}, {"month": "2023-05-01T00:00:00", "ext": "C/C++", "project_count": 1123}, {"month": "2023-05-01T00:00:00", "ext": "Assembly", "project_count": 9}, {"month": "2023-01-01T00:00:00", "ext": "Fortran", "project_count": 56}, {"month": "2022-11-01T00:00:00", "ext": "Fortran", "project_count": 80}, {"month": "2008-04-01T00:00:00", "ext": "Fortran", "project_count": 2}, {"month": "2008-03-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2008-01-01T00:00:00", "ext": "Fortran", "project_count": 2}, {"month": "2007-09-01T00:00:00", "ext": "C/C++", "project_count": 14}, {"month": "2007-05-01T00:00:00", "ext": "C/C++", "project_count": 13}, {"month": "2006-04-01T00:00:00", "ext": "C/C++", "project_count": 4}, {"month": "2006-02-01T00:00:00", "ext": "C/C++", "project_count": 3}, {"month": "2013-02-01T00:00:00", "ext": "Fortran", "project_count": 3}, {"month": "2012-08-01T00:00:00", "ext": "C/C++", "project_count": 84}, {"month": "2012-08-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2012-03-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2012-02-01T00:00:00", "ext": "Fortran", "project_count": 3}, {"month": "2011-06-01T00:00:00", "ext": "C/C++", "project_count": 49}, {"month": "2011-05-01T00:00:00", "ext": "C/C++", "project_count": 76}, {"month": "2011-02-01T00:00:00", "ext": "C/C++", "project_count": 48}, {"month": "2010-11-01T00:00:00", "ext": "Fortran", "project_count": 2}, {"month": "2010-01-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2009-05-01T00:00:00", "ext": "C/C++", "project_count": 42}, {"month": "2009-04-01T00:00:00", "ext": "Fortran", "project_count": 2}, {"month": "2019-11-01T00:00:00", "ext": "Rust", "project_count": 17}, {"month": "2019-07-01T00:00:00", "ext": "Rust", "project_count": 10}, {"month": "2019-02-01T00:00:00", "ext": "Rust", "project_count": 5}, {"month": "2019-01-01T00:00:00", "ext": "Fortran", "project_count": 28}, {"month": "2018-11-01T00:00:00", "ext": "Fortran", "project_count": 27}, {"month": "2018-08-01T00:00:00", "ext": "Go", "project_count": 11}, {"month": "2015-10-01T00:00:00", "ext": "C/C++", "project_count": 306}, {"month": "2015-10-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2015-09-01T00:00:00", "ext": "Fortran", "project_count": 8}, {"month": "2015-07-01T00:00:00", "ext": "Fortran", "project_count": 10}, {"month": "2015-03-01T00:00:00", "ext": "Fortran", "project_count": 14}, {"month": "2015-01-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2014-10-01T00:00:00", "ext": "Rust", "project_count": 2}, {"month": "2014-08-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2014-05-01T00:00:00", "ext": "Go", "project_count": 2}, {"month": "2014-04-01T00:00:00", "ext": "C/C++", "project_count": 181}, {"month": "2014-04-01T00:00:00", "ext": "Assembly", "project_count": 2}, {"month": "2014-03-01T00:00:00", "ext": "C/C++", "project_count": 182}, {"month": "2014-03-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2013-12-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2013-10-01T00:00:00", "ext": "Fortran", "project_count": 5}, {"month": "2013-05-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2021-03-01T00:00:00", "ext": "Go", "project_count": 17}, {"month": "2020-12-01T00:00:00", "ext": "Fortran", "project_count": 52}, {"month": "2020-09-01T00:00:00", "ext": "Fortran", "project_count": 40}, {"month": "2020-07-01T00:00:00", "ext": "Fortran", "project_count": 38}, {"month": "2020-04-01T00:00:00", "ext": "C/C++", "project_count": 764}, {"month": "2020-04-01T00:00:00", "ext": "Assembly", "project_count": 5}, {"month": "2020-03-01T00:00:00", "ext": "Rust", "project_count": 18}, {"month": "2020-02-01T00:00:00", "ext": "Go", "project_count": 13}, {"month": "2020-01-01T00:00:00", "ext": "Rust", "project_count": 24}, {"month": "2019-12-01T00:00:00", "ext": "Rust", "project_count": 8}, {"month": "2022-09-01T00:00:00", "ext": "Go", "project_count": 24}, {"month": "2022-05-01T00:00:00", "ext": "C/C++", "project_count": 907}, {"month": "2022-05-01T00:00:00", "ext": "Assembly", "project_count": 10}, {"month": "2022-04-01T00:00:00", "ext": "Go", "project_count": 21}, {"month": "2022-03-01T00:00:00", "ext": "Go", "project_count": 24}, {"month": "2022-02-01T00:00:00", "ext": "Fortran", "project_count": 52}, {"month": "2021-09-01T00:00:00", "ext": "C/C++", "project_count": 893}, {"month": "2021-09-01T00:00:00", "ext": "Assembly", "project_count": 15}, {"month": "2021-08-01T00:00:00", "ext": "Rust", "project_count": 57}, {"month": "2018-02-01T00:00:00", "ext": "C/C++", "project_count": 475}, {"month": "2018-02-01T00:00:00", "ext": "Assembly", "project_count": 8}, {"month": "2018-01-01T00:00:00", "ext": "Rust", "project_count": 3}, {"month": "2017-11-01T00:00:00", "ext": "C/C++", "project_count": 495}, {"month": "2017-11-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2017-08-01T00:00:00", "ext": "Fortran", "project_count": 22}, {"month": "2017-07-01T00:00:00", "ext": "C/C++", "project_count": 395}, {"month": "2017-07-01T00:00:00", "ext": "Assembly", "project_count": 9}, {"month": "2017-03-01T00:00:00", "ext": "C/C++", "project_count": 386}, {"month": "2017-03-01T00:00:00", "ext": "Assembly", "project_count": 7}, {"month": "2017-02-01T00:00:00", "ext": "C/C++", "project_count": 378}, {"month": "2017-02-01T00:00:00", "ext": "Assembly", "project_count": 5}, {"month": "2016-11-01T00:00:00", "ext": "Fortran", "project_count": 13}, {"month": "2016-08-01T00:00:00", "ext": "Fortran", "project_count": 10}, {"month": "2016-07-01T00:00:00", "ext": "C/C++", "project_count": 333}, {"month": "2016-07-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2016-05-01T00:00:00", "ext": "C/C++", "project_count": 310}, {"month": "2016-05-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2016-04-01T00:00:00", "ext": "Go", "project_count": 4}, {"month": "2015-12-01T00:00:00", "ext": "Go", "project_count": 7}, {"month": "2023-11-01T00:00:00", "ext": "Rust", "project_count": 235}, {"month": "2023-10-01T00:00:00", "ext": "Fortran", "project_count": 95}, {"month": "2023-08-01T00:00:00", "ext": "Rust", "project_count": 237}, {"month": "2023-05-01T00:00:00", "ext": "Fortran", "project_count": 88}, {"month": "2023-01-01T00:00:00", "ext": "C/C++", "project_count": 1051}, {"month": "2023-01-01T00:00:00", "ext": "Assembly", "project_count": 13}, {"month": "2022-11-01T00:00:00", "ext": "C/C++", "project_count": 1265}, {"month": "2022-11-01T00:00:00", "ext": "Assembly", "project_count": 14}, {"month": "2008-11-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2008-07-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2008-02-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2007-01-01T00:00:00", "ext": "C/C++", "project_count": 12}, {"month": "2006-11-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2006-10-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2006-08-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2012-11-01T00:00:00", "ext": "C/C++", "project_count": 106}, {"month": "2012-11-01T00:00:00", "ext": "Assembly", "project_count": 2}, {"month": "2012-10-01T00:00:00", "ext": "C/C++", "project_count": 86}, {"month": "2012-06-01T00:00:00", "ext": "C/C++", "project_count": 81}, {"month": "2012-06-01T00:00:00", "ext": "Assembly", "project_count": 2}, {"month": "2012-05-01T00:00:00", "ext": "C/C++", "project_count": 83}, {"month": "2012-01-01T00:00:00", "ext": "Fortran", "project_count": 4}, {"month": "2011-12-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2011-09-01T00:00:00", "ext": "C/C++", "project_count": 55}, {"month": "2011-07-01T00:00:00", "ext": "C/C++", "project_count": 64}, {"month": "2010-10-01T00:00:00", "ext": "C/C++", "project_count": 60}, {"month": "2010-09-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2010-06-01T00:00:00", "ext": "C/C++", "project_count": 73}, {"month": "2010-06-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2010-04-01T00:00:00", "ext": "C/C++", "project_count": 70}, {"month": "2009-10-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2009-08-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2009-06-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2019-10-01T00:00:00", "ext": "Go", "project_count": 13}, {"month": "2019-09-01T00:00:00", "ext": "Go", "project_count": 15}, {"month": "2019-08-01T00:00:00", "ext": "Go", "project_count": 12}, {"month": "2019-06-01T00:00:00", "ext": "Go", "project_count": 8}, {"month": "2019-05-01T00:00:00", "ext": "C/C++", "project_count": 653}, {"month": "2019-05-01T00:00:00", "ext": "Assembly", "project_count": 4}, {"month": "2019-04-01T00:00:00", "ext": "Go", "project_count": 11}, {"month": "2019-03-01T00:00:00", "ext": "Fortran", "project_count": 31}, {"month": "2018-12-01T00:00:00", "ext": "Rust", "project_count": 7}, {"month": "2018-10-01T00:00:00", "ext": "Fortran", "project_count": 25}, {"month": "2018-09-01T00:00:00", "ext": "Fortran", "project_count": 25}, {"month": "2018-07-01T00:00:00", "ext": "C/C++", "project_count": 599}, {"month": "2018-07-01T00:00:00", "ext": "Assembly", "project_count": 7}, {"month": "2018-06-01T00:00:00", "ext": "Fortran", "project_count": 23}, {"month": "2018-05-01T00:00:00", "ext": "Fortran", "project_count": 26}, {"month": "2015-08-01T00:00:00", "ext": "C/C++", "project_count": 257}, {"month": "2015-08-01T00:00:00", "ext": "Assembly", "project_count": 4}, {"month": "2015-06-01T00:00:00", "ext": "Fortran", "project_count": 11}, {"month": "2015-05-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2015-04-01T00:00:00", "ext": "Fortran", "project_count": 14}, {"month": "2015-02-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2014-12-01T00:00:00", "ext": "Go", "project_count": 4}, {"month": "2014-11-01T00:00:00", "ext": "Go", "project_count": 5}, {"month": "2014-09-01T00:00:00", "ext": "C/C++", "project_count": 191}, {"month": "2014-09-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2014-07-01T00:00:00", "ext": "C/C++", "project_count": 198}, {"month": "2014-07-01T00:00:00", "ext": "Assembly", "project_count": 4}, {"month": "2014-06-01T00:00:00", "ext": "Go", "project_count": 4}, {"month": "2013-11-01T00:00:00", "ext": "Fortran", "project_count": 9}, {"month": "2013-08-01T00:00:00", "ext": "C/C++", "project_count": 135}, {"month": "2013-08-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2013-07-01T00:00:00", "ext": "Fortran", "project_count": 7}, {"month": "2013-04-01T00:00:00", "ext": "Go", "project_count": 4}, {"month": "2021-07-01T00:00:00", "ext": "Fortran", "project_count": 65}, {"month": "2021-06-01T00:00:00", "ext": "Rust", "project_count": 50}, {"month": "2021-05-01T00:00:00", "ext": "Fortran", "project_count": 54}, {"month": "2021-04-01T00:00:00", "ext": "Rust", "project_count": 50}, {"month": "2021-02-01T00:00:00", "ext": "Fortran", "project_count": 65}, {"month": "2021-01-01T00:00:00", "ext": "Fortran", "project_count": 53}, {"month": "2020-11-01T00:00:00", "ext": "Fortran", "project_count": 43}, {"month": "2020-10-01T00:00:00", "ext": "C/C++", "project_count": 854}, {"month": "2020-10-01T00:00:00", "ext": "Assembly", "project_count": 8}, {"month": "2020-08-01T00:00:00", "ext": "C/C++", "project_count": 709}, {"month": "2020-08-01T00:00:00", "ext": "Assembly", "project_count": 10}, {"month": "2020-06-01T00:00:00", "ext": "Rust", "project_count": 32}, {"month": "2020-05-01T00:00:00", "ext": "Rust", "project_count": 20}, {"month": "2022-08-01T00:00:00", "ext": "Fortran", "project_count": 47}, {"month": "2022-07-01T00:00:00", "ext": "Rust", "project_count": 113}, {"month": "2022-06-01T00:00:00", "ext": "Go", "project_count": 25}, {"month": "2022-01-01T00:00:00", "ext": "Rust", "project_count": 87}, {"month": "2021-12-01T00:00:00", "ext": "Fortran", "project_count": 39}, {"month": "2021-11-01T00:00:00", "ext": "Go", "project_count": 25}, {"month": "2021-10-01T00:00:00", "ext": "C/C++", "project_count": 981}, {"month": "2021-10-01T00:00:00", "ext": "Assembly", "project_count": 17}, {"month": "2018-04-01T00:00:00", "ext": "Fortran", "project_count": 26}, {"month": "2018-03-01T00:00:00", "ext": "Rust", "project_count": 4}, {"month": "2017-12-01T00:00:00", "ext": "Fortran", "project_count": 16}, {"month": "2017-10-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2017-09-01T00:00:00", "ext": "C/C++", "project_count": 500}, {"month": "2017-09-01T00:00:00", "ext": "Assembly", "project_count": 7}, {"month": "2017-06-01T00:00:00", "ext": "Rust", "project_count": 6}, {"month": "2017-05-01T00:00:00", "ext": "Rust", "project_count": 3}, {"month": "2017-04-01T00:00:00", "ext": "Fortran", "project_count": 16}, {"month": "2016-12-01T00:00:00", "ext": "Fortran", "project_count": 7}, {"month": "2016-10-01T00:00:00", "ext": "C/C++", "project_count": 370}, {"month": "2016-10-01T00:00:00", "ext": "Assembly", "project_count": 4}, {"month": "2016-09-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2016-06-01T00:00:00", "ext": "C/C++", "project_count": 319}, {"month": "2016-06-01T00:00:00", "ext": "Assembly", "project_count": 9}, {"month": "2016-03-01T00:00:00", "ext": "Go", "project_count": 8}, {"month": "2016-02-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2016-01-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2023-09-01T00:00:00", "ext": "Rust", "project_count": 239}, {"month": "2023-07-01T00:00:00", "ext": "Go", "project_count": 43}, {"month": "2023-06-01T00:00:00", "ext": "Rust", "project_count": 213}, {"month": "2023-04-01T00:00:00", "ext": "Go", "project_count": 35}, {"month": "2023-03-01T00:00:00", "ext": "Fortran", "project_count": 82}, {"month": "2023-02-01T00:00:00", "ext": "C/C++", "project_count": 990}, {"month": "2023-02-01T00:00:00", "ext": "Assembly", "project_count": 9}, {"month": "2022-12-01T00:00:00", "ext": "Go", "project_count": 25}, {"month": "2022-10-01T00:00:00", "ext": "Go", "project_count": 33}, {"month": "2008-11-01T00:00:00", "ext": "C/C++", "project_count": 30}, {"month": "2008-11-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2008-07-01T00:00:00", "ext": "C/C++", "project_count": 21}, {"month": "2008-02-01T00:00:00", "ext": "C/C++", "project_count": 24}, {"month": "2006-12-01T00:00:00", "ext": "C/C++", "project_count": 11}, {"month": "2006-11-01T00:00:00", "ext": "C/C++", "project_count": 8}, {"month": "2006-10-01T00:00:00", "ext": "C/C++", "project_count": 8}, {"month": "2006-08-01T00:00:00", "ext": "C/C++", "project_count": 8}, {"month": "2013-01-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2012-11-01T00:00:00", "ext": "Fortran", "project_count": 4}, {"month": "2012-10-01T00:00:00", "ext": "Fortran", "project_count": 4}, {"month": "2012-06-01T00:00:00", "ext": "Fortran", "project_count": 5}, {"month": "2012-05-01T00:00:00", "ext": "Fortran", "project_count": 2}, {"month": "2012-01-01T00:00:00", "ext": "C/C++", "project_count": 68}, {"month": "2012-01-01T00:00:00", "ext": "Assembly", "project_count": 2}, {"month": "2011-12-01T00:00:00", "ext": "C/C++", "project_count": 63}, {"month": "2011-07-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2010-10-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2010-09-01T00:00:00", "ext": "C/C++", "project_count": 73}, {"month": "2010-09-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2010-06-01T00:00:00", "ext": "Fortran", "project_count": 2}, {"month": "2010-04-01T00:00:00", "ext": "Fortran", "project_count": 1}, {"month": "2009-10-01T00:00:00", "ext": "C/C++", "project_count": 40}, {"month": "2009-08-01T00:00:00", "ext": "C/C++", "project_count": 38}, {"month": "2009-06-01T00:00:00", "ext": "C/C++", "project_count": 44}, {"month": "2009-06-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2019-10-01T00:00:00", "ext": "Rust", "project_count": 17}, {"month": "2019-09-01T00:00:00", "ext": "Rust", "project_count": 14}, {"month": "2019-08-01T00:00:00", "ext": "Rust", "project_count": 17}, {"month": "2019-06-01T00:00:00", "ext": "Rust", "project_count": 11}, {"month": "2019-05-01T00:00:00", "ext": "Fortran", "project_count": 41}, {"month": "2019-04-01T00:00:00", "ext": "Rust", "project_count": 7}, {"month": "2019-03-01T00:00:00", "ext": "C/C++", "project_count": 568}, {"month": "2019-03-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2018-12-01T00:00:00", "ext": "Go", "project_count": 7}, {"month": "2018-10-01T00:00:00", "ext": "C/C++", "project_count": 628}, {"month": "2018-10-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2018-09-01T00:00:00", "ext": "C/C++", "project_count": 535}, {"month": "2018-09-01T00:00:00", "ext": "Assembly", "project_count": 4}, {"month": "2018-07-01T00:00:00", "ext": "Fortran", "project_count": 30}, {"month": "2018-06-01T00:00:00", "ext": "C/C++", "project_count": 563}, {"month": "2018-06-01T00:00:00", "ext": "Assembly", "project_count": 8}, {"month": "2018-05-01T00:00:00", "ext": "C/C++", "project_count": 500}, {"month": "2015-08-01T00:00:00", "ext": "Fortran", "project_count": 16}, {"month": "2015-06-01T00:00:00", "ext": "C/C++", "project_count": 279}, {"month": "2015-06-01T00:00:00", "ext": "Assembly", "project_count": 4}, {"month": "2015-05-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2015-04-01T00:00:00", "ext": "C/C++", "project_count": 253}, {"month": "2015-04-01T00:00:00", "ext": "Assembly", "project_count": 2}, {"month": "2015-02-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2014-12-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2014-11-01T00:00:00", "ext": "Rust", "project_count": 3}, {"month": "2014-09-01T00:00:00", "ext": "Fortran", "project_count": 9}, {"month": "2014-07-01T00:00:00", "ext": "Fortran", "project_count": 13}, {"month": "2014-06-01T00:00:00", "ext": "Rust", "project_count": 1}, {"month": "2014-01-01T00:00:00", "ext": "Go", "project_count": 2}, {"month": "2013-11-01T00:00:00", "ext": "C/C++", "project_count": 151}, {"month": "2013-11-01T00:00:00", "ext": "Assembly", "project_count": 3}, {"month": "2013-08-01T00:00:00", "ext": "Fortran", "project_count": 4}, {"month": "2013-07-01T00:00:00", "ext": "C/C++", "project_count": 113}, {"month": "2013-07-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2013-06-01T00:00:00", "ext": "Go", "project_count": 2}, {"month": "2013-03-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2021-07-01T00:00:00", "ext": "Assembly", "project_count": 12}, {"month": "2021-07-01T00:00:00", "ext": "C/C++", "project_count": 862}, {"month": "2021-06-01T00:00:00", "ext": "Go", "project_count": 14}, {"month": "2021-05-01T00:00:00", "ext": "C/C++", "project_count": 961}, {"month": "2021-05-01T00:00:00", "ext": "Assembly", "project_count": 13}, {"month": "2021-04-01T00:00:00", "ext": "Go", "project_count": 17}, {"month": "2021-02-01T00:00:00", "ext": "C/C++", "project_count": 872}, {"month": "2021-02-01T00:00:00", "ext": "Assembly", "project_count": 10}, {"month": "2021-01-01T00:00:00", "ext": "C/C++", "project_count": 820}, {"month": "2021-01-01T00:00:00", "ext": "Assembly", "project_count": 9}, {"month": "2020-11-01T00:00:00", "ext": "C/C++", "project_count": 898}, {"month": "2020-11-01T00:00:00", "ext": "Assembly", "project_count": 10}, {"month": "2020-10-01T00:00:00", "ext": "Fortran", "project_count": 54}, {"month": "2020-08-01T00:00:00", "ext": "Fortran", "project_count": 32}, {"month": "2020-06-01T00:00:00", "ext": "Go", "project_count": 16}, {"month": "2020-05-01T00:00:00", "ext": "Go", "project_count": 14}, {"month": "2022-08-01T00:00:00", "ext": "C/C++", "project_count": 997}, {"month": "2022-08-01T00:00:00", "ext": "Assembly", "project_count": 15}, {"month": "2022-07-01T00:00:00", "ext": "Go", "project_count": 27}, {"month": "2022-06-01T00:00:00", "ext": "Rust", "project_count": 105}, {"month": "2022-01-01T00:00:00", "ext": "Go", "project_count": 21}, {"month": "2021-12-01T00:00:00", "ext": "C/C++", "project_count": 908}, {"month": "2021-12-01T00:00:00", "ext": "Assembly", "project_count": 8}, {"month": "2021-11-01T00:00:00", "ext": "Rust", "project_count": 78}, {"month": "2021-10-01T00:00:00", "ext": "Fortran", "project_count": 71}, {"month": "2018-05-01T00:00:00", "ext": "Assembly", "project_count": 1}, {"month": "2018-04-01T00:00:00", "ext": "C/C++", "project_count": 564}, {"month": "2018-04-01T00:00:00", "ext": "Assembly", "project_count": 6}, {"month": "2018-03-01T00:00:00", "ext": "Go", "project_count": 5}, {"month": "2017-12-01T00:00:00", "ext": "C/C++", "project_count": 430}, {"month": "2017-12-01T00:00:00", "ext": "Assembly", "project_count": 4}, {"month": "2017-10-01T00:00:00", "ext": "Go", "project_count": 9}, {"month": "2017-09-01T00:00:00", "ext": "Fortran", "project_count": 16}, {"month": "2017-06-01T00:00:00", "ext": "Go", "project_count": 4}, {"month": "2017-05-01T00:00:00", "ext": "Go", "project_count": 7}, {"month": "2017-04-01T00:00:00", "ext": "C/C++", "project_count": 376}, {"month": "2017-04-01T00:00:00", "ext": "Assembly", "project_count": 6}, {"month": "2016-12-01T00:00:00", "ext": "C/C++", "project_count": 401}, {"month": "2016-12-01T00:00:00", "ext": "Assembly", "project_count": 9}, {"month": "2016-10-01T00:00:00", "ext": "Fortran", "project_count": 11}, {"month": "2016-09-01T00:00:00", "ext": "Go", "project_count": 8}, {"month": "2016-06-01T00:00:00", "ext": "Fortran", "project_count": 16}, {"month": "2016-03-01T00:00:00", "ext": "Rust", "project_count": 2}, {"month": "2016-02-01T00:00:00", "ext": "Go", "project_count": 3}, {"month": "2016-01-01T00:00:00", "ext": "Go", "project_count": 4}, {"month": "2023-09-01T00:00:00", "ext": "Go", "project_count": 42}, {"month": "2023-07-01T00:00:00", "ext": "Rust", "project_count": 208}, {"month": "2023-06-01T00:00:00", "ext": "Go", "project_count": 36}, {"month": "2023-04-01T00:00:00", "ext": "Rust", "project_count": 205}, {"month": "2023-03-01T00:00:00", "ext": "C/C++", "project_count": 1158}, {"month": "2023-03-01T00:00:00", "ext": "Assembly", "project_count": 7}, {"month": "2023-02-01T00:00:00", "ext": "Fortran", "project_count": 71}, {"month": "2022-12-01T00:00:00", "ext": "Rust", "project_count": 141}, {"month": "2022-10-01T00:00:00", "ext": "Rust", "project_count": 171}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>blog</category>
  <guid>https://ibis-project.org/posts/querying-pypi-metadata-compiled-languages/</guid>
  <pubDate>Wed, 15 Nov 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Working with arrays in Google BigQuery</title>
  <dc:creator>Phillip Cloud</dc:creator>
  <link>https://ibis-project.org/posts/bigquery-arrays/</link>
  <description><![CDATA[ 





<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Ibis and BigQuery have <a href="https://cloud.google.com/blog/products/data-analytics/ibis-and-bigquery-scalable-analytics-comfort-python">worked well together for years</a>.</p>
<p>In Ibis 7.0.0, they work even better together with the addition of array functionality for BigQuery.</p>
<p>Let’s look at some examples using BigQuery’s <a href="https://developer.imdb.com/non-commercial-datasets/">IMDB sample data</a>.</p>
</section>
<section id="basics" class="level2">
<h2 class="anchored" data-anchor-id="basics">Basics</h2>
<p>First we’ll connect to BigQuery and pluck out a table to work with.</p>
<p>We’ll start with <code>from ibis.interactive import *</code> for maximum convenience.</p>
<div id="5faa101c" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="annotated-cell-1" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="1">1</button><span id="annotated-cell-1-1" class="code-annotation-target"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> ibis.interactive <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span>
<span id="annotated-cell-1-2"></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="2">2</button><span id="annotated-cell-1-3" class="code-annotation-target">con <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bigquery://ibis-gbq"</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="3">3</button><span id="annotated-cell-1-4" class="code-annotation-target">con.set_database(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bigquery-public-data.imdb"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-1" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="1" data-code-annotation="1"><code>from ibis.interactive import *</code> imports Ibis APIs into the global namespace and enables <a href="../../how-to/configure/basics.html#interactive-mode">interactive mode</a>.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="3" data-code-annotation="2">Connect to Google BigQuery. Compute (but not storage) is billed to the project you connect to–<code>ibis-gbq</code> in this case.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="4" data-code-annotation="3">Set the database to the project and dataset that we will use for analysis.</span>
</dd>
</dl>
</div>
</div>
<p>Let’s look at the tables in this dataset:</p>
<div id="e348f2a8" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1">con.tables</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>Tables
------
- name_basics
- reviews
- title_akas
- title_basics
- title_crew
- title_episode
- title_principals
- title_ratings</code></pre>
</div>
</div>
<p>Let’s pull out the <code>name_basics</code> table, which contains names and metadata about people listed on IMDB. We’ll call this <code>ents</code> (short for <code>entities</code>), and remove some columns we won’t need:</p>
<div id="3bb7fb0f" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">ents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> con.tables.name_basics.drop(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"birth_year"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"death_year"</span>)</span>
<span id="cb3-2">ents</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> nconst    </span>┃<span style="font-weight: bold"> primary_name         </span>┃<span style="font-weight: bold"> primary_profession </span>┃<span style="font-weight: bold"> known_for_titles              </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                        │
├───────────┼──────────────────────┼────────────────────┼───────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">nm7138056</span> │ <span style="color: #008000; text-decoration-color: #008000">Rick Rosenthal      </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>                          │
│ <span style="color: #008000; text-decoration-color: #008000">nm7139577</span> │ <span style="color: #008000; text-decoration-color: #008000">Swearwolf           </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>                          │
│ <span style="color: #008000; text-decoration-color: #008000">nm7142352</span> │ <span style="color: #008000; text-decoration-color: #008000">Sue Alcock          </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>               │ <span style="color: #008000; text-decoration-color: #008000">tt0106077,tt2882076,tt0206501</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm7148481</span> │ <span style="color: #008000; text-decoration-color: #008000">Fayez Sayegh        </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>               │ <span style="color: #008000; text-decoration-color: #008000">tt0334858,tt0257303          </span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm7152942</span> │ <span style="color: #008000; text-decoration-color: #008000">Tyler Trevyon Wilson</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>                          │
│ <span style="color: #008000; text-decoration-color: #008000">nm7155448</span> │ <span style="color: #008000; text-decoration-color: #008000">Kieran Statham      </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>                          │
│ <span style="color: #008000; text-decoration-color: #008000">nm7180904</span> │ <span style="color: #008000; text-decoration-color: #008000">Ivan Houston        </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>               │ <span style="color: #008000; text-decoration-color: #008000">tt4513850,tt6479150          </span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm7205405</span> │ <span style="color: #008000; text-decoration-color: #008000">Beryl Heryet        </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>               │ <span style="color: #008000; text-decoration-color: #008000">tt0108961                    </span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm7205905</span> │ <span style="color: #008000; text-decoration-color: #008000">Catherine A. Hughes </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>                          │
│ <span style="color: #008000; text-decoration-color: #008000">nm7224551</span> │ <span style="color: #008000; text-decoration-color: #008000">Rick Young          </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>                          │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                             │
└───────────┴──────────────────────┴────────────────────┴───────────────────────────────┘
</pre>
</div>
</div>
<section id="splitting-strings-into-arrays" class="level3">
<h3 class="anchored" data-anchor-id="splitting-strings-into-arrays">Splitting strings into arrays</h3>
<p>We can see that <code>known_for_titles</code> looks sort of like an array, so let’s call the <a href="../../reference/expression-strings.html#ibis.expr.types.strings.StringValue.split"><code>split</code></a> method on that column and replace the existing column:</p>
<div id="5d4e28ad" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">ents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ents.mutate(known_for_titles<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.known_for_titles.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>))</span>
<span id="cb4-2">ents</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> nconst    </span>┃<span style="font-weight: bold"> primary_name     </span>┃<span style="font-weight: bold"> primary_profession </span>┃<span style="font-weight: bold"> known_for_titles </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>    │
├───────────┼──────────────────┼────────────────────┼──────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">nm7136100</span> │ <span style="color: #008000; text-decoration-color: #008000">Aaisha Nance    </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>               │ <span style="font-weight: bold">[]</span>               │
│ <span style="color: #008000; text-decoration-color: #008000">nm7154336</span> │ <span style="color: #008000; text-decoration-color: #008000">Eduardo Martínez</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>               │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt3916326'</span><span style="font-weight: bold">]</span>    │
│ <span style="color: #008000; text-decoration-color: #008000">nm7159199</span> │ <span style="color: #008000; text-decoration-color: #008000">Russell Michael </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>               │ <span style="font-weight: bold">[]</span>               │
│ <span style="color: #008000; text-decoration-color: #008000">nm7164837</span> │ <span style="color: #008000; text-decoration-color: #008000">Chris Hayden    </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>               │ <span style="font-weight: bold">[]</span>               │
│ <span style="color: #008000; text-decoration-color: #008000">nm7173311</span> │ <span style="color: #008000; text-decoration-color: #008000">Brenda Richmond </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>               │ <span style="font-weight: bold">[]</span>               │
│ <span style="color: #008000; text-decoration-color: #008000">nm7184223</span> │ <span style="color: #008000; text-decoration-color: #008000">Lise Hogstad    </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>               │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt4517204'</span><span style="font-weight: bold">]</span>    │
│ <span style="color: #008000; text-decoration-color: #008000">nm7188457</span> │ <span style="color: #008000; text-decoration-color: #008000">Jake Hirsch     </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>               │ <span style="font-weight: bold">[]</span>               │
│ <span style="color: #008000; text-decoration-color: #008000">nm7201641</span> │ <span style="color: #008000; text-decoration-color: #008000">Zvi Hillman     </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>               │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt3800526'</span><span style="font-weight: bold">]</span>    │
│ <span style="color: #008000; text-decoration-color: #008000">nm7201872</span> │ <span style="color: #008000; text-decoration-color: #008000">Eleanor Glissan </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>               │ <span style="font-weight: bold">[]</span>               │
│ <span style="color: #008000; text-decoration-color: #008000">nm7202400</span> │ <span style="color: #008000; text-decoration-color: #008000">Don Wolfe       </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>               │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0350393'</span><span style="font-weight: bold">]</span>    │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                │
└───────────┴──────────────────┴────────────────────┴──────────────────┘
</pre>
</div>
</div>
<p>Similarly for <code>primary_profession</code>, since people involved in show business often have more than one responsibility on a project:</p>
<div id="8387c80b" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">ents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ents.mutate(primary_profession<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.primary_profession.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>))</span></code></pre></div>
</div>
</section>
<section id="array-length" class="level3">
<h3 class="anchored" data-anchor-id="array-length">Array length</h3>
<p>Let’s see how many titles each entity is known for, and then show the five people with the largest number of titles they’re known for:</p>
<p>This is computed using the <a href="../../reference/expression-collections.html#ibis.expr.types.arrays.ArrayValue.length"><code>length</code></a> API on array expressions:</p>
<div id="01b35e5c" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">(</span>
<span id="cb6-2">    ents.select(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"primary_name"</span>, num_titles<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.known_for_titles.length())</span>
<span id="cb6-3">    .order_by(_.num_titles.desc())</span>
<span id="cb6-4">    .limit(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb6-5">)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> primary_name       </span>┃<span style="font-weight: bold"> num_titles </span>┃
┡━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>      │
├────────────────────┼────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">Paul Winter       </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Chris Estrada     </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Jonathon Saunders </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Jean-Marie Dupriez</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Henry Townsend    </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span> │
└────────────────────┴────────────┘
</pre>
</div>
</div>
<p>It seems like the length of the <code>known_for_titles</code> might be capped at five!</p>
</section>
<section id="index" class="level3">
<h3 class="anchored" data-anchor-id="index">Index</h3>
<p>We can see the position of <code>"actor"</code> in <code>primary_profession</code>s:</p>
<div id="2f3e6c62" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">ents.primary_profession.index(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"actor"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> ArrayPosition(primary_profession, 'actor') </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>                                      │
├────────────────────────────────────────────┤
│                                         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1</span> │
│                                          <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└────────────────────────────────────────────┘
</pre>
</div>
</div>
<p>A return value of <code>-1</code> indicates that <code>"actor"</code> is not present in the value:</p>
<p>Let’s look for entities that are not primarily actors:</p>
<p>We can do this using the <a href="../../reference/expression-collections.html#ibis.expr.types.arrays.ArrayValue.index"><code>index</code></a> method by checking whether the position of the string <code>"actor"</code> is greater than zero:</p>
<div id="c7f296bc" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="annotated-cell-8" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-8-1">actor_index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ents.primary_profession.index(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"actor"</span>)</span>
<span id="annotated-cell-8-2">not_primarily_actors <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> actor_index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="1">1</button><span id="annotated-cell-8-3" class="code-annotation-target">not_primarily_actors.mean()</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-8" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="3" data-code-annotation="1">The average of a <code>bool</code> column gives the percentage of <code>True</code> values</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div class="ansi-escaped-output">
<pre><span class="ansi-cyan-fg ansi-bold">0.019416901585524518</span></pre>
</div>
</div>
</div>
<p>Who are they?</p>
<div id="d91d5c0b" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">ents[not_primarily_actors]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> nconst     </span>┃<span style="font-weight: bold"> primary_name      </span>┃<span style="font-weight: bold"> primary_profession                </span>┃<span style="font-weight: bold"> known_for_titles                     </span>┃
┡━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                        │
├────────────┼───────────────────┼───────────────────────────────────┼──────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">nm4130226 </span> │ <span style="color: #008000; text-decoration-color: #008000">Brian Castleforte</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'animation_department'</span>, <span style="color: #008000; text-decoration-color: #008000">'actor'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt6565702'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0379786'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span>   │
│ <span style="color: #008000; text-decoration-color: #008000">nm8393678 </span> │ <span style="color: #008000; text-decoration-color: #008000">Vincent Bonduau  </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'animation_department'</span>, <span style="color: #008000; text-decoration-color: #008000">'actor'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt1807824'</span><span style="font-weight: bold">]</span>                        │
│ <span style="color: #008000; text-decoration-color: #008000">nm14260828</span> │ <span style="color: #008000; text-decoration-color: #008000">Brian Nurken     </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'animation_department'</span>, <span style="color: #008000; text-decoration-color: #008000">'actor'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt23752664'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt23772766'</span><span style="font-weight: bold">]</span>         │
│ <span style="color: #008000; text-decoration-color: #008000">nm4683360 </span> │ <span style="color: #008000; text-decoration-color: #008000">Youngmin Yoon    </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'animation_department'</span>, <span style="color: #008000; text-decoration-color: #008000">'actor'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt2063592'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0206512'</span><span style="font-weight: bold">]</span>           │
│ <span style="color: #008000; text-decoration-color: #008000">nm3549362 </span> │ <span style="color: #008000; text-decoration-color: #008000">Rundeep Khaira   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'animation_department'</span>, <span style="color: #008000; text-decoration-color: #008000">'actor'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt8801880'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt10468754'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span>  │
│ <span style="color: #008000; text-decoration-color: #008000">nm4797828 </span> │ <span style="color: #008000; text-decoration-color: #008000">Sandria Dajani   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'animation_department'</span>, <span style="color: #008000; text-decoration-color: #008000">'actor'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt13614758'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt11714502'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm9568757 </span> │ <span style="color: #008000; text-decoration-color: #008000">Katsuki Fukuda   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'animation_department'</span>, <span style="color: #008000; text-decoration-color: #008000">'actor'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt9179096'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt9203780'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>   │
│ <span style="color: #008000; text-decoration-color: #008000">nm14460434</span> │ <span style="color: #008000; text-decoration-color: #008000">Akuago220        </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'animation_department'</span>, <span style="color: #008000; text-decoration-color: #008000">'actor'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt26241684'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt26241620'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm3707489 </span> │ <span style="color: #008000; text-decoration-color: #008000">Sejin Lee        </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'animation_department'</span>, <span style="color: #008000; text-decoration-color: #008000">'actor'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt1554501'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt4612828'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>   │
│ <span style="color: #008000; text-decoration-color: #008000">nm5427775 </span> │ <span style="color: #008000; text-decoration-color: #008000">Man Yee Wong     </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'animation_department'</span>, <span style="color: #008000; text-decoration-color: #008000">'actor'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt6726818'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt2355236'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>   │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                    │
└────────────┴───────────────────┴───────────────────────────────────┴──────────────────────────────────────┘
</pre>
</div>
</div>
<p>It’s not 100% clear whether the order of elements in <code>primary_profession</code> matters here.</p>
</section>
<section id="containment" class="level3">
<h3 class="anchored" data-anchor-id="containment">Containment</h3>
<p>We can get people who are <strong>not</strong> actors using <code>contains</code>:</p>
<div id="f1a185d8" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1">non_actors <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ents[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>ents.primary_profession.contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"actor"</span>)]</span>
<span id="cb9-2">non_actors</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> nconst    </span>┃<span style="font-weight: bold"> primary_name               </span>┃<span style="font-weight: bold"> primary_profession </span>┃<span style="font-weight: bold"> known_for_titles                     </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                        │
├───────────┼────────────────────────────┼────────────────────┼──────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">nm7150442</span> │ <span style="color: #008000; text-decoration-color: #008000">Amelia Fay Robinson       </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'actress'</span><span style="font-weight: bold">]</span>        │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt13481164'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt13465802'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm7165224</span> │ <span style="color: #008000; text-decoration-color: #008000">Isabel Gregory            </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'actress'</span><span style="font-weight: bold">]</span>        │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt4443854'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt4496070'</span><span style="font-weight: bold">]</span>           │
│ <span style="color: #008000; text-decoration-color: #008000">nm7178372</span> │ <span style="color: #008000; text-decoration-color: #008000">Stephanie Antia           </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'actress'</span><span style="font-weight: bold">]</span>        │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt4511160'</span><span style="font-weight: bold">]</span>                        │
│ <span style="color: #008000; text-decoration-color: #008000">nm7185484</span> │ <span style="color: #008000; text-decoration-color: #008000">Roberta Fjelsted Rasmussen</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'actress'</span><span style="font-weight: bold">]</span>        │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt1973692'</span><span style="font-weight: bold">]</span>                        │
│ <span style="color: #008000; text-decoration-color: #008000">nm7207148</span> │ <span style="color: #008000; text-decoration-color: #008000">Vinti Idnani              </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'actress'</span><span style="font-weight: bold">]</span>        │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt4193556'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt1949650'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span>   │
│ <span style="color: #008000; text-decoration-color: #008000">nm7226395</span> │ <span style="color: #008000; text-decoration-color: #008000">Ezgi Geles                </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'actress'</span><span style="font-weight: bold">]</span>        │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt4562100'</span><span style="font-weight: bold">]</span>                        │
│ <span style="color: #008000; text-decoration-color: #008000">nm7240877</span> │ <span style="color: #008000; text-decoration-color: #008000">Natalie Mitchell          </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'actress'</span><span style="font-weight: bold">]</span>        │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt4579596'</span><span style="font-weight: bold">]</span>                        │
│ <span style="color: #008000; text-decoration-color: #008000">nm7242240</span> │ <span style="color: #008000; text-decoration-color: #008000">Lea Monique Chavez        </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'actress'</span><span style="font-weight: bold">]</span>        │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt5862516'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt4580910'</span><span style="font-weight: bold">]</span>           │
│ <span style="color: #008000; text-decoration-color: #008000">nm7244117</span> │ <span style="color: #008000; text-decoration-color: #008000">Claire Luger              </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'actress'</span><span style="font-weight: bold">]</span>        │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt2287817'</span><span style="font-weight: bold">]</span>                        │
│ <span style="color: #008000; text-decoration-color: #008000">nm7270151</span> │ <span style="color: #008000; text-decoration-color: #008000">Kitty                     </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'actress'</span><span style="font-weight: bold">]</span>        │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt4461794'</span><span style="font-weight: bold">]</span>                        │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                    │
└───────────┴────────────────────────────┴────────────────────┴──────────────────────────────────────┘
</pre>
</div>
</div>
</section>
<section id="element-removal" class="level3">
<h3 class="anchored" data-anchor-id="element-removal">Element removal</h3>
<p>We can remove elements from arrays too.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<a href="../../reference/expression-collections.html#ibis.expr.types.arrays.ArrayValue.remove"><code>remove()</code></a> does not mutate the underlying data
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<p>Let’s see who only has “actor” in the list of their primary professions:</p>
<div id="5a802a3e" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">ents.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="cb10-2">    [</span>
<span id="cb10-3">        _.primary_profession.length() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb10-4">        _.primary_profession.remove(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"actor"</span>).length() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb10-5">    ]</span>
<span id="cb10-6">)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> nconst    </span>┃<span style="font-weight: bold"> primary_name     </span>┃<span style="font-weight: bold"> primary_profession </span>┃<span style="font-weight: bold"> known_for_titles                   </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                      │
├───────────┼──────────────────┼────────────────────┼────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">nm7149861</span> │ <span style="color: #008000; text-decoration-color: #008000">Max Arnoud      </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'actor'</span><span style="font-weight: bold">]</span>          │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt3385542'</span><span style="font-weight: bold">]</span>                      │
│ <span style="color: #008000; text-decoration-color: #008000">nm7165794</span> │ <span style="color: #008000; text-decoration-color: #008000">Arnaud Charrin  </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'actor'</span><span style="font-weight: bold">]</span>          │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt6441072'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt9120416'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm7166580</span> │ <span style="color: #008000; text-decoration-color: #008000">Dragoslav Curcin</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'actor'</span><span style="font-weight: bold">]</span>          │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt4497928'</span><span style="font-weight: bold">]</span>                      │
│ <span style="color: #008000; text-decoration-color: #008000">nm7172699</span> │ <span style="color: #008000; text-decoration-color: #008000">Guillaume Ferrer</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'actor'</span><span style="font-weight: bold">]</span>          │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt4505204'</span><span style="font-weight: bold">]</span>                      │
│ <span style="color: #008000; text-decoration-color: #008000">nm7181207</span> │ <span style="color: #008000; text-decoration-color: #008000">Lino Vitale     </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'actor'</span><span style="font-weight: bold">]</span>          │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt2396200'</span><span style="font-weight: bold">]</span>                      │
│ <span style="color: #008000; text-decoration-color: #008000">nm7183738</span> │ <span style="color: #008000; text-decoration-color: #008000">Taia Handlin    </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'actor'</span><span style="font-weight: bold">]</span>          │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt4516616'</span><span style="font-weight: bold">]</span>                      │
│ <span style="color: #008000; text-decoration-color: #008000">nm7189398</span> │ <span style="color: #008000; text-decoration-color: #008000">Attila Gal      </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'actor'</span><span style="font-weight: bold">]</span>          │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt3414510'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt2442080'</span><span style="font-weight: bold">]</span>         │
│ <span style="color: #008000; text-decoration-color: #008000">nm7202327</span> │ <span style="color: #008000; text-decoration-color: #008000">Leonardo Tadeu  </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'actor'</span><span style="font-weight: bold">]</span>          │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt4536560'</span><span style="font-weight: bold">]</span>                      │
│ <span style="color: #008000; text-decoration-color: #008000">nm7213972</span> │ <span style="color: #008000; text-decoration-color: #008000">Michael Davis   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'actor'</span><span style="font-weight: bold">]</span>          │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt4547714'</span><span style="font-weight: bold">]</span>                      │
│ <span style="color: #008000; text-decoration-color: #008000">nm7215705</span> │ <span style="color: #008000; text-decoration-color: #008000">Darryl Daniels  </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'actor'</span><span style="font-weight: bold">]</span>          │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt4549616'</span><span style="font-weight: bold">]</span>                      │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                  │
└───────────┴──────────────────┴────────────────────┴────────────────────────────────────┘
</pre>
</div>
</div>
</section>
<section id="slicing-with-square-bracket-syntax" class="level3">
<h3 class="anchored" data-anchor-id="slicing-with-square-bracket-syntax">Slicing with square-bracket syntax</h3>
<p>Let’s remove everyone’s first profession from the list, but only if they have more than one profession listed:</p>
<div id="bbfac9ce" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">ents[_.primary_profession.length() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].mutate(</span>
<span id="cb11-2">    primary_profession<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.primary_profession[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:],</span>
<span id="cb11-3">)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> nconst     </span>┃<span style="font-weight: bold"> primary_name     </span>┃<span style="font-weight: bold"> primary_profession       </span>┃<span style="font-weight: bold"> known_for_titles                   </span>┃
┡━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                      │
├────────────┼──────────────────┼──────────────────────────┼────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">nm4461143 </span> │ <span style="color: #008000; text-decoration-color: #008000">Sima Gorjestani </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'actress'</span><span style="font-weight: bold">]</span>              │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt10570018'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt1933537'</span><span style="font-weight: bold">]</span>        │
│ <span style="color: #008000; text-decoration-color: #008000">nm3178635 </span> │ <span style="color: #008000; text-decoration-color: #008000">Bing Lei Li     </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'animation_department'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt1527823'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt1311062'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm11878910</span> │ <span style="color: #008000; text-decoration-color: #008000">Wang Yu         </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'animation_department'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt17067176'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt13051266'</span><span style="font-weight: bold">]</span>       │
│ <span style="color: #008000; text-decoration-color: #008000">nm0878047 </span> │ <span style="color: #008000; text-decoration-color: #008000">Jack Turpin     </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'animation_department'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt5377482'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0249683'</span><span style="font-weight: bold">]</span>         │
│ <span style="color: #008000; text-decoration-color: #008000">nm9844243 </span> │ <span style="color: #008000; text-decoration-color: #008000">Alaa Alamri     </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'animation_department'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt8426318'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt12326056'</span><span style="font-weight: bold">]</span>        │
│ <span style="color: #008000; text-decoration-color: #008000">nm3878112 </span> │ <span style="color: #008000; text-decoration-color: #008000">Rodney Baker    </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'animation_department'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt1638935'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt1667135'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm10066507</span> │ <span style="color: #008000; text-decoration-color: #008000">Matthew Creed   </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'animation_department'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt8881470'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt26342009'</span><span style="font-weight: bold">]</span>        │
│ <span style="color: #008000; text-decoration-color: #008000">nm4429144 </span> │ <span style="color: #008000; text-decoration-color: #008000">Cisko Vandeverre</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'animation_department'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt3104592'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt1908523'</span><span style="font-weight: bold">]</span>         │
│ <span style="color: #008000; text-decoration-color: #008000">nm2024311 </span> │ <span style="color: #008000; text-decoration-color: #008000">Oliver Morales  </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'animation_department'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0477716'</span><span style="font-weight: bold">]</span>                      │
│ <span style="color: #008000; text-decoration-color: #008000">nm10216453</span> │ <span style="color: #008000; text-decoration-color: #008000">Alister Fell    </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'animation_department'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt9177850'</span><span style="font-weight: bold">]</span>                      │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                  │
└────────────┴──────────────────┴──────────────────────────┴────────────────────────────────────┘
</pre>
</div>
</div>
</section>
</section>
<section id="set-operations-and-sorting" class="level2">
<h2 class="anchored" data-anchor-id="set-operations-and-sorting">Set operations and sorting</h2>
<p>Treating arrays as sets is possible with the <a href="../../reference/expression-collections.html#ibis.expr.types.arrays.ArrayValue.union"><code>union</code></a> and <a href="../../reference/expression-collections.html#ibis.expr.types.arrays.ArrayValue.intersect"><code>intersect</code></a> APIs.</p>
<p>Let’s take a look at <code>intersect</code>:</p>
<section id="intersection" class="level3">
<h3 class="anchored" data-anchor-id="intersection">Intersection</h3>
<p>Let’s see if we can use array intersection to figure which actors share known-for titles and sort the result:</p>
<div id="6a04967e" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1">left <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ents.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(_.known_for_titles.length() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>).limit(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10_000</span>)</span>
<span id="cb12-2">right <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> left.view()</span>
<span id="cb12-3">shared_titles <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb12-4">    left</span>
<span id="cb12-5">    .join(right, left.nconst <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> right.nconst)</span>
<span id="cb12-6">    .select(</span>
<span id="cb12-7">        s.startswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"known_for_titles"</span>),</span>
<span id="cb12-8">        left_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"primary_name"</span>,</span>
<span id="cb12-9">        right_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"primary_name_right"</span>,</span>
<span id="cb12-10">    )</span>
<span id="cb12-11">    .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(_.known_for_titles.intersect(_.known_for_titles_right).length() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb12-12">    .group_by(name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left_name"</span>)</span>
<span id="cb12-13">    .agg(together_with<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.right_name.collect())</span>
<span id="cb12-14">    .mutate(together_with<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.together_with.unique().sort())</span>
<span id="cb12-15">)</span>
<span id="cb12-16">shared_titles</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> name                </span>┃<span style="font-weight: bold"> together_with                                    </span>┃
┡━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>              │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                                    │
├─────────────────────┼──────────────────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">Juan Manuel Urtubey</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Adrián Ventura'</span>, <span style="color: #008000; text-decoration-color: #008000">'Carlos Gallardo'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6</span><span style="font-weight: bold">]</span>    │
│ <span style="color: #008000; text-decoration-color: #008000">Too Too            </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Hainan Liu'</span>, <span style="color: #008000; text-decoration-color: #008000">'Zhao Xianfei'</span><span style="font-weight: bold">]</span>                   │
│ <span style="color: #008000; text-decoration-color: #008000">Elizabeth Daughtry </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Angela DiPentima'</span>, <span style="color: #008000; text-decoration-color: #008000">'Anthony Coard'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">12</span><span style="font-weight: bold">]</span>   │
│ <span style="color: #008000; text-decoration-color: #008000">Marc               </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Ava'</span>, <span style="color: #008000; text-decoration-color: #008000">'Clint Sanner'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6</span><span style="font-weight: bold">]</span>                  │
│ <span style="color: #008000; text-decoration-color: #008000">Geoffrey Devereux  </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Rex Chaston'</span><span style="font-weight: bold">]</span>                                  │
│ <span style="color: #008000; text-decoration-color: #008000">Philippe Gandilhon </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Claude Leicher'</span>, <span style="color: #008000; text-decoration-color: #008000">'Fabrice Leste'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">8</span><span style="font-weight: bold">]</span>      │
│ <span style="color: #008000; text-decoration-color: #008000">Pete Freeman       </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Monica Iken'</span>, <span style="color: #008000; text-decoration-color: #008000">'Roberta Prisco'</span><span style="font-weight: bold">]</span>                │
│ <span style="color: #008000; text-decoration-color: #008000">Vivian Murray      </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Alice Seifullan'</span>, <span style="color: #008000; text-decoration-color: #008000">'Andre Lowe'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">12</span><span style="font-weight: bold">]</span>       │
│ <span style="color: #008000; text-decoration-color: #008000">Patrick Bahnken    </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Adele Springsteen'</span>, <span style="color: #008000; text-decoration-color: #008000">'Alexander Sich'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">73</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Robin Eames        </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Adele Springsteen'</span>, <span style="color: #008000; text-decoration-color: #008000">'Alexander Sich'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">73</span><span style="font-weight: bold">]</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                │
└─────────────────────┴──────────────────────────────────────────────────┘
</pre>
</div>
</div>
</section>
</section>
<section id="advanced-operations" class="level2">
<h2 class="anchored" data-anchor-id="advanced-operations">Advanced operations</h2>
<section id="flatten-arrays-into-rows" class="level3">
<h3 class="anchored" data-anchor-id="flatten-arrays-into-rows">Flatten arrays into rows</h3>
<p>Thanks to the <a href="https://github.com/tobymao/sqlglot/commit/06e0869e7aa5714d77e6ec763da38d6a422965fa">tireless efforts</a> of the <a href="https://github.com/tobymao/sqlglot/graphs/contributors">folks</a> working on <a href="https://github.com/tobymao/sqlglot"><code>sqlglot</code></a>, as of version 7.0.0 Ibis supports <a href="../../reference/expression-collections.html#ibis.expr.types.arrays.ArrayValue.unnest"><code>unnest</code></a> for BigQuery!</p>
<p>You can use it standalone on a column expression:</p>
<div id="8dd09a8d" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1">ents.primary_profession.unnest()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> primary_profession </span>┃
┡━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>             │
├────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │
│ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │
│ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │
│ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │
│ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │
│ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │
│ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │
│ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │
│ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │
│ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                  │
└────────────────────┘
</pre>
</div>
</div>
<p>You can also use it in <code>select</code>/<code>mutate</code> calls to expand the table accordingly:</p>
<div id="69f0a3df" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1">ents.mutate(primary_profession<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.primary_profession.unnest())</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> nconst    </span>┃<span style="font-weight: bold"> primary_name     </span>┃<span style="font-weight: bold"> primary_profession </span>┃<span style="font-weight: bold"> known_for_titles                   </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                      │
├───────────┼──────────────────┼────────────────────┼────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">nm7149861</span> │ <span style="color: #008000; text-decoration-color: #008000">Max Arnoud      </span> │ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt3385542'</span><span style="font-weight: bold">]</span>                      │
│ <span style="color: #008000; text-decoration-color: #008000">nm7165794</span> │ <span style="color: #008000; text-decoration-color: #008000">Arnaud Charrin  </span> │ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt6441072'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt9120416'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm7166580</span> │ <span style="color: #008000; text-decoration-color: #008000">Dragoslav Curcin</span> │ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt4497928'</span><span style="font-weight: bold">]</span>                      │
│ <span style="color: #008000; text-decoration-color: #008000">nm7172699</span> │ <span style="color: #008000; text-decoration-color: #008000">Guillaume Ferrer</span> │ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt4505204'</span><span style="font-weight: bold">]</span>                      │
│ <span style="color: #008000; text-decoration-color: #008000">nm7181207</span> │ <span style="color: #008000; text-decoration-color: #008000">Lino Vitale     </span> │ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt2396200'</span><span style="font-weight: bold">]</span>                      │
│ <span style="color: #008000; text-decoration-color: #008000">nm7183738</span> │ <span style="color: #008000; text-decoration-color: #008000">Taia Handlin    </span> │ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt4516616'</span><span style="font-weight: bold">]</span>                      │
│ <span style="color: #008000; text-decoration-color: #008000">nm7189398</span> │ <span style="color: #008000; text-decoration-color: #008000">Attila Gal      </span> │ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt3414510'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt2442080'</span><span style="font-weight: bold">]</span>         │
│ <span style="color: #008000; text-decoration-color: #008000">nm7202327</span> │ <span style="color: #008000; text-decoration-color: #008000">Leonardo Tadeu  </span> │ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt4536560'</span><span style="font-weight: bold">]</span>                      │
│ <span style="color: #008000; text-decoration-color: #008000">nm7213972</span> │ <span style="color: #008000; text-decoration-color: #008000">Michael Davis   </span> │ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt4547714'</span><span style="font-weight: bold">]</span>                      │
│ <span style="color: #008000; text-decoration-color: #008000">nm7215705</span> │ <span style="color: #008000; text-decoration-color: #008000">Darryl Daniels  </span> │ <span style="color: #008000; text-decoration-color: #008000">actor             </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt4549616'</span><span style="font-weight: bold">]</span>                      │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                  │
└───────────┴──────────────────┴────────────────────┴────────────────────────────────────┘
</pre>
</div>
</div>
<p>Unnesting can be useful when joining nested data.</p>
<p>Here we use unnest to find people known for any of the godfather movies:</p>
<div id="c668bd07" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="annotated-cell-16" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><button class="code-annotation-anchor" data-target-cell="annotated-cell-16" data-target-annotation="1">1</button><span id="annotated-cell-16-1" class="code-annotation-target">basics <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> con.tables.title_basics.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="annotated-cell-16-2">    [</span>
<span id="annotated-cell-16-3">        _.title_type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"movie"</span>,</span>
<span id="annotated-cell-16-4">        _.original_title.lower().startswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"the godfather"</span>),</span>
<span id="annotated-cell-16-5">        _.genres.lower().contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"crime"</span>),</span>
<span id="annotated-cell-16-6">    ]</span>
<span id="annotated-cell-16-7">)</span>
<span id="annotated-cell-16-8"></span>
<span id="annotated-cell-16-9">known_for_the_godfather <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-16" data-target-annotation="2">2</button><span id="annotated-cell-16-10" class="code-annotation-target">    ents.mutate(tconst<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.known_for_titles.unnest())</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-16" data-target-annotation="3">3</button><span id="annotated-cell-16-11" class="code-annotation-target">    .join(basics, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tconst"</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-16" data-target-annotation="4">4</button><span id="annotated-cell-16-12" class="code-annotation-target">    .select(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"primary_title"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"primary_name"</span>)</span>
<span id="annotated-cell-16-13">    .distinct()</span>
<span id="annotated-cell-16-14">    .order_by([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"primary_title"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"primary_name"</span>])</span>
<span id="annotated-cell-16-15">)</span>
<span id="annotated-cell-16-16">known_for_the_godfather</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-16" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-16" data-code-lines="1,7" data-code-annotation="1">Filter the <code>title_basics</code> data set to only the Godfather movies</span>
</dd>
<dt data-target-cell="annotated-cell-16" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-16" data-code-lines="10" data-code-annotation="2">Unnest the <code>known_for_titles</code> array column</span>
</dd>
<dt data-target-cell="annotated-cell-16" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-16" data-code-lines="11" data-code-annotation="3">Join with <code>basics</code> to get movie titles</span>
</dd>
<dt data-target-cell="annotated-cell-16" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-16" data-code-lines="12,14" data-code-annotation="4">Ensure that each entity is only listed once and sort the results</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> primary_title </span>┃<span style="font-weight: bold"> primary_name        </span>┃
┡━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>              │
├───────────────┼─────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather</span> │ <span style="color: #008000; text-decoration-color: #008000">A. Emmett Adams    </span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather</span> │ <span style="color: #008000; text-decoration-color: #008000">Abe Vigoda         </span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather</span> │ <span style="color: #008000; text-decoration-color: #008000">Al Lettieri        </span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather</span> │ <span style="color: #008000; text-decoration-color: #008000">Al Martino         </span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather</span> │ <span style="color: #008000; text-decoration-color: #008000">Al Pacino          </span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather</span> │ <span style="color: #008000; text-decoration-color: #008000">Albert S. Ruddy    </span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather</span> │ <span style="color: #008000; text-decoration-color: #008000">Alex Rocco         </span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather</span> │ <span style="color: #008000; text-decoration-color: #008000">Andrea Eastman     </span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather</span> │ <span style="color: #008000; text-decoration-color: #008000">Angelo Infanti     </span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather</span> │ <span style="color: #008000; text-decoration-color: #008000">Anna Hill Johnstone</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                   │
└───────────────┴─────────────────────┘
</pre>
</div>
</div>
<p>Let’s summarize by showing how many people are known for each Godfather movie:</p>
<div id="a669b2ae" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1">known_for_the_godfather.primary_title.value_counts()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> primary_title          </span>┃<span style="font-weight: bold"> primary_title_count </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>               │
├────────────────────────┼─────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather Part II </span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">113</span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather Part III</span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">199</span> │
│ <span style="color: #008000; text-decoration-color: #008000">The Godfather         </span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">97</span> │
└────────────────────────┴─────────────────────┘
</pre>
</div>
</div>
</section>
<section id="filtering-array-elements" class="level3">
<h3 class="anchored" data-anchor-id="filtering-array-elements">Filtering array elements</h3>
<p>Filtering array elements can be done with the <a href="../../reference/expression-collections.html#ibis.expr.types.arrays.ArrayValue.filter"><code>filter</code></a> method, which applies a predicate to each array element and returns an array of elements for which the predicate returns <code>True</code>.</p>
<p>This method is similar to Python’s <a href="https://docs.python.org/3.7/library/functions.html#filter"><code>filter</code></a> function.</p>
<p>Let’s show all people who are neither editors nor actors:</p>
<div id="02d2ec3b" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="annotated-cell-18" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-18-1">ents.mutate(</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-18" data-target-annotation="1">1</button><span id="annotated-cell-18-2" class="code-annotation-target">    primary_profession<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.primary_profession.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="annotated-cell-18-3">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> pp: <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>pp.isin((<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"actor"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"editor"</span>))</span>
<span id="annotated-cell-18-4">    )</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-18" data-target-annotation="2">2</button><span id="annotated-cell-18-5" class="code-annotation-target">).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(_.primary_profession.length() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-18" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-18" data-code-lines="2" data-code-annotation="1">This <code>filter</code> call is applied to each array element</span>
</dd>
<dt data-target-cell="annotated-cell-18" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-18" data-code-lines="5" data-code-annotation="2">This <code>filter</code> call is applied to the table</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> nconst     </span>┃<span style="font-weight: bold"> primary_name          </span>┃<span style="font-weight: bold"> primary_profession       </span>┃<span style="font-weight: bold"> known_for_titles                    </span>┃
┡━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                       │
├────────────┼───────────────────────┼──────────────────────────┼─────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">nm8193687 </span> │ <span style="color: #008000; text-decoration-color: #008000">Mandl Cho            </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'animation_department'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt5782050'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt5792070'</span><span style="font-weight: bold">]</span>          │
│ <span style="color: #008000; text-decoration-color: #008000">nm1894548 </span> │ <span style="color: #008000; text-decoration-color: #008000">Frederic Cabral      </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'animation_department'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0414853'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0265223'</span><span style="font-weight: bold">]</span>          │
│ <span style="color: #008000; text-decoration-color: #008000">nm5810804 </span> │ <span style="color: #008000; text-decoration-color: #008000">Yukio Narita         </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'animation_department'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt1375678'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt8339440'</span><span style="font-weight: bold">]</span>          │
│ <span style="color: #008000; text-decoration-color: #008000">nm6194234 </span> │ <span style="color: #008000; text-decoration-color: #008000">Noc                  </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'animation_department'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0084904'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt4916874'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>  │
│ <span style="color: #008000; text-decoration-color: #008000">nm11022011</span> │ <span style="color: #008000; text-decoration-color: #008000">Shea Lawrence        </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'animation_department'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0297607'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt10954022'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm11160130</span> │ <span style="color: #008000; text-decoration-color: #008000">Tim Steeman          </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'animation_department'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt11158166'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt21401568'</span><span style="font-weight: bold">]</span>        │
│ <span style="color: #008000; text-decoration-color: #008000">nm0547493 </span> │ <span style="color: #008000; text-decoration-color: #008000">Philippe Marin       </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'animation_department'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt0071653'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0367288'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>  │
│ <span style="color: #008000; text-decoration-color: #008000">nm13967963</span> │ <span style="color: #008000; text-decoration-color: #008000">Christopher O'Connell</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'animation_department'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt6283598'</span><span style="font-weight: bold">]</span>                       │
│ <span style="color: #008000; text-decoration-color: #008000">nm5216032 </span> │ <span style="color: #008000; text-decoration-color: #008000">Jorge Cereijo        </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'animation_department'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt2304694'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt3010976'</span><span style="font-weight: bold">]</span>          │
│ <span style="color: #008000; text-decoration-color: #008000">nm6381330 </span> │ <span style="color: #008000; text-decoration-color: #008000">William Harris       </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'animation_department'</span><span style="font-weight: bold">]</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt3916088'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt3621408'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>  │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                   │
└────────────┴───────────────────────┴──────────────────────────┴─────────────────────────────────────┘
</pre>
</div>
</div>
</section>
<section id="applying-a-function-to-array-elements" class="level3">
<h3 class="anchored" data-anchor-id="applying-a-function-to-array-elements">Applying a function to array elements</h3>
<p>You can apply a function to run an ibis expression on each element of an array using the <a href="../../reference/expression-collections.html#ibis.expr.types.arrays.ArrayValue.map"><code>map</code></a> method.</p>
<p>Let’s normalize the case of primary_profession to upper case:</p>
<div id="91efce5b" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1">ents.mutate(</span>
<span id="cb16-2">    primary_profession<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.primary_profession.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">map</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> pp: pp.upper())</span>
<span id="cb16-3">).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(_.primary_profession.length() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> nconst    </span>┃<span style="font-weight: bold"> primary_name       </span>┃<span style="font-weight: bold"> primary_profession </span>┃<span style="font-weight: bold"> known_for_titles                   </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>                      │
├───────────┼────────────────────┼────────────────────┼────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">nm7145114</span> │ <span style="color: #008000; text-decoration-color: #008000">Andrés León       </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'ACTOR'</span><span style="font-weight: bold">]</span>          │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt1831897'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt0315638'</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">nm7146648</span> │ <span style="color: #008000; text-decoration-color: #008000">Eric Hunter       </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'ACTOR'</span><span style="font-weight: bold">]</span>          │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt4473584'</span><span style="font-weight: bold">]</span>                      │
│ <span style="color: #008000; text-decoration-color: #008000">nm7162932</span> │ <span style="color: #008000; text-decoration-color: #008000">Karsten Wolf      </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'ACTOR'</span><span style="font-weight: bold">]</span>          │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt4493476'</span><span style="font-weight: bold">]</span>                      │
│ <span style="color: #008000; text-decoration-color: #008000">nm7189102</span> │ <span style="color: #008000; text-decoration-color: #008000">Nagibe Chader     </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'ACTOR'</span><span style="font-weight: bold">]</span>          │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt5487218'</span>, <span style="color: #008000; text-decoration-color: #008000">'tt4513020'</span><span style="font-weight: bold">]</span>         │
│ <span style="color: #008000; text-decoration-color: #008000">nm7213059</span> │ <span style="color: #008000; text-decoration-color: #008000">Alberto Tofoletti </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'ACTOR'</span><span style="font-weight: bold">]</span>          │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt2333598'</span><span style="font-weight: bold">]</span>                      │
│ <span style="color: #008000; text-decoration-color: #008000">nm7213261</span> │ <span style="color: #008000; text-decoration-color: #008000">Gianni Rojas      </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'ACTOR'</span><span style="font-weight: bold">]</span>          │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt2333598'</span><span style="font-weight: bold">]</span>                      │
│ <span style="color: #008000; text-decoration-color: #008000">nm7219361</span> │ <span style="color: #008000; text-decoration-color: #008000">Danny Mendes      </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'ACTOR'</span><span style="font-weight: bold">]</span>          │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt4553846'</span><span style="font-weight: bold">]</span>                      │
│ <span style="color: #008000; text-decoration-color: #008000">nm7232029</span> │ <span style="color: #008000; text-decoration-color: #008000">Sabin Rich        </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'ACTOR'</span><span style="font-weight: bold">]</span>          │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt4568740'</span><span style="font-weight: bold">]</span>                      │
│ <span style="color: #008000; text-decoration-color: #008000">nm7233638</span> │ <span style="color: #008000; text-decoration-color: #008000">Jorge José do Lana</span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'ACTOR'</span><span style="font-weight: bold">]</span>          │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt1999221'</span><span style="font-weight: bold">]</span>                      │
│ <span style="color: #008000; text-decoration-color: #008000">nm7236648</span> │ <span style="color: #008000; text-decoration-color: #008000">Joe Mulgrew       </span> │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'ACTOR'</span><span style="font-weight: bold">]</span>          │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'tt2318795'</span><span style="font-weight: bold">]</span>                      │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                  │
└───────────┴────────────────────┴────────────────────┴────────────────────────────────────┘
</pre>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Ibis has a sizable collection of array APIs that work with many different backends and as of version 7.0.0, Ibis supports a much larger set of those APIs for BigQuery!</p>
<p>Check out <a href="../../reference/expression-collections.html#ibis.expr.types.arrays.ArrayValue">the API documentation</a> for the full set of available methods.</p>
<p>Try it out, and let us know what you think.</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>blog</category>
  <category>bigquery</category>
  <category>arrays</category>
  <category>cloud</category>
  <guid>https://ibis-project.org/posts/bigquery-arrays/</guid>
  <pubDate>Tue, 12 Sep 2023 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Icy IO: loading local files with Snowflake</title>
  <dc:creator>Phillip Cloud</dc:creator>
  <link>https://ibis-project.org/posts/snowflake-io/</link>
  <description><![CDATA[ 





<section id="loading-files-without-ibis" class="level2">
<h2 class="anchored" data-anchor-id="loading-files-without-ibis">Loading files without Ibis</h2>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/KFz4pbCqtQU" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<p>It can be challenging to load local files into Snowflake from Python.</p>
<p>Here’s how to load a CSV file into Snowflake without Ibis.</p>
<div class="sourceCode" id="annotated-cell-1" style="background: #f1f3f5;"><pre class="sourceCode sql code-annotation-code code-with-copy code-annotated"><code class="sourceCode sql"><button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="1">1</button><span id="annotated-cell-1-1" class="code-annotation-target"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">CREATE</span> TEMP STAGE load_csv_stage;</span>
<span id="annotated-cell-1-2"></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="2">2</button><span id="annotated-cell-1-3" class="code-annotation-target"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">CREATE</span> TEMP <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FILE</span> FORMAT load_csv_format</span>
<span id="annotated-cell-1-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">TYPE</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> CSV PARSE_HEADER <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">TRUE</span>;</span>
<span id="annotated-cell-1-5"></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="3">3</button><span id="annotated-cell-1-6" class="code-annotation-target">PUT <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'file:///path/to/my.csv'</span> @load_csv_stage;</span>
<span id="annotated-cell-1-7"></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="4">4</button><span id="annotated-cell-1-8" class="code-annotation-target"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">CREATE</span> TEMP <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">TABLE</span> my_table</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="5">5</button><span id="annotated-cell-1-9" class="code-annotation-target"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">USING</span> TEMPLATE (</span>
<span id="annotated-cell-1-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span> ARRAY_AGG(OBJECT_CONSTRUCT(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>))</span>
<span id="annotated-cell-1-11">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">TABLE</span>(</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="6">6</button><span id="annotated-cell-1-12" class="code-annotation-target">        INFER_SCHEMA(</span>
<span id="annotated-cell-1-13">            LOCATION <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=&gt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'@load_csv_stage'</span>,</span>
<span id="annotated-cell-1-14">            FILE_FORMAT <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=&gt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'load_csv_format'</span></span>
<span id="annotated-cell-1-15">        )</span>
<span id="annotated-cell-1-16">    )</span>
<span id="annotated-cell-1-17">);</span>
<span id="annotated-cell-1-18"></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="7">7</button><span id="annotated-cell-1-19" class="code-annotation-target"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">COPY</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">INTO</span> my_table</span>
<span id="annotated-cell-1-20"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> @load_csv_stage</span>
<span id="annotated-cell-1-21">FILE_FORMAT <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">TYPE</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> CSV SKIP_HEADER <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>);</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-1" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="1" data-code-annotation="1"><strong>Creates a temporary <a href="https://docs.snowflake.com/en/sql-reference/sql/create-stage">stage</a> in Snowflake.</strong> Stages are locations in Snowflake that hold files. They can be used to store raw files to load into tables. <code>TEMP</code> stages are only accessible to the current session and will be dropped when the session ends.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="3,4" data-code-annotation="2"><strong>A <a href="https://docs.snowflake.com/en/sql-reference/sql/create-file-format">file format</a> is a set of instructions for how to interpret a file.</strong> File formats are where you specify <a href="https://docs.snowflake.com/sql-reference/sql/create-file-format#type-csv">parsing</a> and some loading options for your files.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="6" data-code-annotation="3"><strong><a href="https://docs.snowflake.com/en/sql-reference/sql/put"><code>PUT</code></a> copies a file or glob pattern</strong> matching one or more files to a stage.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="8,17" data-code-annotation="4"><strong>Creates a temporary table</strong> with schema inferred using Snowflake’s <a href="https://docs.snowflake.com/en/sql-reference/functions/infer_schema"><code>INFER_SCHEMA</code></a> <a href="https://docs.snowflake.com/en/sql-reference/functions-table">table function</a>.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="9" data-code-annotation="5"><strong><a href="https://docs.snowflake.com/sql-reference/sql/create-table#create-table-using-template"><code>USING TEMPLATE</code></a> is a Snowflake-specific syntax</strong> that allows you to specify a set of column definitions computed from staged files.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="12,15" data-code-annotation="6"><strong><a href="https://docs.snowflake.com/en/sql-reference/functions/infer_schema"><code>INFER_SCHEMA</code></a></strong> is a powerful feature of Snowflake that allows you to load files without having to compute the schema in client code.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="19,21" data-code-annotation="7"><strong><a href="https://docs.snowflake.com/en/sql-reference/sql/copy-into-table"><code>COPY INTO</code></a> loads the staged data</strong> into the created temporary table.</span>
</dd>
</dl>
<p>Snowflake provides the full set of primitives required to achieve this, but composing them together can be challenging. Some users struggle to remember the sequence of steps.</p>
</section>
<section id="loading-files-with-ibis" class="level2">
<h2 class="anchored" data-anchor-id="loading-files-with-ibis">Loading files with Ibis</h2>
<p>Let’s take a look at how ibis turns the above process into a <strong>single line</strong> of Python.</p>
<p>First, we connect to snowflake:</p>
<div id="0c2dcca9" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> ibis.interactive <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb1-3"></span>
<span id="cb1-4">con <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>(os.environ[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SNOWFLAKE_URL"</span>])</span></code></pre></div>
</div>
<section id="read_csv" class="level3">
<h3 class="anchored" data-anchor-id="read_csv"><code>read_csv</code></h3>
<p>Loading CSV files is now a single line of familiar Python code:</p>
<div id="3ed91053" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">diamonds <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> con.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"diamonds.csv"</span>)</span>
<span id="cb2-2">diamonds</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> carat         </span>┃<span style="font-weight: bold"> cut       </span>┃<span style="font-weight: bold"> color  </span>┃<span style="font-weight: bold"> clarity </span>┃<span style="font-weight: bold"> depth         </span>┃<span style="font-weight: bold"> table         </span>┃<span style="font-weight: bold"> price </span>┃<span style="font-weight: bold"> x             </span>┃<span style="font-weight: bold"> y             </span>┃<span style="font-weight: bold"> z             </span>┃
┡━━━━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">decimal(3, 2)</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">decimal(3, 1)</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">decimal(3, 1)</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">decimal(4, 2)</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">decimal(4, 2)</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">decimal(4, 2)</span> │
├───────────────┼───────────┼────────┼─────────┼───────────────┼───────────────┼───────┼───────────────┼───────────────┼───────────────┤
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.23</span> │ <span style="color: #008000; text-decoration-color: #008000">Ideal    </span> │ <span style="color: #008000; text-decoration-color: #008000">E     </span> │ <span style="color: #008000; text-decoration-color: #008000">SI2    </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">61.5</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">55.0</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">326</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.95</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.98</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.43</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.21</span> │ <span style="color: #008000; text-decoration-color: #008000">Premium  </span> │ <span style="color: #008000; text-decoration-color: #008000">E     </span> │ <span style="color: #008000; text-decoration-color: #008000">SI1    </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">59.8</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">61.0</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">326</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.89</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.84</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.31</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.23</span> │ <span style="color: #008000; text-decoration-color: #008000">Good     </span> │ <span style="color: #008000; text-decoration-color: #008000">E     </span> │ <span style="color: #008000; text-decoration-color: #008000">VS1    </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">56.9</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">65.0</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">327</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.05</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.07</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.31</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.29</span> │ <span style="color: #008000; text-decoration-color: #008000">Premium  </span> │ <span style="color: #008000; text-decoration-color: #008000">I     </span> │ <span style="color: #008000; text-decoration-color: #008000">VS2    </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">62.4</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">58.0</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">334</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.20</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.23</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.63</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.31</span> │ <span style="color: #008000; text-decoration-color: #008000">Good     </span> │ <span style="color: #008000; text-decoration-color: #008000">J     </span> │ <span style="color: #008000; text-decoration-color: #008000">SI2    </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">63.3</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">58.0</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">335</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.34</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.35</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.75</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.24</span> │ <span style="color: #008000; text-decoration-color: #008000">Very Good</span> │ <span style="color: #008000; text-decoration-color: #008000">J     </span> │ <span style="color: #008000; text-decoration-color: #008000">VVS2   </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">62.8</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">57.0</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">336</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.94</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.96</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.48</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.24</span> │ <span style="color: #008000; text-decoration-color: #008000">Very Good</span> │ <span style="color: #008000; text-decoration-color: #008000">I     </span> │ <span style="color: #008000; text-decoration-color: #008000">VVS1   </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">62.3</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">57.0</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">336</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.95</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.98</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.47</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.26</span> │ <span style="color: #008000; text-decoration-color: #008000">Very Good</span> │ <span style="color: #008000; text-decoration-color: #008000">H     </span> │ <span style="color: #008000; text-decoration-color: #008000">SI1    </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">61.9</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">55.0</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">337</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.07</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.11</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.53</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.22</span> │ <span style="color: #008000; text-decoration-color: #008000">Fair     </span> │ <span style="color: #008000; text-decoration-color: #008000">E     </span> │ <span style="color: #008000; text-decoration-color: #008000">VS2    </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">65.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">61.0</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">337</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.87</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.78</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.49</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.23</span> │ <span style="color: #008000; text-decoration-color: #008000">Very Good</span> │ <span style="color: #008000; text-decoration-color: #008000">H     </span> │ <span style="color: #008000; text-decoration-color: #008000">VS1    </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">59.4</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">61.0</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">338</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.00</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.05</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.39</span> │
│             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>       │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │     <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└───────────────┴───────────┴────────┴─────────┴───────────────┴───────────────┴───────┴───────────────┴───────────────┴───────────────┘
</pre>
</div>
</div>
</section>
<section id="read_parquet" class="level3">
<h3 class="anchored" data-anchor-id="read_parquet"><code>read_parquet</code></h3>
<p>Similarly, loading Parquet files is now a single line of code:</p>
<div id="0fca1621" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">diamonds <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> con.read_parquet(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"diamonds.parquet"</span>)</span>
<span id="cb3-2">diamonds</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━┳━━━━━━━┳━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━┓
┃<span style="font-weight: bold"> carat   </span>┃<span style="font-weight: bold"> cut       </span>┃<span style="font-weight: bold"> color  </span>┃<span style="font-weight: bold"> clarity </span>┃<span style="font-weight: bold"> depth   </span>┃<span style="font-weight: bold"> table   </span>┃<span style="font-weight: bold"> price </span>┃<span style="font-weight: bold"> x       </span>┃<span style="font-weight: bold"> y       </span>┃<span style="font-weight: bold"> z       </span>┃
┡━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━╇━━━━━━━╇━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span> │
├─────────┼───────────┼────────┼─────────┼─────────┼─────────┼───────┼─────────┼─────────┼─────────┤
│    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.23</span> │ <span style="color: #008000; text-decoration-color: #008000">Ideal    </span> │ <span style="color: #008000; text-decoration-color: #008000">E     </span> │ <span style="color: #008000; text-decoration-color: #008000">SI2    </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">61.5</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">55.0</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">326</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.95</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.98</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.43</span> │
│    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.21</span> │ <span style="color: #008000; text-decoration-color: #008000">Premium  </span> │ <span style="color: #008000; text-decoration-color: #008000">E     </span> │ <span style="color: #008000; text-decoration-color: #008000">SI1    </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">59.8</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">61.0</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">326</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.89</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.84</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.31</span> │
│    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.23</span> │ <span style="color: #008000; text-decoration-color: #008000">Good     </span> │ <span style="color: #008000; text-decoration-color: #008000">E     </span> │ <span style="color: #008000; text-decoration-color: #008000">VS1    </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">56.9</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">65.0</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">327</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.05</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.07</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.31</span> │
│    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.29</span> │ <span style="color: #008000; text-decoration-color: #008000">Premium  </span> │ <span style="color: #008000; text-decoration-color: #008000">I     </span> │ <span style="color: #008000; text-decoration-color: #008000">VS2    </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">62.4</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">58.0</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">334</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.20</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.23</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.63</span> │
│    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.31</span> │ <span style="color: #008000; text-decoration-color: #008000">Good     </span> │ <span style="color: #008000; text-decoration-color: #008000">J     </span> │ <span style="color: #008000; text-decoration-color: #008000">SI2    </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">63.3</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">58.0</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">335</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.34</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.35</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.75</span> │
│    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.24</span> │ <span style="color: #008000; text-decoration-color: #008000">Very Good</span> │ <span style="color: #008000; text-decoration-color: #008000">J     </span> │ <span style="color: #008000; text-decoration-color: #008000">VVS2   </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">62.8</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">57.0</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">336</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.94</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.96</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.48</span> │
│    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.24</span> │ <span style="color: #008000; text-decoration-color: #008000">Very Good</span> │ <span style="color: #008000; text-decoration-color: #008000">I     </span> │ <span style="color: #008000; text-decoration-color: #008000">VVS1   </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">62.3</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">57.0</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">336</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.95</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.98</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.47</span> │
│    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.26</span> │ <span style="color: #008000; text-decoration-color: #008000">Very Good</span> │ <span style="color: #008000; text-decoration-color: #008000">H     </span> │ <span style="color: #008000; text-decoration-color: #008000">SI1    </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">61.9</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">55.0</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">337</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.07</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.11</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.53</span> │
│    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.22</span> │ <span style="color: #008000; text-decoration-color: #008000">Fair     </span> │ <span style="color: #008000; text-decoration-color: #008000">E     </span> │ <span style="color: #008000; text-decoration-color: #008000">VS2    </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">65.1</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">61.0</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">337</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.87</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.78</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.49</span> │
│    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.23</span> │ <span style="color: #008000; text-decoration-color: #008000">Very Good</span> │ <span style="color: #008000; text-decoration-color: #008000">H     </span> │ <span style="color: #008000; text-decoration-color: #008000">VS1    </span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">59.4</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">61.0</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">338</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.00</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.05</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.39</span> │
│       <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>       │       <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │       <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │     <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │       <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │       <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │       <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└─────────┴───────────┴────────┴─────────┴─────────┴─────────┴───────┴─────────┴─────────┴─────────┘
</pre>
</div>
</div>
</section>
<section id="read_json" class="level3">
<h3 class="anchored" data-anchor-id="read_json"><code>read_json</code></h3>
<p>Lastly, loading JSON files is now – surprise 🥳 – a single line of code!</p>
<p>Line delimited JSON is supported:</p>
<div id="2de5539d" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">diamonds <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> con.read_json(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"diamonds.ndjson"</span>)</span>
<span id="cb4-2">diamonds</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> carat         </span>┃<span style="font-weight: bold"> clarity </span>┃<span style="font-weight: bold"> color  </span>┃<span style="font-weight: bold"> cut       </span>┃<span style="font-weight: bold"> depth         </span>┃<span style="font-weight: bold"> price </span>┃<span style="font-weight: bold"> table         </span>┃<span style="font-weight: bold"> x             </span>┃<span style="font-weight: bold"> y             </span>┃<span style="font-weight: bold"> z             </span>┃
┡━━━━━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">decimal(3, 2)</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">decimal(3, 1)</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">decimal(3, 1)</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">decimal(4, 2)</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">decimal(4, 2)</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">decimal(4, 2)</span> │
├───────────────┼─────────┼────────┼───────────┼───────────────┼───────┼───────────────┼───────────────┼───────────────┼───────────────┤
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.23</span> │ <span style="color: #008000; text-decoration-color: #008000">SI2    </span> │ <span style="color: #008000; text-decoration-color: #008000">E     </span> │ <span style="color: #008000; text-decoration-color: #008000">Ideal    </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">61.5</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">326</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">55.0</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.95</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.98</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.43</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.21</span> │ <span style="color: #008000; text-decoration-color: #008000">SI1    </span> │ <span style="color: #008000; text-decoration-color: #008000">E     </span> │ <span style="color: #008000; text-decoration-color: #008000">Premium  </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">59.8</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">326</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">61.0</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.89</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.84</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.31</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.23</span> │ <span style="color: #008000; text-decoration-color: #008000">VS1    </span> │ <span style="color: #008000; text-decoration-color: #008000">E     </span> │ <span style="color: #008000; text-decoration-color: #008000">Good     </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">56.9</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">327</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">65.0</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.05</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.07</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.31</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.29</span> │ <span style="color: #008000; text-decoration-color: #008000">VS2    </span> │ <span style="color: #008000; text-decoration-color: #008000">I     </span> │ <span style="color: #008000; text-decoration-color: #008000">Premium  </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">62.4</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">334</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">58.0</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.20</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.23</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.63</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.31</span> │ <span style="color: #008000; text-decoration-color: #008000">SI2    </span> │ <span style="color: #008000; text-decoration-color: #008000">J     </span> │ <span style="color: #008000; text-decoration-color: #008000">Good     </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">63.3</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">335</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">58.0</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.34</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.35</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.75</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.24</span> │ <span style="color: #008000; text-decoration-color: #008000">VVS2   </span> │ <span style="color: #008000; text-decoration-color: #008000">J     </span> │ <span style="color: #008000; text-decoration-color: #008000">Very Good</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">62.8</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">336</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">57.0</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.94</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.96</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.48</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.24</span> │ <span style="color: #008000; text-decoration-color: #008000">VVS1   </span> │ <span style="color: #008000; text-decoration-color: #008000">I     </span> │ <span style="color: #008000; text-decoration-color: #008000">Very Good</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">62.3</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">336</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">57.0</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.95</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.98</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.47</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.26</span> │ <span style="color: #008000; text-decoration-color: #008000">SI1    </span> │ <span style="color: #008000; text-decoration-color: #008000">H     </span> │ <span style="color: #008000; text-decoration-color: #008000">Very Good</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">61.9</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">337</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">55.0</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.07</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.11</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.53</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.22</span> │ <span style="color: #008000; text-decoration-color: #008000">VS2    </span> │ <span style="color: #008000; text-decoration-color: #008000">E     </span> │ <span style="color: #008000; text-decoration-color: #008000">Fair     </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">65.1</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">337</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">61.0</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.87</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.78</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.49</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.23</span> │ <span style="color: #008000; text-decoration-color: #008000">VS1    </span> │ <span style="color: #008000; text-decoration-color: #008000">H     </span> │ <span style="color: #008000; text-decoration-color: #008000">Very Good</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">59.4</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">338</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">61.0</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.00</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.05</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.39</span> │
│             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │     <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└───────────────┴─────────┴────────┴───────────┴───────────────┴───────┴───────────────┴───────────────┴───────────────┴───────────────┘
</pre>
</div>
</div>
<p>As well as strict JSON arrays of objects:</p>
<div id="6c6e0552" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">diamonds <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> con.read_json(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"diamonds.json"</span>)</span>
<span id="cb5-2">diamonds</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> carat         </span>┃<span style="font-weight: bold"> clarity </span>┃<span style="font-weight: bold"> color  </span>┃<span style="font-weight: bold"> cut       </span>┃<span style="font-weight: bold"> depth         </span>┃<span style="font-weight: bold"> price </span>┃<span style="font-weight: bold"> table         </span>┃<span style="font-weight: bold"> x             </span>┃<span style="font-weight: bold"> y             </span>┃<span style="font-weight: bold"> z             </span>┃
┡━━━━━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">decimal(3, 2)</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">decimal(3, 1)</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">decimal(3, 1)</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">decimal(4, 2)</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">decimal(4, 2)</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">decimal(4, 2)</span> │
├───────────────┼─────────┼────────┼───────────┼───────────────┼───────┼───────────────┼───────────────┼───────────────┼───────────────┤
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.23</span> │ <span style="color: #008000; text-decoration-color: #008000">SI2    </span> │ <span style="color: #008000; text-decoration-color: #008000">E     </span> │ <span style="color: #008000; text-decoration-color: #008000">Ideal    </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">61.5</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">326</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">55.0</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.95</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.98</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.43</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.21</span> │ <span style="color: #008000; text-decoration-color: #008000">SI1    </span> │ <span style="color: #008000; text-decoration-color: #008000">E     </span> │ <span style="color: #008000; text-decoration-color: #008000">Premium  </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">59.8</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">326</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">61.0</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.89</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.84</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.31</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.23</span> │ <span style="color: #008000; text-decoration-color: #008000">VS1    </span> │ <span style="color: #008000; text-decoration-color: #008000">E     </span> │ <span style="color: #008000; text-decoration-color: #008000">Good     </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">56.9</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">327</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">65.0</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.05</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.07</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.31</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.29</span> │ <span style="color: #008000; text-decoration-color: #008000">VS2    </span> │ <span style="color: #008000; text-decoration-color: #008000">I     </span> │ <span style="color: #008000; text-decoration-color: #008000">Premium  </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">62.4</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">334</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">58.0</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.20</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.23</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.63</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.31</span> │ <span style="color: #008000; text-decoration-color: #008000">SI2    </span> │ <span style="color: #008000; text-decoration-color: #008000">J     </span> │ <span style="color: #008000; text-decoration-color: #008000">Good     </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">63.3</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">335</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">58.0</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.34</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.35</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.75</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.24</span> │ <span style="color: #008000; text-decoration-color: #008000">VVS2   </span> │ <span style="color: #008000; text-decoration-color: #008000">J     </span> │ <span style="color: #008000; text-decoration-color: #008000">Very Good</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">62.8</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">336</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">57.0</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.94</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.96</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.48</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.24</span> │ <span style="color: #008000; text-decoration-color: #008000">VVS1   </span> │ <span style="color: #008000; text-decoration-color: #008000">I     </span> │ <span style="color: #008000; text-decoration-color: #008000">Very Good</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">62.3</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">336</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">57.0</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.95</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.98</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.47</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.26</span> │ <span style="color: #008000; text-decoration-color: #008000">SI1    </span> │ <span style="color: #008000; text-decoration-color: #008000">H     </span> │ <span style="color: #008000; text-decoration-color: #008000">Very Good</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">61.9</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">337</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">55.0</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.07</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.11</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.53</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.22</span> │ <span style="color: #008000; text-decoration-color: #008000">VS2    </span> │ <span style="color: #008000; text-decoration-color: #008000">E     </span> │ <span style="color: #008000; text-decoration-color: #008000">Fair     </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">65.1</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">337</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">61.0</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.87</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.78</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.49</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.23</span> │ <span style="color: #008000; text-decoration-color: #008000">VS1    </span> │ <span style="color: #008000; text-decoration-color: #008000">H     </span> │ <span style="color: #008000; text-decoration-color: #008000">Very Good</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">59.4</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">338</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">61.0</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.00</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.05</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.39</span> │
│             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │     <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└───────────────┴─────────┴────────┴───────────┴───────────────┴───────┴───────────────┴───────────────┴───────────────┴───────────────┘
</pre>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Ibis 7.0.0 adds support for <a href="../../backends/snowflake.html#ibis.backends.snowflake.Backend.read_csv"><code>read_csv</code></a>, <a href="../../backends/snowflake.html#ibis.backends.snowflake.Backend.read_parquet"><code>read_parquet</code></a> and <a href="../../backends/snowflake.html#ibis.backends.snowflake.Backend.read_json"><code>read_json</code></a> to the Snowflake backend.</p>
<p>We think you’ll enjoy the increase in productivity these new features bring to the Snowflake backend and we’d love to hear your feedback!</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>blog</category>
  <category>snowflake</category>
  <category>io</category>
  <category>productivity</category>
  <guid>https://ibis-project.org/posts/snowflake-io/</guid>
  <pubDate>Thu, 31 Aug 2023 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Ibis v6.1.0</title>
  <dc:creator>Ibis team</dc:creator>
  <link>https://ibis-project.org/posts/v6.1.0-release/</link>
  <description><![CDATA[ 





<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>Ibis 6.1.0 is a minor release that includes new features, backend improvements, bug fixes, documentation improvements, and refactors. We are excited to see further adoption of the dataframe interchange protocol enabling visualization and other libraries to be used more easily with Ibis.</p>
<p>You can view the full changelog in <a href="../../release_notes.html">the release notes</a>.</p>
<p>If you’re new to Ibis, see <a href="../../install.html">how to install</a> and <a href="../../tutorials/getting_started.html">the getting started tutorial</a>.</p>
<p>To follow along with this blog, ensure you’re on <code>'ibis-framework&gt;=6.1,&lt;7'</code>. First, we'll setup Ibis and fetch some sample data to use.</p>
<div id="24a6b50e" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis.selectors <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> s</span>
<span id="cb1-3"></span>
<span id="cb1-4">ibis.__version__</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>'6.1.0'</code></pre>
</div>
</div>
<div id="4e2c9e69" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># interactive mode for demo purposes</span></span>
<span id="cb3-2">ibis.options.interactive <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span></code></pre></div>
</div>
<div id="866d8631" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.examples.penguins.fetch()</span>
<span id="cb4-2">t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> t.mutate(year<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>t[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>].cast(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"str"</span>))</span>
<span id="cb4-3">t.limit(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━┓
┃<span style="font-weight: bold"> species </span>┃<span style="font-weight: bold"> island    </span>┃<span style="font-weight: bold"> bill_length_mm </span>┃<span style="font-weight: bold"> bill_depth_mm </span>┃<span style="font-weight: bold"> flipper_length_mm </span>┃<span style="font-weight: bold"> body_mass_g </span>┃<span style="font-weight: bold"> sex    </span>┃<span style="font-weight: bold"> year   </span>┃
┡━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │
├─────────┼───────────┼────────────────┼───────────────┼───────────────────┼─────────────┼────────┼────────┤
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.7</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3750</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.5</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17.4</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">186</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3800</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.3</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.0</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3250</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │
└─────────┴───────────┴────────────────┴───────────────┴───────────────────┴─────────────┴────────┴────────┘
</pre>
</div>
</div>
</section>
<section id="ecosystem-integrations" class="level2">
<h2 class="anchored" data-anchor-id="ecosystem-integrations">Ecosystem integrations</h2>
<p>With the introduction of <code>__dataframe__</code> support in v6.0.0 and efficiency improvements in this release, Ibis now works with <a href="https://altair-viz.github.io/index.html">Altair</a>, <a href="https://plotly.com/python/">Plotly</a>, <a href="https://plotnine.readthedocs.io/en/stable/">plotnine</a>, and any other visualization library that implements the protocol. This enables passing Ibis tables directly to visualization libraries without a <code>.to_pandas()</code> or <code>to_pyarrow()</code> call for any of the 15+ backends supported, with data efficiently transferred through Apache Arrow.</p>
<div id="cc0a2a10" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="annotated-cell-4" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="1">1</button><span id="annotated-cell-4-1" class="code-annotation-target">width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">640</span></span>
<span id="annotated-cell-4-2">height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">480</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-4" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="1,2" data-code-annotation="1">Set the width and height of the plots.</span>
</dd>
</dl>
</div>
</div>
<div id="71cadaa6" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="annotated-cell-5" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="1">1</button><span id="annotated-cell-5-1" class="code-annotation-target">grouped <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="annotated-cell-5-2">    t.group_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"species"</span>)</span>
<span id="annotated-cell-5-3">    .aggregate(count<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ibis._.count())</span>
<span id="annotated-cell-5-4">    .order_by(ibis.desc(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span>))</span>
<span id="annotated-cell-5-5">)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="2">2</button><span id="annotated-cell-5-6" class="code-annotation-target">grouped</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-5" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="1,5" data-code-annotation="1">Setup data to plot.</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="6" data-code-annotation="2">Display the table.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━┓
┃<span style="font-weight: bold"> species   </span>┃<span style="font-weight: bold"> count </span>┃
┡━━━━━━━━━━━╇━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span> │
├───────────┼───────┤
│ <span style="color: #008000; text-decoration-color: #008000">Adelie   </span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">152</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Gentoo   </span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">124</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Chinstrap</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">68</span> │
└───────────┴───────┘
</pre>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" aria-controls="tabset-1-1" aria-selected="true">Altair</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" aria-controls="tabset-1-2" aria-selected="false">Plotly</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" aria-controls="tabset-1-3" aria-selected="false">plotnine</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" aria-labelledby="tabset-1-1-tab">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install altair</span></code></pre></div>
<div id="d7bb57e9" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="annotated-cell-24" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy"><code class="sourceCode python"><span id="annotated-cell-24-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> altair <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> alt</span>
<span id="annotated-cell-24-2"></span>
<span id="annotated-cell-24-3">chart <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="annotated-cell-24-4">    alt.Chart(grouped)</span>
<span id="annotated-cell-24-5">    .mark_bar()</span>
<span id="annotated-cell-24-6">    .encode(</span>
<span id="annotated-cell-24-7">        x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"species"</span>,</span>
<span id="annotated-cell-24-8">        y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span>,</span>
<span id="annotated-cell-24-9">    )</span>
<span id="annotated-cell-24-10">    .properties(width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>width, height<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>height)</span>
<span id="annotated-cell-24-11">)</span>
<span id="annotated-cell-24-12">chart</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>ExpressionError: Use .count() instead</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>alt.Chart(...)</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" aria-labelledby="tabset-1-2-tab">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install plotly</span></code></pre></div>
<div id="bedde087" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="annotated-cell-28" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy"><code class="sourceCode python"><span id="annotated-cell-28-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> plotly.express <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> px</span>
<span id="annotated-cell-28-2"></span>
<span id="annotated-cell-28-3">px.bar(</span>
<span id="annotated-cell-28-4">    grouped.to_pandas(),</span>
<span id="annotated-cell-28-5">    x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"species"</span>,</span>
<span id="annotated-cell-28-6">    y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span>,</span>
<span id="annotated-cell-28-7">    width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>width,</span>
<span id="annotated-cell-28-8">    height<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>height,</span>
<span id="annotated-cell-28-9">)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>                            <div id="b37509bc-a479-4263-89e5-f183f999e8cd" class="plotly-graph-div" style="height:480px; width:640px;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("b37509bc-a479-4263-89e5-f183f999e8cd")) {                    Plotly.newPlot(                        "b37509bc-a479-4263-89e5-f183f999e8cd",                        [{"alignmentgroup":"True","hovertemplate":"species=%{x}\u003cbr\u003ecount=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"","offsetgroup":"","orientation":"v","showlegend":false,"textposition":"auto","x":["Adelie","Gentoo","Chinstrap"],"xaxis":"x","y":[152,124,68],"yaxis":"y","type":"bar"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"species"}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"count"}},"legend":{"tracegroupgap":0},"margin":{"t":60},"barmode":"relative","height":480,"width":640},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('b37509bc-a479-4263-89e5-f183f999e8cd');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" aria-labelledby="tabset-1-3-tab">
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install plotnine</span></code></pre></div>
<div id="e04b7abe" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> plotnine <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ggplot, aes, geom_bar, theme</span>
<span id="cb10-2"></span>
<span id="cb10-3">(</span>
<span id="cb10-4">    ggplot(</span>
<span id="cb10-5">        grouped,</span>
<span id="cb10-6">        aes(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"species"</span>, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span>),</span>
<span id="cb10-7">    )</span>
<span id="cb10-8">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> geom_bar(stat<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span>)</span>
<span id="cb10-9">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> theme(figure_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>))</span>
<span id="cb10-10">)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://ibis-project.org/posts/v6.1.0-release/index_files/figure-html/cell-9-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>A more modular, composable, and scalable way of working with data is taking shape with <code>__dataframe__</code> and <code>__array__</code> support in Ibis and increasingly the Python data ecosystem. Let's combine the above with PCA after some preprocessing in Ibis to visualize all numeric columns in 2D.</p>
<div id="7810cfc2" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="annotated-cell-6" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="1">1</button><span id="annotated-cell-6-1" class="code-annotation-target"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis.selectors <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> s</span>
<span id="annotated-cell-6-2"></span>
<span id="annotated-cell-6-3"></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="2">2</button><span id="annotated-cell-6-4" class="code-annotation-target"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> transform(t):</span>
<span id="annotated-cell-6-5">    t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> t.mutate(</span>
<span id="annotated-cell-6-6">        s.across(s.numeric(), {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"zscore"</span>: <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> x: (x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x.mean()) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> x.std()})</span>
<span id="annotated-cell-6-7">    ).dropna()</span>
<span id="annotated-cell-6-8">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> t</span>
<span id="annotated-cell-6-9"></span>
<span id="annotated-cell-6-10"></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="3">3</button><span id="annotated-cell-6-11" class="code-annotation-target">f <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> transform(t)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="4">4</button><span id="annotated-cell-6-12" class="code-annotation-target">f</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-6" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="1" data-code-annotation="1">Import the selectors module.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="4,5,6,7,8" data-code-annotation="2">Define a function to transform the table for code reuse (compute z-scores on numeric columns).</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="11" data-code-annotation="3">Apply the function to the table and assign it to a new variable.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="12" data-code-annotation="4">Display the transformed table.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> species </span>┃<span style="font-weight: bold"> island    </span>┃<span style="font-weight: bold"> bill_length_mm </span>┃<span style="font-weight: bold"> bill_depth_mm </span>┃<span style="font-weight: bold"> flipper_length_mm </span>┃<span style="font-weight: bold"> body_mass_g </span>┃<span style="font-weight: bold"> sex    </span>┃<span style="font-weight: bold"> year   </span>┃<span style="font-weight: bold"> bill_length_mm_zscore </span>┃<span style="font-weight: bold"> bill_depth_mm_zscore </span>┃<span style="font-weight: bold"> flipper_length_mm_zscore </span>┃<span style="font-weight: bold"> body_mass_g_zscore </span>┃
┡━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>              │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>                  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>            │
├─────────┼───────────┼────────────────┼───────────────┼───────────────────┼─────────────┼────────┼────────┼───────────────────────┼──────────────────────┼──────────────────────────┼────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.7</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3750</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.883205</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.784300</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.416272</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.563317</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.5</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17.4</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">186</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3800</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.809939</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.126003</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.060696</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.500969</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.3</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.0</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3250</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.663408</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.429833</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.420660</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.186793</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">36.7</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">19.3</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">193</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3450</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.322799</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.088129</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.562890</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.937403</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.3</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20.6</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">190</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3650</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.846572</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.746426</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.776236</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.688012</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">38.9</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17.8</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3625</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.919837</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.328556</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.416272</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.719186</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.2</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">19.6</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4675</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.864888</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.240044</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.420660</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.590115</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">41.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17.6</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">182</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3200</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.516876</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.227280</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.345156</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.249141</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">38.6</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21.2</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">191</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3800</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.974787</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.050255</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.705121</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.500969</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">34.6</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21.1</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">198</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4400</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.707443</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.999617</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.207315</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.247203</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │                     <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                    <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                        <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                  <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└─────────┴───────────┴────────────────┴───────────────┴───────────────────┴─────────────┴────────┴────────┴───────────────────────┴──────────────────────┴──────────────────────────┴────────────────────┘
</pre>
</div>
</div>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install scikit-learn</span></code></pre></div>
<div id="7812e59f" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="annotated-cell-8" style="background: #f1f3f5;"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><button class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="1">1</button><span id="annotated-cell-8-1" class="code-annotation-target"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> plotly.express <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> px</span>
<span id="annotated-cell-8-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.decomposition <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> PCA</span>
<span id="annotated-cell-8-3"></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="2">2</button><span id="annotated-cell-8-4" class="code-annotation-target">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f.select(s.contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"zscore"</span>))</span>
<span id="annotated-cell-8-5"></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="3">3</button><span id="annotated-cell-8-6" class="code-annotation-target">n_components <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="annotated-cell-8-7">pca <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> PCA(n_components<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>n_components).fit(X)</span>
<span id="annotated-cell-8-8"></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="4">4</button><span id="annotated-cell-8-9" class="code-annotation-target">t_pca <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.memtable(pca.transform(X)).relabel(</span>
<span id="annotated-cell-8-10">    {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"col0"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pc1"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"col1"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pc2"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"col2"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pc3"</span>}</span>
<span id="annotated-cell-8-11">)</span>
<span id="annotated-cell-8-12"></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="5">5</button><span id="annotated-cell-8-13" class="code-annotation-target">f <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f.mutate(row_number<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ibis.row_number().over()).join(</span>
<span id="annotated-cell-8-14">    t_pca.mutate(row_number<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ibis.row_number().over()), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"row_number"</span></span>
<span id="annotated-cell-8-15">)</span>
<span id="annotated-cell-8-16"></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="6">6</button><span id="annotated-cell-8-17" class="code-annotation-target">px.scatter_3d(</span>
<span id="annotated-cell-8-18">    f.to_pandas(),</span>
<span id="annotated-cell-8-19">    x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pc1"</span>,</span>
<span id="annotated-cell-8-20">    y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pc2"</span>,</span>
<span id="annotated-cell-8-21">    z<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pc3"</span>,</span>
<span id="annotated-cell-8-22">    color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"species"</span>,</span>
<span id="annotated-cell-8-23">)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-8" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="1,2" data-code-annotation="1">Import data science libraries</span>
</dd>
<dt data-target-cell="annotated-cell-8" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="4" data-code-annotation="2">Select “features” (numeric columns) as X</span>
</dd>
<dt data-target-cell="annotated-cell-8" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="6,7" data-code-annotation="3">Compute PCA</span>
</dd>
<dt data-target-cell="annotated-cell-8" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="9,10,11" data-code-annotation="4">Create a table from the PCA results</span>
</dd>
<dt data-target-cell="annotated-cell-8" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="13,14,15" data-code-annotation="5">Join the PCA results to the original table</span>
</dd>
<dt data-target-cell="annotated-cell-8" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="17,18,19,20,21,22,23" data-code-annotation="6">Plot the results</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display">
<div>                            <div id="d314f10b-ab71-4214-8e83-c562da0277d6" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("d314f10b-ab71-4214-8e83-c562da0277d6")) {                    Plotly.newPlot(                        "d314f10b-ab71-4214-8e83-c562da0277d6",                        [{"hovertemplate":"species=Adelie\u003cbr\u003epc1=%{x}\u003cbr\u003epc2=%{y}\u003cbr\u003epc3=%{z}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"Adelie","marker":{"color":"#636efa","symbol":"circle"},"mode":"markers","name":"Adelie","scene":"scene","showlegend":true,"x":[-1.3138691260427637,-1.378630918265439,-1.8839844056788373,-1.9134406656399912,-1.7691713222603629,-0.8105470540897982,-1.7974036882002518,-1.9481949228797064,-1.5621664787299547,-1.745718527942345,-1.5752354005905727,-0.7953185129178546,-2.3487959420791156,-2.1081622392315484,-1.8530508458444208,-1.5004866095648766,-1.5772862684672722,-1.9245247435390693,-1.7581470019394885,-2.708309167780973,-1.673946976975034,-1.8789672773626795,-1.904413891569045,-1.6568283203236207,-1.5115283537861695,-1.4510769091809697,-1.4326708743397192,-1.6279369014900253,-2.402798772785781,-1.1269209704971839,-2.295639206974038,-0.9697219819784466,-0.5707266824003372,-2.0135576152407135,-0.8724654120280445,-1.9238199612761107,-1.7836004376089105,-1.3987692798573221,-1.1392379319307866,-1.8669512336889065,-0.7830855544259319,-2.450212231152599,-1.2611471144714745,-1.217401942705769,-2.2617494344689955,-1.521301147360894,-2.0186160654905367,-1.1263492697251736,-1.570454131122968,-0.9238576189375951,-2.2479380500804873,-0.9108526130398376,-1.3480977043684428,-1.8061304250511885,-0.5859535722379992,-2.109750496771035,-1.2657963988850958,-1.0287249407938681,-0.3995366047354037,-1.5727238659708762,-0.5820900244389923,-0.941070533866609,-1.920412960016839,-1.4589463680431267,-0.9331822156668959,-0.04210849330231697,-1.5209550882829117,-1.6831344187503627,-1.8391248156095026,-1.8557112261911464,-1.5497113505982594,-1.619461533645183,-1.269305453218963,-0.20018743853187346,-2.0283444420301198,-0.9985925046285808,-1.872276994896654,-0.2633382098001746,-1.577082449779192,-2.5328560769194333,-0.7746804153923569,-1.5958169120021313,-0.37945075556564956,-1.5046925282616792,-2.0048236716438836,-1.8525770066085638,-0.8517124992704438,-1.7123799073560797,-1.984966055911378,-0.205939403964617,-0.63294290950839,-1.4845373441781442,-0.734102142959868,-1.6954924096289123,-0.6298665802725868,-1.8465256053645784,-1.6060642309143263,-1.7374724517903226,-1.6261517314183624,-1.955477247403888,-1.8249390201627262,-0.6708811428802992,-1.8873054902535502,-0.8746002446650297,-1.5695623526635807,-0.6158188668310564,-1.607351909694154,0.06775565376536331,-1.6613047679540631,-1.1324986174269451,-1.680438140677286,-0.7053920337067914,-0.96822929505067,-1.8850526244087447,-1.1053497725786314,-0.8016489158928197,-1.1845478403842975,-1.3649223112345346,-1.9835482130263289,-1.0215968015111836,-1.682311086563663,-1.760985134890843,-1.1066387636925685,-2.0621266060489534,-1.5732922640743234,-0.6173424509708877,-1.847295831821652,-0.9935976778528978,-2.402434193370415,-1.7033176210704057,-1.7273215207957497,-2.3087229609918545,-1.5478044973199843,-1.2338119130168932,-1.787736296880138,-1.5918013005003793,-0.6807242499591375,-1.8044426928226605,-0.7419354881985292,-1.6881211582403295,-1.65770806090851,-1.5591145642433202,-1.3445353749192577,-1.572421212183917,-1.972650576426363,-1.6622992008968143],"y":[-0.4402919798412642,-0.15897830842875235,-0.014236134696754832,0.8135849171805278,-0.3621856813023133,0.4942003712714863,-0.23887121185894436,0.9919691655039661,0.5668876254493836,-0.6080788890866503,0.08570741299948116,1.2853254053667045,-0.6432512917210572,-0.13440083284877552,-0.11148803255880554,-0.288120202061525,-0.5990904182511275,-0.2988085217342182,0.14090326969023434,-0.19514963991507359,0.28664595332631393,-0.7738642854713145,-0.4041697407452686,-0.324420385812166,0.32690162518728316,-0.984701966472308,1.0506551829000268,0.5441833045706372,0.06906224748939238,0.354637217826088,-0.5892602778980115,0.11651636265479545,1.0495767802730134,-0.9903356855762233,0.2083069910848536,0.3455285273021924,-0.6558076860718469,1.4316452122357368,0.2759562851184996,-0.7660113192635546,0.7064071279053272,-0.7912741613515976,0.2442164733567818,0.24609561538371885,-1.180684222685833,0.03193900543675938,-1.119919292758678,1.3047010249039193,-0.8292120371362087,0.08215361633331217,-0.9897686197854588,0.04758067963546717,-1.403821087613807,-1.2269120858554527,0.6802050772338271,-0.4745886018471446,-0.005625872072592686,-0.5307910093495374,0.8920887071341864,-0.8492156613548025,0.40912323761859193,-0.535871427081773,0.12053320566760392,-1.3501832422282671,0.5508408623873554,0.0988775545600112,-0.08187936331173383,-0.5617570639150956,0.05360808233496334,-0.27030865924819447,0.16668180306805835,0.039957008072222154,-0.6372672556739626,0.06706589098292051,-1.203909599924116,-0.0880477480606143,-0.8896610462777425,0.35677178121873515,-0.11963916381915571,-1.7527521697682629,0.4389726319986042,-0.7405619780378807,0.8597044827836087,0.46134190331246006,-0.2118147133558791,0.16273466143478174,-0.6222022116556519,0.47350075266669134,-0.8136079730193982,0.7028409153551975,1.4738675077473193,-0.35085916959308594,0.748418585563911,0.9099085193838786,0.3017712106656422,-0.7823026688594998,0.5659544049012064,-1.0606662095718542,0.1765852981957524,-0.9436191669024362,-0.5580165355942519,0.22192089473640195,-1.5867282522683508,0.3459929985150735,-0.4838461814267719,0.18986487714243855,-0.683712152028217,0.3309557921830949,-0.39169953306488187,0.6560850756343765,-0.32087143665208573,-0.15369975377410303,-0.21383382752555158,-0.8858955562760082,0.7428620581244382,-0.17453734850987315,-0.5191778929891109,-0.42908076293093045,-2.089100238507752,-0.47526160605309986,-0.9962660667735241,0.014342500505876288,0.0517489245698628,-0.3871221827325344,-0.9557728063205654,0.24415854038457532,0.03374901722968265,1.9653409839376674,-0.3038318619768152,-0.18324413958367683,0.2764011352091325,-0.44680285261994007,-0.47791865172379866,0.4484724396703771,-0.18480043992375358,0.9047750161855243,0.142918546260468,-1.2692129215665988,-0.9525861505169197,-0.5480421992674097,-1.11496072829656,-0.6951664525132638,-0.3489739621474796,-0.3358028344818403,-1.1150173127336431,0.30283113199002404],"z":[-0.0290034720348789,0.1927506794962343,-0.6265721193031735,-0.7024774462077622,0.026000359253776667,-1.33838736846389,0.625387456659793,-1.0423991318699894,-2.049488657126064,-0.3653069068602019,-0.36002024394047594,-1.093917853848548,-0.4594314829821335,-0.2750874624574592,-0.8915562432796902,-0.42791115152136416,0.03157998266144219,-0.8636792863169105,0.07401922449916588,0.2354388687527417,-0.2493050195922474,0.6623851970583494,-0.3923864582778642,0.22113893643077984,-0.23154775455847745,-0.10283526651798405,-1.2920776232644806,-0.8528495028199213,-0.21159525316042996,-0.9590596077039683,0.036233584829599076,-0.31659478658254325,-0.5986260840248495,0.39514006508569544,-0.9795715072909277,0.15483183988516389,-0.3550094034333755,-0.867670238232381,-0.6875477014032174,-0.4722482649654631,-0.6084874454011102,-0.11760331788849779,-0.07550545545551936,-0.31981676487535204,0.5788374950067733,-0.7162092509533247,0.13170601908064686,-1.2143786936734449,-0.0003264597451516383,-0.2994055875551011,0.4089253291821366,-0.12333899738664937,-0.05312826132501272,0.21163403650684312,-0.8732091552545741,-0.9980031979412795,-0.36287488228845155,0.045825795575298374,-0.057091438219880705,-0.5118050934346087,-0.3628876952462427,0.2567583923201001,-0.7739102307109963,0.03491555459344715,-0.39021011447703297,-0.5053292782580854,-1.390987665517948,-0.1234039921318906,-0.92634444215301,-0.42197590354037834,-0.7212065016160152,-0.3214818702744886,-0.6843508483491804,-0.6777039550269749,-0.2960707309396463,-0.6503916958167694,-0.04063408774543612,-0.936211106248306,-0.4458571681155306,0.3014058034646582,-0.15535903343243945,-0.7088644567816657,-1.3835204536646337,-1.1921354163786793,0.05470701945931731,-0.11317949436586676,-0.2690540251622018,-0.8861849777347283,0.4390057496421847,-0.84622624095563,-0.6184109339456656,0.25763547846345974,-0.7019653709270627,-0.8905972658629965,-0.2181891893862527,0.5854125986615341,-1.1565878101491875,-0.1041872082174026,0.19995476190994757,0.0921051759646582,0.5643468798145086,-0.3652189991289697,0.3477231188952058,-0.6104987906619149,0.15139753856642618,-0.5088745818488833,0.44995928837664195,-0.1649072326866699,0.030607355407956085,0.04231836861099142,-0.47813017358033777,-1.216935071969819,-0.0032988368726979095,-0.12803539663060423,-0.8943000593327548,-0.562960679023404,0.2985179673922773,0.36740519367695085,0.03807253814101599,0.18791175401382015,0.33627174847093777,-0.242367436449578,-0.7239806824791294,-0.31252951362487563,-0.3167131206938964,-0.42947818759099593,-0.23851311272174924,-0.5856510968460111,0.07074992487582973,0.4072142746708763,0.33292673183489796,-0.1601028139993049,0.07570056952454308,-0.4657089472468683,-0.6778291424752287,-0.39498294762792935,-0.7465370634812292,0.6502102052140758,-0.2146385246617225,0.024452931064140017,0.18594027983717107,-0.4159763177160042,-0.45906757128343945,0.13962025305472292,-0.16555790528288203,-0.7376024402387135],"type":"scatter3d"},{"hovertemplate":"species=Gentoo\u003cbr\u003epc1=%{x}\u003cbr\u003epc2=%{y}\u003cbr\u003epc3=%{z}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"Gentoo","marker":{"color":"#EF553B","symbol":"circle"},"mode":"markers","name":"Gentoo","scene":"scene","showlegend":true,"x":[1.5843321794026255,2.8894401214238212,2.6199782761153574,2.23138939651239,1.5509353213681394,1.4512191413978544,2.021375742967594,1.8116701292356763,1.2763520884373247,2.1706984895712966,1.0304914129694371,2.5235659345351165,0.9003965132637006,3.089121102599238,1.456241693921327,2.4542027088068235,2.8175244246537883,1.7475521805679437,1.6207403461718166,1.8455430792490681,1.779184040202433,1.566285545746695,2.5783387758017104,1.1642759272540364,1.4549630428361546,3.789954136289625,2.1407065959501774,1.5837659028379298,1.1029754696615226,1.7613308005129718,0.6990618768661349,2.7120032582139797,1.238557060687985,1.8908591693466872,2.5811855974475493,1.756000339380918,1.1461674991739963,2.6005211375245705,1.9591596470638388,1.7012171115741066,1.6251842452559235,1.150070632879542,2.4725965826705476,1.8972309872782223,1.7971621810742233,0.9915807857866555,1.8847943794839117,0.9242838999112085,2.7751899272086322,1.0678392556174723,2.210710146438919,1.823105397931332,2.7722833014731374,2.8958494037231435,1.672276275191072,2.819609454229711,1.732492656794695,1.8801038113180177,2.0990003006981253,2.0234368279988173,1.5897040936726425,2.9019060597887516,1.4871596123939042,2.7789440839828514,1.724405944114216,2.3552776514770737,1.7000782785213078,2.6984364213685073,2.4835355030227846,2.6045269638948736,1.473126058365623,2.653847406744264,1.8393663066182835,2.820497883509084,1.935308026938385,2.623682629828514,1.4860967331784645,2.5688686360139457,1.8339242017183925,2.0775489185259723,1.2939306792186702,2.426650037636776,1.9906714748259982,3.0899080203436644,1.7043992667575387,1.9120165017335173,1.0129810990750876,2.6859345852772254,1.1191869607990346,1.976079608644497,2.0978428626150953,3.0844442236421235,2.8767362026715873,1.5709761986054354,3.4781187625267833,1.990841008940614,1.8261456135436391,2.750775295005652,1.7106922518761687,2.0197834966579298,1.5448580234263956,1.1601348131611866,2.5061100387045023,1.3692975399757918,2.31973553608399,2.2284518735648406,2.328349494319942,1.462154797262923,2.5223179263546736,1.4640786042371472,3.374877717475099,1.6071496494744917,1.5767675805590247,2.608260609997255,1.5131717457281708,2.856204193502314,1.1507264677975313,1.6597657504053067,2.689090001633259],"y":[-1.336145797481505,0.4551737493187792,0.009922926361948409,-0.564418000767081,-1.1668566058854186,-0.8220480435711804,-0.3588921307586743,-0.3128897253437064,-1.6935876078920753,0.2481639238382225,-0.8328747018048608,0.14766287474085507,-1.699255931159478,-0.02296457339444988,-0.7745294369623453,-0.20480681479444315,-0.3305293889210595,-0.8764100596577248,-0.21600426728569247,-1.6827361178904718,-0.5154236545406067,-0.6527340202071703,0.03688611033971542,-1.27917354776578,-0.8733188688152191,1.826990264487121,0.24964922784549576,-1.4790628471759428,-1.4206974674490516,0.03428414614689498,-1.560168161851718,0.28934304385180243,-1.2413488163442217,-0.2017268993067078,0.33401725016974027,-1.2921309860840928,-1.1478748243678676,0.320887077132881,-1.3730213934999607,-0.3144264038519615,-0.8465349780272223,-0.972329766399224,-0.12217039397652671,-0.7711554265385012,-0.5194587708501135,-1.3264675521025315,-0.6300253448748927,-1.1372465881032234,0.08170215418960654,-1.2105598509507411,-0.5656139267217918,-0.9467261717576362,0.6345180459700765,0.36873202439953845,-1.2000108804552618,-0.006251417469966367,-0.4111138023709524,-0.2889963994114872,-0.08150911568856914,-0.5826851759732591,-0.5589388975090948,0.18917839285444846,-0.7703372157425964,0.6019235013301685,-1.1701305888886573,-0.012010358901996027,-0.4703492597377133,0.4242891109582265,0.2610412409048032,0.9366186631869756,-1.1399652737230244,-0.2860653729794841,-0.8252582361894758,0.954859295660095,-0.414545745767003,0.9921082523838247,-0.8556814092555569,0.25533631746215163,0.11440971327959933,-0.6478819117239137,-0.5894216364195548,0.6149901690287072,-0.31327920890983685,1.377826178490902,-0.24449256937032124,0.0009719111842412946,-1.198828873343717,0.6082194668489371,-1.3162103181013878,-0.259635298105629,0.0008122398262933692,0.294643216350033,0.6022377111506537,-0.9729314363534757,0.9100623805894708,-0.9742226728452459,-0.7832990085144428,0.2606843654904003,-0.7268681373389891,0.33311513481408794,-0.6918673288939376,-1.5736500003668787,-0.39530203694209554,-0.7772167323429995,-0.31819039089449214,-0.2876586359248224,-0.30016515873383454,0.19773997804787538,-0.634545255287589,-1.1068580192006303,0.6830106197499352,-0.6082976875278455,-1.2037426217760763,0.31385566555833605,-0.8758429938669618,-0.1862193643491106,-0.8030867393680197,-1.1866508952102193,0.30854543561791575],"z":[0.7253109493816123,-0.6930276448711303,-0.2557161654562507,-0.1134226260416448,0.6865879692956024,0.11717636652785357,-0.31077825656032576,-0.21761614451592168,-0.15354293627000637,-0.42430007945408,0.6247025455899065,-0.5408490526299653,0.4550758284367685,-0.8432109499228931,0.2657562542420381,-0.19350217530359984,-0.03682675387900177,-0.11045704383630345,-0.2890828420601117,-0.06436221145226956,-0.1975282924936602,0.6751602903216339,-0.19948143793142992,0.006307022132106913,-0.01517264267372874,0.021400367928482444,-0.4931974673370256,-0.15974739329624985,0.5528795065781595,-0.0922851759418694,0.6748159849252471,-0.5920933244143004,0.6875090700858041,0.4770418242006431,-0.3042294941376953,-0.11507828673674539,0.7415410510075937,-0.24281555931199253,0.08574141300125218,-0.6030847997676325,0.32425463954482775,0.4380354498931833,0.2017932713815646,0.11633572322251304,-0.43731306324417624,0.5012923631859093,-0.25482283968665115,0.189631094072768,-0.2187320149021048,0.7728820771896897,-0.3896234813399782,0.19265830276959497,-0.8250541056613434,-0.7874104915534272,-0.09352760915008358,-0.1018766129563232,0.25428798728967694,-0.29613882088420423,-0.15912455413533608,-0.19257427959119353,0.13888530930240764,-0.8660305219346653,0.6313453553418091,-0.6207466452537291,0.23831621621644394,-1.3467734151729915,0.6856668085130172,0.08594765642152488,-0.24789061767771384,-0.709305187812406,-0.0415942258961658,0.40991446753861366,0.4216241085232469,-0.48781267351772417,0.04973578617372396,-0.3537079382561848,0.1710873019863891,-0.03271758783694564,0.150340703304595,0.05562106146466514,0.7741441167002117,-0.191743142559959,0.22445380131882406,-0.046239780908481444,-0.06290889058428734,-0.6286812024243505,-0.2477709444328614,0.14409637519419502,0.2174140636986588,-0.1598941230897806,0.3540861141637787,-0.7981151460168594,-0.36913798455521885,0.5348936188998373,-0.14098576398054125,0.38151876035769816,0.24330402217509814,-0.42055327291516614,-0.2623021476035196,-0.15815198687423385,0.8882347224945311,0.4606994064988933,-0.3413447917609845,0.5308445271537144,-0.3835927522412481,-0.32705237283315136,0.09964501120904704,-1.051750234023754,0.0702883321537728,0.5508113337127215,-0.038134802494031644,0.3906293222028189,0.2527541489444496,-0.5719885758639462,-0.09667177973986155,-0.33513360138260584,-0.15792143134208678,0.38575582677759673,-0.9017533498725265],"type":"scatter3d"},{"hovertemplate":"species=Chinstrap\u003cbr\u003epc1=%{x}\u003cbr\u003epc2=%{y}\u003cbr\u003epc3=%{z}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"Chinstrap","marker":{"color":"#00cc96","symbol":"circle"},"mode":"markers","name":"Chinstrap","scene":"scene","showlegend":true,"x":[-0.7922291340634333,-0.3830876034150576,-0.5092353378917297,-1.1909882357928185,-0.2979685909593475,-0.32532883339559343,-1.630312005438758,-0.07588612701132406,-0.4646218620068658,-0.4110955934835766,-0.5163238447564241,-0.570006644287163,-0.7783835879757018,0.3726627646748752,-0.7115675786963128,-0.053823411649171655,-0.830881655698697,-0.12552232480535225,-1.0574334834055101,-1.42360032305258,-0.504477974787429,0.09714099881363494,-0.3011560009644012,-0.22963056418156233,-0.6836144768959992,0.5653302059025657,-1.408711984728229,0.18556918917385729,-1.1921504584930007,-0.47468973046869783,0.07379649908343941,0.7345194263189502,-1.0485439492101694,0.6093405670874431,0.14028204413523412,-0.8379360008641674,-0.4687102558817134,-0.531193107846075,-0.14146094957332805,0.4677127065355889,-0.642786741099023,0.4429678260021579,-0.030807415892241626,-0.19177776918847117,0.07291124126833198,-0.6285830133659644,0.02450483190735283,-1.312734451374622,-0.32804957272929086,-0.8523602003912655,-0.1323809468985156,-0.04933492614422982,-0.4521030722196351,0.5585748645252613,-0.7425641605961022,0.4940977224680821,-0.20996469108124424,0.11494465156796488,-1.3941731393547208,-0.6548809779955389,-0.7906559629884697,0.2648185882718398,-0.41727176470559363,-0.9128049931478871,-1.0697331521429922,0.21848851979229952,-0.5051967852593403,-0.36387704921321157],"y":[0.5062581297166108,1.5736204868990158,1.572701393199937,0.7087957658904076,1.9762236561724873,0.3648616356695722,0.5576347634628742,1.1797866811717104,0.9137621384859241,1.8601190360108635,0.5045473679546875,2.071414475329434,0.33665387281747156,1.244749042254718,0.12439317523494318,1.6835986623360737,1.7535257839224074,1.7495442706426882,0.7722491317274098,-0.4366576224526566,1.5897939752483625,1.6156282375807032,1.1408061229416535,1.3087474936088874,0.47301860205189794,2.1445133477711376,-0.6627637468600542,2.5974780209851356,-0.4324798131286293,1.1505204754433214,0.21118322108560195,2.3620095719843857,-0.04622742938251532,2.1768185143584833,1.4705482927024582,0.3248518988776433,1.4797731342173894,0.03429604517676132,1.0078500082945592,1.3100956769677532,0.8935031699423113,1.5431151965694432,0.6453312791227185,0.06375310449631408,1.5319991602831995,0.1857375868368244,1.7462836889189464,-0.1908177851810619,1.4932697470582847,-0.18359316157358044,1.6725526117664105,1.3057033228138317,0.06983424013856651,2.344773441438871,0.2489169719125208,1.481210925124658,1.2624115415882347,1.0072765920385038,-0.18013817441543606,0.5562529858471701,0.5106083113291715,1.4214121089440306,0.8210636917115601,1.355772234777453,1.013877410994056,1.7894042383852025,-0.01142867250000675,0.9939861001670605],"z":[0.8059177398573444,0.5065930944524353,0.9587996287442838,0.5508712911792626,0.8709817241184749,0.24293319714711925,1.110425617718742,1.0357952001194746,-0.0005706051217079257,0.6870989708831381,0.6007737812847641,0.6577659232857794,0.9625559415573041,0.8513849672785146,0.8868616222972509,0.3497906095289973,0.8607436380857291,2.209750851509982,0.7122645926230213,1.2281108428920506,0.72227742426497,0.6480737655823032,1.1080179383437696,0.564421914595567,0.6844147537789913,0.09635249863780232,0.7364144093415783,0.3379463348143881,0.791257324082825,0.9054466576861884,0.7502112672470785,-0.41717061646679326,1.7272433465991668,0.2371432814114684,0.12083496537361814,0.8292681581508066,0.9580259146494652,0.817974396012578,1.126095161999462,0.3277726466174128,1.3350663861735046,-0.1930087271460114,1.0943537797029643,1.3330077180044857,0.6596156950973209,0.751868862407461,0.3184495833469016,0.6609628979022704,1.2330628013444693,1.1373875503416004,0.11088370180846045,0.6568475322697916,0.7469351727015382,0.8655137598847236,0.31942005991767813,0.3294200786018356,0.7632133125522834,0.34156470563606084,0.563418984102101,1.2178106281133227,0.9277872889939099,0.5120550390729138,0.5393530515368564,1.486108007945322,0.3230897172331023,0.5269737854001818,1.0836957912458942,0.8841313360962134],"type":"scatter3d"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"scene":{"domain":{"x":[0.0,1.0],"y":[0.0,1.0]},"xaxis":{"title":{"text":"pc1"}},"yaxis":{"title":{"text":"pc2"}},"zaxis":{"title":{"text":"pc3"}}},"legend":{"title":{"text":"species"},"tracegroupgap":0},"margin":{"t":60}},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('d314f10b-ab71-4214-8e83-c562da0277d6');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
</section>
<section id="backends" class="level2">
<h2 class="anchored" data-anchor-id="backends">Backends</h2>
<p>Numerous backends received improvements. See the <a href="../../release_notes.html">release notes</a> for more details.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" aria-controls="tabset-2-1" aria-selected="true">DataFusion</a></li><li class="nav-item"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" aria-controls="tabset-2-2" aria-selected="false">BigQuery</a></li><li class="nav-item"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" aria-controls="tabset-2-3" aria-selected="false">PySpark</a></li><li class="nav-item"><a class="nav-link" id="tabset-2-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-4" aria-controls="tabset-2-4" aria-selected="false">Trino</a></li><li class="nav-item"><a class="nav-link" id="tabset-2-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-5" aria-controls="tabset-2-5" aria-selected="false">SQLite</a></li><li class="nav-item"><a class="nav-link" id="tabset-2-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-6" aria-controls="tabset-2-6" aria-selected="false">pandas</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" aria-labelledby="tabset-2-1-tab">
<p>The DataFusion backend (and a few others) received several improvements from community member <a href="https://github.com/mesejo">@mesejo</a> with memtables and many new operations now supported. Some highlights include:</p>
<div id="c24f725c" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1">url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.literal(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://ibis-project.org/concepts/why_ibis"</span>)</span>
<span id="cb13-2">con <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.datafusion.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>()</span>
<span id="cb13-3"></span>
<span id="cb13-4">con.execute(url.host())</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>'ibis-project.org'</code></pre>
</div>
</div>
<div id="16d76af6" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1">con.execute(url.path())</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>'/concepts/why_ibis'</code></pre>
</div>
</div>
<div id="f5ee0679" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1">con.execute(ibis.literal(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"aaabbbaaa"</span>).re_search(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bbb"</span>))</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>True</code></pre>
</div>
</div>
<div id="a192e678" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1">con.execute(ibis.literal(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.56</span>).ln())</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>1.715598108262491</code></pre>
</div>
</div>
<div id="87803f17" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1">con.execute(ibis.literal(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.56</span>).log10())</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>0.7450747915820575</code></pre>
</div>
</div>
<div id="ec7d20c1" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1">con.execute(ibis.literal(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.56</span>).radians())</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>0.09704030641088471</code></pre>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" aria-labelledby="tabset-2-2-tab">
<p>Some remaining gaps in <code>CREATE TABLE</code> DDL options for BigQuery have been filled in, including the ability to pass in <code>overwrite=True</code> for table creation.</p>
</div>
<div id="tabset-2-3" class="tab-pane" aria-labelledby="tabset-2-3-tab">
<p>The PySpark backend now supports reading/writing Delta Lake tables. Your PySpark session must be configured to use the Delta Lake package and you must have the <code>delta</code> package installed in your environment.</p>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1">t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.read_delta(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/path/to/delta"</span>)</span>
<span id="cb25-2"></span>
<span id="cb25-3">...</span>
<span id="cb25-4"></span>
<span id="cb25-5">t.to_delta(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/path/to/delta"</span>, mode<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"overwrite"</span>)</span></code></pre></div>
</div>
<div id="tabset-2-4" class="tab-pane" aria-labelledby="tabset-2-4-tab">
<p>The <code>.sql</code> API is now supported in Trino, enabling you to chain Ibis and SQL together.</p>
</div>
<div id="tabset-2-5" class="tab-pane" aria-labelledby="tabset-2-5-tab">
<p>Scalar Python UDFs are now supported in SQLite.</p>
<p>Additionally, URL parsing has been added:</p>
<div id="18842920" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1">con <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.sqlite.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>()</span>
<span id="cb26-2"></span>
<span id="cb26-3">con.execute(url.host())</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>'ibis-project.org'</code></pre>
</div>
</div>
<div id="1953136c" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1">con.execute(url.path())</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>'/concepts/why_ibis'</code></pre>
</div>
</div>
</div>
<div id="tabset-2-6" class="tab-pane" aria-labelledby="tabset-2-6-tab">
<p>URL parsing support was added.</p>
<div id="b2c845b3" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1">con <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.pandas.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>()</span>
<span id="cb30-2"></span>
<span id="cb30-3">con.execute(url.host())</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>'ibis-project.org'</code></pre>
</div>
</div>
<div id="8462ce32" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1">con.execute(url.path())</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>'/concepts/why_ibis'</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="functionality" class="level2">
<h2 class="anchored" data-anchor-id="functionality">Functionality</h2>
<p>Various new features and were added.</p>
<section id="nunique-supported-on-tables" class="level3">
<h3 class="anchored" data-anchor-id="nunique-supported-on-tables"><code>.nunique()</code> supported on tables</h3>
<p>You can now call <code>.nunique()</code> on tables to get the number of unique rows.</p>
<div id="a4b7830c" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># how many unique rows are there? equivalent to `.count()` in this case</span></span>
<span id="cb34-2">t.nunique()</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div class="ansi-escaped-output">
<pre><span class="ansi-cyan-fg ansi-bold">344</span></pre>
</div>
</div>
</div>
<div id="09761376" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># how many unique species/island/year combinations are there?</span></span>
<span id="cb35-2">t.select(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"species"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"island"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>).nunique()</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div class="ansi-escaped-output">
<pre><span class="ansi-cyan-fg ansi-bold">15</span></pre>
</div>
</div>
</div>
</section>
<section id="to_sql-returns-a-str-type" class="level3">
<h3 class="anchored" data-anchor-id="to_sql-returns-a-str-type"><code>to_sql</code> returns a <code>str</code> type</h3>
<p>The <code>ibis.expr.sql.SQLString</code> type resulting from <code>to_sql</code> is now a proper <code>str</code> subclass, enabling use without casting to <code>str</code> first.</p>
<div id="9684a5ea" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">type</span>(ibis.to_sql(t))</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>ibis.expr.sql.SQLString</code></pre>
</div>
</div>
<div id="8bade411" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">issubclass</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">type</span>(ibis.to_sql(t)), <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>True</code></pre>
</div>
</div>
</section>
<section id="allow-mixing-literals-and-columns-in-ibisarray" class="level3">
<h3 class="anchored" data-anchor-id="allow-mixing-literals-and-columns-in-ibisarray">Allow mixing literals and columns in <code>ibis.array</code></h3>
<p>Note that arrays must still be of a single type.</p>
<div id="6bfcdc09" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1">ibis.array([t[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"species"</span>], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hello"</span>])</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> ArrayColumn()       </span>┃
┡━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span>       │
├─────────────────────┤
│ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Adelie'</span>, <span style="color: #008000; text-decoration-color: #008000">'hello'</span><span style="font-weight: bold">]</span> │
│ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Adelie'</span>, <span style="color: #008000; text-decoration-color: #008000">'hello'</span><span style="font-weight: bold">]</span> │
│ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Adelie'</span>, <span style="color: #008000; text-decoration-color: #008000">'hello'</span><span style="font-weight: bold">]</span> │
│ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Adelie'</span>, <span style="color: #008000; text-decoration-color: #008000">'hello'</span><span style="font-weight: bold">]</span> │
│ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Adelie'</span>, <span style="color: #008000; text-decoration-color: #008000">'hello'</span><span style="font-weight: bold">]</span> │
│ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Adelie'</span>, <span style="color: #008000; text-decoration-color: #008000">'hello'</span><span style="font-weight: bold">]</span> │
│ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Adelie'</span>, <span style="color: #008000; text-decoration-color: #008000">'hello'</span><span style="font-weight: bold">]</span> │
│ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Adelie'</span>, <span style="color: #008000; text-decoration-color: #008000">'hello'</span><span style="font-weight: bold">]</span> │
│ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Adelie'</span>, <span style="color: #008000; text-decoration-color: #008000">'hello'</span><span style="font-weight: bold">]</span> │
│ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'Adelie'</span>, <span style="color: #008000; text-decoration-color: #008000">'hello'</span><span style="font-weight: bold">]</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                   │
└─────────────────────┘
</pre>
</div>
</div>
<div id="bbe78626" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb41" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1">ibis.array([t[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"flipper_length_mm"</span>], <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>])</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> ArrayColumn() </span>┃
┡━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;int64&gt;</span>  │
├───────────────┤
│ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">42</span><span style="font-weight: bold">]</span>     │
│ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">186</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">42</span><span style="font-weight: bold">]</span>     │
│ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">42</span><span style="font-weight: bold">]</span>     │
│ <span style="font-weight: bold">[</span><span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">42</span><span style="font-weight: bold">]</span>    │
│ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">193</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">42</span><span style="font-weight: bold">]</span>     │
│ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">190</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">42</span><span style="font-weight: bold">]</span>     │
│ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">42</span><span style="font-weight: bold">]</span>     │
│ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">42</span><span style="font-weight: bold">]</span>     │
│ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">193</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">42</span><span style="font-weight: bold">]</span>     │
│ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">190</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">42</span><span style="font-weight: bold">]</span>     │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>             │
└───────────────┘
</pre>
</div>
</div>
</section>
<section id="array-concat-and-repeat-methods" class="level3">
<h3 class="anchored" data-anchor-id="array-concat-and-repeat-methods">Array <code>concat</code> and <code>repeat</code> methods</h3>
<p>You can still use <code>+</code> or <code>*</code> in typical Python fashion, with new and more explicit <code>concat</code> and <code>repeat</code> methods added in this release.</p>
<div id="5b21260b" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1">a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.array([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>])</span>
<span id="cb42-2">b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.array([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>])</span>
<span id="cb42-3"></span>
<span id="cb42-4">c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> a.concat(b)</span>
<span id="cb42-5">c</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div class="ansi-escaped-output">
<pre><span class="ansi-bold">[</span><span class="ansi-cyan-fg ansi-bold">1</span>, <span class="ansi-cyan-fg ansi-bold">2</span>, <span class="ansi-cyan-fg ansi-bold">3</span>, <span class="ansi-cyan-fg ansi-bold">4</span>, <span class="ansi-cyan-fg ansi-bold">5</span><span class="ansi-bold">]</span></pre>
</div>
</div>
</div>
<div id="909aca5a" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1">c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b</span>
<span id="cb43-2">c</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div class="ansi-escaped-output">
<pre><span class="ansi-bold">[</span><span class="ansi-cyan-fg ansi-bold">1</span>, <span class="ansi-cyan-fg ansi-bold">2</span>, <span class="ansi-cyan-fg ansi-bold">3</span>, <span class="ansi-cyan-fg ansi-bold">4</span>, <span class="ansi-cyan-fg ansi-bold">5</span><span class="ansi-bold">]</span></pre>
</div>
</div>
</div>
<div id="22351df0" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1">b.repeat(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="29">
<div class="ansi-escaped-output">
<pre><span class="ansi-bold">[</span><span class="ansi-cyan-fg ansi-bold">4</span>, <span class="ansi-cyan-fg ansi-bold">5</span>, <span class="ansi-cyan-fg ansi-bold">4</span>, <span class="ansi-cyan-fg ansi-bold">5</span><span class="ansi-bold">]</span></pre>
</div>
</div>
</div>
<div id="9818ea14" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb45" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1">b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span></code></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="30">
<div class="ansi-escaped-output">
<pre><span class="ansi-bold">[</span><span class="ansi-cyan-fg ansi-bold">4</span>, <span class="ansi-cyan-fg ansi-bold">5</span>, <span class="ansi-cyan-fg ansi-bold">4</span>, <span class="ansi-cyan-fg ansi-bold">5</span><span class="ansi-bold">]</span></pre>
</div>
</div>
</div>
</section>
<section id="support-boolean-literals-in-the-join-api" class="level3">
<h3 class="anchored" data-anchor-id="support-boolean-literals-in-the-join-api">Support boolean literals in the join API</h3>
<p>This allows for joins with boolean predicates.</p>
<div id="247f723b" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1">t.join(t, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> species </span>┃<span style="font-weight: bold"> island    </span>┃<span style="font-weight: bold"> bill_length_mm </span>┃<span style="font-weight: bold"> bill_depth_mm </span>┃<span style="font-weight: bold"> flipper_length_mm </span>┃<span style="font-weight: bold"> body_mass_g </span>┃<span style="font-weight: bold"> sex    </span>┃<span style="font-weight: bold"> year   </span>┃<span style="font-weight: bold"> species_right </span>┃<span style="font-weight: bold"> island_right </span>┃<span style="font-weight: bold"> bill_length_mm_right </span>┃<span style="font-weight: bold"> bill_depth_mm_right </span>┃<span style="font-weight: bold"> flipper_length_mm_right </span>┃<span style="font-weight: bold"> body_mass_g_right </span>┃<span style="font-weight: bold"> sex_right </span>┃<span style="font-weight: bold"> year_right </span>┃
┡━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>              │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>     │
├─────────┼───────────┼────────────────┼───────────────┼───────────────────┼─────────────┼────────┼────────┼───────────────┼──────────────┼──────────────────────┼─────────────────────┼─────────────────────────┼───────────────────┼───────────┼────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.7</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3750</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │ <span style="color: #008000; text-decoration-color: #008000">Adelie       </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen   </span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.1</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.7</span> │                     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3750</span> │ <span style="color: #008000; text-decoration-color: #008000">male     </span> │ <span style="color: #008000; text-decoration-color: #008000">2007      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.7</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3750</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │ <span style="color: #008000; text-decoration-color: #008000">Adelie       </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen   </span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.5</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17.4</span> │                     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">186</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3800</span> │ <span style="color: #008000; text-decoration-color: #008000">female   </span> │ <span style="color: #008000; text-decoration-color: #008000">2007      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.7</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3750</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │ <span style="color: #008000; text-decoration-color: #008000">Adelie       </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen   </span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.3</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.0</span> │                     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3250</span> │ <span style="color: #008000; text-decoration-color: #008000">female   </span> │ <span style="color: #008000; text-decoration-color: #008000">2007      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.7</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3750</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │ <span style="color: #008000; text-decoration-color: #008000">Adelie       </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen   </span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │                    <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>      │ <span style="color: #008000; text-decoration-color: #008000">2007      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.7</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3750</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │ <span style="color: #008000; text-decoration-color: #008000">Adelie       </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen   </span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">36.7</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">19.3</span> │                     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">193</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3450</span> │ <span style="color: #008000; text-decoration-color: #008000">female   </span> │ <span style="color: #008000; text-decoration-color: #008000">2007      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.7</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3750</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │ <span style="color: #008000; text-decoration-color: #008000">Adelie       </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen   </span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.3</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20.6</span> │                     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">190</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3650</span> │ <span style="color: #008000; text-decoration-color: #008000">male     </span> │ <span style="color: #008000; text-decoration-color: #008000">2007      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.7</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3750</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │ <span style="color: #008000; text-decoration-color: #008000">Adelie       </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen   </span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">38.9</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17.8</span> │                     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3625</span> │ <span style="color: #008000; text-decoration-color: #008000">female   </span> │ <span style="color: #008000; text-decoration-color: #008000">2007      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.7</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3750</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │ <span style="color: #008000; text-decoration-color: #008000">Adelie       </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen   </span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.2</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">19.6</span> │                     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4675</span> │ <span style="color: #008000; text-decoration-color: #008000">male     </span> │ <span style="color: #008000; text-decoration-color: #008000">2007      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.7</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3750</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │ <span style="color: #008000; text-decoration-color: #008000">Adelie       </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen   </span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">34.1</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.1</span> │                     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">193</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3475</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>      │ <span style="color: #008000; text-decoration-color: #008000">2007      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.7</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3750</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │ <span style="color: #008000; text-decoration-color: #008000">Adelie       </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen   </span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">42.0</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20.2</span> │                     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">190</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4250</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>      │ <span style="color: #008000; text-decoration-color: #008000">2007      </span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>            │                    <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                       <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>          │
└─────────┴───────────┴────────────────┴───────────────┴───────────────────┴─────────────┴────────┴────────┴───────────────┴──────────────┴──────────────────────┴─────────────────────┴─────────────────────────┴───────────────────┴───────────┴────────────┘
</pre>
</div>
</div>
<div id="1540b3c9" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb47" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1">t.join(t, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> species </span>┃<span style="font-weight: bold"> island </span>┃<span style="font-weight: bold"> bill_length_mm </span>┃<span style="font-weight: bold"> bill_depth_mm </span>┃<span style="font-weight: bold"> flipper_length_mm </span>┃<span style="font-weight: bold"> body_mass_g </span>┃<span style="font-weight: bold"> sex    </span>┃<span style="font-weight: bold"> year   </span>┃<span style="font-weight: bold"> species_right </span>┃<span style="font-weight: bold"> island_right </span>┃<span style="font-weight: bold"> bill_length_mm_right </span>┃<span style="font-weight: bold"> bill_depth_mm_right </span>┃<span style="font-weight: bold"> flipper_length_mm_right </span>┃<span style="font-weight: bold"> body_mass_g_right </span>┃<span style="font-weight: bold"> sex_right </span>┃<span style="font-weight: bold"> year_right </span>┃
┡━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>              │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>     │
└─────────┴────────┴────────────────┴───────────────┴───────────────────┴─────────────┴────────┴────────┴───────────────┴──────────────┴──────────────────────┴─────────────────────┴─────────────────────────┴───────────────────┴───────────┴────────────┘
</pre>
</div>
</div>
<div id="f6412d33" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1">t.join(t, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>, how<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"outer"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> species </span>┃<span style="font-weight: bold"> island    </span>┃<span style="font-weight: bold"> bill_length_mm </span>┃<span style="font-weight: bold"> bill_depth_mm </span>┃<span style="font-weight: bold"> flipper_length_mm </span>┃<span style="font-weight: bold"> body_mass_g </span>┃<span style="font-weight: bold"> sex    </span>┃<span style="font-weight: bold"> year   </span>┃<span style="font-weight: bold"> species_right </span>┃<span style="font-weight: bold"> island_right </span>┃<span style="font-weight: bold"> bill_length_mm_right </span>┃<span style="font-weight: bold"> bill_depth_mm_right </span>┃<span style="font-weight: bold"> flipper_length_mm_right </span>┃<span style="font-weight: bold"> body_mass_g_right </span>┃<span style="font-weight: bold"> sex_right </span>┃<span style="font-weight: bold"> year_right </span>┃
┡━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>              │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>     │
├─────────┼───────────┼────────────────┼───────────────┼───────────────────┼─────────────┼────────┼────────┼───────────────┼──────────────┼──────────────────────┼─────────────────────┼─────────────────────────┼───────────────────┼───────────┼────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.7</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3750</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>         │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │                    <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>       │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.5</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17.4</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">186</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3800</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>         │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │                    <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>       │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.3</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.0</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3250</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>         │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │                    <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>       │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │        <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>         │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │                    <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>       │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">36.7</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">19.3</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">193</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3450</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>         │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │                    <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>       │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.3</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20.6</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">190</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3650</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>         │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │                    <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>       │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">38.9</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17.8</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3625</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>         │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │                    <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>       │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.2</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">19.6</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4675</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>         │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │                    <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>       │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">34.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.1</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">193</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3475</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>         │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │                    <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>       │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">42.0</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20.2</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">190</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4250</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008000; text-decoration-color: #008000">2007  </span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>         │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │                    <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>       │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>            │                    <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                       <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>          │
└─────────┴───────────┴────────────────┴───────────────┴───────────────────┴─────────────┴────────┴────────┴───────────────┴──────────────┴──────────────────────┴─────────────────────┴─────────────────────────┴───────────────────┴───────────┴────────────┘
</pre>
</div>
</div>
</section>
</section>
<section id="refactors" class="level2">
<h2 class="anchored" data-anchor-id="refactors">Refactors</h2>
<p>Several internal refactors that shouldn't affect normal usage were made. See <a href="../../release_notes.html">the release notes</a> for more details.</p>
</section>
<section id="wrapping-up" class="level2">
<h2 class="anchored" data-anchor-id="wrapping-up">Wrapping up</h2>
<p>Ibis v6.1.0 brings exciting enhancements to the library that enable broader ecosystem adoption of Python standards.</p>
<p>As always, try Ibis by <a href="../../install.html">installing</a> and <a href="../../tutorials/getting_started.html">getting started</a>.</p>
<p>If you run into any issues or find support is lacking for your backend, <a href="https://github.com/ibis-project/issues/new/choose">open an issue</a> or <a href="https://github.com/ibis-project/discussions/new/choose">discussion</a> and let us know!</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>release</category>
  <category>blog</category>
  <guid>https://ibis-project.org/posts/v6.1.0-release/</guid>
  <pubDate>Wed, 02 Aug 2023 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Ibis v6.0.0</title>
  <dc:creator>Ibis team</dc:creator>
  <link>https://ibis-project.org/posts/ibis-version-6.0.0-release/</link>
  <description><![CDATA[ 





<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>Ibis 6.0.0 adds the Oracle backend, revamped UDF support, and many new features. This release also includes a number of refactors, bug fixes, and performance improvements. You can view the full changelog in <a href="../../../release_notes.md">the release notes</a>.</p>
<p>If you’re new to Ibis, see <a href="../../../install.qmd">how to install</a> and <a href="../../../tutorials/getting_started.qmd">the getting started tutorial</a>.</p>
<p>To follow along with this blog, ensure you’re on <code>'ibis-framework&gt;=6,&lt;7'</code>. First, we’ll setup Ibis and fetch some sample data to use.</p>
<div id="df4d0de1" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis.selectors <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> s</span>
<span id="cb1-3"></span>
<span id="cb1-4">ibis.options.interactive <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb1-5">ibis.options.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">repr</span>.interactive.max_rows <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span></code></pre></div>
</div>
<p>Now, fetch the penguins dataset.</p>
<div id="4967a305" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.examples.penguins.fetch()</span>
<span id="cb2-2">t</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━┓
┃<span style="font-weight: bold"> species </span>┃<span style="font-weight: bold"> island    </span>┃<span style="font-weight: bold"> bill_length_mm </span>┃<span style="font-weight: bold"> bill_depth_mm </span>┃<span style="font-weight: bold"> flipper_length_mm </span>┃<span style="font-weight: bold"> body_mass_g </span>┃<span style="font-weight: bold"> sex    </span>┃<span style="font-weight: bold"> year  </span>┃
┡━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span> │
├─────────┼───────────┼────────────────┼───────────────┼───────────────────┼─────────────┼────────┼───────┤
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.7</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3750</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.5</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17.4</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">186</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3800</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.3</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.0</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3250</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │     <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└─────────┴───────────┴────────────────┴───────────────┴───────────────────┴─────────────┴────────┴───────┘
</pre>
</div>
</div>
</section>
<section id="breaking-changes" class="level2">
<h2 class="anchored" data-anchor-id="breaking-changes">Breaking changes</h2>
<section id="join-duplicate-column-names" class="level3">
<h3 class="anchored" data-anchor-id="join-duplicate-column-names">Join duplicate column names</h3>
<p>Previously when joining tables with duplicate column names, <code>_x</code> and <code>_y</code> suffixes would be appended by default to the left and right tables respectively. You could override this with the <code>suffix</code> argument, which is now removed in favor of <code>lname</code> and <code>rname</code> arguments. The default is changed to no suffix for the left table and <code>_right</code> for the right table.</p>
<div id="63b558d3" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">t.join(t, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"island"</span>).select(s.startswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"species"</span>))</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> species </span>┃<span style="font-weight: bold"> species_right </span>┃
┡━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>        │
├─────────┼───────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Adelie       </span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Adelie       </span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Adelie       </span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>             │
└─────────┴───────────────┘
</pre>
</div>
</div>
<p>To replicate the previous behavior:</p>
<div id="8870c8c1" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">t.join(t, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"island"</span>, lname<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{name}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">_x"</span>, rname<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{name}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">_y"</span>).select(</span>
<span id="cb4-2">    s.startswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"species"</span>)</span>
<span id="cb4-3">)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━┓
┃<span style="font-weight: bold"> species_x </span>┃<span style="font-weight: bold"> species_y </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │
├───────────┼───────────┤
│ <span style="color: #008000; text-decoration-color: #008000">Adelie   </span> │ <span style="color: #008000; text-decoration-color: #008000">Adelie   </span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie   </span> │ <span style="color: #008000; text-decoration-color: #008000">Adelie   </span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie   </span> │ <span style="color: #008000; text-decoration-color: #008000">Adelie   </span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │
└───────────┴───────────┘
</pre>
</div>
</div>
</section>
<section id="count-column-names-no-longer-named-count-automatically" class="level3">
<h3 class="anchored" data-anchor-id="count-column-names-no-longer-named-count-automatically"><code>.count()</code> column names no longer named <code>count</code> automatically</h3>
<p>Columns created with the <code>.count()</code> aggregation are no longer automatically named <code>count</code>. This is to follow convention with other aggregations and reduce the likelihood of name collisions.</p>
<div id="07597e82" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">t.group_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"species"</span>).agg(ibis._.species.count())</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> species   </span>┃<span style="font-weight: bold"> Count(species) </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>          │
├───────────┼────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">Adelie   </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">152</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Gentoo   </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">124</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Chinstrap</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">68</span> │
└───────────┴────────────────┘
</pre>
</div>
</div>
<p>To reproduce the old behavior, you can rename the column to <code>count</code> with:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">t.group_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"species"</span>).agg(count<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ibis._.species.count())</span></code></pre></div>
</section>
</section>
<section id="backends" class="level2">
<h2 class="anchored" data-anchor-id="backends">Backends</h2>
<section id="oracle" class="level3">
<h3 class="anchored" data-anchor-id="oracle">Oracle</h3>
<p>The Oracle backend was added! See the <a href="https://voltrondata.com/resources/ibis-6-0-oracle-backend-support">Voltron Data blog</a> for more details.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">ibis.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"oracle://user:password@host"</span>)</span></code></pre></div>
</section>
<section id="duckdb" class="level3">
<h3 class="anchored" data-anchor-id="duckdb">DuckDB</h3>
<p>There were various DuckDB improvements, but one notable new feature is the ability to attach to a SQLite database through DuckDB. This allows you to run OLAP queries via DuckDB significantly faster on source data from SQLite.</p>
<p>First we’ll create a DuckDB connection and show it has no tables:</p>
<div id="8ba6caec" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">duckdb_con <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"duckdb://"</span>)</span>
<span id="cb8-2">duckdb_con.list_tables()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>[]</code></pre>
</div>
</div>
<p>Then create a SQLite database with a table:</p>
<div id="7a85bcc6" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">sqlite_con <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sqlite://penguins.db"</span>)</span>
<span id="cb10-2">sqlite_con.create_table(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"penguins"</span>, t.to_pandas(), overwrite<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━┓
┃<span style="font-weight: bold"> species </span>┃<span style="font-weight: bold"> island    </span>┃<span style="font-weight: bold"> bill_length_mm </span>┃<span style="font-weight: bold"> bill_depth_mm </span>┃<span style="font-weight: bold"> flipper_length_mm </span>┃<span style="font-weight: bold"> body_mass_g </span>┃<span style="font-weight: bold"> sex    </span>┃<span style="font-weight: bold"> year  </span>┃
┡━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span> │
├─────────┼───────────┼────────────────┼───────────────┼───────────────────┼─────────────┼────────┼───────┤
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.7</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181.0</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3750.0</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.5</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17.4</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">186.0</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3800.0</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.3</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.0</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195.0</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3250.0</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │     <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└─────────┴───────────┴────────────────┴───────────────┴───────────────────┴─────────────┴────────┴───────┘
</pre>
</div>
</div>
<p>And attach it:</p>
<div id="e75c55eb" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">duckdb_con.attach_sqlite(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./penguins.db"</span>)</span>
<span id="cb11-2">duckdb_con.list_tables()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>['penguins']</code></pre>
</div>
</div>
<section id="motherduck-support" class="level4">
<h4 class="anchored" data-anchor-id="motherduck-support">MotherDuck support!</h4>
<p>MotherDuck launched recently and is now supported in Ibis!</p>
<p>Simply connect with the DuckDB backend using <code>md:</code> or <code>motherduck:</code> as the database.</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1">ibis.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"duckdb://md:"</span>)</span></code></pre></div>
</section>
</section>
<section id="polars" class="level3">
<h3 class="anchored" data-anchor-id="polars">Polars</h3>
<p>The Polars backend received many improvements from community members <a href="https://github.com/alexander-beedie"><span class="citation" data-cites="alexander-beedie">@alexander-beedie</span></a> and <a href="https://github.com/mesejo"><span class="citation" data-cites="mesejo">@mesejo</span></a>, with plenty of operations now supported.</p>
<p>Some additions in this version include:</p>
<ul>
<li><code>any</code> and <code>all</code> reductions</li>
<li><code>argmin</code> and <code>argmax</code></li>
<li><code>identical_to</code></li>
<li><code>corr</code></li>
<li>support for <code>.sql()</code></li>
</ul>
<p>Give it a try by setting your backend to Polars with <code>ibis.set_backend("polars")</code>.</p>
</section>
</section>
<section id="functionality" class="level2">
<h2 class="anchored" data-anchor-id="functionality">Functionality</h2>
<section id="udfs" class="level3">
<h3 class="anchored" data-anchor-id="udfs">UDFs</h3>
<p>User-defined functions (UDFs) have been revamped with a new syntax and new backends added. To get started, import the decorator:</p>
<div id="c85c3821" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> ibis <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> udf</span></code></pre></div>
</div>
<p>Define a UDF:</p>
<div id="1cf149ea" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@udf.scalar.python</span></span>
<span id="cb15-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> num_vowels(s: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, include_y: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>:</span>
<span id="cb15-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">map</span>(s.lower().count, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"aeiou"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> include_y)))</span></code></pre></div>
</div>
<p>And call it:</p>
<div id="158fdd6a" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1">num_vowels(t[:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].species.execute()[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div class="ansi-escaped-output">
<pre><span class="ansi-cyan-fg ansi-bold">4</span></pre>
</div>
</div>
</div>
<div id="aab3553e" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1">t.group_by(num_vowels<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>num_vowels(t.species)).agg(</span>
<span id="cb17-2">    num_vowels_island_count<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>t.island.count()</span>
<span id="cb17-3">)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> num_vowels </span>┃<span style="font-weight: bold"> num_vowels_island_count </span>┃
┡━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>                   │
├────────────┼─────────────────────────┤
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4</span> │                     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">152</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3</span> │                     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">124</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span> │                      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">68</span> │
└────────────┴─────────────────────────┘
</pre>
</div>
</div>
<div id="9307cb71" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1">t.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(num_vowels(t.species) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━┓
┃<span style="font-weight: bold"> species </span>┃<span style="font-weight: bold"> island </span>┃<span style="font-weight: bold"> bill_length_mm </span>┃<span style="font-weight: bold"> bill_depth_mm </span>┃<span style="font-weight: bold"> flipper_length_mm </span>┃<span style="font-weight: bold"> body_mass_g </span>┃<span style="font-weight: bold"> sex    </span>┃<span style="font-weight: bold"> year  </span>┃
┡━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span> │
├─────────┼────────┼────────────────┼───────────────┼───────────────────┼─────────────┼────────┼───────┤
│ <span style="color: #008000; text-decoration-color: #008000">Gentoo </span> │ <span style="color: #008000; text-decoration-color: #008000">Biscoe</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">46.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">13.2</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">211</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4500</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Gentoo </span> │ <span style="color: #008000; text-decoration-color: #008000">Biscoe</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">50.0</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">16.3</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">230</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5700</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Gentoo </span> │ <span style="color: #008000; text-decoration-color: #008000">Biscoe</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">48.7</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">14.1</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">210</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4450</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │     <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└─────────┴────────┴────────────────┴───────────────┴───────────────────┴─────────────┴────────┴───────┘
</pre>
</div>
</div>
</section>
<section id="to_torch-api" class="level3">
<h3 class="anchored" data-anchor-id="to_torch-api"><code>to_torch</code> API</h3>
<p>A new <code>to_torch</code> output method was added. Combined with UDFs, this brings powerful ML capabilities into Ibis. See a complete example in the <a href="../torch">Ibis + DuckDB + PyTorch blog</a>.</p>
<div id="33e48456" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb19-2"></span>
<span id="cb19-3">torch.set_printoptions(threshold<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span></code></pre></div>
</div>
<div id="867cc0d3" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1">t.select(s.numeric()).to_torch()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>{'bill_length_mm': tensor([39.1000, 39.5000, 40.3000,  ..., 49.6000, 50.8000, 50.2000],
        dtype=torch.float64),
 'bill_depth_mm': tensor([18.7000, 17.4000, 18.0000,  ..., 18.2000, 19.0000, 18.7000],
        dtype=torch.float64),
 'flipper_length_mm': tensor([181, 186, 195,  ..., 193, 210, 198]),
 'body_mass_g': tensor([3750, 3800, 3250,  ..., 3775, 4100, 3775]),
 'year': tensor([2007, 2007, 2007,  ..., 2009, 2009, 2009])}</code></pre>
</div>
</div>
</section>
<section id="array-zip-support" class="level3">
<h3 class="anchored" data-anchor-id="array-zip-support">Array zip support</h3>
<p>A new zip operation was added on array data types, allowing you to zip together multiple arrays.</p>
<div id="f0880cfc" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1">arrays <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.memtable(</span>
<span id="cb22-2">    {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"numbers"</span>: [[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], [], <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"strings"</span>: [[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"c"</span>], <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>, [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"e"</span>]]}</span>
<span id="cb22-3">)</span>
<span id="cb22-4">arrays</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> numbers      </span>┃<span style="font-weight: bold"> strings       </span>┃
┡━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;int64&gt;</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;string&gt;</span> │
├──────────────┼───────────────┤
│ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span><span style="font-weight: bold">]</span>       │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'a'</span>, <span style="color: #008000; text-decoration-color: #008000">'c'</span><span style="font-weight: bold">]</span>    │
│ <span style="font-weight: bold">[]</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>          │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>         │ <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'e'</span><span style="font-weight: bold">]</span>         │
└──────────────┴───────────────┘
</pre>
</div>
</div>
<div id="cac84c5c" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1">arrays.numbers.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(arrays.strings)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> ArrayZip()                           </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;struct&lt;f1: int64, f2: string&gt;&gt;</span> │
├──────────────────────────────────────┤
│ <span style="font-weight: bold">[{</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">}</span>, <span style="font-weight: bold">{</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">}]</span>                       │
│ <span style="font-weight: bold">[]</span>                                   │
│ <span style="font-weight: bold">[{</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">}]</span>                              │
└──────────────────────────────────────┘
</pre>
</div>
</div>
<div id="4e961ab3" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1">arrays.numbers.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(arrays.strings).unnest()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> ArrayZip()                    </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">struct&lt;f1: int64, f2: string&gt;</span> │
├───────────────────────────────┤
│ <span style="font-weight: bold">{</span><span style="color: #008000; text-decoration-color: #008000">'f1'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3</span>, <span style="color: #008000; text-decoration-color: #008000">'f2'</span>: <span style="color: #008000; text-decoration-color: #008000">'a'</span><span style="font-weight: bold">}</span>          │
│ <span style="font-weight: bold">{</span><span style="color: #008000; text-decoration-color: #008000">'f1'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span>, <span style="color: #008000; text-decoration-color: #008000">'f2'</span>: <span style="color: #008000; text-decoration-color: #008000">'c'</span><span style="font-weight: bold">}</span>          │
│ <span style="font-weight: bold">{</span><span style="color: #008000; text-decoration-color: #008000">'f1'</span>: <span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>, <span style="color: #008000; text-decoration-color: #008000">'f2'</span>: <span style="color: #008000; text-decoration-color: #008000">'e'</span><span style="font-weight: bold">}</span>       │
└───────────────────────────────┘
</pre>
</div>
</div>
</section>
<section id="try-cast-support" class="level3">
<h3 class="anchored" data-anchor-id="try-cast-support">Try cast support</h3>
<p>A new <code>try_cast()</code> operation was added that allows you to cast a column to a type, but return null if the cast fails.</p>
<div id="d8e748e5" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1">ibis.literal(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>).try_cast(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"int"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div class="ansi-escaped-output">
<pre><span style="font-style:italic" class="ansi-magenta-fg">None</span></pre>
</div>
</div>
</div>
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1">ibis.literal(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>).try_cast(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"float"</span>)</span></code></pre></div>
</section>
<section id="dataframe__-support" class="level3">
<h3 class="anchored" data-anchor-id="dataframe__-support"><code>__dataframe__</code> support</h3>
<p>Ibis now supports the <a href="https://data-apis.org/dataframe-protocol/latest/index.html">dataframe interchange protocol</a>, allowing Ibis expressions to be used in any framework that supports it. Adoption of the protocol is still in its early stages, but we expect this to enable Ibis to be used in many new places going forward.</p>
<div id="418f5bdb" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1">t.__dataframe__()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>&lt;ibis.expr.types.dataframe_interchange.IbisDataFrame at 0x7f7bf415d9c0&gt;</code></pre>
</div>
</div>
</section>
<section id="streamlit-experimental-connection-interface" class="level3">
<h3 class="anchored" data-anchor-id="streamlit-experimental-connection-interface">Streamlit experimental connection interface</h3>
<p>A new experimental connection interface was added for Streamlit. See <a href="../../../how-to/visualization/streamlit.qmd">how-to write a Streamlit app with Ibis</a>.</p>
</section>
<section id="sql-dialect-parameter" class="level3">
<h3 class="anchored" data-anchor-id="sql-dialect-parameter">SQL dialect parameter</h3>
<p>In SQL methods, you can now pass the <code>dialect</code> parameter to specify the SQL dialect used. This leverages <a href="https://github.com/tobymao/sqlglot"><code>sqlglot</code></a> under the hood.</p>
<div id="da81bb20" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1">bigquery_sql <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb29-2"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">SELECT</span></span>
<span id="cb29-3"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  t0.`species`,</span></span>
<span id="cb29-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  COUNT(t0.`species`) AS `count`,</span></span>
<span id="cb29-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  CAST(COUNT(DISTINCT t0.`island`) AS FLOAT64) AS `islands`</span></span>
<span id="cb29-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">FROM penguins AS t0</span></span>
<span id="cb29-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">GROUP BY</span></span>
<span id="cb29-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  1</span></span>
<span id="cb29-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb29-10"></span>
<span id="cb29-11">duckdb_con.sql(bigquery_sql, dialect<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bigquery"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━━┓
┃<span style="font-weight: bold"> species   </span>┃<span style="font-weight: bold"> count </span>┃<span style="font-weight: bold"> islands </span>┃
┡━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span> │
├───────────┼───────┼─────────┤
│ <span style="color: #008000; text-decoration-color: #008000">Adelie   </span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">152</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.0</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Gentoo   </span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">124</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.0</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Chinstrap</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">68</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.0</span> │
└───────────┴───────┴─────────┘
</pre>
</div>
</div>
</section>
<section id="delta-lake-readwrite-support-for-some-backends" class="level3">
<h3 class="anchored" data-anchor-id="delta-lake-readwrite-support-for-some-backends">Delta Lake read/write support for some backends</h3>
<p><a href="https://delta-io">Delta Lake tables</a> are supported through the <a href="https://github.com/delta-io/delta-rs"><code>deltalake</code> package</a> with <code>read_delta()</code> implemented for DuckDB, Polars, and DataFusion.</p>
<div id="202f5c55" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1">t.to_delta(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"penguins.delta"</span>, mode<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"overwrite"</span>)</span></code></pre></div>
</div>
<div id="4e3e2b24" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1">t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.read_delta(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"penguins.delta"</span>)</span>
<span id="cb31-2">t</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━┓
┃<span style="font-weight: bold"> species </span>┃<span style="font-weight: bold"> island    </span>┃<span style="font-weight: bold"> bill_length_mm </span>┃<span style="font-weight: bold"> bill_depth_mm </span>┃<span style="font-weight: bold"> flipper_length_mm </span>┃<span style="font-weight: bold"> body_mass_g </span>┃<span style="font-weight: bold"> sex    </span>┃<span style="font-weight: bold"> year  </span>┃
┡━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span> │
├─────────┼───────────┼────────────────┼───────────────┼───────────────────┼─────────────┼────────┼───────┤
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.7</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3750</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.5</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17.4</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">186</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3800</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.3</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.0</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3250</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │     <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└─────────┴───────────┴────────────────┴───────────────┴───────────────────┴─────────────┴────────┴───────┘
</pre>
</div>
</div>
</section>
<section id="selectors" class="level3">
<h3 class="anchored" data-anchor-id="selectors">Selectors</h3>
<p>Some minor selectors improvements were added including the ability to use abstract type names and lists of strings.</p>
<div id="4b1a65d9" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1">t.select(s.of_type(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"string"</span>))</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━┓
┃<span style="font-weight: bold"> species </span>┃<span style="font-weight: bold"> island    </span>┃<span style="font-weight: bold"> sex    </span>┃
┡━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │
├─────────┼───────────┼────────┤
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │
└─────────┴───────────┴────────┘
</pre>
</div>
</div>
<div id="7a7f62d3" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1">t.agg(s.across([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"species"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"island"</span>], ibis._.count()))</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━┳━━━━━━━━┓
┃<span style="font-weight: bold"> species </span>┃<span style="font-weight: bold"> island </span>┃
┡━━━━━━━━━╇━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>  │
├─────────┼────────┤
│     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">344</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">344</span> │
└─────────┴────────┘
</pre>
</div>
</div>
</section>
</section>
<section id="refactors" class="level2">
<h2 class="anchored" data-anchor-id="refactors">Refactors</h2>
<p>Several internal refactors that shouldn’t affect normal usage were made. See <a href="../../release_notes.html">the release notes</a> for more details.</p>
</section>
<section id="wrapping-up" class="level2">
<h2 class="anchored" data-anchor-id="wrapping-up">Wrapping up</h2>
<p>Ibis v6.0.0 brings exciting new features that enable future support for ML and streaming workloads.</p>
<p>As always, try Ibis by <a href="../../install.html">installing</a> and <a href="../../tutorials/getting_started.html">getting started</a>.</p>
<p>If you run into any issues or find support is lacking for your backend, <a href="https://github.com/ibis-project/issues/new/choose">open an issue</a> or <a href="https://github.com/ibis-project/discussions/new/choose">discussion</a> and let us know!</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>release</category>
  <category>blog</category>
  <guid>https://ibis-project.org/posts/ibis-version-6.0.0-release/</guid>
  <pubDate>Mon, 03 Jul 2023 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Ibis on 🔥: Supercharge Your Workflow with DuckDB and PyTorch</title>
  <dc:creator>Phillip Cloud</dc:creator>
  <link>https://ibis-project.org/posts/torch/</link>
  <description><![CDATA[ 





<p>In this blog post we show how to leverage ecosystem tools to build an end-to-end ML pipeline using Ibis, DuckDB and PyTorch.</p>
<p>Check out the live stream of this notebook below!</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/L4_deAdStKs" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<p>Let’s get started!</p>
<div id="00698153" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis.expr.datatypes <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> dt</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> ibis <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> _, selectors <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> s, udf</span>
<span id="cb1-5"></span>
<span id="cb1-6">ibis.options.interactive <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span></code></pre></div>
</div>
<section id="define-a-function-to-clean-inputs" class="level2">
<h2 class="anchored" data-anchor-id="define-a-function-to-clean-inputs">Define a Function to Clean Inputs</h2>
<p>Let’s define a function to clean the data in a few different ways:</p>
<ul>
<li>Remove outliers (Z-score based)</li>
<li>Remove negative trip distances and negative fare amounts</li>
<li>Cast inputs to <code>float32</code>, since that’s what PyTorch wants</li>
</ul>
<p>We use a function here to ensure that we can run the same code on the test data set before prediction.</p>
<div id="958d91ec" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> clean_input(path):</span>
<span id="cb2-2">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> (</span>
<span id="cb2-3">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># load parquet</span></span>
<span id="cb2-4">        ibis.read_parquet(path)</span>
<span id="cb2-5">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># compute fare_amount_zscore and trip_distance_zscore</span></span>
<span id="cb2-6">        .mutate(s.across([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fare_amount"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trip_distance"</span>], <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>(zscore<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> _.mean()) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> _.std())))</span>
<span id="cb2-7">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># filter out negative trip distance and bizarre transactions</span></span>
<span id="cb2-8">        .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>([_.trip_distance <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, _.fare_amount <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>])</span>
<span id="cb2-9">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># keep values that within 2 standard deviations</span></span>
<span id="cb2-10">        .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(s.if_all(s.endswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_zscore"</span>), _.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">abs</span>() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb2-11">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># drop columns that aren't necessary for further analysis</span></span>
<span id="cb2-12">        .drop(s.endswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_zscore"</span>))</span>
<span id="cb2-13">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># select the columns we care about</span></span>
<span id="cb2-14">        .select(s.across([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fare_amount"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trip_distance"</span>], _.cast(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"float32"</span>)))</span>
<span id="cb2-15">    )</span></code></pre></div>
</div>
<div id="859cdcf4" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">training_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> clean_input(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://storage.googleapis.com/ibis-tutorial-data/nyctaxi/yellow/yellow_tripdata_2016-01.parquet"</span>)</span>
<span id="cb3-2">training_data</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> trip_distance </span>┃<span style="font-weight: bold"> fare_amount </span>┃
┡━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float32</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float32</span>     │
├───────────────┼─────────────┤
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.20</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">14.0</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.00</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">9.5</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.90</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6.0</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.80</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5.0</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.80</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">11.0</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.30</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">11.0</span> │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">13.80</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">43.0</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.46</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20.0</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.83</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5.5</span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.87</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">7.0</span> │
│             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└───────────────┴─────────────┘
</pre>
</div>
</div>
</section>
<section id="execute-the-query-and-convert-to-torch-tensors" class="level2">
<h2 class="anchored" data-anchor-id="execute-the-query-and-convert-to-torch-tensors">Execute the Query and Convert to Torch Tensors</h2>
<p>New in Ibis 6.0 is the <code>to_torch</code> method, which executes a query and returns the results as a dictionary of <code>torch.Tensor</code>s keyed by column names.</p>
<p>We’ll use that to get our input data for training.</p>
<div id="0e01d8f2" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb4-2"></span>
<span id="cb4-3">torch_training_data: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, torch.Tensor] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> training_data.to_torch()</span>
<span id="cb4-4">torch_training_data</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>{'trip_distance': tensor([3.2000, 1.0000, 0.9000,  ..., 5.6300, 0.7700, 1.2600]),
 'fare_amount': tensor([14.0000,  9.5000,  6.0000,  ..., 18.5000,  5.0000,  6.5000])}</code></pre>
</div>
</div>
</section>
<section id="train-the-model" class="level2">
<h2 class="anchored" data-anchor-id="train-the-model">Train the Model</h2>
<p>Let’s assume for now we don’t have access to the model code. Maybe your co-worker wrote the model or it’s part of an API that you don’t control. Either way, it’s a black box to us.</p>
<p>The API looks like this:</p>
<div id="4345f20d" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pyarrow</span>
<span id="cb6-2"></span>
<span id="cb6-3"></span>
<span id="cb6-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> PredictCabFare:</span>
<span id="cb6-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, data: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, torch.Tensor]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb6-6">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Initialize the model with training data."""</span></span>
<span id="cb6-7"></span>
<span id="cb6-8">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> train(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb6-9">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Train the model."""</span></span>
<span id="cb6-10"></span>
<span id="cb6-11">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__call__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: pyarrow.ChunkedArray) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pyarrow.Array:</span>
<span id="cb6-12">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Invoke the trained model on unseen input."""</span></span></code></pre></div>
</div>
<div id="f1f6ccd5" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> model <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> PredictCabFare</span>
<span id="cb7-2"></span>
<span id="cb7-3"></span>
<span id="cb7-4">model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> PredictCabFare(torch_training_data)</span>
<span id="cb7-5">model.train()</span></code></pre></div>
</div>
</section>
<section id="define-an-ibis-udf-that-predicts-fares" class="level2">
<h2 class="anchored" data-anchor-id="define-an-ibis-udf-that-predicts-fares">Define an Ibis UDF that predicts fares</h2>
<p>Now we get to the meaty part: defining an Ibis UDF (user-defined function) that invokes our model on unseen data!</p>
<div id="190a3ea6" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> ibis.expr.operations <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> udf</span>
<span id="cb8-2"></span>
<span id="cb8-3"></span>
<span id="cb8-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@udf.scalar.pyarrow</span></span>
<span id="cb8-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> predict_fare(distance: dt.float64) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> dt.float32:</span>
<span id="cb8-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> model(distance)</span></code></pre></div>
</div>
<p>Let’s run our UDF</p>
<div id="ce8225d3" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1">prediction <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb9-2">    clean_input(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://storage.googleapis.com/ibis-tutorial-data/nyctaxi/yellow/yellow_tripdata_2016-02.parquet"</span>)</span>
<span id="cb9-3">    .limit(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10_000</span>)</span>
<span id="cb9-4">    .mutate(predicted_fare<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> t: predict_fare(t.trip_distance.cast(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"float32"</span>)))</span>
<span id="cb9-5">)</span>
<span id="cb9-6">prediction</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> trip_distance </span>┃<span style="font-weight: bold"> fare_amount </span>┃<span style="font-weight: bold"> predicted_fare </span>┃
┡━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float32</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float32</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float32</span>        │
├───────────────┼─────────────┼────────────────┤
│           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">9.1</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">27.0</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">29.085516</span> │
│           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.3</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">11.5</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">12.626410</span> │
│           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.5</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.0</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.680637</span> │
│           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">7.4</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">26.5</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">24.261295</span> │
│           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.6</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">7.5</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">7.802191</span> │
│           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.8</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">16.0</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">14.045299</span> │
│           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.1</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6.0</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6.383303</span> │
│           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6.8</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21.0</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">22.558630</span> │
│           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.9</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">12.0</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">11.491301</span> │
│           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.2</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6.5</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6.667080</span> │
│             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└───────────────┴─────────────┴────────────────┘
</pre>
</div>
</div>
</section>
<section id="prepare-the-data-for-plotting" class="level2">
<h2 class="anchored" data-anchor-id="prepare-the-data-for-plotting">Prepare the Data for Plotting</h2>
<p>Here we <a href="https://r4ds.had.co.nz/tidy-data.html">tidy up our data</a> to make it easier to adjust plotting style based on the data.</p>
<p>In this case, we’re interested in visually distinguishing the model’s <strong>predicted</strong> fare amount from the <strong>actual</strong> fare amount so we pivot the data into a <a href="https://r4ds.had.co.nz/tidy-data.html#longer">longer form</a> which adds a string column <code>metric</code> that indicates the kind of fare a given row contains.</p>
<div id="e4794df0" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">pivoted_prediction <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> prediction.pivot_longer(</span>
<span id="cb10-2">    s.contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fare"</span>),</span>
<span id="cb10-3">    values_to<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fare"</span>,</span>
<span id="cb10-4">    names_to<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metric"</span>,</span>
<span id="cb10-5">)</span>
<span id="cb10-6">pivoted_prediction</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┓
┃<span style="font-weight: bold"> trip_distance </span>┃<span style="font-weight: bold"> metric         </span>┃<span style="font-weight: bold"> fare      </span>┃
┡━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float32</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float32</span>   │
├───────────────┼────────────────┼───────────┤
│           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">9.1</span> │ <span style="color: #008000; text-decoration-color: #008000">fare_amount   </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">27.000000</span> │
│           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">9.1</span> │ <span style="color: #008000; text-decoration-color: #008000">predicted_fare</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">29.085516</span> │
│           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.3</span> │ <span style="color: #008000; text-decoration-color: #008000">fare_amount   </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">11.500000</span> │
│           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.3</span> │ <span style="color: #008000; text-decoration-color: #008000">predicted_fare</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">12.626410</span> │
│           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.5</span> │ <span style="color: #008000; text-decoration-color: #008000">fare_amount   </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.000000</span> │
│           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.5</span> │ <span style="color: #008000; text-decoration-color: #008000">predicted_fare</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.680637</span> │
│           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">7.4</span> │ <span style="color: #008000; text-decoration-color: #008000">fare_amount   </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">26.500000</span> │
│           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">7.4</span> │ <span style="color: #008000; text-decoration-color: #008000">predicted_fare</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">24.261295</span> │
│           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.6</span> │ <span style="color: #008000; text-decoration-color: #008000">fare_amount   </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">7.500000</span> │
│           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.6</span> │ <span style="color: #008000; text-decoration-color: #008000">predicted_fare</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">7.802191</span> │
│             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>              │         <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└───────────────┴────────────────┴───────────┘
</pre>
</div>
</div>
</section>
<section id="plot-the-results" class="level2">
<h2 class="anchored" data-anchor-id="plot-the-results">Plot the Results</h2>
<p>There are a bunch of strange and interesting data points and observations that don’t have an obvious explanation:</p>
<ul>
<li>There seem to be a good number of \$50-ish rides regardless of distance. What’s going on there?</li>
<li>What’s going on with the extreme outliers? For instance, the 50 mile ride that only cost about \$60 or the 25 mile ride that cost about \$140.</li>
</ul>
<div id="eb2af3ac" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> plotnine <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> aes, ggtitle, ggplot, geom_point, xlab, ylab</span>
<span id="cb11-2"></span>
<span id="cb11-3">(</span>
<span id="cb11-4">    ggplot(pivoted_prediction, aes(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trip_distance"</span>, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fare"</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metric"</span>))</span>
<span id="cb11-5">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> geom_point()</span>
<span id="cb11-6">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> xlab(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Trip Distance"</span>)</span>
<span id="cb11-7">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> ylab(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fare"</span>)</span>
<span id="cb11-8">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> ggtitle(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted Fare vs Actual Fare by Trip Distance"</span>)</span>
<span id="cb11-9">)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://ibis-project.org/posts/torch/index_files/figure-html/cell-11-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
</section>
<section id="appendix-model.py" class="level1">
<h1>Appendix: <code>model.py</code></h1>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Linear regression model for predicting cab fares using PyTorch.</span></span>
<span id="cb13-2"></span>
<span id="cb13-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Adapted from https://gist.github.com/pdet/e8d38734232c08e6c15aba79b4eb8368#file-taxi_prediction_example-py.</span></span>
<span id="cb13-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb13-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> __future__ <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> annotations</span>
<span id="cb13-6"></span>
<span id="cb13-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pyarrow <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pa</span>
<span id="cb13-8"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb13-9"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> tqdm</span>
<span id="cb13-10"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> torch <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> nn</span>
<span id="cb13-11"></span>
<span id="cb13-12"></span>
<span id="cb13-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> LinearRegression(nn.Module):</span>
<span id="cb13-14">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, input_dim, output_dim):</span>
<span id="cb13-15">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">super</span>().<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>()</span>
<span id="cb13-16">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.linear <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nn.Linear(input_dim, output_dim)</span>
<span id="cb13-17"></span>
<span id="cb13-18">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> forward(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, distances):</span>
<span id="cb13-19">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.linear(distances)</span>
<span id="cb13-20"></span>
<span id="cb13-21"></span>
<span id="cb13-22"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> PredictCabFare:</span>
<span id="cb13-23">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, data, learning_rate: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, epochs: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb13-24">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define the input and output dimensions</span></span>
<span id="cb13-25">        input_dim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb13-26">        output_dim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb13-27"></span>
<span id="cb13-28">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a linear regression model instance</span></span>
<span id="cb13-29">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data</span>
<span id="cb13-30">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> LinearRegression(input_dim, output_dim)</span>
<span id="cb13-31">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.learning_rate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> learning_rate</span>
<span id="cb13-32">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.epochs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> epochs</span>
<span id="cb13-33"></span>
<span id="cb13-34">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> train(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb13-35">        distances <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trip_distance"</span>].reshape(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb13-36">        fares <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fare_amount"</span>].reshape(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb13-37"></span>
<span id="cb13-38">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define the loss function</span></span>
<span id="cb13-39">        criterion <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nn.MSELoss()</span>
<span id="cb13-40"></span>
<span id="cb13-41">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define the optimizer</span></span>
<span id="cb13-42">        optimizer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.optim.SGD(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model.parameters(), lr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.learning_rate)</span>
<span id="cb13-43"></span>
<span id="cb13-44">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train the model</span></span>
<span id="cb13-45">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> _ <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> tqdm.trange(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.epochs):</span>
<span id="cb13-46">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Forward pass</span></span>
<span id="cb13-47">            y_pred <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model(distances)</span>
<span id="cb13-48"></span>
<span id="cb13-49">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute loss</span></span>
<span id="cb13-50">            loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> criterion(y_pred, fares)</span>
<span id="cb13-51"></span>
<span id="cb13-52">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Backward pass and optimize</span></span>
<span id="cb13-53">            optimizer.zero_grad()</span>
<span id="cb13-54">            loss.backward()</span>
<span id="cb13-55">            optimizer.step()</span>
<span id="cb13-56"></span>
<span id="cb13-57">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> predict(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>):</span>
<span id="cb13-58">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> torch.no_grad():</span>
<span id="cb13-59">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>)</span>
<span id="cb13-60"></span>
<span id="cb13-61">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__call__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: pa.ChunkedArray):</span>
<span id="cb13-62">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert the input to numpy so it can be fed to the model</span></span>
<span id="cb13-63">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#</span></span>
<span id="cb13-64">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># .copy() to avoid the warning about undefined behavior from torch</span></span>
<span id="cb13-65">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.from_numpy(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>.to_numpy().copy())[:, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>]</span>
<span id="cb13-66">        predicted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.predict(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>).ravel()</span>
<span id="cb13-67">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> pa.array(predicted.numpy())</span></code></pre></div>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>blog</category>
  <category>case study</category>
  <category>machine learning</category>
  <category>ecosystem</category>
  <category>new feature</category>
  <guid>https://ibis-project.org/posts/torch/</guid>
  <pubDate>Tue, 27 Jun 2023 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Exploring campaign finance data</title>
  <dc:creator>Nick Crews</dc:creator>
  <link>https://ibis-project.org/posts/campaign-finance/</link>
  <description><![CDATA[ 





<p>Hi! My name is <a href="https://www.linkedin.com/in/nicholas-b-crews/">Nick Crews</a>, and I’m a data engineer that looks at public campaign finance data.</p>
<p>In this post, I’ll walk through how I use Ibis to explore public campaign contribution data from the Federal Election Commission (FEC). We’ll do some loading, cleaning, featurizing, and visualization. There will be filtering, sorting, grouping, and aggregation.</p>
<section id="downloading-the-data" class="level2">
<h2 class="anchored" data-anchor-id="downloading-the-data">Downloading The Data</h2>
<div id="02d63441" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> pathlib <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Path</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> zipfile <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ZipFile</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> urllib.request <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> urlretrieve</span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Download and unzip the 2018 individual contributions data</span></span>
<span id="cb1-6">url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://cg-519a459a-0ea3-42c2-b7bc-fa1143481f74.s3-us-gov-west-1.amazonaws.com/bulk-downloads/2018/indiv18.zip"</span></span>
<span id="cb1-7">zip_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Path(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"indiv18.zip"</span>)</span>
<span id="cb1-8">csv_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Path(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"indiv18.csv"</span>)</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> zip_path.exists():</span>
<span id="cb1-11">    urlretrieve(url, zip_path)</span>
<span id="cb1-12"></span>
<span id="cb1-13"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> csv_path.exists():</span>
<span id="cb1-14">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> ZipFile(zip_path) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> zip_file, csv_path.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"w"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> csv_file:</span>
<span id="cb1-15">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> line <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> zip_file.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"itcont.txt"</span>):</span>
<span id="cb1-16">            csv_file.write(line.decode())</span></code></pre></div>
</div>
</section>
<section id="loading-the-data" class="level2">
<h2 class="anchored" data-anchor-id="loading-the-data">Loading the data</h2>
<p>Now that we have our raw data in a .csv format, let’s load it into Ibis, using the duckdb backend.</p>
<p>Note that a 4.3 GB .csv would be near the limit of what pandas could handle on my laptop with 16GB of RAM. In pandas, typically every time you perform a transformation on the data, a copy of the data is made. I could only do a few transformations before I ran out of memory.</p>
<p>With Ibis, this problem is solved in two different ways.</p>
<p>First, because they are designed to work with very large datasets, many (all?) SQL backends support out of core operations. The data lives on disk, and are only loaded in a streaming fashion when needed, and then written back to disk as the operation is performed.</p>
<p>Second, unless you explicitly ask for it, Ibis makes use of lazy evaluation. This means that when you ask for a result, the result is not persisted in memory. Only the original source data is persisted. Everything else is derived from this on the fly.</p>
<div id="83a871f2" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis</span>
<span id="cb2-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> ibis <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> _</span>
<span id="cb2-3"></span>
<span id="cb2-4">ibis.options.interactive <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb2-5"></span>
<span id="cb2-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The raw .csv file doesn't have column names, so we will add them in the next step.</span></span>
<span id="cb2-7">raw <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.read_csv(csv_path)</span>
<span id="cb2-8">raw</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> C00401224 </span>┃<span style="font-weight: bold"> A      </span>┃<span style="font-weight: bold"> M6     </span>┃<span style="font-weight: bold"> P      </span>┃<span style="font-weight: bold"> 201804059101866001 </span>┃<span style="font-weight: bold"> 24T    </span>┃<span style="font-weight: bold"> IND    </span>┃<span style="font-weight: bold"> STOUFFER, LEIGH   </span>┃<span style="font-weight: bold"> AMSTELVEEN   </span>┃<span style="font-weight: bold"> ZZ     </span>┃<span style="font-weight: bold"> 1187RC    </span>┃<span style="font-weight: bold"> MYSELF            </span>┃<span style="font-weight: bold"> SELF EMPLOYED           </span>┃<span style="font-weight: bold"> 05172017 </span>┃<span style="font-weight: bold"> 10    </span>┃<span style="font-weight: bold"> C00458000 </span>┃<span style="font-weight: bold"> SA11AI_81445687 </span>┃<span style="font-weight: bold"> 1217152 </span>┃<span style="font-weight: bold"> column18 </span>┃<span style="font-weight: bold"> EARMARKED FOR PROGRESSIVE CHANGE CAMPAIGN COMMITTEE (C00458000) </span>┃<span style="font-weight: bold"> 4050820181544765358 </span>┃
┡━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>              │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                                          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>               │
├───────────┼────────┼────────┼────────┼────────────────────┼────────┼────────┼───────────────────┼──────────────┼────────┼───────────┼───────────────────┼─────────────────────────┼──────────┼───────┼───────────┼─────────────────┼─────────┼──────────┼─────────────────────────────────────────────────────────────────┼─────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">A     </span> │ <span style="color: #008000; text-decoration-color: #008000">M6    </span> │ <span style="color: #008000; text-decoration-color: #008000">P     </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">201804059101867748</span> │ <span style="color: #008000; text-decoration-color: #008000">24T   </span> │ <span style="color: #008000; text-decoration-color: #008000">IND   </span> │ <span style="color: #008000; text-decoration-color: #008000">STRAWS, JOYCE    </span> │ <span style="color: #008000; text-decoration-color: #008000">OCOEE       </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │ <span style="color: #008000; text-decoration-color: #008000">34761    </span> │ <span style="color: #008000; text-decoration-color: #008000">SILVERSEA CRUISES</span> │ <span style="color: #008000; text-decoration-color: #008000">RESERVATIONS SUPERVISOR</span> │ <span style="color: #008000; text-decoration-color: #008000">05182017</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10</span> │ <span style="color: #008000; text-decoration-color: #008000">C00000935</span> │ <span style="color: #008000; text-decoration-color: #008000">SA11AI_81592336</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1217152</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │ <span style="color: #008000; text-decoration-color: #008000">EARMARKED FOR DCCC (C00000935)                                 </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4050820181544770597</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">A     </span> │ <span style="color: #008000; text-decoration-color: #008000">M6    </span> │ <span style="color: #008000; text-decoration-color: #008000">P     </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">201804059101867748</span> │ <span style="color: #008000; text-decoration-color: #008000">24T   </span> │ <span style="color: #008000; text-decoration-color: #008000">IND   </span> │ <span style="color: #008000; text-decoration-color: #008000">STRAWS, JOYCE    </span> │ <span style="color: #008000; text-decoration-color: #008000">OCOEE       </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │ <span style="color: #008000; text-decoration-color: #008000">34761    </span> │ <span style="color: #008000; text-decoration-color: #008000">SILVERSEA CRUISES</span> │ <span style="color: #008000; text-decoration-color: #008000">RESERVATIONS SUPERVISOR</span> │ <span style="color: #008000; text-decoration-color: #008000">05192017</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">15</span> │ <span style="color: #008000; text-decoration-color: #008000">C00000935</span> │ <span style="color: #008000; text-decoration-color: #008000">SA11AI_81627562</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1217152</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │ <span style="color: #008000; text-decoration-color: #008000">EARMARKED FOR DCCC (C00000935)                                 </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4050820181544770598</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">A     </span> │ <span style="color: #008000; text-decoration-color: #008000">M6    </span> │ <span style="color: #008000; text-decoration-color: #008000">P     </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">201804059101865942</span> │ <span style="color: #008000; text-decoration-color: #008000">24T   </span> │ <span style="color: #008000; text-decoration-color: #008000">IND   </span> │ <span style="color: #008000; text-decoration-color: #008000">STOTT, JIM       </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">039020760</span> │ <span style="color: #008000; text-decoration-color: #008000">NONE             </span> │ <span style="color: #008000; text-decoration-color: #008000">NONE                   </span> │ <span style="color: #008000; text-decoration-color: #008000">05132017</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">35</span> │ <span style="color: #008000; text-decoration-color: #008000">C00000935</span> │ <span style="color: #008000; text-decoration-color: #008000">SA11AI_81047921</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1217152</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │ <span style="color: #008000; text-decoration-color: #008000">EARMARKED FOR DCCC (C00000935)                                 </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4050820181544765179</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">A     </span> │ <span style="color: #008000; text-decoration-color: #008000">M6    </span> │ <span style="color: #008000; text-decoration-color: #008000">P     </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">201804059101865942</span> │ <span style="color: #008000; text-decoration-color: #008000">24T   </span> │ <span style="color: #008000; text-decoration-color: #008000">IND   </span> │ <span style="color: #008000; text-decoration-color: #008000">STOTT, JIM       </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">039020760</span> │ <span style="color: #008000; text-decoration-color: #008000">NONE             </span> │ <span style="color: #008000; text-decoration-color: #008000">NONE                   </span> │ <span style="color: #008000; text-decoration-color: #008000">05152017</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">35</span> │ <span style="color: #008000; text-decoration-color: #008000">C00000935</span> │ <span style="color: #008000; text-decoration-color: #008000">SA11AI_81209209</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1217152</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │ <span style="color: #008000; text-decoration-color: #008000">EARMARKED FOR DCCC (C00000935)                                 </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4050820181544765180</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">A     </span> │ <span style="color: #008000; text-decoration-color: #008000">M6    </span> │ <span style="color: #008000; text-decoration-color: #008000">P     </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">201804059101865942</span> │ <span style="color: #008000; text-decoration-color: #008000">24T   </span> │ <span style="color: #008000; text-decoration-color: #008000">IND   </span> │ <span style="color: #008000; text-decoration-color: #008000">STOTT, JIM       </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">039020760</span> │ <span style="color: #008000; text-decoration-color: #008000">NONE             </span> │ <span style="color: #008000; text-decoration-color: #008000">NONE                   </span> │ <span style="color: #008000; text-decoration-color: #008000">05192017</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span> │ <span style="color: #008000; text-decoration-color: #008000">C00000935</span> │ <span style="color: #008000; text-decoration-color: #008000">SA11AI_81605223</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1217152</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │ <span style="color: #008000; text-decoration-color: #008000">EARMARKED FOR DCCC (C00000935)                                 </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4050820181544765181</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">A     </span> │ <span style="color: #008000; text-decoration-color: #008000">M6    </span> │ <span style="color: #008000; text-decoration-color: #008000">P     </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">201804059101865943</span> │ <span style="color: #008000; text-decoration-color: #008000">24T   </span> │ <span style="color: #008000; text-decoration-color: #008000">IND   </span> │ <span style="color: #008000; text-decoration-color: #008000">STOTT, JIM       </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">039020760</span> │ <span style="color: #008000; text-decoration-color: #008000">NONE             </span> │ <span style="color: #008000; text-decoration-color: #008000">NONE                   </span> │ <span style="color: #008000; text-decoration-color: #008000">05242017</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">15</span> │ <span style="color: #008000; text-decoration-color: #008000">C00000935</span> │ <span style="color: #008000; text-decoration-color: #008000">SA11AI_82200022</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1217152</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │ <span style="color: #008000; text-decoration-color: #008000">EARMARKED FOR DCCC (C00000935)                                 </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4050820181544765182</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">A     </span> │ <span style="color: #008000; text-decoration-color: #008000">M6    </span> │ <span style="color: #008000; text-decoration-color: #008000">P     </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">201804059101865943</span> │ <span style="color: #008000; text-decoration-color: #008000">24T   </span> │ <span style="color: #008000; text-decoration-color: #008000">IND   </span> │ <span style="color: #008000; text-decoration-color: #008000">STOTT, JIM       </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">03902    </span> │ <span style="color: #008000; text-decoration-color: #008000">NOT EMPLOYED     </span> │ <span style="color: #008000; text-decoration-color: #008000">NOT EMPLOYED           </span> │ <span style="color: #008000; text-decoration-color: #008000">05292017</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">100</span> │ <span style="color: #008000; text-decoration-color: #008000">C00213512</span> │ <span style="color: #008000; text-decoration-color: #008000">SA11AI_82589834</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1217152</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │ <span style="color: #008000; text-decoration-color: #008000">EARMARKED FOR NANCY PELOSI FOR CONGRESS (C00213512)            </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4050820181544765184</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">A     </span> │ <span style="color: #008000; text-decoration-color: #008000">M6    </span> │ <span style="color: #008000; text-decoration-color: #008000">P     </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">201804059101865944</span> │ <span style="color: #008000; text-decoration-color: #008000">24T   </span> │ <span style="color: #008000; text-decoration-color: #008000">IND   </span> │ <span style="color: #008000; text-decoration-color: #008000">STOTT, JIM       </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">039020760</span> │ <span style="color: #008000; text-decoration-color: #008000">NONE             </span> │ <span style="color: #008000; text-decoration-color: #008000">NONE                   </span> │ <span style="color: #008000; text-decoration-color: #008000">05302017</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">35</span> │ <span style="color: #008000; text-decoration-color: #008000">C00000935</span> │ <span style="color: #008000; text-decoration-color: #008000">SA11AI_82643727</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1217152</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │ <span style="color: #008000; text-decoration-color: #008000">EARMARKED FOR DCCC (C00000935)                                 </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4050820181544765185</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">A     </span> │ <span style="color: #008000; text-decoration-color: #008000">M6    </span> │ <span style="color: #008000; text-decoration-color: #008000">P     </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">201804059101867050</span> │ <span style="color: #008000; text-decoration-color: #008000">24T   </span> │ <span style="color: #008000; text-decoration-color: #008000">IND   </span> │ <span style="color: #008000; text-decoration-color: #008000">STRANGE, WINIFRED</span> │ <span style="color: #008000; text-decoration-color: #008000">ANNA MSRIA  </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │ <span style="color: #008000; text-decoration-color: #008000">34216    </span> │ <span style="color: #008000; text-decoration-color: #008000">NOT EMPLOYED     </span> │ <span style="color: #008000; text-decoration-color: #008000">NOT EMPLOYED           </span> │ <span style="color: #008000; text-decoration-color: #008000">05162017</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">25</span> │ <span style="color: #008000; text-decoration-color: #008000">C00000935</span> │ <span style="color: #008000; text-decoration-color: #008000">SA11AI_81325918</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1217152</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │ <span style="color: #008000; text-decoration-color: #008000">EARMARKED FOR DCCC (C00000935)                                 </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4050820181544768505</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">A     </span> │ <span style="color: #008000; text-decoration-color: #008000">M6    </span> │ <span style="color: #008000; text-decoration-color: #008000">P     </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">201804059101867051</span> │ <span style="color: #008000; text-decoration-color: #008000">24T   </span> │ <span style="color: #008000; text-decoration-color: #008000">IND   </span> │ <span style="color: #008000; text-decoration-color: #008000">STRANGE, WINIFRED</span> │ <span style="color: #008000; text-decoration-color: #008000">ANNA MSRIA  </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │ <span style="color: #008000; text-decoration-color: #008000">34216    </span> │ <span style="color: #008000; text-decoration-color: #008000">NOT EMPLOYED     </span> │ <span style="color: #008000; text-decoration-color: #008000">NOT EMPLOYED           </span> │ <span style="color: #008000; text-decoration-color: #008000">05232017</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">25</span> │ <span style="color: #008000; text-decoration-color: #008000">C00000935</span> │ <span style="color: #008000; text-decoration-color: #008000">SA11AI_81991189</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1217152</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │ <span style="color: #008000; text-decoration-color: #008000">EARMARKED FOR DCCC (C00000935)                                 </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4050820181544768506</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │                  <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>        │     <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>               │       <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                               │                   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└───────────┴────────┴────────┴────────┴────────────────────┴────────┴────────┴───────────────────┴──────────────┴────────┴───────────┴───────────────────┴─────────────────────────┴──────────┴───────┴───────────┴─────────────────┴─────────┴──────────┴─────────────────────────────────────────────────────────────────┴─────────────────────┘
</pre>
</div>
</div>
<div id="d2a81789" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For a more comprehesive description of the columns and their meaning, see</span></span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># https://www.fec.gov/campaign-finance-data/contributions-individuals-file-description/</span></span>
<span id="cb3-3">columns <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb3-4">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CMTE_ID"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"keep"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Committee ID</span></span>
<span id="cb3-5">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AMNDT_IND"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drop"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Amendment indicator. A = amendment, N = new, T = termination</span></span>
<span id="cb3-6">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RPT_TP"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drop"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Report type (monthly, quarterly, etc)</span></span>
<span id="cb3-7">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TRANSACTION_PGI"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"keep"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Primary/general indicator</span></span>
<span id="cb3-8">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"IMAGE_NUM"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drop"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Image number</span></span>
<span id="cb3-9">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TRANSACTION_TP"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drop"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Transaction type</span></span>
<span id="cb3-10">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ENTITY_TP"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"keep"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Entity type</span></span>
<span id="cb3-11">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"NAME"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drop"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Contributor name</span></span>
<span id="cb3-12">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CITY"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"keep"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Contributor city</span></span>
<span id="cb3-13">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"STATE"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"keep"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Contributor state</span></span>
<span id="cb3-14">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ZIP_CODE"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drop"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Contributor zip code</span></span>
<span id="cb3-15">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"EMPLOYER"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drop"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Contributor employer</span></span>
<span id="cb3-16">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OCCUPATION"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drop"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Contributor occupation</span></span>
<span id="cb3-17">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TRANSACTION_DT"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"keep"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Transaction date</span></span>
<span id="cb3-18">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TRANSACTION_AMT"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"keep"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Transaction amount</span></span>
<span id="cb3-19">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Other ID. For individual contributions will be null. For contributions from</span></span>
<span id="cb3-20">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># other FEC committees, will be the committee ID of the other committee.</span></span>
<span id="cb3-21">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OTHER_ID"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drop"</span>,</span>
<span id="cb3-22">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TRAN_ID"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drop"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Transaction ID</span></span>
<span id="cb3-23">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FILE_NUM"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drop"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># File number, unique number assigned to each report filed with the FEC</span></span>
<span id="cb3-24">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MEMO_CD"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drop"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Memo code</span></span>
<span id="cb3-25">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MEMO_TEXT"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drop"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Memo text</span></span>
<span id="cb3-26">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SUB_ID"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drop"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Submission ID. Unique number assigned to each transaction.</span></span>
<span id="cb3-27">}</span>
<span id="cb3-28"></span>
<span id="cb3-29">renaming <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {old: new <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> old, new <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(raw.columns, columns.keys())}</span>
<span id="cb3-30">to_keep <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [k <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> k, v <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> columns.items() <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> v <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"keep"</span>]</span>
<span id="cb3-31">kept <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> raw.relabel(renaming)[to_keep]</span>
<span id="cb3-32">kept</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> CMTE_ID   </span>┃<span style="font-weight: bold"> TRANSACTION_PGI </span>┃<span style="font-weight: bold"> ENTITY_TP </span>┃<span style="font-weight: bold"> CITY         </span>┃<span style="font-weight: bold"> STATE  </span>┃<span style="font-weight: bold"> TRANSACTION_DT </span>┃<span style="font-weight: bold"> TRANSACTION_AMT </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>           │
├───────────┼─────────────────┼───────────┼──────────────┼────────┼────────────────┼─────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">OCOEE       </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │ <span style="color: #008000; text-decoration-color: #008000">05182017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">OCOEE       </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │ <span style="color: #008000; text-decoration-color: #008000">05192017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">15</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">05132017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">35</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">05152017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">35</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">05192017      </span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">05242017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">15</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">05292017      </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">100</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">05302017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">35</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">ANNA MSRIA  </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │ <span style="color: #008000; text-decoration-color: #008000">05162017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">25</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">ANNA MSRIA  </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │ <span style="color: #008000; text-decoration-color: #008000">05232017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">25</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>              │               <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└───────────┴─────────────────┴───────────┴──────────────┴────────┴────────────────┴─────────────────┘
</pre>
</div>
</div>
<div id="1e6d16fe" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 21 million rows</span></span>
<span id="cb4-2">kept.count()</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div class="ansi-escaped-output">
<pre><span class="ansi-cyan-fg ansi-bold">21730730</span></pre>
</div>
</div>
</div>
<p>Huh, what’s up with those timings? Previewing the head only took a fraction of a second, but finding the number of rows took 10 seconds.</p>
<p>That’s because duckdb is scanning the .csv file on the fly every time we access it. So we only have to read the first few lines to get that preview, but we have to read the whole file to get the number of rows.</p>
<p>Note that this isn’t a feature of Ibis, but a feature of Duckdb. This what I think is one of the strengths of Ibis: Ibis itself doesn’t have to implement any of the optimimizations or features of the backends. Those backends can focus on what they do best, and Ibis can get those things for free.</p>
<p>So, let’s tell duckdb to actually read in the file to its native format so later accesses will be faster. This will be a ~20 seconds that we’ll only have to pay once.</p>
<div id="185a2d89" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">kept <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> kept.cache()</span>
<span id="cb5-2">kept</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> CMTE_ID   </span>┃<span style="font-weight: bold"> TRANSACTION_PGI </span>┃<span style="font-weight: bold"> ENTITY_TP </span>┃<span style="font-weight: bold"> CITY         </span>┃<span style="font-weight: bold"> STATE  </span>┃<span style="font-weight: bold"> TRANSACTION_DT </span>┃<span style="font-weight: bold"> TRANSACTION_AMT </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>           │
├───────────┼─────────────────┼───────────┼──────────────┼────────┼────────────────┼─────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">OCOEE       </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │ <span style="color: #008000; text-decoration-color: #008000">05182017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">OCOEE       </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │ <span style="color: #008000; text-decoration-color: #008000">05192017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">15</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">05132017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">35</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">05152017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">35</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">05192017      </span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">05242017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">15</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">05292017      </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">100</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">05302017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">35</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">ANNA MSRIA  </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │ <span style="color: #008000; text-decoration-color: #008000">05162017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">25</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">ANNA MSRIA  </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │ <span style="color: #008000; text-decoration-color: #008000">05232017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">25</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>              │               <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└───────────┴─────────────────┴───────────┴──────────────┴────────┴────────────────┴─────────────────┘
</pre>
</div>
</div>
<p>Look, now accessing it only takes a fraction of a second!</p>
<div id="9253e73f" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">kept.count()</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div class="ansi-escaped-output">
<pre><span class="ansi-cyan-fg ansi-bold">21730730</span></pre>
</div>
</div>
</div>
<section id="committees-data" class="level3">
<h3 class="anchored" data-anchor-id="committees-data">Committees Data</h3>
<p>The contributions only list an opaque <code>CMTE_ID</code> column. We want to know which actual committee this is. Let’s load the committees table so we can lookup from committee ID to committee name.</p>
<div id="30076e2c" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> read_committees():</span>
<span id="cb7-2">    committees_url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://cg-519a459a-0ea3-42c2-b7bc-fa1143481f74.s3-us-gov-west-1.amazonaws.com/bulk-downloads/2018/committee_summary_2018.csv"</span></span>
<span id="cb7-3">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># This just creates a view, it doesn't actually fetch the data yet</span></span>
<span id="cb7-4">    tmp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.read_csv(committees_url)</span>
<span id="cb7-5">    tmp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tmp[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CMTE_ID"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CMTE_NM"</span>]</span>
<span id="cb7-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The raw table contains multiple rows for each committee id, so lets pick</span></span>
<span id="cb7-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># an arbitrary row for each committee id as the representative name.</span></span>
<span id="cb7-8">    deduped <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tmp.group_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CMTE_ID"</span>).agg(CMTE_NM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.CMTE_NM.arbitrary())</span>
<span id="cb7-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> deduped</span>
<span id="cb7-10"></span>
<span id="cb7-11"></span>
<span id="cb7-12">comms <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> read_committees().cache()</span>
<span id="cb7-13">comms</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> CMTE_ID   </span>┃<span style="font-weight: bold"> CMTE_NM                                                        </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                                         │
├───────────┼────────────────────────────────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">C00659441</span> │ <span style="color: #008000; text-decoration-color: #008000">JASON ORTITAY FOR CONGRESS                                    </span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00661249</span> │ <span style="color: #008000; text-decoration-color: #008000">SERVICE AFTER SERVICE                                         </span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00457754</span> │ <span style="color: #008000; text-decoration-color: #008000">U.S. TRAVEL ASSOCIATION PAC                                   </span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00577635</span> │ <span style="color: #008000; text-decoration-color: #008000">ISAKSON VICTORY COMMITTEE                                     </span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00297911</span> │ <span style="color: #008000; text-decoration-color: #008000">TEXAS FORESTRY ASSOCIATION FORESTRY POLITICAL ACTION COMMITTEE</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00551382</span> │ <span style="color: #008000; text-decoration-color: #008000">VOTECLIMATE.US PAC                                            </span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00414318</span> │ <span style="color: #008000; text-decoration-color: #008000">LOEBSACK FOR CONGRESS                                         </span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00610709</span> │ <span style="color: #008000; text-decoration-color: #008000">AUSTIN INNOVATION 2016                                        </span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00131607</span> │ <span style="color: #008000; text-decoration-color: #008000">FLORIDA CITRUS MUTUAL POLITCAL ACTION COMMITTEE               </span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00136531</span> │ <span style="color: #008000; text-decoration-color: #008000">NATIONAL DEMOCRATIC POLICY COMMITTEE                          </span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                              │
└───────────┴────────────────────────────────────────────────────────────────┘
</pre>
</div>
</div>
<p>Now add the committee name to the contributions table:</p>
<div id="0a9f3b35" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">together <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> kept.left_join(comms, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CMTE_ID"</span>).drop(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CMTE_ID"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CMTE_ID_right"</span>)</span>
<span id="cb8-2">together</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> TRANSACTION_PGI </span>┃<span style="font-weight: bold"> ENTITY_TP </span>┃<span style="font-weight: bold"> CITY             </span>┃<span style="font-weight: bold"> STATE  </span>┃<span style="font-weight: bold"> TRANSACTION_DT </span>┃<span style="font-weight: bold"> TRANSACTION_AMT </span>┃<span style="font-weight: bold"> CMTE_NM                                         </span>┃
┡━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                          │
├─────────────────┼───────────┼──────────────────┼────────┼────────────────┼─────────────────┼─────────────────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">COHASSET        </span> │ <span style="color: #008000; text-decoration-color: #008000">MA    </span> │ <span style="color: #008000; text-decoration-color: #008000">01312017      </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">230</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">KEY LARGO       </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │ <span style="color: #008000; text-decoration-color: #008000">01042017      </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5000</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">LOOKOUT MOUNTAIN</span> │ <span style="color: #008000; text-decoration-color: #008000">GA    </span> │ <span style="color: #008000; text-decoration-color: #008000">01312017      </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">230</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">NORTH YARMOUTH  </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">01312017      </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">ALPHARETTA      </span> │ <span style="color: #008000; text-decoration-color: #008000">GA    </span> │ <span style="color: #008000; text-decoration-color: #008000">01312017      </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">FALMOUTH        </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">01312017      </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">FALMOUTH        </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">01312017      </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">HOLLIS CENTER   </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">01312017      </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">FALMOUTH        </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">01312017      </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">ALEXANDRIA      </span> │ <span style="color: #008000; text-decoration-color: #008000">VA    </span> │ <span style="color: #008000; text-decoration-color: #008000">01312017      </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>              │               <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                               │
└─────────────────┴───────────┴──────────────────┴────────┴────────────────┴─────────────────┴─────────────────────────────────────────────────┘
</pre>
</div>
</div>
</section>
</section>
<section id="cleaning" class="level2">
<h2 class="anchored" data-anchor-id="cleaning">Cleaning</h2>
<p>First, let’s drop any contributions that don’t have a committee name. There are only 6 of them.</p>
<div id="14ae871f" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># We can do this fearlessly, no .copy() needed, because</span></span>
<span id="cb9-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># everything in Ibis is immutable. If we did this in pandas,</span></span>
<span id="cb9-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># we might start modifying the original DataFrame accidentally!</span></span>
<span id="cb9-4">cleaned <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> together</span>
<span id="cb9-5"></span>
<span id="cb9-6">has_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cleaned.CMTE_NM.notnull()</span>
<span id="cb9-7">cleaned <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cleaned[has_name]</span>
<span id="cb9-8">has_name.value_counts()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> NotNull(CMTE_NM) </span>┃<span style="font-weight: bold"> NotNull(CMTE_NM)_count </span>┃
┡━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">boolean</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>                  │
├──────────────────┼────────────────────────┤
│ True             │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21730724</span> │
│ False            │                      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6</span> │
└──────────────────┴────────────────────────┘
</pre>
</div>
</div>
<p>Let’s look at the <code>ENTITY_TP</code> column. This represents the type of entity that made the contribution:</p>
<div id="72577ed8" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">together.ENTITY_TP.value_counts()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> ENTITY_TP </span>┃<span style="font-weight: bold"> ENTITY_TP_count </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>           │
├───────────┼─────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21687992</span> │
│ <span style="color: #008000; text-decoration-color: #008000">CCM      </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">698</span> │
│ <span style="color: #008000; text-decoration-color: #008000">CAN      </span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">13659</span> │
│ <span style="color: #008000; text-decoration-color: #008000">ORG      </span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18555</span> │
│ <span style="color: #008000; text-decoration-color: #008000">PTY      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">49</span> │
│ <span style="color: #008000; text-decoration-color: #008000">COM      </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">867</span> │
│ <span style="color: #008000; text-decoration-color: #008000">PAC      </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3621</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>      │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5289</span> │
└───────────┴─────────────────┘
</pre>
</div>
</div>
<p>We only care about contributions from individuals.</p>
<p>Once we filter on this column, the contents of it are irrelevant, so let’s drop it.</p>
<div id="f29924a2" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">cleaned <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> together[_.ENTITY_TP <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"IND"</span>].drop(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ENTITY_TP"</span>)</span></code></pre></div>
</div>
<p>It looks like the <code>TRANSACTION_DT</code> column was a raw string like “MMDDYYYY”, so let’s convert that to a proper date type.</p>
<div id="15443483" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> ibis.expr.types <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> StringValue, DateValue</span>
<span id="cb12-2"></span>
<span id="cb12-3"></span>
<span id="cb12-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> mmddyyyy_to_date(val: StringValue) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> DateValue:</span>
<span id="cb12-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> val.cast(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>).lpad(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0"</span>).to_timestamp(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%m</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%d</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">%Y"</span>).date()</span>
<span id="cb12-6"></span>
<span id="cb12-7"></span>
<span id="cb12-8">cleaned <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cleaned.mutate(date<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>mmddyyyy_to_date(_.TRANSACTION_DT)).drop(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TRANSACTION_DT"</span>)</span>
<span id="cb12-9">cleaned</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> TRANSACTION_PGI </span>┃<span style="font-weight: bold"> CITY             </span>┃<span style="font-weight: bold"> STATE  </span>┃<span style="font-weight: bold"> TRANSACTION_AMT </span>┃<span style="font-weight: bold"> CMTE_NM                                         </span>┃<span style="font-weight: bold"> date       </span>┃
┡━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">date</span>       │
├─────────────────┼──────────────────┼────────┼─────────────────┼─────────────────────────────────────────────────┼────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">COHASSET        </span> │ <span style="color: #008000; text-decoration-color: #008000">MA    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">230</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">KEY LARGO       </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5000</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-04</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">LOOKOUT MOUNTAIN</span> │ <span style="color: #008000; text-decoration-color: #008000">GA    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">230</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">NORTH YARMOUTH  </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">ALPHARETTA      </span> │ <span style="color: #008000; text-decoration-color: #008000">GA    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">FALMOUTH        </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">FALMOUTH        </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">HOLLIS CENTER   </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">FALMOUTH        </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">ALEXANDRIA      </span> │ <span style="color: #008000; text-decoration-color: #008000">VA    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │               <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>          │
└─────────────────┴──────────────────┴────────┴─────────────────┴─────────────────────────────────────────────────┴────────────┘
</pre>
</div>
</div>
<p>The <code>TRANSACTION_PGI</code> column represents the type (primary, general, etc) of election, and the year. But it seems to be not very consistent:</p>
<div id="fa016097" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1">cleaned.TRANSACTION_PGI.topk(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> TRANSACTION_PGI </span>┃<span style="font-weight: bold"> Count(TRANSACTION_PGI) </span>┃
┡━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>                  │
├─────────────────┼────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17013596</span> │
│ <span style="color: #008000; text-decoration-color: #008000">G2018          </span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2095123</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P2018          </span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1677183</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P2020          </span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">208501</span> │
│ <span style="color: #008000; text-decoration-color: #008000">O2018          </span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">161874</span> │
│ <span style="color: #008000; text-decoration-color: #008000">S2017          </span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">124336</span> │
│ <span style="color: #008000; text-decoration-color: #008000">G2017          </span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">98401</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P2022          </span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">91136</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P2017          </span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">61153</span> │
│ <span style="color: #008000; text-decoration-color: #008000">R2017          </span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">54281</span> │
└─────────────────┴────────────────────────┘
</pre>
</div>
</div>
<div id="35c8a393" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_election_type(pgi: StringValue) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> StringValue:</span>
<span id="cb14-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Use the first letter of the TRANSACTION_PGI column to determine the election type</span></span>
<span id="cb14-3"></span>
<span id="cb14-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    If the first letter is not one of the known election stage, then return null.</span></span>
<span id="cb14-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb14-6">    election_types <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb14-7">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"primary"</span>,</span>
<span id="cb14-8">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"G"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"general"</span>,</span>
<span id="cb14-9">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"O"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"other"</span>,</span>
<span id="cb14-10">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"convention"</span>,</span>
<span id="cb14-11">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"runoff"</span>,</span>
<span id="cb14-12">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"special"</span>,</span>
<span id="cb14-13">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"recount"</span>,</span>
<span id="cb14-14">    }</span>
<span id="cb14-15">    first_letter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pgi[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb14-16">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> first_letter.substitute(election_types, else_<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ibis.NA)</span>
<span id="cb14-17"></span>
<span id="cb14-18"></span>
<span id="cb14-19">cleaned <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cleaned.mutate(election_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>get_election_type(_.TRANSACTION_PGI)).drop(</span>
<span id="cb14-20">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TRANSACTION_PGI"</span></span>
<span id="cb14-21">)</span>
<span id="cb14-22">cleaned</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> CITY             </span>┃<span style="font-weight: bold"> STATE  </span>┃<span style="font-weight: bold"> TRANSACTION_AMT </span>┃<span style="font-weight: bold"> CMTE_NM                                         </span>┃<span style="font-weight: bold"> date       </span>┃<span style="font-weight: bold"> election_type </span>┃
┡━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">date</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>        │
├──────────────────┼────────┼─────────────────┼─────────────────────────────────────────────────┼────────────┼───────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">COHASSET        </span> │ <span style="color: #008000; text-decoration-color: #008000">MA    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">230</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">KEY LARGO       </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5000</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-04</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">LOOKOUT MOUNTAIN</span> │ <span style="color: #008000; text-decoration-color: #008000">GA    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">230</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">NORTH YARMOUTH  </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">ALPHARETTA      </span> │ <span style="color: #008000; text-decoration-color: #008000">GA    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">FALMOUTH        </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">FALMOUTH        </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">HOLLIS CENTER   </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">FALMOUTH        </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">ALEXANDRIA      </span> │ <span style="color: #008000; text-decoration-color: #008000">VA    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │               <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>             │
└──────────────────┴────────┴─────────────────┴─────────────────────────────────────────────────┴────────────┴───────────────┘
</pre>
</div>
</div>
<p>That worked well! There are 0 nulls in the resulting column, so we always were able to determine the election type.</p>
<div id="e7038c36" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1">cleaned.election_type.topk(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> election_type </span>┃<span style="font-weight: bold"> Count(election_type) </span>┃
┡━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>                │
├───────────────┼──────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">19061953</span> │
│ <span style="color: #008000; text-decoration-color: #008000">general      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2216685</span> │
│ <span style="color: #008000; text-decoration-color: #008000">other        </span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">161965</span> │
│ <span style="color: #008000; text-decoration-color: #008000">special      </span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">149572</span> │
│ <span style="color: #008000; text-decoration-color: #008000">runoff       </span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">69637</span> │
│ <span style="color: #008000; text-decoration-color: #008000">convention   </span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">22453</span> │
│ <span style="color: #008000; text-decoration-color: #008000">recount      </span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5063</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>          │                    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │
└───────────────┴──────────────────────┘
</pre>
</div>
</div>
<p>About 1/20 of transactions are negative. These could represent refunds, or they could be data entry errors. Let’s drop them to keep it simple.</p>
<div id="ab64b9b2" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1">above_zero <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cleaned.TRANSACTION_AMT <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb16-2">cleaned <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cleaned[above_zero]</span>
<span id="cb16-3">above_zero.value_counts()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> Greater(TRANSACTION_AMT, 0) </span>┃<span style="font-weight: bold"> Greater(TRANSACTION_AMT, 0)_count </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">boolean</span>                     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>                             │
├─────────────────────────────┼───────────────────────────────────┤
│ True                        │                          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20669809</span> │
│ False                       │                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1018183</span> │
└─────────────────────────────┴───────────────────────────────────┘
</pre>
</div>
</div>
</section>
<section id="adding-features" class="level2">
<h2 class="anchored" data-anchor-id="adding-features">Adding Features</h2>
<p>Now that the data is cleaned up to a usable format, let’s add some features.</p>
<p>First, it’s useful to categorize donations by size, placing them into buckets of small, medium, large, etc.</p>
<div id="db1e9cbe" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1">edges <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb17-2">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,</span>
<span id="cb17-3">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>,</span>
<span id="cb17-4">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,</span>
<span id="cb17-5">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>,</span>
<span id="cb17-6">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,</span>
<span id="cb17-7">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5000</span>,</span>
<span id="cb17-8">]</span>
<span id="cb17-9">labels <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb17-10">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;10"</span>,</span>
<span id="cb17-11">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10-50"</span>,</span>
<span id="cb17-12">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"50-100"</span>,</span>
<span id="cb17-13">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"100-500"</span>,</span>
<span id="cb17-14">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"500-1000"</span>,</span>
<span id="cb17-15">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1000-5000"</span>,</span>
<span id="cb17-16">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"5000+"</span>,</span>
<span id="cb17-17">]</span>
<span id="cb17-18"></span>
<span id="cb17-19"></span>
<span id="cb17-20"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> bucketize(vals, edges, str_labels):</span>
<span id="cb17-21">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Uses Ibis's .bucket() method to create a categorical column</span></span>
<span id="cb17-22">    int_labels <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> vals.bucket(edges, include_under<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, include_over<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb17-23">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Map the integer labels to the string labels</span></span>
<span id="cb17-24">    int_to_str <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(i): s <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i, s <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(str_labels)}</span>
<span id="cb17-25">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> int_labels.cast(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>).substitute(int_to_str)</span>
<span id="cb17-26"></span>
<span id="cb17-27"></span>
<span id="cb17-28">featured <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cleaned.mutate(amount_bucket<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>bucketize(_.TRANSACTION_AMT, edges, labels))</span>
<span id="cb17-29">featured</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> CITY             </span>┃<span style="font-weight: bold"> STATE  </span>┃<span style="font-weight: bold"> TRANSACTION_AMT </span>┃<span style="font-weight: bold"> CMTE_NM                                         </span>┃<span style="font-weight: bold"> date       </span>┃<span style="font-weight: bold"> election_type </span>┃<span style="font-weight: bold"> amount_bucket </span>┃
┡━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">date</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>        │
├──────────────────┼────────┼─────────────────┼─────────────────────────────────────────────────┼────────────┼───────────────┼───────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">COHASSET        </span> │ <span style="color: #008000; text-decoration-color: #008000">MA    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">230</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">100-500      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">KEY LARGO       </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5000</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-04</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">1000-5000    </span> │
│ <span style="color: #008000; text-decoration-color: #008000">LOOKOUT MOUNTAIN</span> │ <span style="color: #008000; text-decoration-color: #008000">GA    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">230</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">100-500      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">NORTH YARMOUTH  </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">100-500      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">ALPHARETTA      </span> │ <span style="color: #008000; text-decoration-color: #008000">GA    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">100-500      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">FALMOUTH        </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">100-500      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">FALMOUTH        </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">100-500      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">HOLLIS CENTER   </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">100-500      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">FALMOUTH        </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">100-500      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">ALEXANDRIA      </span> │ <span style="color: #008000; text-decoration-color: #008000">VA    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">100-500      </span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │               <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>             │
└──────────────────┴────────┴─────────────────┴─────────────────────────────────────────────────┴────────────┴───────────────┴───────────────┘
</pre>
</div>
</div>
</section>
<section id="analysis" class="level2">
<h2 class="anchored" data-anchor-id="analysis">Analysis</h2>
<section id="by-donation-size" class="level3">
<h3 class="anchored" data-anchor-id="by-donation-size">By donation size</h3>
<p>One thing we can look at is the donation breakdown by size: - Are most donations small or large? - Where do politicians/committees get most of their money from? Large or small donations?</p>
<p>We also will compare performance of Ibis vs pandas during this groupby.</p>
<div id="2c306d0f" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> summary_by(table, by):</span>
<span id="cb18-2">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> table.group_by(by).agg(</span>
<span id="cb18-3">        n_donations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.count(),</span>
<span id="cb18-4">        total_amount<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.TRANSACTION_AMT.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(),</span>
<span id="cb18-5">        mean_amount<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.TRANSACTION_AMT.mean(),</span>
<span id="cb18-6">        median_amount<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.TRANSACTION_AMT.approx_median(),</span>
<span id="cb18-7">    )</span>
<span id="cb18-8"></span>
<span id="cb18-9"></span>
<span id="cb18-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> summary_by_pandas(df, by):</span>
<span id="cb18-11">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> df.groupby(by, as_index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>).agg(</span>
<span id="cb18-12">        n_donations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"election_type"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span>),</span>
<span id="cb18-13">        total_amount<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TRANSACTION_AMT"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sum"</span>),</span>
<span id="cb18-14">        mean_amount<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TRANSACTION_AMT"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean"</span>),</span>
<span id="cb18-15">        median_amount<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TRANSACTION_AMT"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"median"</span>),</span>
<span id="cb18-16">    )</span>
<span id="cb18-17"></span>
<span id="cb18-18"></span>
<span id="cb18-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># persist the input data so the following timings of the group_by are accurate.</span></span>
<span id="cb18-20">subset <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> featured[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"election_type"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"amount_bucket"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TRANSACTION_AMT"</span>]</span>
<span id="cb18-21">subset <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> subset.cache()</span>
<span id="cb18-22">pandas_subset <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> subset.execute()</span></code></pre></div>
</div>
<p>Let’s take a look at what we are actually computing:</p>
<div id="a621ca5f" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1">by_type_and_bucket <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> summary_by(subset, [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"election_type"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"amount_bucket"</span>])</span>
<span id="cb19-2">by_type_and_bucket</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> election_type </span>┃<span style="font-weight: bold"> amount_bucket </span>┃<span style="font-weight: bold"> n_donations </span>┃<span style="font-weight: bold"> total_amount </span>┃<span style="font-weight: bold"> mean_amount  </span>┃<span style="font-weight: bold"> median_amount </span>┃
┡━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>         │
├───────────────┼───────────────┼─────────────┼──────────────┼──────────────┼───────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">50-100       </span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2663933</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">155426540</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">58.344763</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">50</span> │
│ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">10-50        </span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">8115403</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">187666251</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">23.124699</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">25</span> │
│ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">100-500      </span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3636287</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">637353634</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">175.275943</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">150</span> │
│ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">&lt;10          </span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2423728</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10080721</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.159180</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span> │
│ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">500-1000     </span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">634677</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">334630687</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">527.245649</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">500</span> │
│ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">1000-5000    </span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">684755</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1231394874</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1798.299938</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1008</span> │
│ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">5000+        </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">44085</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1558371116</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">35349.237065</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10000</span> │
│ <span style="color: #008000; text-decoration-color: #008000">general      </span> │ <span style="color: #008000; text-decoration-color: #008000">100-500      </span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">700821</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">123174568</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">175.757530</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">150</span> │
│ <span style="color: #008000; text-decoration-color: #008000">general      </span> │ <span style="color: #008000; text-decoration-color: #008000">50-100       </span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">304363</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">16184312</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">53.174374</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">50</span> │
│ <span style="color: #008000; text-decoration-color: #008000">general      </span> │ <span style="color: #008000; text-decoration-color: #008000">10-50        </span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">660787</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">14411588</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21.809733</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">25</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>             │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │            <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │            <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└───────────────┴───────────────┴─────────────┴──────────────┴──────────────┴───────────────┘
</pre>
</div>
</div>
<p>OK, now let’s do our timings.</p>
<p>One interesting thing to pay attention to here is the execution time for the following groupby. Before, we could get away with lazy execution: because we only wanted to preview the first few rows, we only had to compute the first few rows, so all our previews were very fast.</p>
<p>But now, as soon as we do a groupby, we have to actually go through the whole dataset in order to compute the aggregate per group. So this is going to be slower. BUT, duckdb is still quite fast. It only takes milliseconds to groupby-agg all 20 million rows!</p>
<div id="fc3694c3" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>timeit summary_by(subset, [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"election_type"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"amount_bucket"</span>]).execute()  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># .execute() so we actually fetch the data</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>679 ms ± 11.6 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)</code></pre>
</div>
</div>
<p>Now let’s try the same thing in pandas:</p>
<div id="ab990661" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>timeit summary_by_pandas(pandas_subset, [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"election_type"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"amount_bucket"</span>])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>3.59 s ± 31.3 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)</code></pre>
</div>
</div>
<p>It takes about 4 seconds, which is about 10 times slower than duckdb. At this scale, it again doesn’t matter, but you could imagine with a dataset much larger than this, it would matter.</p>
<p>Let’s also think about memory usage:</p>
<div id="03834f0b" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1">pandas_subset.memory_usage(deep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e9</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># GB</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>2.782586663</code></pre>
</div>
</div>
<p>The source dataframe is couple gigabytes, so probably during the groupby, the peak memory usage is going to be a bit higher than this. You could use a profiler such as <a href="https://github.com/pythonspeed/filprofiler">FIL</a> if you wanted an exact number, I was too lazy to use that here.</p>
<p>Again, this works on my laptop at this dataset size, but much larger than this and I’d start having problems. Duckdb on the other hand is designed around working out of core so it should scale to datasets into the hundreds of gigabytes, much larger than your computer’s RAM.</p>
</section>
<section id="back-to-analysis" class="level3">
<h3 class="anchored" data-anchor-id="back-to-analysis">Back to analysis</h3>
<p>OK, let’s plot the result of that groupby.</p>
<p>Surprise! (Or maybe not…) Most donations are small. But most of the money comes from donations larger than $1000.</p>
<p>Well if that’s the case, why do politicians spend so much time soliciting small donations? One explanation is that they can use the number of donations as a marketing pitch, to show how popular they are, and thus how viable of a candidate they are.</p>
<p>This also might explain whose interests are being served by our politicians.</p>
<div id="cf2c035e" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> altair <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> alt</span>
<span id="cb26-2"></span>
<span id="cb26-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Do some bookkeeping so the buckets are displayed smallest to largest on the charts</span></span>
<span id="cb26-4">bucket_col <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> alt.Column(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"amount_bucket:N"</span>, sort<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>labels)</span>
<span id="cb26-5"></span>
<span id="cb26-6">n_by_bucket <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb26-7">    alt.Chart(by_type_and_bucket.execute())</span>
<span id="cb26-8">    .mark_bar()</span>
<span id="cb26-9">    .encode(</span>
<span id="cb26-10">        x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>bucket_col,</span>
<span id="cb26-11">        y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n_donations:Q"</span>,</span>
<span id="cb26-12">        color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"election_type:N"</span>,</span>
<span id="cb26-13">    )</span>
<span id="cb26-14">)</span>
<span id="cb26-15">total_by_bucket <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb26-16">    alt.Chart(by_type_and_bucket.execute())</span>
<span id="cb26-17">    .mark_bar()</span>
<span id="cb26-18">    .encode(</span>
<span id="cb26-19">        x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>bucket_col,</span>
<span id="cb26-20">        y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"total_amount:Q"</span>,</span>
<span id="cb26-21">        color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"election_type:N"</span>,</span>
<span id="cb26-22">    )</span>
<span id="cb26-23">)</span>
<span id="cb26-24">n_by_bucket <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> total_by_bucket</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">

<style>
  #altair-viz-86646cc3a2964613b7509f2dcc47f742.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-86646cc3a2964613b7509f2dcc47f742.vega-embed details,
  #altair-viz-86646cc3a2964613b7509f2dcc47f742.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-86646cc3a2964613b7509f2dcc47f742"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-86646cc3a2964613b7509f2dcc47f742") {
      outputDiv = document.getElementById("altair-viz-86646cc3a2964613b7509f2dcc47f742");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.8.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "hconcat": [{"data": {"name": "data-7df486c18103705f447413da2d200c84"}, "mark": {"type": "bar"}, "encoding": {"color": {"field": "election_type", "type": "nominal"}, "x": {"field": "amount_bucket", "sort": ["<10", "10-50", "50-100", "100-500", "500-1000", "1000-5000", "5000+"], "type": "nominal"}, "y": {"field": "n_donations", "type": "quantitative"}}}, {"data": {"name": "data-334b351fcf36268adfd9e34181060327"}, "mark": {"type": "bar"}, "encoding": {"color": {"field": "election_type", "type": "nominal"}, "x": {"field": "amount_bucket", "sort": ["<10", "10-50", "50-100", "100-500", "500-1000", "1000-5000", "5000+"], "type": "nominal"}, "y": {"field": "total_amount", "type": "quantitative"}}}], "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json", "datasets": {"data-7df486c18103705f447413da2d200c84": [{"election_type": "primary", "amount_bucket": "<10", "n_donations": 2423728, "total_amount": 10080721, "mean_amount": 4.159179990493983, "median_amount": 5}, {"election_type": "primary", "amount_bucket": "10-50", "n_donations": 8115403, "total_amount": 187666251, "mean_amount": 23.12469892129818, "median_amount": 25}, {"election_type": "primary", "amount_bucket": "100-500", "n_donations": 3636287, "total_amount": 637353634, "mean_amount": 175.27594329050484, "median_amount": 150}, {"election_type": "primary", "amount_bucket": "50-100", "n_donations": 2663933, "total_amount": 155426540, "mean_amount": 58.34476317535013, "median_amount": 50}, {"election_type": "primary", "amount_bucket": "5000+", "n_donations": 44085, "total_amount": 1558371116, "mean_amount": 35349.237064761255, "median_amount": 10000}, {"election_type": "primary", "amount_bucket": "1000-5000", "n_donations": 684755, "total_amount": 1231394874, "mean_amount": 1798.2999379340056, "median_amount": 1008}, {"election_type": "general", "amount_bucket": "100-500", "n_donations": 700821, "total_amount": 123174568, "mean_amount": 175.75753009684357, "median_amount": 149}, {"election_type": "primary", "amount_bucket": "500-1000", "n_donations": 634677, "total_amount": 334630687, "mean_amount": 527.2456493618014, "median_amount": 500}, {"election_type": "general", "amount_bucket": "1000-5000", "n_donations": 246101, "total_amount": 460025242, "mean_amount": 1869.2538510611496, "median_amount": 1959}, {"election_type": "general", "amount_bucket": "10-50", "n_donations": 660787, "total_amount": 14411588, "mean_amount": 21.809732939661345, "median_amount": 25}, {"election_type": "general", "amount_bucket": "50-100", "n_donations": 304363, "total_amount": 16184312, "mean_amount": 53.174374020495264, "median_amount": 50}, {"election_type": "general", "amount_bucket": "500-1000", "n_donations": 174182, "total_amount": 91015697, "mean_amount": 522.5321617618354, "median_amount": 500}, {"election_type": "general", "amount_bucket": "<10", "n_donations": 115873, "total_amount": 536742, "mean_amount": 4.632157620843509, "median_amount": 5}, {"election_type": "runoff", "amount_bucket": "10-50", "n_donations": 20166, "total_amount": 461107, "mean_amount": 22.865565803828225, "median_amount": 25}, {"election_type": "runoff", "amount_bucket": "50-100", "n_donations": 11578, "total_amount": 585827, "mean_amount": 50.59828986007946, "median_amount": 50}, {"election_type": "runoff", "amount_bucket": "100-500", "n_donations": 18193, "total_amount": 3088289, "mean_amount": 169.75149782883526, "median_amount": 100}, {"election_type": "runoff", "amount_bucket": "500-1000", "n_donations": 4117, "total_amount": 2110393, "mean_amount": 512.6045664318679, "median_amount": 500}, {"election_type": "runoff", "amount_bucket": "1000-5000", "n_donations": 5196, "total_amount": 9601993, "mean_amount": 1847.958622016936, "median_amount": 1894}, {"election_type": "runoff", "amount_bucket": "<10", "n_donations": 10191, "total_amount": 49621, "mean_amount": 4.869100186439015, "median_amount": 5}, {"election_type": "special", "amount_bucket": "100-500", "n_donations": 34497, "total_amount": 5943498, "mean_amount": 172.29028611183583, "median_amount": 117}, {"election_type": "general", "amount_bucket": "5000+", "n_donations": 3125, "total_amount": 44496373, "mean_amount": 14238.83936, "median_amount": 7541}, {"election_type": "special", "amount_bucket": "5000+", "n_donations": 129, "total_amount": 788712, "mean_amount": 6114.046511627907, "median_amount": 5400}, {"election_type": "other", "amount_bucket": "500-1000", "n_donations": 119, "total_amount": 62535, "mean_amount": 525.5042016806723, "median_amount": 500}, {"election_type": "other", "amount_bucket": "100-500", "n_donations": 630, "total_amount": 117988, "mean_amount": 187.2825396825397, "median_amount": 192}, {"election_type": "other", "amount_bucket": "1000-5000", "n_donations": 235, "total_amount": 548212, "mean_amount": 2332.817021276596, "median_amount": 2633}, {"election_type": "other", "amount_bucket": "50-100", "n_donations": 451, "total_amount": 27149, "mean_amount": 60.19733924611973, "median_amount": 50}, {"election_type": "other", "amount_bucket": "10-50", "n_donations": 2644, "total_amount": 64297, "mean_amount": 24.318078668683814, "median_amount": 23}, {"election_type": "convention", "amount_bucket": "100-500", "n_donations": 6350, "total_amount": 1097843, "mean_amount": 172.88866141732282, "median_amount": 138}, {"election_type": "convention", "amount_bucket": "1000-5000", "n_donations": 2822, "total_amount": 4977314, "mean_amount": 1763.7540751240256, "median_amount": 1434}, {"election_type": "convention", "amount_bucket": "10-50", "n_donations": 6848, "total_amount": 141604, "mean_amount": 20.678154205607477, "median_amount": 25}, {"election_type": "convention", "amount_bucket": "500-1000", "n_donations": 1824, "total_amount": 945321, "mean_amount": 518.2680921052631, "median_amount": 500}, {"election_type": "convention", "amount_bucket": "50-100", "n_donations": 2966, "total_amount": 153281, "mean_amount": 51.67936614969656, "median_amount": 50}, {"election_type": "convention", "amount_bucket": "<10", "n_donations": 945, "total_amount": 4660, "mean_amount": 4.931216931216931, "median_amount": 5}, {"election_type": "other", "amount_bucket": "<10", "n_donations": 10993, "total_amount": 25816, "mean_amount": 2.3484035295187846, "median_amount": 1}, {"election_type": "special", "amount_bucket": "1000-5000", "n_donations": 7935, "total_amount": 13493154, "mean_amount": 1700.4604914933836, "median_amount": 1001}, {"election_type": "special", "amount_bucket": "50-100", "n_donations": 22859, "total_amount": 1177660, "mean_amount": 51.518439126820944, "median_amount": 50}, {"election_type": "special", "amount_bucket": "<10", "n_donations": 25115, "total_amount": 122898, "mean_amount": 4.893410312562214, "median_amount": 5}, {"election_type": "special", "amount_bucket": "10-50", "n_donations": 51066, "total_amount": 1134616, "mean_amount": 22.21861904202405, "median_amount": 25}, {"election_type": "special", "amount_bucket": "500-1000", "n_donations": 7811, "total_amount": 4003293, "mean_amount": 512.5199078223019, "median_amount": 500}, {"election_type": "runoff", "amount_bucket": "5000+", "n_donations": 37, "total_amount": 211400, "mean_amount": 5713.513513513513, "median_amount": 5400}, {"election_type": null, "amount_bucket": "1000-5000", "n_donations": 116, "total_amount": 228657, "mean_amount": 1971.1810344827586, "median_amount": 1300}, {"election_type": "recount", "amount_bucket": "5000+", "n_donations": 26, "total_amount": 1888024, "mean_amount": 72616.30769230769, "median_amount": 101450}, {"election_type": null, "amount_bucket": "5000+", "n_donations": 48, "total_amount": 1622455, "mean_amount": 33801.145833333336, "median_amount": 21731}, {"election_type": "recount", "amount_bucket": "100-500", "n_donations": 2232, "total_amount": 413753, "mean_amount": 185.37320788530465, "median_amount": 200}, {"election_type": "recount", "amount_bucket": "10-50", "n_donations": 883, "total_amount": 20860, "mean_amount": 23.62400906002265, "median_amount": 25}, {"election_type": "recount", "amount_bucket": "1000-5000", "n_donations": 589, "total_amount": 1113150, "mean_amount": 1889.8981324278438, "median_amount": 1965}, {"election_type": "recount", "amount_bucket": "500-1000", "n_donations": 494, "total_amount": 250960, "mean_amount": 508.0161943319838, "median_amount": 500}, {"election_type": "recount", "amount_bucket": "50-100", "n_donations": 712, "total_amount": 38450, "mean_amount": 54.002808988764045, "median_amount": 50}, {"election_type": "convention", "amount_bucket": "5000+", "n_donations": 219, "total_amount": 1590300, "mean_amount": 7261.643835616438, "median_amount": 8100}, {"election_type": null, "amount_bucket": "100-500", "n_donations": 195, "total_amount": 46746, "mean_amount": 239.72307692307692, "median_amount": 250}, {"election_type": null, "amount_bucket": "500-1000", "n_donations": 89, "total_amount": 48290, "mean_amount": 542.5842696629213, "median_amount": 500}, {"election_type": null, "amount_bucket": "50-100", "n_donations": 36, "total_amount": 1880, "mean_amount": 52.22222222222222, "median_amount": 50}, {"election_type": "recount", "amount_bucket": "<10", "n_donations": 110, "total_amount": 569, "mean_amount": 5.172727272727273, "median_amount": 5}, {"election_type": null, "amount_bucket": "10-50", "n_donations": 151, "total_amount": 3167, "mean_amount": 20.973509933774835, "median_amount": 25}, {"election_type": null, "amount_bucket": "<10", "n_donations": 24, "total_amount": 108, "mean_amount": 4.5, "median_amount": 5}, {"election_type": "other", "amount_bucket": "5000+", "n_donations": 48, "total_amount": 1901300, "mean_amount": 39610.416666666664, "median_amount": 16950}], "data-334b351fcf36268adfd9e34181060327": [{"election_type": "primary", "amount_bucket": "<10", "n_donations": 2423728, "total_amount": 10080721, "mean_amount": 4.159179990493983, "median_amount": 5}, {"election_type": "primary", "amount_bucket": "10-50", "n_donations": 8115403, "total_amount": 187666251, "mean_amount": 23.12469892129818, "median_amount": 25}, {"election_type": "primary", "amount_bucket": "100-500", "n_donations": 3636287, "total_amount": 637353634, "mean_amount": 175.27594329050484, "median_amount": 150}, {"election_type": "primary", "amount_bucket": "50-100", "n_donations": 2663933, "total_amount": 155426540, "mean_amount": 58.34476317535013, "median_amount": 50}, {"election_type": "primary", "amount_bucket": "5000+", "n_donations": 44085, "total_amount": 1558371116, "mean_amount": 35349.237064761255, "median_amount": 10000}, {"election_type": "primary", "amount_bucket": "1000-5000", "n_donations": 684755, "total_amount": 1231394874, "mean_amount": 1798.2999379340056, "median_amount": 1005}, {"election_type": "general", "amount_bucket": "100-500", "n_donations": 700821, "total_amount": 123174568, "mean_amount": 175.75753009684357, "median_amount": 150}, {"election_type": "primary", "amount_bucket": "500-1000", "n_donations": 634677, "total_amount": 334630687, "mean_amount": 527.2456493618014, "median_amount": 500}, {"election_type": "general", "amount_bucket": "1000-5000", "n_donations": 246101, "total_amount": 460025242, "mean_amount": 1869.2538510611496, "median_amount": 1946}, {"election_type": "general", "amount_bucket": "10-50", "n_donations": 660787, "total_amount": 14411588, "mean_amount": 21.809732939661345, "median_amount": 25}, {"election_type": "general", "amount_bucket": "50-100", "n_donations": 304363, "total_amount": 16184312, "mean_amount": 53.174374020495264, "median_amount": 50}, {"election_type": "general", "amount_bucket": "500-1000", "n_donations": 174182, "total_amount": 91015697, "mean_amount": 522.5321617618354, "median_amount": 500}, {"election_type": "general", "amount_bucket": "<10", "n_donations": 115873, "total_amount": 536742, "mean_amount": 4.632157620843509, "median_amount": 5}, {"election_type": "runoff", "amount_bucket": "10-50", "n_donations": 20166, "total_amount": 461107, "mean_amount": 22.865565803828225, "median_amount": 25}, {"election_type": "runoff", "amount_bucket": "50-100", "n_donations": 11578, "total_amount": 585827, "mean_amount": 50.59828986007946, "median_amount": 50}, {"election_type": "runoff", "amount_bucket": "100-500", "n_donations": 18193, "total_amount": 3088289, "mean_amount": 169.75149782883526, "median_amount": 100}, {"election_type": "runoff", "amount_bucket": "500-1000", "n_donations": 4117, "total_amount": 2110393, "mean_amount": 512.6045664318679, "median_amount": 500}, {"election_type": "runoff", "amount_bucket": "1000-5000", "n_donations": 5196, "total_amount": 9601993, "mean_amount": 1847.958622016936, "median_amount": 1901}, {"election_type": "runoff", "amount_bucket": "<10", "n_donations": 10191, "total_amount": 49621, "mean_amount": 4.869100186439015, "median_amount": 5}, {"election_type": "special", "amount_bucket": "100-500", "n_donations": 34497, "total_amount": 5943498, "mean_amount": 172.29028611183583, "median_amount": 118}, {"election_type": "general", "amount_bucket": "5000+", "n_donations": 3125, "total_amount": 44496373, "mean_amount": 14238.83936, "median_amount": 7528}, {"election_type": "special", "amount_bucket": "5000+", "n_donations": 129, "total_amount": 788712, "mean_amount": 6114.046511627907, "median_amount": 5400}, {"election_type": "special", "amount_bucket": "1000-5000", "n_donations": 7935, "total_amount": 13493154, "mean_amount": 1700.4604914933836, "median_amount": 1000}, {"election_type": "convention", "amount_bucket": "1000-5000", "n_donations": 2822, "total_amount": 4977314, "mean_amount": 1763.7540751240256, "median_amount": 1437}, {"election_type": "convention", "amount_bucket": "100-500", "n_donations": 6350, "total_amount": 1097843, "mean_amount": 172.88866141732282, "median_amount": 139}, {"election_type": "convention", "amount_bucket": "500-1000", "n_donations": 1824, "total_amount": 945321, "mean_amount": 518.2680921052631, "median_amount": 500}, {"election_type": "special", "amount_bucket": "10-50", "n_donations": 51066, "total_amount": 1134616, "mean_amount": 22.21861904202405, "median_amount": 25}, {"election_type": "special", "amount_bucket": "50-100", "n_donations": 22859, "total_amount": 1177660, "mean_amount": 51.518439126820944, "median_amount": 50}, {"election_type": "special", "amount_bucket": "500-1000", "n_donations": 7811, "total_amount": 4003293, "mean_amount": 512.5199078223019, "median_amount": 500}, {"election_type": "special", "amount_bucket": "<10", "n_donations": 25115, "total_amount": 122898, "mean_amount": 4.893410312562214, "median_amount": 5}, {"election_type": null, "amount_bucket": "1000-5000", "n_donations": 116, "total_amount": 228657, "mean_amount": 1971.1810344827586, "median_amount": 1300}, {"election_type": null, "amount_bucket": "5000+", "n_donations": 48, "total_amount": 1622455, "mean_amount": 33801.145833333336, "median_amount": 21731}, {"election_type": "convention", "amount_bucket": "10-50", "n_donations": 6848, "total_amount": 141604, "mean_amount": 20.678154205607477, "median_amount": 25}, {"election_type": "convention", "amount_bucket": "<10", "n_donations": 945, "total_amount": 4660, "mean_amount": 4.931216931216931, "median_amount": 5}, {"election_type": "convention", "amount_bucket": "50-100", "n_donations": 2966, "total_amount": 153281, "mean_amount": 51.67936614969656, "median_amount": 50}, {"election_type": "convention", "amount_bucket": "5000+", "n_donations": 219, "total_amount": 1590300, "mean_amount": 7261.643835616438, "median_amount": 8100}, {"election_type": "recount", "amount_bucket": "100-500", "n_donations": 2232, "total_amount": 413753, "mean_amount": 185.37320788530465, "median_amount": 200}, {"election_type": "recount", "amount_bucket": "10-50", "n_donations": 883, "total_amount": 20860, "mean_amount": 23.62400906002265, "median_amount": 25}, {"election_type": "recount", "amount_bucket": "1000-5000", "n_donations": 589, "total_amount": 1113150, "mean_amount": 1889.8981324278438, "median_amount": 1965}, {"election_type": "recount", "amount_bucket": "500-1000", "n_donations": 494, "total_amount": 250960, "mean_amount": 508.0161943319838, "median_amount": 500}, {"election_type": "recount", "amount_bucket": "50-100", "n_donations": 712, "total_amount": 38450, "mean_amount": 54.002808988764045, "median_amount": 50}, {"election_type": "recount", "amount_bucket": "<10", "n_donations": 110, "total_amount": 569, "mean_amount": 5.172727272727273, "median_amount": 5}, {"election_type": null, "amount_bucket": "100-500", "n_donations": 195, "total_amount": 46746, "mean_amount": 239.72307692307692, "median_amount": 250}, {"election_type": null, "amount_bucket": "500-1000", "n_donations": 89, "total_amount": 48290, "mean_amount": 542.5842696629213, "median_amount": 500}, {"election_type": "other", "amount_bucket": "10-50", "n_donations": 2644, "total_amount": 64297, "mean_amount": 24.318078668683814, "median_amount": 23}, {"election_type": "other", "amount_bucket": "50-100", "n_donations": 451, "total_amount": 27149, "mean_amount": 60.19733924611973, "median_amount": 50}, {"election_type": "other", "amount_bucket": "100-500", "n_donations": 630, "total_amount": 117988, "mean_amount": 187.2825396825397, "median_amount": 192}, {"election_type": "other", "amount_bucket": "<10", "n_donations": 10993, "total_amount": 25816, "mean_amount": 2.3484035295187846, "median_amount": 1}, {"election_type": "other", "amount_bucket": "1000-5000", "n_donations": 235, "total_amount": 548212, "mean_amount": 2332.817021276596, "median_amount": 2633}, {"election_type": "recount", "amount_bucket": "5000+", "n_donations": 26, "total_amount": 1888024, "mean_amount": 72616.30769230769, "median_amount": 101450}, {"election_type": null, "amount_bucket": "<10", "n_donations": 24, "total_amount": 108, "mean_amount": 4.5, "median_amount": 5}, {"election_type": null, "amount_bucket": "10-50", "n_donations": 151, "total_amount": 3167, "mean_amount": 20.973509933774835, "median_amount": 25}, {"election_type": "other", "amount_bucket": "500-1000", "n_donations": 119, "total_amount": 62535, "mean_amount": 525.5042016806723, "median_amount": 500}, {"election_type": "runoff", "amount_bucket": "5000+", "n_donations": 37, "total_amount": 211400, "mean_amount": 5713.513513513513, "median_amount": 5400}, {"election_type": null, "amount_bucket": "50-100", "n_donations": 36, "total_amount": 1880, "mean_amount": 52.22222222222222, "median_amount": 50}, {"election_type": "other", "amount_bucket": "5000+", "n_donations": 48, "total_amount": 1901300, "mean_amount": 39610.416666666664, "median_amount": 16950}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
</section>
<section id="by-election-stage" class="level3">
<h3 class="anchored" data-anchor-id="by-election-stage">By election stage</h3>
<p>Let’s look at how donations break down by election stage. Do people donate differently for primary elections vs general elections?</p>
<p>Let’s ignore everything but primary and general elections, since they are the most common, and arguably the most important.</p>
<div id="92651642" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1">gb2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> by_type_and_bucket[_.election_type.isin((<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"primary"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"general"</span>))]</span>
<span id="cb27-2">n_donations_per_election_type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> _.n_donations.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>().over(group_by<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"election_type"</span>)</span>
<span id="cb27-3">frac <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> _.n_donations <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> n_donations_per_election_type</span>
<span id="cb27-4">gb2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gb2.mutate(frac_n_donations_per_election_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>frac)</span>
<span id="cb27-5">gb2</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> election_type </span>┃<span style="font-weight: bold"> amount_bucket </span>┃<span style="font-weight: bold"> n_donations </span>┃<span style="font-weight: bold"> total_amount </span>┃<span style="font-weight: bold"> mean_amount  </span>┃<span style="font-weight: bold"> median_amount </span>┃<span style="font-weight: bold"> frac_n_donations_per_election_type </span>┃
┡━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>                            │
├───────────────┼───────────────┼─────────────┼──────────────┼──────────────┼───────────────┼────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">10-50        </span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">8115403</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">187666251</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">23.124699</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">25</span> │                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.445831</span> │
│ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">&lt;10          </span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2423728</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10080721</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.159180</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span> │                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.133151</span> │
│ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">100-500      </span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3636287</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">637353634</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">175.275943</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">150</span> │                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.199765</span> │
│ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">50-100       </span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2663933</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">155426540</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">58.344763</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">50</span> │                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.146347</span> │
│ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">500-1000     </span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">634677</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">334630687</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">527.245649</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">500</span> │                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.034867</span> │
│ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">1000-5000    </span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">684755</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1231394874</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1798.299938</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1008</span> │                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.037618</span> │
│ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">5000+        </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">44085</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1558371116</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">35349.237065</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10000</span> │                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.002422</span> │
│ <span style="color: #008000; text-decoration-color: #008000">general      </span> │ <span style="color: #008000; text-decoration-color: #008000">50-100       </span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">304363</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">16184312</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">53.174374</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">50</span> │                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.138017</span> │
│ <span style="color: #008000; text-decoration-color: #008000">general      </span> │ <span style="color: #008000; text-decoration-color: #008000">100-500      </span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">700821</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">123174568</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">175.757530</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">150</span> │                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.317796</span> │
│ <span style="color: #008000; text-decoration-color: #008000">general      </span> │ <span style="color: #008000; text-decoration-color: #008000">500-1000     </span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">174182</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">91015697</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">522.532162</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">500</span> │                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.078985</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>             │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │            <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │            <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                                  <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└───────────────┴───────────────┴─────────────┴──────────────┴──────────────┴───────────────┴────────────────────────────────────┘
</pre>
</div>
</div>
<p>It looks like primary elections get a larger proportion of small donations.</p>
<div id="fd42d9bf" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1">alt.Chart(gb2.execute()).mark_bar().encode(</span>
<span id="cb28-2">    x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"election_type:O"</span>,</span>
<span id="cb28-3">    y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"frac_n_donations_per_election_type:Q"</span>,</span>
<span id="cb28-4">    color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>bucket_col,</span>
<span id="cb28-5">)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">

<style>
  #altair-viz-d70f3d08fb7d48c3b9c5b7d4e4e4b735.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-d70f3d08fb7d48c3b9c5b7d4e4e4b735.vega-embed details,
  #altair-viz-d70f3d08fb7d48c3b9c5b7d4e4e4b735.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-d70f3d08fb7d48c3b9c5b7d4e4e4b735"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-d70f3d08fb7d48c3b9c5b7d4e4e4b735") {
      outputDiv = document.getElementById("altair-viz-d70f3d08fb7d48c3b9c5b7d4e4e4b735");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.8.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-a720be181ccb86f83b23a767dba558e0"}, "mark": {"type": "bar"}, "encoding": {"color": {"field": "amount_bucket", "sort": ["<10", "10-50", "50-100", "100-500", "500-1000", "1000-5000", "5000+"], "type": "nominal"}, "x": {"field": "election_type", "type": "ordinal"}, "y": {"field": "frac_n_donations_per_election_type", "type": "quantitative"}}, "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json", "datasets": {"data-a720be181ccb86f83b23a767dba558e0": [{"election_type": "primary", "amount_bucket": "<10", "n_donations": 2423728, "total_amount": 10080721, "mean_amount": 4.159179990493983, "median_amount": 5, "frac_n_donations_per_election_type": 0.13315088589336582}, {"election_type": "primary", "amount_bucket": "10-50", "n_donations": 8115403, "total_amount": 187666251, "mean_amount": 23.12469892129818, "median_amount": 25, "frac_n_donations_per_election_type": 0.44583100860809405}, {"election_type": "primary", "amount_bucket": "50-100", "n_donations": 2663933, "total_amount": 155426540, "mean_amount": 58.34476317535013, "median_amount": 50, "frac_n_donations_per_election_type": 0.14634688335925966}, {"election_type": "primary", "amount_bucket": "100-500", "n_donations": 3636287, "total_amount": 637353634, "mean_amount": 175.27594329050484, "median_amount": 150, "frac_n_donations_per_election_type": 0.1997645096366133}, {"election_type": "primary", "amount_bucket": "500-1000", "n_donations": 634677, "total_amount": 334630687, "mean_amount": 527.2456493618014, "median_amount": 500, "frac_n_donations_per_election_type": 0.03486686823197312}, {"election_type": "primary", "amount_bucket": "1000-5000", "n_donations": 684755, "total_amount": 1231394874, "mean_amount": 1798.2999379340056, "median_amount": 1008, "frac_n_donations_per_election_type": 0.037617973167744775}, {"election_type": "primary", "amount_bucket": "5000+", "n_donations": 44085, "total_amount": 1558371116, "mean_amount": 35349.237064761255, "median_amount": 10000, "frac_n_donations_per_election_type": 0.0024218711029492714}, {"election_type": "general", "amount_bucket": "1000-5000", "n_donations": 246101, "total_amount": 460025242, "mean_amount": 1869.2538510611496, "median_amount": 1956, "frac_n_donations_per_election_type": 0.1115976768187944}, {"election_type": "general", "amount_bucket": "100-500", "n_donations": 700821, "total_amount": 123174568, "mean_amount": 175.75753009684357, "median_amount": 150, "frac_n_donations_per_election_type": 0.3177963334802553}, {"election_type": "general", "amount_bucket": "50-100", "n_donations": 304363, "total_amount": 16184312, "mean_amount": 53.174374020495264, "median_amount": 50, "frac_n_donations_per_election_type": 0.13801733316645898}, {"election_type": "general", "amount_bucket": "<10", "n_donations": 115873, "total_amount": 536742, "mean_amount": 4.632157620843509, "median_amount": 5, "frac_n_donations_per_election_type": 0.052544108337731925}, {"election_type": "general", "amount_bucket": "500-1000", "n_donations": 174182, "total_amount": 91015697, "mean_amount": 522.5321617618354, "median_amount": 500, "frac_n_donations_per_election_type": 0.0789850774423966}, {"election_type": "general", "amount_bucket": "10-50", "n_donations": 660787, "total_amount": 14411588, "mean_amount": 21.809732939661345, "median_amount": 25, "frac_n_donations_per_election_type": 0.2996423991453131}, {"election_type": "general", "amount_bucket": "5000+", "n_donations": 3125, "total_amount": 44496373, "mean_amount": 14238.83936, "median_amount": 7525, "frac_n_donations_per_election_type": 0.0014170716090496688}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
</section>
<section id="by-recipient" class="level3">
<h3 class="anchored" data-anchor-id="by-recipient">By recipient</h3>
<p>Let’s look at the top players. Who gets the most donations?</p>
<p>Far and away it is ActBlue, which acts as a conduit for donations to Democratic interests.</p>
<p>Beto O’Rourke is the top individual politician, hats off to him!</p>
<div id="e844f42e" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1">by_recip <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> summary_by(featured, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CMTE_NM"</span>)</span>
<span id="cb29-2">by_recip</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> CMTE_NM                                                                          </span>┃<span style="font-weight: bold"> n_donations </span>┃<span style="font-weight: bold"> total_amount </span>┃<span style="font-weight: bold"> mean_amount </span>┃<span style="font-weight: bold"> median_amount </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                                                           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>         │
├──────────────────────────────────────────────────────────────────────────────────┼─────────────┼──────────────┼─────────────┼───────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">EXELON CORPORATION POLITICAL ACTION COMMITTEE (EXELON PAC)                      </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">13250</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1939503</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">146.377585</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">118</span> │
│ <span style="color: #008000; text-decoration-color: #008000">ARCHER DANIELS MIDLAND COMPANY-ADM PAC                                          </span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4460</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">275807</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">61.840135</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">25</span> │
│ <span style="color: #008000; text-decoration-color: #008000">PFIZER INC. PAC                                                                 </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">46900</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1948689</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">41.549872</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20</span> │
│ <span style="color: #008000; text-decoration-color: #008000">SUEZ WATER INC. FEDERAL PAC                                                     </span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">108</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">16873</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">156.231481</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">120</span> │
│ <span style="color: #008000; text-decoration-color: #008000">INTERNATIONAL WAREHOUSE LOGISTICS ASSOCIATION PAC                               </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">90</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">132200</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1468.888889</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1000</span> │
│ <span style="color: #008000; text-decoration-color: #008000">BAKERY, CONFECTIONERY, TOBACCO WORKERS AND GRAIN MILLERS INTERNATIONAL UNION PAC</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">387</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">19091</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">49.330749</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">30</span> │
│ <span style="color: #008000; text-decoration-color: #008000">UNION PACIFIC CORP. FUND FOR EFFECTIVE GOVERNMENT                               </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">16118</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2436963</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">151.195123</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">114</span> │
│ <span style="color: #008000; text-decoration-color: #008000">NATIONAL ASSOCIATION OF REALTORS POLITICAL ACTION COMMITTEE                     </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">24277</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5492063</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">226.224945</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">154</span> │
│ <span style="color: #008000; text-decoration-color: #008000">AMERICAN FINANCIAL SERVICES ASSOCIATION PAC                                     </span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">690</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">685839</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">993.969565</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">65</span> │
│ <span style="color: #008000; text-decoration-color: #008000">WEYERHAEUSER COMPANY POLITICAL ACTION COMMITTEE                                 </span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5512</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">343244</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">62.272134</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">30</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                                                │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │            <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└──────────────────────────────────────────────────────────────────────────────────┴─────────────┴──────────────┴─────────────┴───────────────┘
</pre>
</div>
</div>
<div id="a0c1efd8" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1">top_recip <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> by_recip.order_by(ibis.desc(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n_donations"</span>)).head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb30-2">alt.Chart(top_recip.execute()).mark_bar().encode(</span>
<span id="cb30-3">    x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>alt.X(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CMTE_NM:O"</span>, sort<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-y"</span>),</span>
<span id="cb30-4">    y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n_donations:Q"</span>,</span>
<span id="cb30-5">)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">

<style>
  #altair-viz-59298bf7a2fb45ba8365f4fc9ef956b9.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-59298bf7a2fb45ba8365f4fc9ef956b9.vega-embed details,
  #altair-viz-59298bf7a2fb45ba8365f4fc9ef956b9.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-59298bf7a2fb45ba8365f4fc9ef956b9"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-59298bf7a2fb45ba8365f4fc9ef956b9") {
      outputDiv = document.getElementById("altair-viz-59298bf7a2fb45ba8365f4fc9ef956b9");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.8.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-ce10b3f5b7c7e35451245a008d469163"}, "mark": {"type": "bar"}, "encoding": {"x": {"field": "CMTE_NM", "sort": "-y", "type": "ordinal"}, "y": {"field": "n_donations", "type": "quantitative"}}, "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json", "datasets": {"data-ce10b3f5b7c7e35451245a008d469163": [{"CMTE_NM": "ACTBLUE", "n_donations": 5820888, "total_amount": 693057213, "mean_amount": 119.06382892094814, "median_amount": 25}, {"CMTE_NM": "DCCC", "n_donations": 1315476, "total_amount": 124802082, "mean_amount": 94.87218466927561, "median_amount": 25}, {"CMTE_NM": "REPUBLICAN NATIONAL COMMITTEE", "n_donations": 570561, "total_amount": 131525422, "mean_amount": 230.5194746924518, "median_amount": 50}, {"CMTE_NM": "END CITIZENS UNITED", "n_donations": 489710, "total_amount": 13654987, "mean_amount": 27.8838230789651, "median_amount": 15}, {"CMTE_NM": "DSCC", "n_donations": 347493, "total_amount": 67844824, "mean_amount": 195.2408365060591, "median_amount": 35}, {"CMTE_NM": "PROGRESSIVE TURNOUT PROJECT", "n_donations": 313433, "total_amount": 9251647, "mean_amount": 29.517144014829327, "median_amount": 15}, {"CMTE_NM": "DNC SERVICES CORP./DEM. NAT'L COMMITTEE", "n_donations": 280264, "total_amount": 70156788, "mean_amount": 250.32393743042275, "median_amount": 50}, {"CMTE_NM": "BETO FOR TEXAS", "n_donations": 280027, "total_amount": 44914966, "mean_amount": 160.39512618426082, "median_amount": 50}, {"CMTE_NM": "NRSC", "n_donations": 203124, "total_amount": 55384644, "mean_amount": 272.66420511608675, "median_amount": 50}, {"CMTE_NM": "NRCC", "n_donations": 178176, "total_amount": 38646560, "mean_amount": 216.90104166666666, "median_amount": 50}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
</section>
<section id="by-location" class="level3">
<h3 class="anchored" data-anchor-id="by-location">By Location</h3>
<p>Where are the largest donations coming from?</p>
<div id="3348eca1" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1">f2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> featured.mutate(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.CITY <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">", "</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> _.STATE).drop(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CITY"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"STATE"</span>)</span>
<span id="cb31-2">by_loc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> summary_by(f2, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"loc"</span>)</span>
<span id="cb31-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Drop the places with a small number of donations so we're</span></span>
<span id="cb31-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># resistant to outliers for the mean</span></span>
<span id="cb31-5">by_loc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> by_loc[_.n_donations <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>]</span>
<span id="cb31-6">by_loc</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> loc              </span>┃<span style="font-weight: bold"> n_donations </span>┃<span style="font-weight: bold"> total_amount </span>┃<span style="font-weight: bold"> mean_amount </span>┃<span style="font-weight: bold"> median_amount </span>┃
┡━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>         │
├──────────────────┼─────────────┼──────────────┼─────────────┼───────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">DALLAS, TX      </span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">154038</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">66558403</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">432.090802</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">58</span> │
│ <span style="color: #008000; text-decoration-color: #008000">PHILADELPHIA, PA</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">222938</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">36054977</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">161.726476</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">62</span> │
│ <span style="color: #008000; text-decoration-color: #008000">MALIBU, CA      </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">11699</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4934763</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">421.810668</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">50</span> │
│ <span style="color: #008000; text-decoration-color: #008000">SANTEE, CA      </span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2454</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">201274</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">82.018745</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">26</span> │
│ <span style="color: #008000; text-decoration-color: #008000">WINNETKA, IL    </span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">8589</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5621809</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">654.535918</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">172</span> │
│ <span style="color: #008000; text-decoration-color: #008000">OREM, UT        </span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2110</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">837475</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">396.907583</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">50</span> │
│ <span style="color: #008000; text-decoration-color: #008000">MESA, AZ        </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">22128</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1856636</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">83.904375</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20</span> │
│ <span style="color: #008000; text-decoration-color: #008000">WAYZATA, MN     </span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6488</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3326275</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">512.681104</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">117</span> │
│ <span style="color: #008000; text-decoration-color: #008000">MINNETONKA, MN  </span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5709</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1187881</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">208.071641</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">50</span> │
│ <span style="color: #008000; text-decoration-color: #008000">OJAI, CA        </span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4496</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">926422</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">206.054715</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">25</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │            <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└──────────────────┴─────────────┴──────────────┴─────────────┴───────────────┘
</pre>
</div>
</div>
<div id="95c93760" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> top_by(col):</span>
<span id="cb32-2">    top <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> by_loc.order_by(ibis.desc(col)).head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb32-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> (</span>
<span id="cb32-4">        alt.Chart(top.execute())</span>
<span id="cb32-5">        .mark_bar()</span>
<span id="cb32-6">        .encode(</span>
<span id="cb32-7">            x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>alt.X(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'loc:O'</span>, sort<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-y"</span>),</span>
<span id="cb32-8">            y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>col,</span>
<span id="cb32-9">        )</span>
<span id="cb32-10">    )</span>
<span id="cb32-11"></span>
<span id="cb32-12"></span>
<span id="cb32-13">top_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n_donations"</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> top_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"total_amount"</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> top_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean_amount"</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> top_by(</span>
<span id="cb32-14">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"median_amount"</span></span>
<span id="cb32-15">)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">

<style>
  #altair-viz-0d2671a035be4c5e8b9b39040d382bd3.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-0d2671a035be4c5e8b9b39040d382bd3.vega-embed details,
  #altair-viz-0d2671a035be4c5e8b9b39040d382bd3.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-0d2671a035be4c5e8b9b39040d382bd3"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-0d2671a035be4c5e8b9b39040d382bd3") {
      outputDiv = document.getElementById("altair-viz-0d2671a035be4c5e8b9b39040d382bd3");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.8.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "hconcat": [{"data": {"name": "data-88a0fd8958c48a49df7689732aa79f72"}, "mark": {"type": "bar"}, "encoding": {"x": {"field": "loc", "sort": "-y", "type": "ordinal"}, "y": {"field": "n_donations", "type": "quantitative"}}}, {"data": {"name": "data-3702e7b9b7a3360d0314740591d3849d"}, "mark": {"type": "bar"}, "encoding": {"x": {"field": "loc", "sort": "-y", "type": "ordinal"}, "y": {"field": "total_amount", "type": "quantitative"}}}, {"data": {"name": "data-290a9847dd1ffd50031c2439e64328e3"}, "mark": {"type": "bar"}, "encoding": {"x": {"field": "loc", "sort": "-y", "type": "ordinal"}, "y": {"field": "mean_amount", "type": "quantitative"}}}, {"data": {"name": "data-5b715f99a3cfcd002ab9d2ec64e81179"}, "mark": {"type": "bar"}, "encoding": {"x": {"field": "loc", "sort": "-y", "type": "ordinal"}, "y": {"field": "median_amount", "type": "quantitative"}}}], "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json", "datasets": {"data-88a0fd8958c48a49df7689732aa79f72": [{"loc": "NEW YORK, NY", "n_donations": 695091, "total_amount": 444600108, "mean_amount": 639.6286356750411, "median_amount": 50}, {"loc": "WASHINGTON, DC", "n_donations": 401498, "total_amount": 124456508, "mean_amount": 309.9803934266173, "median_amount": 57}, {"loc": "HOUSTON, TX", "n_donations": 251960, "total_amount": 83026989, "mean_amount": 329.5244840450865, "median_amount": 50}, {"loc": "LOS ANGELES, CA", "n_donations": 245263, "total_amount": 89881980, "mean_amount": 366.4718282007478, "median_amount": 50}, {"loc": "SAN FRANCISCO, CA", "n_donations": 238117, "total_amount": 189799961, "mean_amount": 797.086982449804, "median_amount": 50}, {"loc": "PHILADELPHIA, PA", "n_donations": 222938, "total_amount": 36054977, "mean_amount": 161.72647552234253, "median_amount": 62}, {"loc": "CHICAGO, IL", "n_donations": 212527, "total_amount": 108119674, "mean_amount": 508.7338267608351, "median_amount": 40}, {"loc": "SEATTLE, WA", "n_donations": 197671, "total_amount": 52867387, "mean_amount": 267.4514066302088, "median_amount": 36}, {"loc": "AUSTIN, TX", "n_donations": 189865, "total_amount": 33315922, "mean_amount": 175.4716351091565, "median_amount": 38}, {"loc": "ARLINGTON, VA", "n_donations": 163168, "total_amount": 23382868, "mean_amount": 143.30547656403218, "median_amount": 50}], "data-3702e7b9b7a3360d0314740591d3849d": [{"loc": "NEW YORK, NY", "n_donations": 695091, "total_amount": 444600108, "mean_amount": 639.6286356750411, "median_amount": 50}, {"loc": "SAN FRANCISCO, CA", "n_donations": 238117, "total_amount": 189799961, "mean_amount": 797.086982449804, "median_amount": 50}, {"loc": "LAS VEGAS, NV", "n_donations": 65940, "total_amount": 153467387, "mean_amount": 2327.37923870185, "median_amount": 46}, {"loc": "WASHINGTON, DC", "n_donations": 401498, "total_amount": 124456508, "mean_amount": 309.9803934266173, "median_amount": 57}, {"loc": "CHICAGO, IL", "n_donations": 212527, "total_amount": 108119674, "mean_amount": 508.7338267608351, "median_amount": 40}, {"loc": "LOS ANGELES, CA", "n_donations": 245263, "total_amount": 89881980, "mean_amount": 366.4718282007478, "median_amount": 50}, {"loc": "HOUSTON, TX", "n_donations": 251960, "total_amount": 83026989, "mean_amount": 329.5244840450865, "median_amount": 50}, {"loc": "DALLAS, TX", "n_donations": 154038, "total_amount": 66558403, "mean_amount": 432.09080226956985, "median_amount": 57}, {"loc": "SEATTLE, WA", "n_donations": 197671, "total_amount": 52867387, "mean_amount": 267.4514066302088, "median_amount": 36}, {"loc": "BOSTON, MA", "n_donations": 82925, "total_amount": 47592049, "mean_amount": 573.9167802230932, "median_amount": 57}], "data-290a9847dd1ffd50031c2439e64328e3": [{"loc": "LAKE FOREST, IL", "n_donations": 5636, "total_amount": 37486362, "mean_amount": 6651.235273243435, "median_amount": 100}, {"loc": "MOUNT VERNON, OH", "n_donations": 1431, "total_amount": 5605857, "mean_amount": 3917.4402515723273, "median_amount": 47}, {"loc": "LOS ALTOS HILLS, CA", "n_donations": 4098, "total_amount": 10367629, "mean_amount": 2529.92410932162, "median_amount": 318}, {"loc": "PALM BEACH, FL", "n_donations": 7140, "total_amount": 17212425, "mean_amount": 2410.703781512605, "median_amount": 260}, {"loc": "LAS VEGAS, NV", "n_donations": 65940, "total_amount": 153467387, "mean_amount": 2327.37923870185, "median_amount": 45}, {"loc": "RHINEBECK, NY", "n_donations": 3014, "total_amount": 5942571, "mean_amount": 1971.6559389515594, "median_amount": 47}, {"loc": "JOPLIN, MO", "n_donations": 1839, "total_amount": 3617186, "mean_amount": 1966.9309407286569, "median_amount": 50}, {"loc": "BALA CYNWYD, PA", "n_donations": 3668, "total_amount": 6949933, "mean_amount": 1894.7472737186479, "median_amount": 100}, {"loc": "CARMEL, IN", "n_donations": 10932, "total_amount": 20383688, "mean_amount": 1864.5890962312478, "median_amount": 53}, {"loc": "WAYLAND, MA", "n_donations": 5283, "total_amount": 9704279, "mean_amount": 1836.8879424569373, "median_amount": 50}], "data-5b715f99a3cfcd002ab9d2ec64e81179": [{"loc": "GLADWYNE, PA", "n_donations": 1727, "total_amount": 1333243, "mean_amount": 771.9994209612044, "median_amount": 335}, {"loc": "LOS ALTOS HILLS, CA", "n_donations": 4098, "total_amount": 10367629, "mean_amount": 2529.92410932162, "median_amount": 326}, {"loc": "MC LEAN, VA", "n_donations": 4692, "total_amount": 3656109, "mean_amount": 779.2218670076726, "median_amount": 305}, {"loc": "PALM BEACH, FL", "n_donations": 7140, "total_amount": 17212425, "mean_amount": 2410.703781512605, "median_amount": 262}, {"loc": "PARADISE VALLEY, AZ", "n_donations": 8197, "total_amount": 7035291, "mean_amount": 858.2763206050994, "median_amount": 250}, {"loc": "MISSION HILLS, KS", "n_donations": 2258, "total_amount": 1642339, "mean_amount": 727.3423383525244, "median_amount": 250}, {"loc": "DOVER, MA", "n_donations": 1040, "total_amount": 976757, "mean_amount": 939.189423076923, "median_amount": 250}, {"loc": "ATHERTON, CA", "n_donations": 8780, "total_amount": 11595391, "mean_amount": 1320.6595671981777, "median_amount": 250}, {"loc": "KENILWORTH, IL", "n_donations": 1500, "total_amount": 855723, "mean_amount": 570.482, "median_amount": 250}, {"loc": "WOODSIDE, CA", "n_donations": 5626, "total_amount": 6110007, "mean_amount": 1086.030394596516, "median_amount": 249}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
</section>
<section id="by-month" class="level3">
<h3 class="anchored" data-anchor-id="by-month">By month</h3>
<p>When do the donations come in?</p>
<div id="6d0776d2" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1">by_month <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> summary_by(featured, _.date.month().name(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month_int"</span>))</span>
<span id="cb33-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sorta hacky, .substritute doesn't work to change dtypes (yet?)</span></span>
<span id="cb33-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># so we cast to string and then do our mapping</span></span>
<span id="cb33-4">month_map <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb33-5">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Jan"</span>,</span>
<span id="cb33-6">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Feb"</span>,</span>
<span id="cb33-7">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mar"</span>,</span>
<span id="cb33-8">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"4"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Apr"</span>,</span>
<span id="cb33-9">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"5"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"May"</span>,</span>
<span id="cb33-10">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"6"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Jun"</span>,</span>
<span id="cb33-11">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"7"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Jul"</span>,</span>
<span id="cb33-12">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"8"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Aug"</span>,</span>
<span id="cb33-13">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"9"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sep"</span>,</span>
<span id="cb33-14">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Oct"</span>,</span>
<span id="cb33-15">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"11"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Nov"</span>,</span>
<span id="cb33-16">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"12"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dec"</span>,</span>
<span id="cb33-17">}</span>
<span id="cb33-18">by_month <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> by_month.mutate(month_str<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.month_int.cast(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>).substitute(month_map))</span>
<span id="cb33-19">by_month</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━┓
┃<span style="font-weight: bold"> month_int </span>┃<span style="font-weight: bold"> n_donations </span>┃<span style="font-weight: bold"> total_amount </span>┃<span style="font-weight: bold"> mean_amount </span>┃<span style="font-weight: bold"> median_amount </span>┃<span style="font-weight: bold"> month_str </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int32</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │
├───────────┼─────────────┼──────────────┼─────────────┼───────────────┼───────────┤
│      <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1514</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">250297</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">165.321664</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>      │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">348979</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">174837854</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">500.998209</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">122</span> │ <span style="color: #008000; text-decoration-color: #008000">Jan      </span> │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">581646</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">255997655</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">440.126219</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">100</span> │ <span style="color: #008000; text-decoration-color: #008000">Feb      </span> │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1042577</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">430906797</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">413.309326</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">81</span> │ <span style="color: #008000; text-decoration-color: #008000">Mar      </span> │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1088244</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">299252692</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">274.986760</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">50</span> │ <span style="color: #008000; text-decoration-color: #008000">Apr      </span> │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1374247</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">387317192</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">281.839576</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">48</span> │ <span style="color: #008000; text-decoration-color: #008000">May      </span> │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1667285</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">465305247</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">279.079610</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">44</span> │ <span style="color: #008000; text-decoration-color: #008000">Jun      </span> │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">7</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1607053</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">320528605</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">199.451172</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">35</span> │ <span style="color: #008000; text-decoration-color: #008000">Jul      </span> │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">8</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2023466</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">473544182</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">234.026261</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">35</span> │ <span style="color: #008000; text-decoration-color: #008000">Aug      </span> │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">9</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2583847</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">697888624</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">270.096729</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">38</span> │ <span style="color: #008000; text-decoration-color: #008000">Sep      </span> │
│         <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │            <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │
└───────────┴─────────────┴──────────────┴─────────────┴───────────────┴───────────┘
</pre>
</div>
</div>
<div id="a2b27c61" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1">months_in_order <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(month_map.values())</span>
<span id="cb34-2">alt.Chart(by_month.execute()).mark_bar().encode(</span>
<span id="cb34-3">    x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>alt.X(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month_str:O"</span>, sort<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>months_in_order),</span>
<span id="cb34-4">    y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n_donations:Q"</span>,</span>
<span id="cb34-5">)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">

<style>
  #altair-viz-8f3242609f02454fa698b7480db40ce3.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-8f3242609f02454fa698b7480db40ce3.vega-embed details,
  #altair-viz-8f3242609f02454fa698b7480db40ce3.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-8f3242609f02454fa698b7480db40ce3"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-8f3242609f02454fa698b7480db40ce3") {
      outputDiv = document.getElementById("altair-viz-8f3242609f02454fa698b7480db40ce3");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.8.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-60ff3524db1ce5308db1f55005eff874"}, "mark": {"type": "bar"}, "encoding": {"x": {"field": "month_str", "sort": ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"], "type": "ordinal"}, "y": {"field": "n_donations", "type": "quantitative"}}, "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json", "datasets": {"data-60ff3524db1ce5308db1f55005eff874": [{"month_int": null, "n_donations": 1514, "total_amount": 250297, "mean_amount": 165.3216644649934, "median_amount": 100, "month_str": null}, {"month_int": 1.0, "n_donations": 348979, "total_amount": 174837854, "mean_amount": 500.9982090612902, "median_amount": 120, "month_str": "Jan"}, {"month_int": 2.0, "n_donations": 581646, "total_amount": 255997655, "mean_amount": 440.126219384299, "median_amount": 100, "month_str": "Feb"}, {"month_int": 3.0, "n_donations": 1042577, "total_amount": 430906797, "mean_amount": 413.3093258339672, "median_amount": 81, "month_str": "Mar"}, {"month_int": 4.0, "n_donations": 1088244, "total_amount": 299252692, "mean_amount": 274.98676032213365, "median_amount": 50, "month_str": "Apr"}, {"month_int": 5.0, "n_donations": 1374247, "total_amount": 387317192, "mean_amount": 281.83957614606396, "median_amount": 48, "month_str": "May"}, {"month_int": 6.0, "n_donations": 1667285, "total_amount": 465305247, "mean_amount": 279.07960966481437, "median_amount": 44, "month_str": "Jun"}, {"month_int": 7.0, "n_donations": 1607053, "total_amount": 320528605, "mean_amount": 199.45117242555162, "median_amount": 35, "month_str": "Jul"}, {"month_int": 8.0, "n_donations": 2023466, "total_amount": 473544182, "mean_amount": 234.02626088108227, "median_amount": 35, "month_str": "Aug"}, {"month_int": 9.0, "n_donations": 2583847, "total_amount": 697888624, "mean_amount": 270.0967294116099, "median_amount": 38, "month_str": "Sep"}, {"month_int": 10.0, "n_donations": 3686024, "total_amount": 850820707, "mean_amount": 230.82343115508743, "median_amount": 29, "month_str": "Oct"}, {"month_int": 11.0, "n_donations": 2545616, "total_amount": 285143995, "mean_amount": 112.01375030640914, "median_amount": 25, "month_str": "Nov"}, {"month_int": 12.0, "n_donations": 2119311, "total_amount": 283081648, "mean_amount": 133.57249030463203, "median_amount": 25, "month_str": "Dec"}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Thanks for following along! I hope you’ve learned something about Ibis, and maybe even about campaign finance.</p>
<p>Ibis is a great tool for exploring data. I now find myself reaching for it when in the past I would have reached for pandas.</p>
<p>Some of the highlights for me:</p>
<ul>
<li>Fast, lazy execution, a great display format, and good type hinting/editor support for a great REPL experience.</li>
<li>Very well thought-out API and semantics (e.g.&nbsp;<code>isinstance(val, NumericValue)</code>?? That’s beautiful!)</li>
<li>Fast and fairly complete string support, since I work with a lot of text data.</li>
<li>Extremely responsive maintainers. Sometimes I’ve submitted multiple feature requests and bug reports in a single day, and a PR has been merged by the next day.</li>
<li>Escape hatch to SQL. I didn’t have to use that here, but if something isn’t supported, you can always fall back to SQL.</li>
</ul>
<p>Check out <a href="https://ibis-project.org/">The Ibis Website</a> for more information.</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>blog</category>
  <category>data engineering</category>
  <category>case study</category>
  <category>duckdb</category>
  <category>performance</category>
  <guid>https://ibis-project.org/posts/campaign-finance/</guid>
  <pubDate>Fri, 24 Mar 2023 04:00:00 GMT</pubDate>
</item>
<item>
  <title>Ibis sneak peek: writing to files</title>
  <dc:creator>Kae Suarez</dc:creator>
  <link>https://ibis-project.org/posts/ibis-to-file/</link>
  <description><![CDATA[ 





<p>Ibis 5.0 is coming soon and will offer new functionality and fixes to users. To enhance clarity around this process, we’re sharing a sneak peek into what we’re working on.</p>
<p>In Ibis 4.0, we added the ability to read CSVs and Parquet via the Ibis interface. We felt this was important because, well, the ability to read files is simply necessary, be it on a local scale, legacy data, data not yet in a database, and so on. However, for a user, the natural next question was “can I go ahead and write when I’m done?” The answer was no. We didn’t like that, especially since we do care about file-based use cases.</p>
<p>So, we’ve gone ahead and fixed that for Ibis 5.0.</p>
<section id="files-in-files-out" class="level2">
<h2 class="anchored" data-anchor-id="files-in-files-out">Files in, Files out</h2>
<p>Before we can write a file, we need data — so let’s read in a file, to start this off:</p>
<div id="1c631a25" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis</span>
<span id="cb1-2"></span>
<span id="cb1-3">ibis.options.interactive <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb1-4"></span>
<span id="cb1-5">t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ibis.read_csv(</span>
<span id="cb1-6">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://storage.googleapis.com/ibis-examples/data/penguins.csv.gz"</span></span>
<span id="cb1-7">)</span>
<span id="cb1-8">t</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━┓
┃<span style="font-weight: bold"> species </span>┃<span style="font-weight: bold"> island    </span>┃<span style="font-weight: bold"> bill_length_mm </span>┃<span style="font-weight: bold"> bill_depth_mm </span>┃<span style="font-weight: bold"> flipper_length_mm </span>┃<span style="font-weight: bold"> body_mass_g </span>┃<span style="font-weight: bold"> sex    </span>┃<span style="font-weight: bold"> year  </span>┃
┡━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span> │
├─────────┼───────────┼────────────────┼───────────────┼───────────────────┼─────────────┼────────┼───────┤
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.7</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3750</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.5</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17.4</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">186</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3800</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.3</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.0</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3250</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │        <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">36.7</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">19.3</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">193</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3450</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.3</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20.6</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">190</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3650</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">38.9</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17.8</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3625</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.2</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">19.6</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4675</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">34.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.1</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">193</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3475</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">42.0</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20.2</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">190</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4250</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │     <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└─────────┴───────────┴────────────────┴───────────────┴───────────────────┴─────────────┴────────┴───────┘
</pre>
</div>
</div>
<p>Of course, we could just write out, but let’s do an operation first — how about using selectors, which you can read more about <a href="https://ibis-project.org/blog/selectors/">here</a>? Self-promotion aside, here’s an operation:</p>
<div id="4988920a" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> ibis <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> _</span>
<span id="cb2-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis.selectors <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> s</span>
<span id="cb2-3"></span>
<span id="cb2-4">expr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb2-5">    t.group_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"species"</span>)</span>
<span id="cb2-6">     .mutate(s.across(s.numeric() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>s.c(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>), (_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> _.mean()) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> _.std()))</span>
<span id="cb2-7">)</span>
<span id="cb2-8">expr</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━┓
┃<span style="font-weight: bold"> species </span>┃<span style="font-weight: bold"> island    </span>┃<span style="font-weight: bold"> bill_length_mm </span>┃<span style="font-weight: bold"> bill_depth_mm </span>┃<span style="font-weight: bold"> flipper_length_mm </span>┃<span style="font-weight: bold"> body_mass_g </span>┃<span style="font-weight: bold"> sex    </span>┃<span style="font-weight: bold"> year  </span>┃
┡━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span> │
├─────────┼───────────┼────────────────┼───────────────┼───────────────────┼─────────────┼────────┼───────┤
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Biscoe   </span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.423513</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.366874</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.312925</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.053074</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2009</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.979426</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.126283</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.842104</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.380180</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2009</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.542615</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.613453</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.924596</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.179266</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2008</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Biscoe   </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.641513</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.366874</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.451665</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.091799</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Biscoe   </span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.222043</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.359177</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.007089</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.434698</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2009</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.392432</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.934527</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.077514</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.743124</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.129610</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.866019</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.230432</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.634089</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2008</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Dream    </span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.747686</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.126283</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.465843</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.437586</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2009</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Dream    </span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.860324</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.284681</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.216254</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.200835</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Dream    </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.754151</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.044090</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.771678</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.434698</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │     <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└─────────┴───────────┴────────────────┴───────────────┴───────────────────┴─────────────┴────────┴───────┘
</pre>
</div>
</div>
<p>Now, finally, time to do the exciting part:</p>
<div id="717f6f14" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">expr.to_parquet(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normalized.parquet"</span>)</span></code></pre></div>
</div>
<p>Like many things in Ibis, this is as simple and plain-looking as it is important. Being able to create files from Ibis instead of redirecting into other libraries first enables operation at larger scales and fewer steps. Where desired, you can address a backend directly to use its native export functionality — we want to make sure you have the flexibility to use Ibis or the backend as you see fit.</p>
</section>
<section id="wrapping-up" class="level2">
<h2 class="anchored" data-anchor-id="wrapping-up">Wrapping Up</h2>
<p>Ibis is an interface tool for analytical engines that can reach scales far beyond a laptop. Files are important to Ibis because:</p>
<ul>
<li>Ibis also supports local execution, where files are the standard unit of data — we want to support all our users.</li>
<li>Files are useful for moving between platforms, and long-term storage that isn’t tied to a particular backend.</li>
<li>Files can move more easily between our backends than database files, so we think this adds some convenience for the multi-backend use case.</li>
</ul>
<p>We’re excited to release this functionality in Ibis 5.0.</p>
<p>Interested in Ibis? Docs are available on this very website, at:</p>
<ul>
<li><a href="https://ibis-project.org/">Ibis Docs</a></li>
</ul>
<p>and the repo is always at:</p>
<ul>
<li><a href="https://github.com/ibis-project/ibis">Ibis GitHub</a></li>
</ul>
<p>Please feel free to reach out on GitHub!</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>blog</category>
  <category>io</category>
  <category>new feature</category>
  <category>sneak peek</category>
  <guid>https://ibis-project.org/posts/ibis-to-file/</guid>
  <pubDate>Thu, 09 Mar 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Ibis sneak peek: examples</title>
  <dc:creator>Kae Suarez</dc:creator>
  <link>https://ibis-project.org/posts/ibis-examples/</link>
  <description><![CDATA[ 





<p>Ibis has been moving quickly to provide a powerful but easy-to-use interface for interacting with analytical engines. However, as we’re approaching the 5.0 release of Ibis, we’ve realized that moving from not knowing Ibis to writing a first expression is not trivial.</p>
<p>As is, in our tutorial structure, work must be done on the user’s part — though we do provide the commands — to download a SQLite database onto disk, which can only be used with said backend. We feel that this put too much emphasis on a single backend, and added too much effort into picking the right backend for the first tutorial. We want minimal steps between users and learning the Ibis API.</p>
<p>This is why we’ve added the <code>ibis.examples</code> module.</p>
<section id="getting-started-with-examples" class="level2">
<h2 class="anchored" data-anchor-id="getting-started-with-examples">Getting Started with Examples</h2>
<p>This module offers in-Ibis access to multiple small tables (the largest is around only 30k rows), which are downloaded when requested and immediately read into the backend upon completion. We worked to keep pulling in examples simple, so it looks like this:</p>
<div id="d32ab650" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ibis.examples <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> ex</span>
<span id="cb1-3"></span>
<span id="cb1-4">ibis.options.interactive <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb1-5"></span>
<span id="cb1-6">t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ex.penguins.fetch()</span>
<span id="cb1-7">t</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━┓
┃<span style="font-weight: bold"> species </span>┃<span style="font-weight: bold"> island    </span>┃<span style="font-weight: bold"> bill_length_mm </span>┃<span style="font-weight: bold"> bill_depth_mm </span>┃<span style="font-weight: bold"> flipper_length_mm </span>┃<span style="font-weight: bold"> body_mass_g </span>┃<span style="font-weight: bold"> sex    </span>┃<span style="font-weight: bold"> year  </span>┃
┡━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span> │
├─────────┼───────────┼────────────────┼───────────────┼───────────────────┼─────────────┼────────┼───────┤
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.7</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3750</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.5</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17.4</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">186</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3800</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.3</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.0</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3250</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │        <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">36.7</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">19.3</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">193</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3450</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.3</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20.6</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">190</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3650</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">38.9</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17.8</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3625</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.2</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">19.6</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4675</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">34.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.1</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">193</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3475</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">42.0</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20.2</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">190</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4250</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │     <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└─────────┴───────────┴────────────────┴───────────────┴───────────────────┴─────────────┴────────┴───────┘
</pre>
</div>
</div>
<p>Another advantage of this new method is that we were able to register all of them so you can tab-complete, as you can see here:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ibis-project.org/posts/ibis-examples/tab_complete.png" class="img-fluid figure-img"></p>
<figcaption>Tab Complete</figcaption>
</figure>
</div>
<p>Once you’ve retrieved an example table, you can get straight to learning and experimenting, instead of struggling with just getting the data itself.</p>
<p>In the future, our tutorials will use the <em>examples</em> module to to help speed up learning of the Ibis framework.</p>
<p>Interested in Ibis? Docs are available on this very website, at:</p>
<ul>
<li><a href="https://ibis-project.org/">Ibis Docs</a></li>
</ul>
<p>and the repo is always at:</p>
<ul>
<li><a href="https://github.com/ibis-project/ibis">Ibis GitHub</a></li>
</ul>
<p>Please feel free to reach out on GitHub!</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>blog</category>
  <category>new feature</category>
  <category>sneak peek</category>
  <guid>https://ibis-project.org/posts/ibis-examples/</guid>
  <pubDate>Wed, 08 Mar 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Maximizing productivity with selectors</title>
  <dc:creator>Phillip Cloud</dc:creator>
  <link>https://ibis-project.org/posts/selectors/</link>
  <description><![CDATA[ 





<p>Before Ibis 5.0 it’s been challenging to concisely express whole-table operations with ibis. Happily this is no longer the case in ibis 5.0.</p>
<p>Let’s jump right in!</p>
<p>We’ll look at selectors examples using the <a href="https://allisonhorst.github.io/palmerpenguins/"><code>palmerpenguins</code> data set</a> with the <a href="../../backends/duckdb.html">DuckDB backend</a>.</p>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<div id="ba6b57fd" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> ibis.interactive <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb1-2"></span>
<span id="cb1-3">t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ex.penguins.fetch()</span>
<span id="cb1-4">t</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━┓
┃<span style="font-weight: bold"> species </span>┃<span style="font-weight: bold"> island    </span>┃<span style="font-weight: bold"> bill_length_mm </span>┃<span style="font-weight: bold"> bill_depth_mm </span>┃<span style="font-weight: bold"> flipper_length_mm </span>┃<span style="font-weight: bold"> body_mass_g </span>┃<span style="font-weight: bold"> sex    </span>┃<span style="font-weight: bold"> year  </span>┃
┡━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span> │
├─────────┼───────────┼────────────────┼───────────────┼───────────────────┼─────────────┼────────┼───────┤
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.7</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3750</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.5</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17.4</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">186</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3800</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.3</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.0</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3250</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │        <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">36.7</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">19.3</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">193</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3450</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.3</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20.6</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">190</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3650</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">38.9</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17.8</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3625</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.2</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">19.6</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4675</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">34.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.1</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">193</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3475</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">42.0</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20.2</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">190</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4250</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │     <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└─────────┴───────────┴────────────────┴───────────────┴───────────────────┴─────────────┴────────┴───────┘
</pre>
</div>
</div>
</section>
<section id="examples" class="level2">
<h2 class="anchored" data-anchor-id="examples">Examples</h2>
<section id="normalization" class="level3">
<h3 class="anchored" data-anchor-id="normalization">Normalization</h3>
<p>Let’s say you want to compute the <a href="https://en.wikipedia.org/wiki/Standard_score">z-score</a> of every numeric column and replace the existing data with that normalized value. Here’s how you’d do that with selectors:</p>
<div id="c36a2829" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">t.mutate(s.across(s.numeric(), (_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> _.mean()) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> _.std()))</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━┓
┃<span style="font-weight: bold"> species </span>┃<span style="font-weight: bold"> island    </span>┃<span style="font-weight: bold"> bill_length_mm </span>┃<span style="font-weight: bold"> bill_depth_mm </span>┃<span style="font-weight: bold"> flipper_length_mm </span>┃<span style="font-weight: bold"> body_mass_g </span>┃<span style="font-weight: bold"> sex    </span>┃<span style="font-weight: bold"> year      </span>┃
┡━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>   │
├─────────┼───────────┼────────────────┼───────────────┼───────────────────┼─────────────┼────────┼───────────┤
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.883205</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.784300</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.416272</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.563317</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.257484</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.809939</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.126003</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.060696</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.500969</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.257484</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.663408</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.429833</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.420660</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.186793</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.257484</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.257484</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.322799</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.088129</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.562890</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.937403</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.257484</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.846572</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.746426</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.776236</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.688012</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.257484</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.919837</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.328556</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.416272</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.719186</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.257484</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.864888</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.240044</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.420660</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.590115</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.257484</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.799025</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.480471</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.562890</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.906229</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.257484</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.352029</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.543873</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.776236</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.060160</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.257484</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │         <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└─────────┴───────────┴────────────────┴───────────────┴───────────────────┴─────────────┴────────┴───────────┘
</pre>
</div>
</div>
</section>
<section id="whats-up-with-the-year-column" class="level3">
<h3 class="anchored" data-anchor-id="whats-up-with-the-year-column">What’s Up With the <code>year</code> Column?</h3>
<p>Whoops, looks like we included <code>year</code> in our normalization because it’s an <code>int64</code> column (and therefore numeric) but normalizing the year doesn’t make sense.</p>
<p>We can exclude <code>year</code> from the normalization using another selector:</p>
<div id="7c987863" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">t.mutate(s.across(s.numeric() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>s.c(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>), (_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> _.mean()) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> _.std()))</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━┓
┃<span style="font-weight: bold"> species </span>┃<span style="font-weight: bold"> island    </span>┃<span style="font-weight: bold"> bill_length_mm </span>┃<span style="font-weight: bold"> bill_depth_mm </span>┃<span style="font-weight: bold"> flipper_length_mm </span>┃<span style="font-weight: bold"> body_mass_g </span>┃<span style="font-weight: bold"> sex    </span>┃<span style="font-weight: bold"> year  </span>┃
┡━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span> │
├─────────┼───────────┼────────────────┼───────────────┼───────────────────┼─────────────┼────────┼───────┤
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.883205</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.784300</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.416272</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.563317</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.809939</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.126003</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.060696</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.500969</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.663408</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.429833</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.420660</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.186793</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.322799</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.088129</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.562890</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.937403</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.846572</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.746426</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.776236</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.688012</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.919837</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.328556</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.416272</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.719186</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.864888</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.240044</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.420660</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.590115</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.799025</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.480471</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.562890</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.906229</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.352029</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.543873</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.776236</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.060160</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │     <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└─────────┴───────────┴────────────────┴───────────────┴───────────────────┴─────────────┴────────┴───────┘
</pre>
</div>
</div>
<p><code>c</code> is short for “column” and the <code>~</code> means “negate”. Combining those we get “not the year column”!</p>
<p>Pretty neat right?</p>
</section>
<section id="composable-group-by" class="level3">
<h3 class="anchored" data-anchor-id="composable-group-by">Composable Group By</h3>
<p>The power of this approach comes in when you want the grouped version. Perhaps we think some of these columns vary by species.</p>
<p>With selectors, all you need to do is slap a <code>.group_by("species")</code> onto <code>t</code>:</p>
<div id="fe399083" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">t.group_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"species"</span>).mutate(</span>
<span id="cb4-2">    s.across(s.numeric() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>s.c(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>), (_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> _.mean()) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> _.std())</span>
<span id="cb4-3">)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━┓
┃<span style="font-weight: bold"> species </span>┃<span style="font-weight: bold"> island    </span>┃<span style="font-weight: bold"> bill_length_mm </span>┃<span style="font-weight: bold"> bill_depth_mm </span>┃<span style="font-weight: bold"> flipper_length_mm </span>┃<span style="font-weight: bold"> body_mass_g </span>┃<span style="font-weight: bold"> sex    </span>┃<span style="font-weight: bold"> year  </span>┃
┡━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span> │
├─────────┼───────────┼────────────────┼───────────────┼───────────────────┼─────────────┼────────┼───────┤
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.791697</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.270997</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.160007</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.001444</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2008</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Biscoe   </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.467524</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.038103</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.924596</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.816322</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2009</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Dream    </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.378692</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.619441</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.910418</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.070231</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Dream    </span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.860324</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.284681</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.216254</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.200835</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.785232</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.783827</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.465843</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.546622</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.190962</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.852335</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.007089</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.110480</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.040778</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.449067</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.369172</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.164997</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.153416</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.030405</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.771678</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.124749</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.761426</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.202489</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.465843</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.492104</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.204702</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.523563</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.007089</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.197947</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │     <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└─────────┴───────────┴────────────────┴───────────────┴───────────────────┴─────────────┴────────┴───────┘
</pre>
</div>
</div>
<p>Since ibis translates this into a run-of-the-mill selection as if you had called <code>select</code> or <code>mutate</code> without selectors, nothing special is needed for a backend to work with these new constructs.</p>
<p>Let’s look at some more examples.</p>
</section>
<section id="min-max-normalization" class="level3">
<h3 class="anchored" data-anchor-id="min-max-normalization">Min-max Normalization</h3>
<p>Grouped min/max normalization? Easy:</p>
<div id="f95a9fbf" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">t.group_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"species"</span>).mutate(</span>
<span id="cb5-2">    s.across(s.numeric() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>s.c(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>), (_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> _.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>()) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (_.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> _.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>()))</span>
<span id="cb5-3">)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━┓
┃<span style="font-weight: bold"> species </span>┃<span style="font-weight: bold"> island    </span>┃<span style="font-weight: bold"> bill_length_mm </span>┃<span style="font-weight: bold"> bill_depth_mm </span>┃<span style="font-weight: bold"> flipper_length_mm </span>┃<span style="font-weight: bold"> body_mass_g </span>┃<span style="font-weight: bold"> sex    </span>┃<span style="font-weight: bold"> year  </span>┃
┡━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span> │
├─────────┼───────────┼────────────────┼───────────────┼───────────────────┼─────────────┼────────┼───────┤
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.633094</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.216667</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.500000</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.441558</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2008</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Biscoe   </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.762590</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.466667</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.631579</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.636364</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2009</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Dream    </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.553957</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.600000</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.315789</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.935065</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Dream    </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.316547</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.416667</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.263158</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.155844</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.330935</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.633333</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.552632</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.311688</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.517986</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.850000</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.473684</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.415584</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.489209</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.383333</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.236842</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.402597</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.510791</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.683333</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.605263</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.948052</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.143885</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.433333</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.552632</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.324675</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.712230</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.783333</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.473684</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.727273</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │     <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└─────────┴───────────┴────────────────┴───────────────┴───────────────────┴─────────────┴────────┴───────┘
</pre>
</div>
</div>
</section>
<section id="casting-and-munging" class="level3">
<h3 class="anchored" data-anchor-id="casting-and-munging">Casting and Munging</h3>
<p>How about casting every column whose name ends with any of the strings <code>"mm"</code> or <code>"g"</code> to a <code>float32</code>? No problem!</p>
<div id="c1d8dafb" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">t.mutate(s.across(s.endswith((<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mm"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"g"</span>)), _.cast(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"float32"</span>)))</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━┓
┃<span style="font-weight: bold"> species </span>┃<span style="font-weight: bold"> island    </span>┃<span style="font-weight: bold"> bill_length_mm </span>┃<span style="font-weight: bold"> bill_depth_mm </span>┃<span style="font-weight: bold"> flipper_length_mm </span>┃<span style="font-weight: bold"> body_mass_g </span>┃<span style="font-weight: bold"> sex    </span>┃<span style="font-weight: bold"> year  </span>┃
┡━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float32</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float32</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float32</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float32</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span> │
├─────────┼───────────┼────────────────┼───────────────┼───────────────────┼─────────────┼────────┼───────┤
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.099998</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.700001</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181.0</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3750.0</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.500000</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17.400000</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">186.0</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3800.0</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.299999</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.000000</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195.0</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3250.0</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">36.700001</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">19.299999</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">193.0</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3450.0</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.299999</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20.600000</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">190.0</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3650.0</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">38.900002</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17.799999</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181.0</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3625.0</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.200001</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">19.600000</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195.0</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4675.0</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">34.099998</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.100000</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">193.0</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3475.0</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">42.000000</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20.200001</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">190.0</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4250.0</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │     <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└─────────┴───────────┴────────────────┴───────────────┴───────────────────┴─────────────┴────────┴───────┘
</pre>
</div>
</div>
<p>We can make all string columns have the same case too!</p>
<div id="bb938f39" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">t.mutate(s.across(s.of_type(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"string"</span>), _.lower()))</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━┓
┃<span style="font-weight: bold"> species </span>┃<span style="font-weight: bold"> island    </span>┃<span style="font-weight: bold"> bill_length_mm </span>┃<span style="font-weight: bold"> bill_depth_mm </span>┃<span style="font-weight: bold"> flipper_length_mm </span>┃<span style="font-weight: bold"> body_mass_g </span>┃<span style="font-weight: bold"> sex    </span>┃<span style="font-weight: bold"> year  </span>┃
┡━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span> │
├─────────┼───────────┼────────────────┼───────────────┼───────────────────┼─────────────┼────────┼───────┤
│ <span style="color: #008000; text-decoration-color: #008000">adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.7</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3750</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.5</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17.4</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">186</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3800</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.3</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.0</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3250</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">torgersen</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │        <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">36.7</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">19.3</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">193</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3450</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.3</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20.6</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">190</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3650</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">38.9</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17.8</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">181</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3625</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.2</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">19.6</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">195</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4675</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">34.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.1</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">193</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3475</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #008000; text-decoration-color: #008000">adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">42.0</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20.2</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">190</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4250</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>   │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │     <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└─────────┴───────────┴────────────────┴───────────────┴───────────────────┴─────────────┴────────┴───────┘
</pre>
</div>
</div>
</section>
<section id="multiple-computations-per-column" class="level3">
<h3 class="anchored" data-anchor-id="multiple-computations-per-column">Multiple Computations per Column</h3>
<p>What if I want to compute multiple things? Heck yeah!</p>
<div id="d4c94ff9" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">t.group_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sex"</span>).mutate(</span>
<span id="cb8-2">    s.across(</span>
<span id="cb8-3">        s.numeric() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>s.c(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>),</span>
<span id="cb8-4">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>(centered<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> _.mean(), zscore<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> _.mean()) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> _.std()),</span>
<span id="cb8-5">    )</span>
<span id="cb8-6">).select(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sex"</span>, s.endswith((<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_centered"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_zscore"</span>)))</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> sex    </span>┃<span style="font-weight: bold"> bill_length_mm_centered </span>┃<span style="font-weight: bold"> bill_depth_mm_centered </span>┃<span style="font-weight: bold"> flipper_length_mm_centered </span>┃<span style="font-weight: bold"> body_mass_g_centered </span>┃<span style="font-weight: bold"> bill_length_mm_zscore </span>┃<span style="font-weight: bold"> bill_depth_mm_zscore </span>┃<span style="font-weight: bold"> flipper_length_mm_zscore </span>┃<span style="font-weight: bold"> body_mass_g_zscore </span>┃
┡━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>                │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>                    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>              │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>              │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>                  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>            │
├────────┼─────────────────────────┼────────────────────────┼────────────────────────────┼──────────────────────┼───────────────────────┼──────────────────────┼──────────────────────────┼────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">female</span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.10303</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.925455</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">11.636364</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">937.727273</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.836760</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.072270</span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.930851</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.407635</span> │
│ <span style="color: #008000; text-decoration-color: #008000">female</span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.20303</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-2.425455</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10.636364</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">712.727273</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.245342</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.350716</span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.850856</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.069885</span> │
│ <span style="color: #008000; text-decoration-color: #008000">female</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8.09697</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.674545</span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-12.363636</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-462.272727</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.651271</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.375649</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.989030</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.693924</span> │
│ <span style="color: #008000; text-decoration-color: #008000">female</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-5.89697</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.874545</span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-10.363636</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-562.272727</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.202610</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.487027</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.829039</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.844035</span> │
│ <span style="color: #008000; text-decoration-color: #008000">female</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.99697</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.174545</span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-15.363636</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-662.272727</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.203319</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.654095</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.229015</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.994147</span> │
│ <span style="color: #008000; text-decoration-color: #008000">female</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-5.49697</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.374545</span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-12.363636</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-162.272727</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.121035</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.765473</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.989030</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.243590</span> │
│ <span style="color: #008000; text-decoration-color: #008000">female</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-3.39697</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.574545</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-2.363636</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-412.272727</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.692768</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.433743</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.189079</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.618868</span> │
│ <span style="color: #008000; text-decoration-color: #008000">female</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-7.69697</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.974545</span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-13.363636</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-537.272727</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.569697</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.099608</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.069025</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.806507</span> │
│ <span style="color: #008000; text-decoration-color: #008000">female</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-4.29697</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.874545</span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-23.363636</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-462.272727</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.876311</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.043919</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.868975</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.693924</span> │
│ <span style="color: #008000; text-decoration-color: #008000">female</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-6.19697</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.774545</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-8.363636</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-62.272727</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.263791</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.545122</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.669049</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.093478</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │                       <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                      <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                          <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                    <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                     <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                    <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                        <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                  <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└────────┴─────────────────────────┴────────────────────────┴────────────────────────────┴──────────────────────┴───────────────────────┴──────────────────────┴──────────────────────────┴────────────────────┘
</pre>
</div>
</div>
<p>Don’t like the naming convention?</p>
<p>Pass a function to make your own name!</p>
<div id="aeb79ffa" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1">t.select(s.startswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bill"</span>)).mutate(</span>
<span id="cb9-2">    s.across(</span>
<span id="cb9-3">        s.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">all</span>(),</span>
<span id="cb9-4">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> _.mean(), y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()),</span>
<span id="cb9-5">        names<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> col, fn: <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>col<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>fn<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_improved"</span>,</span>
<span id="cb9-6">    )</span>
<span id="cb9-7">)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> bill_length_mm </span>┃<span style="font-weight: bold"> bill_depth_mm </span>┃<span style="font-weight: bold"> bill_length_mm_x_improved </span>┃<span style="font-weight: bold"> bill_depth_mm_x_improved </span>┃<span style="font-weight: bold"> bill_length_mm_y_improved </span>┃<span style="font-weight: bold"> bill_depth_mm_y_improved </span>┃
┡━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>                  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>                  │
├────────────────┼───────────────┼───────────────────────────┼──────────────────────────┼───────────────────────────┼──────────────────────────┤
│           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.7</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-4.82193</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.54883</span> │                      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">59.6</span> │                     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21.5</span> │
│           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.5</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17.4</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-4.42193</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.24883</span> │                      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">59.6</span> │                     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21.5</span> │
│           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">40.3</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.0</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-3.62193</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.84883</span> │                      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">59.6</span> │                     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21.5</span> │
│            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │                       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │                      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">nan</span> │                      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">59.6</span> │                     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21.5</span> │
│           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">36.7</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">19.3</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-7.22193</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.14883</span> │                      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">59.6</span> │                     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21.5</span> │
│           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.3</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20.6</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-4.62193</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.44883</span> │                      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">59.6</span> │                     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21.5</span> │
│           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">38.9</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17.8</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-5.02193</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.64883</span> │                      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">59.6</span> │                     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21.5</span> │
│           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.2</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">19.6</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-4.72193</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.44883</span> │                      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">59.6</span> │                     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21.5</span> │
│           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">34.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.1</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-9.82193</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.94883</span> │                      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">59.6</span> │                     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21.5</span> │
│           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">42.0</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20.2</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.92193</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.04883</span> │                      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">59.6</span> │                     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21.5</span> │
│              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                         <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                        <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                         <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                        <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└────────────────┴───────────────┴───────────────────────────┴──────────────────────────┴───────────────────────────┴──────────────────────────┘
</pre>
</div>
</div>
<p>Don’t like lambda functions? We support a format string too!</p>
<div id="5f3dd2c1" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">t.select(s.startswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bill"</span>)).mutate(</span>
<span id="cb10-2">    s.across(</span>
<span id="cb10-3">        s.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">all</span>(),</span>
<span id="cb10-4">        func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> _.mean(), y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()),</span>
<span id="cb10-5">        names<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{col}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{fn}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">_improved"</span>,</span>
<span id="cb10-6">    )</span>
<span id="cb10-7">).head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> bill_length_mm </span>┃<span style="font-weight: bold"> bill_depth_mm </span>┃<span style="font-weight: bold"> bill_length_mm_x_improved </span>┃<span style="font-weight: bold"> bill_depth_mm_x_improved </span>┃<span style="font-weight: bold"> bill_length_mm_y_improved </span>┃<span style="font-weight: bold"> bill_depth_mm_y_improved </span>┃
┡━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>                  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>                   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>                  │
├────────────────┼───────────────┼───────────────────────────┼──────────────────────────┼───────────────────────────┼──────────────────────────┤
│           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18.7</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-4.82193</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.54883</span> │                      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">59.6</span> │                     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21.5</span> │
│           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">39.5</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17.4</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-4.42193</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.24883</span> │                      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">59.6</span> │                     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21.5</span> │
└────────────────┴───────────────┴───────────────────────────┴──────────────────────────┴───────────────────────────┴──────────────────────────┘
</pre>
</div>
</div>
</section>
<section id="working-with-other-ibis-apis" class="level3">
<h3 class="anchored" data-anchor-id="working-with-other-ibis-apis">Working with other Ibis APIs</h3>
<p>We’ve seen lots of mutate use, but selectors also work with <code>.agg</code>:</p>
<div id="6b61a552" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">t.group_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>).agg(s.across(s.numeric() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>s.c(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>), _.mean())).order_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> year  </span>┃<span style="font-weight: bold"> bill_length_mm </span>┃<span style="font-weight: bold"> bill_depth_mm </span>┃<span style="font-weight: bold"> flipper_length_mm </span>┃<span style="font-weight: bold"> body_mass_g </span>┃
┡━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>     │
├───────┼────────────────┼───────────────┼───────────────────┼─────────────┤
│  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2007</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">43.740367</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17.427523</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">196.880734</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4124.541284</span> │
│  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2008</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">43.541228</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">16.914035</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">202.798246</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4266.666667</span> │
│  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2009</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">44.452941</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17.125210</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">202.806723</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4210.294118</span> │
└───────┴────────────────┴───────────────┴───────────────────┴─────────────┘
</pre>
</div>
</div>
<p>Naturally, selectors work in grouping keys too, for even more convenience:</p>
<div id="4d5a0118" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1">t.group_by(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>s.numeric() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> s.c(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>)).mutate(</span>
<span id="cb12-2">    s.across(s.numeric() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>s.c(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>), <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>(centered<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> _.mean(), std<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>_.std()))</span>
<span id="cb12-3">).select(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"species"</span>, s.endswith((<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_centered"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_std"</span>)))</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> species </span>┃<span style="font-weight: bold"> bill_length_mm_centered </span>┃<span style="font-weight: bold"> bill_depth_mm_centered </span>┃<span style="font-weight: bold"> flipper_length_mm_centered </span>┃<span style="font-weight: bold"> body_mass_g_centered </span>┃<span style="font-weight: bold"> bill_length_mm_std </span>┃<span style="font-weight: bold"> bill_depth_mm_std </span>┃<span style="font-weight: bold"> flipper_length_mm_std </span>┃<span style="font-weight: bold"> body_mass_g_std </span>┃
┡━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>                │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>                    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>              │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>         │
├─────────┼─────────────────────────┼────────────────────────┼────────────────────────────┼──────────────────────┼────────────────────┼───────────────────┼───────────────────────┼─────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │                   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.46</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.400000</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.600000</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-170.000000</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.327780</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.681909</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.302173</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">189.076704</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │                   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.96</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.200000</span> │                   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.400000</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">180.000000</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.327780</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.681909</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.302173</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">189.076704</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │                   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.36</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.100000</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.600000</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">30.000000</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.327780</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.681909</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.302173</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">189.076704</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │                    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.44</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.300000</span> │                   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.400000</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-220.000000</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.327780</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.681909</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.302173</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">189.076704</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │                    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.34</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.600000</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.600000</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">180.000000</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.327780</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.681909</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.302173</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">189.076704</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Gentoo </span> │                    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.00</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.935294</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">11.117647</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">147.058824</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.056755</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.670766</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.973459</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">349.763576</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Gentoo </span> │                    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.00</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.164706</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.882353</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">147.058824</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.056755</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.670766</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.973459</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">349.763576</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Gentoo </span> │                   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.40</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.864706</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-3.882353</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-152.941176</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.056755</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.670766</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.973459</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">349.763576</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Gentoo </span> │                   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-2.30</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.064706</span> │                   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.117647</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-352.941176</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.056755</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.670766</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.973459</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">349.763576</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Gentoo </span> │                   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-2.20</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.035294</span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-3.882353</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-402.941176</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.056755</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.670766</span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.973459</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">349.763576</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>       │                       <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                      <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                          <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                    <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                  <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                     <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │               <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└─────────┴─────────────────────────┴────────────────────────┴────────────────────────────┴──────────────────────┴────────────────────┴───────────────────┴───────────────────────┴─────────────────┘
</pre>
</div>
</div>
</section>
<section id="filtering-selectors" class="level3">
<h3 class="anchored" data-anchor-id="filtering-selectors">Filtering Selectors</h3>
<p>You can also express complex filters more concisely.</p>
<p>Let’s say we only want to keep rows where all the bill size z-score related columns’ absolute values are greater than 2.</p>
<div id="c4a578ce" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1">t.drop(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>).group_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"species"</span>).mutate(</span>
<span id="cb13-2">    s.across(s.numeric(), <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>(zscore<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> _.mean()) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> _.std()))</span>
<span id="cb13-3">).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(s.if_all(s.startswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bill"</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> s.endswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_zscore"</span>), _.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">abs</span>() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> species </span>┃<span style="font-weight: bold"> island    </span>┃<span style="font-weight: bold"> bill_length_mm </span>┃<span style="font-weight: bold"> bill_depth_mm </span>┃<span style="font-weight: bold"> flipper_length_mm </span>┃<span style="font-weight: bold"> body_mass_g </span>┃<span style="font-weight: bold"> sex    </span>┃<span style="font-weight: bold"> bill_length_mm_zscore </span>┃<span style="font-weight: bold"> bill_depth_mm_zscore </span>┃<span style="font-weight: bold"> flipper_length_mm_zscore </span>┃<span style="font-weight: bold"> body_mass_g_zscore </span>┃
┡━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>              │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>                  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>            │
├─────────┼───────────┼────────────────┼───────────────┼───────────────────┼─────────────┼────────┼───────────────────────┼──────────────────────┼──────────────────────────┼────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Torgersen</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">46.0</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21.5</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">194</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4200</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.706539</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.592071</span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.618760</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.088911</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Adelie </span> │ <span style="color: #008000; text-decoration-color: #008000">Dream    </span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">32.1</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">15.5</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">188</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3050</span> │ <span style="color: #008000; text-decoration-color: #008000">female</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-2.512345</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-2.339505</span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.298747</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.418906</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Gentoo </span> │ <span style="color: #008000; text-decoration-color: #008000">Biscoe   </span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">55.9</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17.0</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">228</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5600</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.724046</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.056508</span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.667394</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.039411</span> │
│ <span style="color: #008000; text-decoration-color: #008000">Gentoo </span> │ <span style="color: #008000; text-decoration-color: #008000">Biscoe   </span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">59.6</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17.0</span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">230</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6050</span> │ <span style="color: #008000; text-decoration-color: #008000">male  </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.924621</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.056508</span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.975799</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.932062</span> │
└─────────┴───────────┴────────────────┴───────────────┴───────────────────┴─────────────┴────────┴───────────────────────┴──────────────────────┴──────────────────────────┴────────────────────┘
</pre>
</div>
</div>
</section>
<section id="bonus-generated-sql" class="level3">
<h3 class="anchored" data-anchor-id="bonus-generated-sql">Bonus: Generated SQL</h3>
<p>The SQL for that last expression is pretty gnarly:</p>
<div id="9890792a" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1">ibis.to_sql(</span>
<span id="cb14-2">    t.drop(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>)</span>
<span id="cb14-3">    .group_by(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"species"</span>)</span>
<span id="cb14-4">    .mutate(s.across(s.numeric(), <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>(zscore<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> _.mean()) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> _.std())))</span>
<span id="cb14-5">    .<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span>(s.if_all(s.startswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bill"</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> s.endswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_zscore"</span>), _.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">abs</span>() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb14-6">)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb15-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">WITH</span> t0 <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> (</span>
<span id="cb15-2">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span></span>
<span id="cb15-3">    t2.species <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> species,</span>
<span id="cb15-4">    t2.island <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> island,</span>
<span id="cb15-5">    t2.bill_length_mm <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> bill_length_mm,</span>
<span id="cb15-6">    t2.bill_depth_mm <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> bill_depth_mm,</span>
<span id="cb15-7">    t2.flipper_length_mm <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> flipper_length_mm,</span>
<span id="cb15-8">    t2.body_mass_g <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> body_mass_g,</span>
<span id="cb15-9">    t2.sex <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> sex</span>
<span id="cb15-10">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> main._ibis_examples_penguins_mqqdnfaydfbevoowdsf7djbsom <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> t2</span>
<span id="cb15-11">), t1 <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> (</span>
<span id="cb15-12">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span></span>
<span id="cb15-13">    t0.species <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> species,</span>
<span id="cb15-14">    t0.island <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> island,</span>
<span id="cb15-15">    t0.bill_length_mm <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> bill_length_mm,</span>
<span id="cb15-16">    t0.bill_depth_mm <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> bill_depth_mm,</span>
<span id="cb15-17">    t0.flipper_length_mm <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> flipper_length_mm,</span>
<span id="cb15-18">    t0.body_mass_g <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> body_mass_g,</span>
<span id="cb15-19">    t0.sex <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> sex,</span>
<span id="cb15-20">    (</span>
<span id="cb15-21">      t0.bill_length_mm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">AVG</span>(t0.bill_length_mm) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">OVER</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">PARTITION</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">BY</span> t0.species <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">ROWS</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">BETWEEN</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">UNBOUNDED</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">PRECEDING</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AND</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">UNBOUNDED</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FOLLOWING</span>)</span>
<span id="cb15-22">    ) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">STDDEV_SAMP</span>(t0.bill_length_mm) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">OVER</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">PARTITION</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">BY</span> t0.species <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">ROWS</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">BETWEEN</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">UNBOUNDED</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">PRECEDING</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AND</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">UNBOUNDED</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FOLLOWING</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> bill_length_mm_zscore,</span>
<span id="cb15-23">    (</span>
<span id="cb15-24">      t0.bill_depth_mm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">AVG</span>(t0.bill_depth_mm) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">OVER</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">PARTITION</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">BY</span> t0.species <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">ROWS</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">BETWEEN</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">UNBOUNDED</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">PRECEDING</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AND</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">UNBOUNDED</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FOLLOWING</span>)</span>
<span id="cb15-25">    ) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">STDDEV_SAMP</span>(t0.bill_depth_mm) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">OVER</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">PARTITION</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">BY</span> t0.species <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">ROWS</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">BETWEEN</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">UNBOUNDED</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">PRECEDING</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AND</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">UNBOUNDED</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FOLLOWING</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> bill_depth_mm_zscore,</span>
<span id="cb15-26">    (</span>
<span id="cb15-27">      t0.flipper_length_mm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">AVG</span>(t0.flipper_length_mm) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">OVER</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">PARTITION</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">BY</span> t0.species <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">ROWS</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">BETWEEN</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">UNBOUNDED</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">PRECEDING</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AND</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">UNBOUNDED</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FOLLOWING</span>)</span>
<span id="cb15-28">    ) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">STDDEV_SAMP</span>(t0.flipper_length_mm) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">OVER</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">PARTITION</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">BY</span> t0.species <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">ROWS</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">BETWEEN</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">UNBOUNDED</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">PRECEDING</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AND</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">UNBOUNDED</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FOLLOWING</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> flipper_length_mm_zscore,</span>
<span id="cb15-29">    (</span>
<span id="cb15-30">      t0.body_mass_g <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">AVG</span>(t0.body_mass_g) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">OVER</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">PARTITION</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">BY</span> t0.species <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">ROWS</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">BETWEEN</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">UNBOUNDED</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">PRECEDING</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AND</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">UNBOUNDED</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FOLLOWING</span>)</span>
<span id="cb15-31">    ) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">STDDEV_SAMP</span>(t0.body_mass_g) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">OVER</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">PARTITION</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">BY</span> t0.species <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">ROWS</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">BETWEEN</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">UNBOUNDED</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">PRECEDING</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AND</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">UNBOUNDED</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FOLLOWING</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> body_mass_g_zscore</span>
<span id="cb15-32">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> t0</span>
<span id="cb15-33">)</span>
<span id="cb15-34"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">SELECT</span></span>
<span id="cb15-35">  t1.species,</span>
<span id="cb15-36">  t1.island,</span>
<span id="cb15-37">  t1.bill_length_mm,</span>
<span id="cb15-38">  t1.bill_depth_mm,</span>
<span id="cb15-39">  t1.flipper_length_mm,</span>
<span id="cb15-40">  t1.body_mass_g,</span>
<span id="cb15-41">  t1.sex,</span>
<span id="cb15-42">  t1.bill_length_mm_zscore,</span>
<span id="cb15-43">  t1.bill_depth_mm_zscore,</span>
<span id="cb15-44">  t1.flipper_length_mm_zscore,</span>
<span id="cb15-45">  t1.body_mass_g_zscore</span>
<span id="cb15-46"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> t1</span>
<span id="cb15-47"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">WHERE</span></span>
<span id="cb15-48">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ABS</span>(t1.bill_length_mm_zscore) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">CAST</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> TINYINT)</span>
<span id="cb15-49">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AND</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ABS</span>(t1.bill_depth_mm_zscore) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">CAST</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">AS</span> TINYINT)</span></code></pre></div>
</div>
</div>
<p>Good thing you didn’t have to write that by hand!</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>This blog post illustrates the ability to apply computations to many columns at once and the power of ibis as a composable, expressive library for analytics.</p>
<ul>
<li><a href="../../contribute/index.html">Get involved!</a></li>
<li><a href="https://github.com/ibis-project/ibis/issues/new/choose">Report issues!</a></li>
</ul>


</section>

<a onclick="window.scrollTo(0, 0); return false;" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a> ]]></description>
  <category>blog</category>
  <category>new feature</category>
  <category>productivity</category>
  <category>duckdb</category>
  <guid>https://ibis-project.org/posts/selectors/</guid>
  <pubDate>Mon, 27 Feb 2023 05:00:00 GMT</pubDate>
</item>
</channel>
</rss>
