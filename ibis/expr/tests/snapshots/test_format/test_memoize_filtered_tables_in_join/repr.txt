r0 := UnboundTable: purchases
  region string
  kind   string
  user   int64
  amount float64

r1 := Aggregate[r0]
  groups:
    region: r0.region
    kind:   r0.kind
  metrics:
    total: Sum(r0.amount)

r2 := Filter[r1]
  r1.kind == 'foo'

r3 := Filter[r1]
  r1.kind == 'bar'

r4 := SelfReference[r2]

r5 := SelfReference[r3]

JoinChain[r4]
  JoinLink[inner, r5]
    r4.region == r5.region
  values:
    region:      r4.region
    kind:        r4.kind
    total:       r4.total
    right_total: r5.total