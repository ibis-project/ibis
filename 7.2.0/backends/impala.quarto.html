<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.339">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Ibis - Impala</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../logo.svg" rel="icon" type="image/svg+xml">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "keyboard-shortcut": [
    null
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
<meta name="twitter:title" content="Ibis - Impala">
<meta name="twitter:description" content="the portable Python dataframe library">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Ibis</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-getting-started" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Getting started</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-getting-started">    
        <li>
    <a class="dropdown-item" href="../install.html">
 <span class="dropdown-text">Installation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../tutorials/getting_started.html">
 <span class="dropdown-text">Tutorial: getting started</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../tutorials/ibis-for-dplyr-users.html">
 <span class="dropdown-text">Tutorial: Ibis for dplyr users</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../tutorials/ibis-for-pandas-users.html">
 <span class="dropdown-text">Tutorial: Ibis for pandas users</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../tutorials/ibis-for-sql-users.html">
 <span class="dropdown-text">Tutorial: Ibis for SQL users</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Data Platforms</li>
        <li>
    <a class="dropdown-item" href="../tutorials/data-platforms/starburst-galaxy/0_setup.html">
 <span class="dropdown-text">Starburst Galaxy</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-concepts" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Concepts</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-concepts">    
        <li>
    <a class="dropdown-item" href="../why.html">
 <span class="dropdown-text">Why Ibis?</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../concepts/internals.html">
 <span class="dropdown-text">Internals</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../concepts/versioning.html">
 <span class="dropdown-text">Versioning policy</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-backends" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Backends</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-backends">    
        <li>
    <a class="dropdown-item" href="../backends/bigquery.html">
 <span class="dropdown-text">BigQuery</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../backends/clickhouse.html">
 <span class="dropdown-text">ClickHouse</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../backends/dask.html">
 <span class="dropdown-text">Dask</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../backends/datafusion.html">
 <span class="dropdown-text">DataFusion</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../backends/druid.html">
 <span class="dropdown-text">Druid</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../backends/duckdb.html">
 <span class="dropdown-text">DuckDB</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../backends/exasol.html">
 <span class="dropdown-text">Exasol</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../backends/impala.html">
 <span class="dropdown-text">Impala</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../backends/mssql.html">
 <span class="dropdown-text">MSSQL</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../backends/mysql.html">
 <span class="dropdown-text">MySQL</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../backends/oracle.html">
 <span class="dropdown-text">Oracle</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../backends/pandas.html">
 <span class="dropdown-text">pandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../backends/polars.html">
 <span class="dropdown-text">Polars</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../backends/postgresql.html">
 <span class="dropdown-text">PostgreSQL</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../backends/pyspark.html">
 <span class="dropdown-text">PySpark</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../backends/snowflake.html">
 <span class="dropdown-text">Snowflake</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../backends/sqlite.html">
 <span class="dropdown-text">SQLite</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../backends/trino.html">
 <span class="dropdown-text">Trino</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../support_matrix.html">
 <span class="dropdown-text">Operation support matrix</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-how-to" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">How-to</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-how-to">    
        <li class="dropdown-header">Configure</li>
        <li>
    <a class="dropdown-item" href="../how-to/configure/basics.html">
 <span class="dropdown-text">Basic configuration</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Input Output</li>
        <li>
    <a class="dropdown-item" href="../how-to/input-output/basics.html">
 <span class="dropdown-text">Basic input/output</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../how-to/input-output/multiple-backends.html">
 <span class="dropdown-text">Work with multiple backends</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Analytics</li>
        <li>
    <a class="dropdown-item" href="../how-to/analytics/basics.html">
 <span class="dropdown-text">Basic analytics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../how-to/analytics/chain_expressions.html">
 <span class="dropdown-text">Chaining expressions</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Visualization</li>
        <li>
    <a class="dropdown-item" href="../how-to/visualization/altair.html">
 <span class="dropdown-text">Altair + Ibis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../how-to/visualization/matplotlib.html">
 <span class="dropdown-text">matplotlib + Ibis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../how-to/visualization/plotly.html">
 <span class="dropdown-text">Plotly + Ibis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../how-to/visualization/plotnine.html">
 <span class="dropdown-text">plotnine + Ibis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../how-to/visualization/seaborn.html">
 <span class="dropdown-text">seaborn + Ibis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../how-to/visualization/streamlit.html">
 <span class="dropdown-text">Streamlit + Ibis</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Extending</li>
        <li>
    <a class="dropdown-item" href="../how-to/extending/builtin.html">
 <span class="dropdown-text">Reference built-in functions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../how-to/extending/elementwise.html">
 <span class="dropdown-text">Add an elementwise operation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../how-to/extending/reduction.html">
 <span class="dropdown-text">Add a reduction operation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../how-to/extending/sql.html">
 <span class="dropdown-text">Using SQL strings with Ibis</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-reference" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Reference</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-reference">    
        <li class="dropdown-header">Expression API</li>
        <li>
    <a class="dropdown-item" href="../reference/expression-tables.html">
 <span class="dropdown-text">Table expressions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../reference/selectors.html">
 <span class="dropdown-text">Column selectors</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../reference/expression-generic.html">
 <span class="dropdown-text">Generic expressions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../reference/expression-numeric.html">
 <span class="dropdown-text">Numeric and Boolean expressions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../reference/expression-strings.html">
 <span class="dropdown-text">String expressions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../reference/expression-temporal.html">
 <span class="dropdown-text">Temporal expressions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../reference/expression-collections.html">
 <span class="dropdown-text">Collection expressions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../reference/expression-geospatial.html">
 <span class="dropdown-text">Geospatial expressions</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Type system</li>
        <li>
    <a class="dropdown-item" href="../reference/datatypes.html">
 <span class="dropdown-text">Data types</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../reference/schemas.html">
 <span class="dropdown-text">Schemas</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">UDFs</li>
        <li>
    <a class="dropdown-item" href="../reference/scalar-udfs.html">
 <span class="dropdown-text">Scalar UDFs</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Connection APIs</li>
        <li>
    <a class="dropdown-item" href="../reference/connection.html">
 <span class="dropdown-text">Top-level connection APIs</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Configuration</li>
        <li>
    <a class="dropdown-item" href="../reference/ContextAdjustment.html">
 <span class="dropdown-text">ContextAdjustment</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../reference/Interactive.html">
 <span class="dropdown-text">Interactive</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../reference/Options.html">
 <span class="dropdown-text">Options</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../reference/Repr.html">
 <span class="dropdown-text">Repr</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../reference/SQL.html">
 <span class="dropdown-text">SQL</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../posts.html"> 
<span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../release_notes.html"> 
<span class="menu-text">Release notes</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-contribute" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Contribute</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-contribute">    
        <li class="dropdown-header">Contribute</li>
        <li>
    <a class="dropdown-item" href="../contribute/01_environment.html">
 <span class="dropdown-text">Setting up a development environment</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../contribute/02_workflow.html">
 <span class="dropdown-text">Contribute to the Ibis codebase</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../contribute/03_style.html">
 <span class="dropdown-text">Style and formatting</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../contribute/04_maintainers_guide.html">
 <span class="dropdown-text">Maintaining the codebase</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../contribute/05_reference.html">
 <span class="dropdown-text">Test Class Reference</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/ibis-project/ibis">
            Source code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/ibis-project/ibis/issues/new?assignees=&amp;labels=bug&amp;projects=&amp;template=bug-report.yml&amp;title=bug">
            Report a bug
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/ibis-project/ibis/issues/new?assignees=&amp;labels=docs&amp;projects=&amp;template=docs-issue.yml&amp;title=docs">
            Report a documentation issue
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/ibis-project/ibis/issues/new?assignees=&amp;labels=feature&amp;projects=&amp;template=feature-request.yml&amp;title=feat">
            Submit a feature request
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/ibis-project/ibis/discussions/new?category=q-a">
            Ask the community for help
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#install" id="toc-install" class="nav-link active" data-scroll-target="#install">Install</a></li>
  <li><a href="#database-methods" id="toc-database-methods" class="nav-link" data-scroll-target="#database-methods">Database methods</a></li>
  <li><a href="#table-methods" id="toc-table-methods" class="nav-link" data-scroll-target="#table-methods">Table methods</a></li>
  <li><a href="#creating-views" id="toc-creating-views" class="nav-link" data-scroll-target="#creating-views">Creating views</a></li>
  <li><a href="#accessing-data" id="toc-accessing-data" class="nav-link" data-scroll-target="#accessing-data">Accessing data</a></li>
  <li><a href="#the-impala-client-object" id="toc-the-impala-client-object" class="nav-link" data-scroll-target="#the-impala-client-object">The Impala client object</a></li>
  <li><a href="#table-objects" id="toc-table-objects" class="nav-link" data-scroll-target="#table-objects">Table objects</a></li>
  <li><a href="#expression-execution" id="toc-expression-execution" class="nav-link" data-scroll-target="#expression-execution">Expression execution</a></li>
  <li><a href="#creating-tables" id="toc-creating-tables" class="nav-link" data-scroll-target="#creating-tables">Creating tables</a>
  <ul class="collapse">
  <li><a href="#creating-tables-from-a-table-expression" id="toc-creating-tables-from-a-table-expression" class="nav-link" data-scroll-target="#creating-tables-from-a-table-expression">Creating tables from a table expression</a></li>
  <li><a href="#creating-an-empty-table" id="toc-creating-an-empty-table" class="nav-link" data-scroll-target="#creating-an-empty-table">Creating an empty table</a></li>
  <li><a href="#creating-a-partitioned-table" id="toc-creating-a-partitioned-table" class="nav-link" data-scroll-target="#creating-a-partitioned-table">Creating a partitioned table</a></li>
  </ul></li>
  <li><a href="#partitioned-tables" id="toc-partitioned-tables" class="nav-link" data-scroll-target="#partitioned-tables">Partitioned tables</a></li>
  <li><a href="#inserting-data-into-tables" id="toc-inserting-data-into-tables" class="nav-link" data-scroll-target="#inserting-data-into-tables">Inserting data into tables</a></li>
  <li><a href="#managing-table-metadata" id="toc-managing-table-metadata" class="nav-link" data-scroll-target="#managing-table-metadata">Managing table metadata</a>
  <ul class="collapse">
  <li><a href="#detailed-table-metadata-describe-formatted" id="toc-detailed-table-metadata-describe-formatted" class="nav-link" data-scroll-target="#detailed-table-metadata-describe-formatted">Detailed table metadata: <code>DESCRIBE FORMATTED</code></a></li>
  <li><a href="#modifying-table-metadata" id="toc-modifying-table-metadata" class="nav-link" data-scroll-target="#modifying-table-metadata">Modifying table metadata</a></li>
  </ul></li>
  <li><a href="#table-statistics" id="toc-table-statistics" class="nav-link" data-scroll-target="#table-statistics">Table statistics</a>
  <ul class="collapse">
  <li><a href="#computing-table-and-partition-statistics" id="toc-computing-table-and-partition-statistics" class="nav-link" data-scroll-target="#computing-table-and-partition-statistics">Computing table and partition statistics</a></li>
  <li><a href="#seeing-table-and-column-statistics" id="toc-seeing-table-and-column-statistics" class="nav-link" data-scroll-target="#seeing-table-and-column-statistics">Seeing table and column statistics</a></li>
  <li><a href="#refresh-and-invalidate-metadata" id="toc-refresh-and-invalidate-metadata" class="nav-link" data-scroll-target="#refresh-and-invalidate-metadata"><code>REFRESH</code> and <code>INVALIDATE METADATA</code></a></li>
  </ul></li>
  <li><a href="#parquet-and-other-session-options" id="toc-parquet-and-other-session-options" class="nav-link" data-scroll-target="#parquet-and-other-session-options">Parquet and other session options</a></li>
  <li><a href="#ingesting-data-from-pandas" id="toc-ingesting-data-from-pandas" class="nav-link" data-scroll-target="#ingesting-data-from-pandas">Ingesting data from pandas</a></li>
  <li><a href="#queries-on-parquet-avro-and-delimited-files" id="toc-queries-on-parquet-avro-and-delimited-files" class="nav-link" data-scroll-target="#queries-on-parquet-avro-and-delimited-files">Queries on Parquet, Avro, and Delimited files</a></li>
  <li><a href="#other-helper-functions-for-interacting-with-the-database" id="toc-other-helper-functions-for-interacting-with-the-database" class="nav-link" data-scroll-target="#other-helper-functions-for-interacting-with-the-database">Other helper functions for interacting with the database</a></li>
  <li><a href="#user-defined-functions-udf" id="toc-user-defined-functions-udf" class="nav-link" data-scroll-target="#user-defined-functions-udf">User Defined functions (UDF)</a>
  <ul class="collapse">
  <li><a href="#using-scalar-functions-udfs" id="toc-using-scalar-functions-udfs" class="nav-link" data-scroll-target="#using-scalar-functions-udfs">Using scalar functions (UDFs)</a></li>
  </ul></li>
  <li><a href="#working-with-secure-clusters-kerberos" id="toc-working-with-secure-clusters-kerberos" class="nav-link" data-scroll-target="#working-with-secure-clusters-kerberos">Working with secure clusters (Kerberos)</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.dev/ibis-project/ibis/blob/master/docs/backends/impala.quarto.ipynb" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/ibis-project/ibis/issues/new/choose" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Impala</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>

<p><a href="https://impala.apache.org">https://impala.apache.org</a></p>
<p><img src="https://img.shields.io/badge/memtables-native-green?style=flat-square.png" class="img-fluid"> <img src="https://img.shields.io/badge/inputs-Impala%20tables-blue?style=flat-square.png" class="img-fluid"> <img src="https://img.shields.io/badge/outputs-Impala%20tables%20%7C%20CSV%20%7C%20pandas%20%7C%20Parquet%20%7C%20PyArrow-orange?style=flat-square.png" class="img-fluid"></p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The Impala backend is in maintenance-only mode
</div>
</div>
<div class="callout-body-container callout-body">
<p>Feature requests are unlikely to be accepted for the Impala backend, due to the maintenance burden of the components involved.</p>
</div>
</div>
<section id="install" class="level2">
<h2 class="anchored" data-anchor-id="install">Install</h2>
<p>Install Ibis and dependencies for the Impala backend:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true"><code>pip</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false"><code>conda</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false"><code>mamba</code></a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>Install with the <code>impala</code> extra:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install <span class="st">'ibis-framework[impala]'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And connect:</p>
<div class="sourceCode" id="annotated-cell-51"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-51-1"><a href="#annotated-cell-51-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ibis</span>
<span id="annotated-cell-51-2"><a href="#annotated-cell-51-2" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-51" data-target-annotation="1">1</button><span id="annotated-cell-51-3" class="code-annotation-target"><a href="#annotated-cell-51-3" aria-hidden="true" tabindex="-1"></a>con <span class="op">=</span> ibis.impala.<span class="ex">connect</span>()</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-51" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-51" data-code-lines="3" data-code-annotation="1">Adjust connection parameters as needed.</span>
</dd>
</dl>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>Install for Impala:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> install <span class="at">-c</span> conda-forge ibis-impala</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And connect:</p>
<div class="sourceCode" id="annotated-cell-53"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-53-1"><a href="#annotated-cell-53-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ibis</span>
<span id="annotated-cell-53-2"><a href="#annotated-cell-53-2" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-53" data-target-annotation="1">1</button><span id="annotated-cell-53-3" class="code-annotation-target"><a href="#annotated-cell-53-3" aria-hidden="true" tabindex="-1"></a>con <span class="op">=</span> ibis.impala.<span class="ex">connect</span>()</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-53" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-53" data-code-lines="3" data-code-annotation="1">Adjust connection parameters as needed.</span>
</dd>
</dl>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p>Install for Impala:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">mamba</span> install <span class="at">-c</span> conda-forge ibis-impala</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And connect:</p>
<div class="sourceCode" id="annotated-cell-55"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-55-1"><a href="#annotated-cell-55-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ibis</span>
<span id="annotated-cell-55-2"><a href="#annotated-cell-55-2" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-55" data-target-annotation="1">1</button><span id="annotated-cell-55-3" class="code-annotation-target"><a href="#annotated-cell-55-3" aria-hidden="true" tabindex="-1"></a>con <span class="op">=</span> ibis.impala.<span class="ex">connect</span>()</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-55" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-55" data-code-lines="3" data-code-annotation="1">Adjust connection parameters as needed.</span>
</dd>
</dl>
</div>
</div>
</div>
</section>
<section id="database-methods" class="level2">
<h2 class="anchored" data-anchor-id="database-methods">Database methods</h2>
<section id="ibis.backends.impala.Backend.create_database" class="level4">
<h4 class="anchored" data-anchor-id="ibis.backends.impala.Backend.create_database">create_database</h4>
<p><code>create_database(self, name, path=None, force=False)</code></p>
<p>Create a new Impala database.</p>
<section id="parameters" class="level5">
<h5 class="anchored" data-anchor-id="parameters">Parameters</h5>
<table class="table">
<colgroup>
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 71%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>name</code></td>
<td></td>
<td>Database name</td>
<td><em>required</em></td>
</tr>
<tr class="even">
<td><code>path</code></td>
<td></td>
<td>Path where to store the database data; otherwise uses the Impala default</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>force</code></td>
<td></td>
<td>Forcibly create the database</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="ibis.backends.impala.Backend.drop_database" class="level4">
<h4 class="anchored" data-anchor-id="ibis.backends.impala.Backend.drop_database">drop_database</h4>
<p><code>drop_database(self, name, force=False)</code></p>
<p>Drop an Impala database.</p>
<section id="parameters-1" class="level5">
<h5 class="anchored" data-anchor-id="parameters-1">Parameters</h5>
<table class="table">
<colgroup>
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 72%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>name</code></td>
<td></td>
<td>Database name</td>
<td><em>required</em></td>
</tr>
<tr class="even">
<td><code>force</code></td>
<td></td>
<td>If False and there are any tables in this database, raises an IntegrityError</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="ibis.backends.impala.Backend.list_databases" class="level4">
<h4 class="anchored" data-anchor-id="ibis.backends.impala.Backend.list_databases">list_databases</h4>
<p><code>list_databases(self, like=None)</code></p>
</section>
</section>
<section id="table-methods" class="level2">
<h2 class="anchored" data-anchor-id="table-methods">Table methods</h2>
<p>The <code>Backend</code> object itself has many helper utility methods. You’ll find the most methods on <code>ImpalaTable</code>.</p>
<div id="c08bcc25-9bec-4d71-b83b-c781482ff667" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>backend.resolved_bases</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>[Class('SQLBackend', 69, 664),
 Class('BaseBackend', 754, 1267),
 Class('_DatabaseSchemaHandler', 29, 66),
 Class('BaseBackend', 754, 1267),
 Class('_DatabaseSchemaHandler', 29, 66),
 Class('BaseBackend', 754, 1267),
 Class('_DatabaseSchemaHandler', 29, 66),
 Class('BaseBackend', 754, 1267),
 Class('_DatabaseSchemaHandler', 29, 66),
 Class('BaseBackend', 754, 1267),
 Class('_DatabaseSchemaHandler', 29, 66),
 Class('BaseBackend', 754, 1267),
 Class('_DatabaseSchemaHandler', 29, 66),
 Class('BaseBackend', 754, 1267),
 Class('_DatabaseSchemaHandler', 29, 66),
 Class('BaseBackend', 754, 1267),
 Class('_DatabaseSchemaHandler', 29, 66),
 Class('BaseBackend', 754, 1267),
 Class('_DatabaseSchemaHandler', 29, 66),
 Class('BaseBackend', 754, 1267),
 Class('_DatabaseSchemaHandler', 29, 66)]</code></pre>
</div>
</div>
<pre><code>KeyError: 'sql'</code></pre>
<p>The best way to interact with a single table is through the <code>ImpalaTable</code> object you get back from <code>Backend.table</code>.</p>
<section id="ibis.backends.impala.client.ImpalaTable.drop" class="level4">
<h4 class="anchored" data-anchor-id="ibis.backends.impala.client.ImpalaTable.drop">drop</h4>
<p><code>drop(self)</code></p>
<p>Drop the table from the database.</p>
</section>
<section id="ibis.backends.impala.client.ImpalaTable.insert" class="level4">
<h4 class="anchored" data-anchor-id="ibis.backends.impala.client.ImpalaTable.insert">insert</h4>
<p><code>insert(self, obj=None, overwrite=False, partition=None, values=None, validate=True)</code></p>
<p>Insert into an Impala table.</p>
<section id="parameters-2" class="level5">
<h5 class="anchored" data-anchor-id="parameters-2">Parameters</h5>
<table class="table">
<colgroup>
<col style="width: 4%">
<col style="width: 2%">
<col style="width: 89%">
<col style="width: 3%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>obj</code></td>
<td></td>
<td>Table expression or DataFrame</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>overwrite</code></td>
<td></td>
<td>If True, will replace existing contents of table</td>
<td><code>False</code></td>
</tr>
<tr class="odd">
<td><code>partition</code></td>
<td></td>
<td>For partitioned tables, indicate the partition that’s being inserted into, either with an ordered list of partition keys or a dict of partition field name to value. For example for the partition (year=2007, month=7), this can be either (2007, 7) or {‘year’: 2007, ‘month’: 7}.</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>values</code></td>
<td></td>
<td>Unsupported and unused</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>validate</code></td>
<td></td>
<td>If True, do more rigorous validation that schema of table being inserted is compatible with the existing table</td>
<td><code>True</code></td>
</tr>
</tbody>
</table>
</section>
<section id="examples" class="level5">
<h5 class="anchored" data-anchor-id="examples">Examples</h5>
<p>Append to an existing table</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> t.insert(table_expr)  <span class="co"># quartodoc: +SKIP</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Completely overwrite contents</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> t.insert(table_expr, overwrite<span class="op">=</span><span class="va">True</span>)  <span class="co"># quartodoc: +SKIP</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="ibis.backends.impala.client.ImpalaTable.describe_formatted" class="level4">
<h4 class="anchored" data-anchor-id="ibis.backends.impala.client.ImpalaTable.describe_formatted">describe_formatted</h4>
</section>
</section>
<section id="creating-views" class="level2">
<h2 class="anchored" data-anchor-id="creating-views">Creating views</h2>
<section id="ibis.backends.impala.Backend.drop_table_or_view" class="level4">
<h4 class="anchored" data-anchor-id="ibis.backends.impala.Backend.drop_table_or_view">drop_table_or_view</h4>
<p><code>drop_table_or_view(self, name, *, database=None, force=False)</code></p>
<p>Drop view or table.</p>
</section>
<section id="ibis.backends.impala.Backend.create_view" class="level4">
<h4 class="anchored" data-anchor-id="ibis.backends.impala.Backend.create_view">create_view</h4>
<p><code>create_view(self, name, obj, *, database=None, overwrite=False)</code></p>
<p>Create a new view from an expression.</p>
<section id="parameters-3" class="level5">
<h5 class="anchored" data-anchor-id="parameters-3">Parameters</h5>
<table class="table">
<colgroup>
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 72%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>name</code></td>
<td>str</td>
<td>Name of the new view.</td>
<td><em>required</em></td>
</tr>
<tr class="even">
<td><code>obj</code></td>
<td>ir.Table</td>
<td>An Ibis table expression that will be used to create the view.</td>
<td><em>required</em></td>
</tr>
<tr class="odd">
<td><code>database</code></td>
<td>str | None</td>
<td>Name of the database where the view will be created, if not provided the database’s default is used.</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>overwrite</code></td>
<td>bool</td>
<td>Whether to clobber an existing view with the same name</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
</section>
<section id="returns" class="level5">
<h5 class="anchored" data-anchor-id="returns">Returns</h5>
<table class="table">
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Table</td>
<td>The view that was created.</td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="accessing-data" class="level2">
<h2 class="anchored" data-anchor-id="accessing-data">Accessing data</h2>
<section id="ibis.backends.impala.Backend.delimited_file" class="level4">
<h4 class="anchored" data-anchor-id="ibis.backends.impala.Backend.delimited_file">delimited_file</h4>
<p><code>delimited_file(self, directory, schema, name=None, database=None, delimiter=',', na_rep=None, escapechar=None, lineterminator=None, external=True)</code></p>
<p>Interpret delimited text files as an Ibis table expression.</p>
<p>See the <code>parquet_file</code> method for more details on what happens under the hood.</p>
<section id="parameters-4" class="level5">
<h5 class="anchored" data-anchor-id="parameters-4">Parameters</h5>
<table class="table">
<colgroup>
<col style="width: 18%">
<col style="width: 8%">
<col style="width: 62%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>directory</code></td>
<td></td>
<td>Server directory containing delimited text files</td>
<td><em>required</em></td>
</tr>
<tr class="even">
<td><code>schema</code></td>
<td></td>
<td>Ibis schema</td>
<td><em>required</em></td>
</tr>
<tr class="odd">
<td><code>name</code></td>
<td></td>
<td>Name for the table; otherwise random names are generated</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>database</code></td>
<td></td>
<td>Database to create the table in</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>delimiter</code></td>
<td></td>
<td>Character used to delimit columns</td>
<td><code>','</code></td>
</tr>
<tr class="even">
<td><code>na_rep</code></td>
<td></td>
<td>Character used to represent NULL values</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>escapechar</code></td>
<td></td>
<td>Character used to escape special characters</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>lineterminator</code></td>
<td></td>
<td>Character used to delimit lines</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>external</code></td>
<td></td>
<td>Create table as EXTERNAL (data will not be deleted on drop).</td>
<td><code>True</code></td>
</tr>
</tbody>
</table>
</section>
<section id="returns-1" class="level5">
<h5 class="anchored" data-anchor-id="returns-1">Returns</h5>
<table class="table">
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ImpalaTable</td>
<td>Impala table expression</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="ibis.backends.impala.Backend.parquet_file" class="level4">
<h4 class="anchored" data-anchor-id="ibis.backends.impala.Backend.parquet_file">parquet_file</h4>
<p><code>parquet_file(self, directory, schema=None, name=None, database=None, external=True, like_file=None, like_table=None)</code></p>
<p>Create an Ibis table from the passed directory of Parquet files.</p>
<p>The table can be optionally named, otherwise a unique name will be generated.</p>
<section id="parameters-5" class="level5">
<h5 class="anchored" data-anchor-id="parameters-5">Parameters</h5>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 10%">
<col style="width: 76%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>directory</code></td>
<td>str | Path</td>
<td>Path</td>
<td><em>required</em></td>
</tr>
<tr class="even">
<td><code>schema</code></td>
<td>sch.Schema | None</td>
<td>If no schema provided, and neither of the like_* argument is passed, one will be inferred from one of the parquet files in the directory.</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>like_file</code></td>
<td>str | Path | None</td>
<td>Absolute path to Parquet file on the server to use for schema definitions. An alternative to having to supply an explicit schema</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>like_table</code></td>
<td>str | None</td>
<td>Fully scoped and escaped string to an Impala table whose schema we will use for the newly created table.</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>name</code></td>
<td>str | None</td>
<td>Random unique name generated otherwise</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>database</code></td>
<td>str | None</td>
<td>Database to create the (possibly temporary) table in</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>external</code></td>
<td>bool</td>
<td>If a table is external, the referenced data will not be deleted when the table is dropped in Impala. Otherwise Impala takes ownership of the Parquet file.</td>
<td><code>True</code></td>
</tr>
</tbody>
</table>
</section>
<section id="returns-2" class="level5">
<h5 class="anchored" data-anchor-id="returns-2">Returns</h5>
<table class="table">
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ImpalaTable</td>
<td>Impala table expression</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="ibis.backends.impala.Backend.avro_file" class="level4">
<h4 class="anchored" data-anchor-id="ibis.backends.impala.Backend.avro_file">avro_file</h4>
<p><code>avro_file(self, directory, avro_schema, name=None, database=None, external=True)</code></p>
<p>Create a table to read a collection of Avro data.</p>
<section id="parameters-6" class="level5">
<h5 class="anchored" data-anchor-id="parameters-6">Parameters</h5>
<table class="table">
<colgroup>
<col style="width: 18%">
<col style="width: 9%">
<col style="width: 57%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>directory</code></td>
<td></td>
<td>Server path to directory containing avro files</td>
<td><em>required</em></td>
</tr>
<tr class="even">
<td><code>avro_schema</code></td>
<td></td>
<td>The Avro schema for the data as a Python dict</td>
<td><em>required</em></td>
</tr>
<tr class="odd">
<td><code>name</code></td>
<td></td>
<td>Table name</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>database</code></td>
<td></td>
<td>Database name</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>external</code></td>
<td></td>
<td>Whether the table is external</td>
<td><code>True</code></td>
</tr>
</tbody>
</table>
</section>
<section id="returns-3" class="level5">
<h5 class="anchored" data-anchor-id="returns-3">Returns</h5>
<table class="table">
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ImpalaTable</td>
<td>Impala table expression</td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="the-impala-client-object" class="level2">
<h2 class="anchored" data-anchor-id="the-impala-client-object">The Impala client object</h2>
<p>To use Ibis with Impala, you first must connect to a cluster using the <code>ibis.impala.connect</code> function:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ibis</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> ibis.impala.<span class="ex">connect</span>(host<span class="op">=</span>impala_host, port<span class="op">=</span>impala_port)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>By default binary transport mode is used, however it is also possible to use HTTP. Depending on your configuration, additional connection arguments may need to be provided. For the full list of possible connection arguments please refer to the <a href="https://github.com/cloudera/impyla"><code>impyla</code></a> documentation.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ibis</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> ibis.impala.<span class="ex">connect</span>(</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    host<span class="op">=</span>impala_host,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    port<span class="op">=</span>impala_port,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    username<span class="op">=</span>username,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    password<span class="op">=</span>password,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    use_ssl<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    auth_mechanism<span class="op">=</span><span class="st">'LDAP'</span>,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    use_http_transport<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    http_path<span class="op">=</span><span class="st">'cliservice'</span>,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>All examples here use the following block of code to connect to impala using docker:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ibis</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> ibis.impala.<span class="ex">connect</span>(host<span class="op">=</span>host)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can accomplish many tasks directly through the client object, but we additionally provide APIs to streamline tasks involving a single Impala table or database.</p>
</section>
<section id="table-objects" class="level2">
<h2 class="anchored" data-anchor-id="table-objects">Table objects</h2>
<section id="ibis.backends.sql.SQLBackend.table" class="level4">
<h4 class="anchored" data-anchor-id="ibis.backends.sql.SQLBackend.table">table</h4>
<p><code>table(self, name, schema=None, database=None)</code></p>
<p>Construct a table expression.</p>
<section id="parameters-7" class="level5">
<h5 class="anchored" data-anchor-id="parameters-7">Parameters</h5>
<table class="table">
<colgroup>
<col style="width: 14%">
<col style="width: 40%">
<col style="width: 30%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>name</code></td>
<td>str</td>
<td>Table name</td>
<td><em>required</em></td>
</tr>
<tr class="even">
<td><code>schema</code></td>
<td>str | None</td>
<td>[deprecated] Schema name</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>database</code></td>
<td>tuple[str, str] | str | None</td>
<td>Database name</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</section>
<section id="returns-4" class="level5">
<h5 class="anchored" data-anchor-id="returns-4">Returns</h5>
<table class="table">
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Table</td>
<td>Table expression</td>
</tr>
</tbody>
</table>
<p>The client’s <code>table</code> method allows you to create an Ibis table expression referencing a physical Impala table:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> client.table(<span class="st">'functional_alltypes'</span>, database<span class="op">=</span><span class="st">'ibis_testing'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>ImpalaTable</code> is a Python subclass of the more general Ibis <code>Table</code> that has additional Impala-specific methods. So you can use it interchangeably with any code expecting a <code>Table</code>.</p>
<p>While the client has a <code>drop_table</code> method you can use to drop tables, the table itself has a method <code>drop</code> that you can use:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>table.drop()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</section>
<section id="expression-execution" class="level2">
<h2 class="anchored" data-anchor-id="expression-execution">Expression execution</h2>
<p>Ibis expressions have execution methods like <code>to_pandas</code> that compile and run the expressions on Impala or whichever backend is being referenced.</p>
<p>For example:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> fa <span class="op">=</span> db.functional_alltypes</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> expr <span class="op">=</span> fa.double_col.<span class="bu">sum</span>()</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> expr.to_pandas()</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fl">331785.00000000006</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>For longer-running queries, Ibis will attempt to cancel the query in progress if an interrupt is received.</p>
</section>
<section id="creating-tables" class="level2">
<h2 class="anchored" data-anchor-id="creating-tables">Creating tables</h2>
<p>There are several ways to create new Impala tables:</p>
<ul>
<li>From an Ibis table expression</li>
<li>Empty, from a declared schema</li>
<li>Empty and partitioned</li>
</ul>
<p>In all cases, you should use the <code>create_table</code> method either on the top-level client connection or a database object.</p>
<section id="ibis.backends.impala.Backend.create_table" class="level4">
<h4 class="anchored" data-anchor-id="ibis.backends.impala.Backend.create_table">create_table</h4>
<p><code>create_table(self, name, obj=None, *, schema=None, database=None, temp=None, overwrite=False, external=False, format='parquet', location=None, partition=None, like_parquet=None)</code></p>
<p>Create a new table using an Ibis table expression or in-memory data.</p>
<section id="parameters-8" class="level5">
<h5 class="anchored" data-anchor-id="parameters-8">Parameters</h5>
<table class="table">
<colgroup>
<col style="width: 7%">
<col style="width: 38%">
<col style="width: 47%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>name</code></td>
<td>str</td>
<td>Table name</td>
<td><em>required</em></td>
</tr>
<tr class="even">
<td><code>obj</code></td>
<td>ir.Table | pd.DataFrame | pa.Table | pl.DataFrame | pl.LazyFrame | None</td>
<td>If passed, creates table from select statement results</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>schema</code></td>
<td></td>
<td>Mutually exclusive with obj, creates an empty table with a particular schema</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>database</code></td>
<td></td>
<td>Database name</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>temp</code></td>
<td>bool | None</td>
<td>Whether a table is temporary</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>overwrite</code></td>
<td>bool</td>
<td>Do not create table if table with indicated name already exists</td>
<td><code>False</code></td>
</tr>
<tr class="odd">
<td><code>external</code></td>
<td>bool</td>
<td>Create an external table; Impala will not delete the underlying data when the table is dropped</td>
<td><code>False</code></td>
</tr>
<tr class="even">
<td><code>format</code></td>
<td></td>
<td>File format</td>
<td><code>'parquet'</code></td>
</tr>
<tr class="odd">
<td><code>location</code></td>
<td></td>
<td>Specify the directory location where Impala reads and writes files for the table</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>partition</code></td>
<td></td>
<td>Must pass a schema to use this. Cannot partition from an expression.</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>like_parquet</code></td>
<td></td>
<td>Can specify instead of a schema</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="creating-tables-from-a-table-expression" class="level3">
<h3 class="anchored" data-anchor-id="creating-tables-from-a-table-expression">Creating tables from a table expression</h3>
<p>If you pass an Ibis expression to <code>create_table</code>, Ibis issues a <code>CREATE TABLE ... AS SELECT</code> (CTAS) statement:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> table <span class="op">=</span> db.table(<span class="st">'functional_alltypes'</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> expr <span class="op">=</span> table.group_by(<span class="st">'string_col'</span>).size()</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> db.create_table(<span class="st">'string_freqs'</span>, expr, <span class="bu">format</span><span class="op">=</span><span class="st">'parquet'</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> freqs <span class="op">=</span> db.table(<span class="st">'string_freqs'</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> freqs.to_pandas()</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  string_col  count</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>          <span class="dv">9</span>    <span class="dv">730</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>          <span class="dv">3</span>    <span class="dv">730</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>          <span class="dv">6</span>    <span class="dv">730</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>          <span class="dv">4</span>    <span class="dv">730</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>          <span class="dv">1</span>    <span class="dv">730</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>          <span class="dv">8</span>    <span class="dv">730</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>          <span class="dv">2</span>    <span class="dv">730</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>          <span class="dv">7</span>    <span class="dv">730</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>          <span class="dv">5</span>    <span class="dv">730</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>          <span class="dv">0</span>    <span class="dv">730</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> files <span class="op">=</span> freqs.files()</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> files</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>                                                Path  Size Partition</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  hdfs:<span class="op">//</span>impala:<span class="dv">8020</span><span class="op">/</span>user<span class="op">/</span>hive<span class="op">/</span>warehouse<span class="op">/</span>ibis_te...  <span class="dv">584</span><span class="er">B</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> freqs.drop()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can also choose to create an empty table and use <code>insert</code> (see below).</p>
</section>
<section id="creating-an-empty-table" class="level3">
<h3 class="anchored" data-anchor-id="creating-an-empty-table">Creating an empty table</h3>
<p>To create an empty table, you must declare an Ibis schema that will be translated to the appropriate Impala schema and data types.</p>
<p>As Ibis types are simplified compared with Impala types, this may expand in the future to include a more fine-grained schema declaration.</p>
<p>You can use the <code>create_table</code> method either on a database or client object.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>schema <span class="op">=</span> ibis.schema(<span class="bu">dict</span>(foo<span class="op">=</span><span class="st">'string'</span>, year<span class="op">=</span><span class="st">'int32'</span>, month<span class="op">=</span><span class="st">'int16'</span>))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>name <span class="op">=</span> <span class="st">'new_table'</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>db.create_table(name, schema<span class="op">=</span>schema)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>By default, this stores the data files in the database default location. You can force a particular path with the <code>location</code> option.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> getpass <span class="im">import</span> getuser</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>schema <span class="op">=</span> ibis.schema(<span class="bu">dict</span>(foo<span class="op">=</span><span class="st">'string'</span>, year<span class="op">=</span><span class="st">'int32'</span>, month<span class="op">=</span><span class="st">'int16'</span>))</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>name <span class="op">=</span> <span class="st">'new_table'</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>location <span class="op">=</span> <span class="st">'/home/</span><span class="sc">{}</span><span class="st">/new-table-data'</span>.<span class="bu">format</span>(getuser())</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>db.create_table(name, schema<span class="op">=</span>schema, location<span class="op">=</span>location)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If the schema matches a known table schema, you can always use the <code>schema</code> method to get a schema object:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> t <span class="op">=</span> db.table(<span class="st">'functional_alltypes'</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> t.schema()</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>ibis.Schema {</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">id</span>               int32</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  bool_col         boolean</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  tinyint_col      int8</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  smallint_col     int16</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  int_col          int32</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  bigint_col       int64</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  float_col        float32</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  double_col       float64</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  date_string_col  string</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  string_col       string</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  timestamp_col    timestamp</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  year             int32</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  month            int32</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="creating-a-partitioned-table" class="level3">
<h3 class="anchored" data-anchor-id="creating-a-partitioned-table">Creating a partitioned table</h3>
<p>To create an empty partitioned table, include a list of columns to be used as the partition keys.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>schema <span class="op">=</span> ibis.schema(<span class="bu">dict</span>(foo<span class="op">=</span><span class="st">'string'</span>, year<span class="op">=</span><span class="st">'int32'</span>, month<span class="op">=</span><span class="st">'int16'</span>))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>name <span class="op">=</span> <span class="st">'new_table'</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>db.create_table(name, schema<span class="op">=</span>schema, partition<span class="op">=</span>[<span class="st">'year'</span>, <span class="st">'month'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="partitioned-tables" class="level2">
<h2 class="anchored" data-anchor-id="partitioned-tables">Partitioned tables</h2>
<p>Ibis enables you to manage partitioned tables in various ways. Since each partition behaves as its own "subtable" sharing a common schema, each partition can have its own file format, directory path, serialization properties, and so forth.</p>
<p>There are a handful of table methods for adding and removing partitions and getting information about the partition schema and any existing partition data:</p>
<section id="ibis.backends.impala.client.ImpalaTable.add_partition" class="level4">
<h4 class="anchored" data-anchor-id="ibis.backends.impala.client.ImpalaTable.add_partition">add_partition</h4>
<p><code>add_partition(self, spec, location=None)</code></p>
<p>Add a new table partition.</p>
<p>Partition parameters can be set in a single DDL statement or you can use <code>alter_partition</code> to set them after the fact.</p>
</section>
<section id="ibis.backends.impala.client.ImpalaTable.drop_partition" class="level4">
<h4 class="anchored" data-anchor-id="ibis.backends.impala.client.ImpalaTable.drop_partition">drop_partition</h4>
<p><code>drop_partition(self, spec)</code></p>
<p>Drop an existing table partition.</p>
</section>
<section id="ibis.backends.impala.client.ImpalaTable.is_partitioned" class="level4">
<h4 class="anchored" data-anchor-id="ibis.backends.impala.client.ImpalaTable.is_partitioned">is_partitioned</h4>
<p>True if the table is partitioned.</p>
</section>
<section id="ibis.backends.impala.client.ImpalaTable.partition_schema" class="level4">
<h4 class="anchored" data-anchor-id="ibis.backends.impala.client.ImpalaTable.partition_schema">partition_schema</h4>
<p><code>partition_schema(self)</code></p>
<p>Return the schema for the partition columns.</p>
</section>
<section id="ibis.backends.impala.client.ImpalaTable.partitions" class="level4">
<h4 class="anchored" data-anchor-id="ibis.backends.impala.client.ImpalaTable.partitions">partitions</h4>
<p><code>partitions(self)</code></p>
<p>Return information about the table’s partitions.</p>
<p>Raises an exception if the table is not partitioned.</p>
<p>To address a specific partition in any method that is partition specific, you can either use a dict with the partition key names and values, or pass a list of the partition values:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>schema <span class="op">=</span> ibis.schema(<span class="bu">dict</span>(foo<span class="op">=</span><span class="st">'string'</span>, year<span class="op">=</span><span class="st">'int32'</span>, month<span class="op">=</span><span class="st">'int16'</span>))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>name <span class="op">=</span> <span class="st">'new_table'</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>db.create_table(name, schema<span class="op">=</span>schema, partition<span class="op">=</span>[<span class="st">'year'</span>, <span class="st">'month'</span>])</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> db.table(name)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>table.add_partition({<span class="st">'year'</span>: <span class="dv">2007</span>, <span class="st">'month'</span>, <span class="dv">4</span>})</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>table.add_partition([<span class="dv">2007</span>, <span class="dv">5</span>])</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>table.add_partition([<span class="dv">2007</span>, <span class="dv">6</span>])</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>table.drop_partition([<span class="dv">2007</span>, <span class="dv">6</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We’ll cover partition metadata management and data loading below.</p>
</section>
</section>
<section id="inserting-data-into-tables" class="level2">
<h2 class="anchored" data-anchor-id="inserting-data-into-tables">Inserting data into tables</h2>
<p>If the schemas are compatible, you can insert into a table directly from an Ibis table expression:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> t <span class="op">=</span> db.functional_alltypes</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> db.create_table(<span class="st">'insert_test'</span>, schema<span class="op">=</span>t.schema())</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> target <span class="op">=</span> db.table(<span class="st">'insert_test'</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> target.insert(t[:<span class="dv">3</span>])</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> target.insert(t[:<span class="dv">3</span>])</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> target.insert(t[:<span class="dv">3</span>])</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> target.to_pandas()</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>     <span class="bu">id</span>  bool_col  tinyint_col  ...           timestamp_col  year  month</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="dv">5770</span>      <span class="va">True</span>            <span class="dv">0</span>  ... <span class="dv">2010</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span> <span class="dv">00</span>:<span class="dv">00</span>:<span class="fl">00.000</span>  <span class="dv">2010</span>      <span class="dv">8</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="dv">5771</span>     <span class="va">False</span>            <span class="dv">1</span>  ... <span class="dv">2010</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span> <span class="dv">00</span>:<span class="dv">0</span><span class="er">1</span>:<span class="fl">00.000</span>  <span class="dv">2010</span>      <span class="dv">8</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="dv">5772</span>      <span class="va">True</span>            <span class="dv">2</span>  ... <span class="dv">2010</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span> <span class="dv">00</span>:<span class="dv">0</span><span class="er">2</span>:<span class="fl">00.100</span>  <span class="dv">2010</span>      <span class="dv">8</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="dv">5770</span>      <span class="va">True</span>            <span class="dv">0</span>  ... <span class="dv">2010</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span> <span class="dv">00</span>:<span class="dv">00</span>:<span class="fl">00.000</span>  <span class="dv">2010</span>      <span class="dv">8</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="dv">5771</span>     <span class="va">False</span>            <span class="dv">1</span>  ... <span class="dv">2010</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span> <span class="dv">00</span>:<span class="dv">0</span><span class="er">1</span>:<span class="fl">00.000</span>  <span class="dv">2010</span>      <span class="dv">8</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  <span class="dv">5772</span>      <span class="va">True</span>            <span class="dv">2</span>  ... <span class="dv">2010</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span> <span class="dv">00</span>:<span class="dv">0</span><span class="er">2</span>:<span class="fl">00.100</span>  <span class="dv">2010</span>      <span class="dv">8</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>  <span class="dv">5770</span>      <span class="va">True</span>            <span class="dv">0</span>  ... <span class="dv">2010</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span> <span class="dv">00</span>:<span class="dv">00</span>:<span class="fl">00.000</span>  <span class="dv">2010</span>      <span class="dv">8</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>  <span class="dv">5771</span>     <span class="va">False</span>            <span class="dv">1</span>  ... <span class="dv">2010</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span> <span class="dv">00</span>:<span class="dv">0</span><span class="er">1</span>:<span class="fl">00.000</span>  <span class="dv">2010</span>      <span class="dv">8</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>  <span class="dv">5772</span>      <span class="va">True</span>            <span class="dv">2</span>  ... <span class="dv">2010</span><span class="op">-</span><span class="dv">0</span><span class="er">8</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span> <span class="dv">00</span>:<span class="dv">0</span><span class="er">2</span>:<span class="fl">00.100</span>  <span class="dv">2010</span>      <span class="dv">8</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>[<span class="dv">9</span> rows x <span class="dv">13</span> columns]</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> target.drop()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If the table is partitioned, you must indicate the partition you are inserting into:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>part <span class="op">=</span> {<span class="st">'year'</span>: <span class="dv">2007</span>, <span class="st">'month'</span>: <span class="dv">4</span>}</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>table.insert(expr, partition<span class="op">=</span>part)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="managing-table-metadata" class="level2">
<h2 class="anchored" data-anchor-id="managing-table-metadata">Managing table metadata</h2>
<p>Ibis has functions that wrap many of the DDL commands for Impala table metadata.</p>
<section id="detailed-table-metadata-describe-formatted" class="level3">
<h3 class="anchored" data-anchor-id="detailed-table-metadata-describe-formatted">Detailed table metadata: <code>DESCRIBE FORMATTED</code></h3>
<p>To get a handy wrangled version of <code>DESCRIBE FORMATTED</code> use the <code>metadata</code> method.</p>
<section id="ibis.backends.impala.client.ImpalaTable.metadata" class="level4">
<h4 class="anchored" data-anchor-id="ibis.backends.impala.client.ImpalaTable.metadata">metadata</h4>
<p><code>metadata(self)</code></p>
<p>Return results of <code>DESCRIBE FORMATTED</code> statement.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> t <span class="op">=</span> client.table(<span class="st">'ibis_testing.functional_alltypes'</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> meta <span class="op">=</span> t.metadata()</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> meta</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span><span class="kw">class</span> <span class="st">'ibis.backends.impala.metadata.TableMetadata'</span><span class="op">&gt;</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>{<span class="st">'info'</span>: {<span class="st">'CreateTime'</span>: datetime.datetime(<span class="dv">2021</span>, <span class="dv">1</span>, <span class="dv">14</span>, <span class="dv">21</span>, <span class="dv">23</span>, <span class="dv">8</span>),</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>          <span class="st">'Database'</span>: <span class="st">'ibis_testing'</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">'LastAccessTime'</span>: <span class="st">'UNKNOWN'</span>,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>          <span class="st">'Location'</span>: <span class="st">'hdfs://impala:8020/__ibis/ibis-testing-data/parquet/functional_alltypes'</span>,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>          <span class="st">'Owner'</span>: <span class="st">'root'</span>,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>          <span class="st">'Protect Mode'</span>: <span class="st">'None'</span>,</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>          <span class="st">'Retention'</span>: <span class="dv">0</span>,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>          <span class="st">'Table Parameters'</span>: {<span class="st">'COLUMN_STATS_ACCURATE'</span>: <span class="va">False</span>,</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>                               <span class="st">'EXTERNAL'</span>: <span class="va">True</span>,</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>                               <span class="st">'STATS_GENERATED_VIA_STATS_TASK'</span>: <span class="va">True</span>,</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>                               <span class="st">'numFiles'</span>: <span class="dv">3</span>,</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>                               <span class="st">'numRows'</span>: <span class="dv">7300</span>,</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>                               <span class="st">'rawDataSize'</span>: <span class="st">'-1'</span>,</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>                               <span class="st">'totalSize'</span>: <span class="dv">106278</span>,</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>                               <span class="st">'transient_lastDdlTime'</span>: datetime.datetime(<span class="dv">2021</span>, <span class="dv">1</span>, <span class="dv">14</span>, <span class="dv">21</span>, <span class="dv">23</span>, <span class="dv">17</span>)},</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>          <span class="st">'Table Type'</span>: <span class="st">'EXTERNAL_TABLE'</span>},</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a> <span class="st">'schema'</span>: [(<span class="st">'id'</span>, <span class="st">'int'</span>),</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'bool_col'</span>, <span class="st">'boolean'</span>),</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'tinyint_col'</span>, <span class="st">'tinyint'</span>),</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'smallint_col'</span>, <span class="st">'smallint'</span>),</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'int_col'</span>, <span class="st">'int'</span>),</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'bigint_col'</span>, <span class="st">'bigint'</span>),</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'float_col'</span>, <span class="st">'float'</span>),</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'double_col'</span>, <span class="st">'double'</span>),</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'date_string_col'</span>, <span class="st">'string'</span>),</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'string_col'</span>, <span class="st">'string'</span>),</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'timestamp_col'</span>, <span class="st">'timestamp'</span>),</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'year'</span>, <span class="st">'int'</span>),</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'month'</span>, <span class="st">'int'</span>)],</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a> <span class="st">'storage info'</span>: {<span class="st">'Bucket Columns'</span>: <span class="st">'[]'</span>,</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Compressed'</span>: <span class="va">False</span>,</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'InputFormat'</span>: <span class="st">'org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat'</span>,</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Num Buckets'</span>: <span class="dv">0</span>,</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'OutputFormat'</span>: <span class="st">'org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat'</span>,</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'SerDe Library'</span>: <span class="st">'org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe'</span>,</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Sort Columns'</span>: <span class="st">'[]'</span>}}</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> meta.location</span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a><span class="co">'hdfs://impala:8020/__ibis/ibis-testing-data/parquet/functional_alltypes'</span></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> meta.create_time</span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>datetime.datetime(<span class="dv">2021</span>, <span class="dv">1</span>, <span class="dv">14</span>, <span class="dv">21</span>, <span class="dv">23</span>, <span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>files</code> function is also available to see all of the physical HDFS data files backing a table:</p>
</section>
<section id="ibis.backends.impala.client.ImpalaTable.files" class="level4">
<h4 class="anchored" data-anchor-id="ibis.backends.impala.client.ImpalaTable.files">files</h4>
<p><code>files(self)</code></p>
<p>Return results of SHOW FILES statement.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> ss <span class="op">=</span> c.table(<span class="st">'tpcds_parquet.store_sales'</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> ss.files()[:<span class="dv">5</span>]</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>                                                path      size  <span class="op">\</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  hdfs:<span class="op">//</span>localhost:<span class="dv">20500</span><span class="op">/</span>test<span class="op">-</span>warehouse<span class="op">/</span>tpcds.st...  <span class="fl">160.61</span><span class="er">KB</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  hdfs:<span class="op">//</span>localhost:<span class="dv">20500</span><span class="op">/</span>test<span class="op">-</span>warehouse<span class="op">/</span>tpcds.st...  <span class="fl">123.88</span><span class="er">KB</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  hdfs:<span class="op">//</span>localhost:<span class="dv">20500</span><span class="op">/</span>test<span class="op">-</span>warehouse<span class="op">/</span>tpcds.st...  <span class="fl">139.28</span><span class="er">KB</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  hdfs:<span class="op">//</span>localhost:<span class="dv">20500</span><span class="op">/</span>test<span class="op">-</span>warehouse<span class="op">/</span>tpcds.st...  <span class="fl">139.60</span><span class="er">KB</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  hdfs:<span class="op">//</span>localhost:<span class="dv">20500</span><span class="op">/</span>test<span class="op">-</span>warehouse<span class="op">/</span>tpcds.st...   <span class="fl">62.84</span><span class="er">KB</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>                 partition</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  ss_sold_date_sk<span class="op">=</span><span class="dv">2451803</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  ss_sold_date_sk<span class="op">=</span><span class="dv">2451819</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  ss_sold_date_sk<span class="op">=</span><span class="dv">2451772</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  ss_sold_date_sk<span class="op">=</span><span class="dv">2451789</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  ss_sold_date_sk<span class="op">=</span><span class="dv">2451741</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="modifying-table-metadata" class="level3">
<h3 class="anchored" data-anchor-id="modifying-table-metadata">Modifying table metadata</h3>
<p>For unpartitioned tables, you can use the <code>alter</code> method to change its location, file format, and other properties. For partitioned tables, to change partition-specific metadata use <code>alter_partition</code>.</p>
<section id="ibis.backends.impala.client.ImpalaTable.alter" class="level4">
<h4 class="anchored" data-anchor-id="ibis.backends.impala.client.ImpalaTable.alter">alter</h4>
<p><code>alter(self, location=None, format=None, tbl_properties=None, serde_properties=None)</code></p>
<p>Change settings and parameters of the table.</p>
<section id="parameters-9" class="level5">
<h5 class="anchored" data-anchor-id="parameters-9">Parameters</h5>
<table class="table">
<colgroup>
<col style="width: 18%">
<col style="width: 7%">
<col style="width: 63%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>location</code></td>
<td></td>
<td>For partitioned tables, you may want the alter_partition function</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>format</code></td>
<td></td>
<td>Table format</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>tbl_properties</code></td>
<td></td>
<td>Table properties</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>serde_properties</code></td>
<td></td>
<td>Serialization/deserialization properties</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="ibis.backends.impala.client.ImpalaTable.alter_partition" class="level4">
<h4 class="anchored" data-anchor-id="ibis.backends.impala.client.ImpalaTable.alter_partition">alter_partition</h4>
<p><code>alter_partition(self, spec, location=None, format=None, tbl_properties=None, serde_properties=None)</code></p>
<p>Change settings and parameters of an existing partition.</p>
<section id="parameters-10" class="level5">
<h5 class="anchored" data-anchor-id="parameters-10">Parameters</h5>
<table class="table">
<colgroup>
<col style="width: 21%">
<col style="width: 8%">
<col style="width: 56%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>spec</code></td>
<td></td>
<td>The partition keys for the partition being modified</td>
<td><em>required</em></td>
</tr>
<tr class="even">
<td><code>location</code></td>
<td></td>
<td>Location of the partition</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>format</code></td>
<td></td>
<td>Table format</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>tbl_properties</code></td>
<td></td>
<td>Table properties</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>serde_properties</code></td>
<td></td>
<td>Serialization/deserialization properties</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p>For example, if you wanted to "point" an existing table at a directory of CSV files, you could run the following command:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> getpass <span class="im">import</span> getuser</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>csv_props <span class="op">=</span> {</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'serialization.format'</span>: <span class="st">','</span>,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'field.delim'</span>: <span class="st">','</span>,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>data_dir <span class="op">=</span> <span class="st">'/home/</span><span class="sc">{}</span><span class="st">/my-csv-files'</span>.<span class="bu">format</span>(getuser())</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>table.alter(location<span class="op">=</span>data_dir, <span class="bu">format</span><span class="op">=</span><span class="st">'text'</span>, serde_properties<span class="op">=</span>csv_props)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If the table is partitioned, you can modify only the properties of a particular partition:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>table.alter_partition(</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'year'</span>: <span class="dv">2007</span>, <span class="st">'month'</span>: <span class="dv">5</span>},</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    location<span class="op">=</span>data_dir,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">format</span><span class="op">=</span><span class="st">'text'</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    serde_properties<span class="op">=</span>csv_props</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</section>
</section>
<section id="table-statistics" class="level2">
<h2 class="anchored" data-anchor-id="table-statistics">Table statistics</h2>
<section id="computing-table-and-partition-statistics" class="level3">
<h3 class="anchored" data-anchor-id="computing-table-and-partition-statistics">Computing table and partition statistics</h3>
<section id="ibis.backends.impala.client.ImpalaTable.compute_stats" class="level4">
<h4 class="anchored" data-anchor-id="ibis.backends.impala.client.ImpalaTable.compute_stats">compute_stats</h4>
<p><code>compute_stats(self, incremental=False)</code></p>
<p>Invoke Impala COMPUTE STATS command on the table.</p>
<p>Impala-backed physical tables have a method <code>compute_stats</code> that computes table, column, and partition-level statistics to assist with query planning and optimization. It is standard practice to invoke this after creating a table or loading new data:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>table.compute_stats()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you are using a recent version of Impala, you can also access the <code>COMPUTE INCREMENTAL STATS</code> DDL command:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>table.compute_stats(incremental<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="seeing-table-and-column-statistics" class="level3">
<h3 class="anchored" data-anchor-id="seeing-table-and-column-statistics">Seeing table and column statistics</h3>
<section id="ibis.backends.impala.client.ImpalaTable.column_stats" class="level4">
<h4 class="anchored" data-anchor-id="ibis.backends.impala.client.ImpalaTable.column_stats">column_stats</h4>
<p><code>column_stats(self)</code></p>
<p>Return results of <code>SHOW COLUMN STATS</code>.</p>
<section id="returns-5" class="level5">
<h5 class="anchored" data-anchor-id="returns-5">Returns</h5>
<table class="table">
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>DataFrame</td>
<td>Column statistics</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="ibis.backends.impala.client.ImpalaTable.stats" class="level4">
<h4 class="anchored" data-anchor-id="ibis.backends.impala.client.ImpalaTable.stats">stats</h4>
<p><code>stats(self)</code></p>
<p>Return results of <code>SHOW TABLE STATS</code>.</p>
<p>If not partitioned, contains only one row.</p>
<section id="returns-6" class="level5">
<h5 class="anchored" data-anchor-id="returns-6">Returns</h5>
<table class="table">
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>DataFrame</td>
<td>Table statistics</td>
</tr>
</tbody>
</table>
<p>The <code>compute_stats</code> and <code>stats</code> functions return the results of <code>SHOW COLUMN STATS</code> and <code>SHOW TABLE STATS</code>, respectively, and their output will depend, of course, on the last <code>COMPUTE STATS</code> call.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> ss <span class="op">=</span> c.table(<span class="st">'tpcds_parquet.store_sales'</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> ss.compute_stats(incremental<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> stats <span class="op">=</span> ss.stats()</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> stats[:<span class="dv">5</span>]</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  ss_sold_date_sk  <span class="co">#Rows  #Files     Size Bytes Cached Cache Replication  \</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>         <span class="dv">2450829</span>   <span class="dv">1071</span>       <span class="dv">1</span>  <span class="fl">78.34</span><span class="er">KB</span>   NOT CACHED        NOT CACHED</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>         <span class="dv">2450846</span>    <span class="dv">839</span>       <span class="dv">1</span>  <span class="fl">61.83</span><span class="er">KB</span>   NOT CACHED        NOT CACHED</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>         <span class="dv">2450860</span>    <span class="dv">747</span>       <span class="dv">1</span>  <span class="fl">54.86</span><span class="er">KB</span>   NOT CACHED        NOT CACHED</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>         <span class="dv">2450874</span>    <span class="dv">922</span>       <span class="dv">1</span>  <span class="fl">66.74</span><span class="er">KB</span>   NOT CACHED        NOT CACHED</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>         <span class="dv">2450888</span>    <span class="dv">856</span>       <span class="dv">1</span>  <span class="fl">63.33</span><span class="er">KB</span>   NOT CACHED        NOT CACHED</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    Format Incremental stats  <span class="op">\</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  PARQUET              true</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  PARQUET              true</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  PARQUET              true</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  PARQUET              true</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  PARQUET              true</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>                                            Location</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  hdfs:<span class="op">//</span>localhost:<span class="dv">20500</span><span class="op">/</span>test<span class="op">-</span>warehouse<span class="op">/</span>tpcds.st...</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  hdfs:<span class="op">//</span>localhost:<span class="dv">20500</span><span class="op">/</span>test<span class="op">-</span>warehouse<span class="op">/</span>tpcds.st...</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  hdfs:<span class="op">//</span>localhost:<span class="dv">20500</span><span class="op">/</span>test<span class="op">-</span>warehouse<span class="op">/</span>tpcds.st...</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  hdfs:<span class="op">//</span>localhost:<span class="dv">20500</span><span class="op">/</span>test<span class="op">-</span>warehouse<span class="op">/</span>tpcds.st...</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  hdfs:<span class="op">//</span>localhost:<span class="dv">20500</span><span class="op">/</span>test<span class="op">-</span>warehouse<span class="op">/</span>tpcds.st...</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> cstats <span class="op">=</span> ss.column_stats()</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> cstats</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>                   Column          Type  <span class="co">#Distinct Values  #Nulls  Max Size  Avg Size</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>         ss_sold_time_sk        BIGINT             <span class="dv">13879</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">8</span></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>              ss_item_sk        BIGINT             <span class="dv">17925</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">8</span></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>          ss_customer_sk        BIGINT             <span class="dv">15207</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">8</span></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>             ss_cdemo_sk        BIGINT             <span class="dv">16968</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">8</span></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>             ss_hdemo_sk        BIGINT              <span class="dv">6220</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">8</span></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>              ss_addr_sk        BIGINT             <span class="dv">14077</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">8</span></span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>             ss_store_sk        BIGINT                 <span class="dv">6</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">8</span></span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>             ss_promo_sk        BIGINT               <span class="dv">298</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">8</span></span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>        ss_ticket_number           INT             <span class="dv">15006</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">4</span></span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>             ss_quantity           INT                <span class="dv">99</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">4</span></span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span>      ss_wholesale_cost  DECIMAL(<span class="dv">7</span>,<span class="dv">2</span>)             <span class="dv">10196</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">4</span></span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span>          ss_list_price  DECIMAL(<span class="dv">7</span>,<span class="dv">2</span>)             <span class="dv">19393</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">4</span></span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a><span class="dv">12</span>         ss_sales_price  DECIMAL(<span class="dv">7</span>,<span class="dv">2</span>)             <span class="dv">15594</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">4</span></span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a><span class="dv">13</span>    ss_ext_discount_amt  DECIMAL(<span class="dv">7</span>,<span class="dv">2</span>)             <span class="dv">29772</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">4</span></span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a><span class="dv">14</span>     ss_ext_sales_price  DECIMAL(<span class="dv">7</span>,<span class="dv">2</span>)            <span class="dv">102758</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">4</span></span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a><span class="dv">15</span>  ss_ext_wholesale_cost  DECIMAL(<span class="dv">7</span>,<span class="dv">2</span>)            <span class="dv">125448</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">4</span></span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a><span class="dv">16</span>      ss_ext_list_price  DECIMAL(<span class="dv">7</span>,<span class="dv">2</span>)            <span class="dv">141419</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">4</span></span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a><span class="dv">17</span>             ss_ext_tax  DECIMAL(<span class="dv">7</span>,<span class="dv">2</span>)             <span class="dv">33837</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">4</span></span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a><span class="dv">18</span>          ss_coupon_amt  DECIMAL(<span class="dv">7</span>,<span class="dv">2</span>)             <span class="dv">29772</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">4</span></span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a><span class="dv">19</span>            ss_net_paid  DECIMAL(<span class="dv">7</span>,<span class="dv">2</span>)            <span class="dv">109981</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">4</span></span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a><span class="dv">20</span>    ss_net_paid_inc_tax  DECIMAL(<span class="dv">7</span>,<span class="dv">2</span>)            <span class="dv">132286</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">4</span></span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a><span class="dv">21</span>          ss_net_profit  DECIMAL(<span class="dv">7</span>,<span class="dv">2</span>)            <span class="dv">122436</span>      <span class="op">-</span><span class="dv">1</span>       NaN         <span class="dv">4</span></span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a><span class="dv">22</span>        ss_sold_date_sk        BIGINT               <span class="dv">120</span>       <span class="dv">0</span>       NaN         <span class="dv">8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</section>
<section id="refresh-and-invalidate-metadata" class="level3">
<h3 class="anchored" data-anchor-id="refresh-and-invalidate-metadata"><code>REFRESH</code> and <code>INVALIDATE METADATA</code></h3>
<p>These DDL commands are available as table-level and client-level methods:</p>
<section id="ibis.backends.impala.Backend.invalidate_metadata" class="level4">
<h4 class="anchored" data-anchor-id="ibis.backends.impala.Backend.invalidate_metadata">invalidate_metadata</h4>
<p><code>invalidate_metadata(self, name=None, database=None)</code></p>
<p>Issue an <code>INVALIDATE METADATA</code> command.</p>
<p>Optionally this applies to a specific table. See Impala documentation.</p>
<section id="parameters-11" class="level5">
<h5 class="anchored" data-anchor-id="parameters-11">Parameters</h5>
<table class="table">
<colgroup>
<col style="width: 13%">
<col style="width: 14%">
<col style="width: 59%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>name</code></td>
<td>str | None</td>
<td>Table name. Can be fully qualified (with database)</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>database</code></td>
<td>str | None</td>
<td>Database name</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="ibis.backends.impala.client.ImpalaTable.invalidate_metadata" class="level4">
<h4 class="anchored" data-anchor-id="ibis.backends.impala.client.ImpalaTable.invalidate_metadata">invalidate_metadata</h4>
<p><code>invalidate_metadata(self)</code></p>
</section>
<section id="ibis.backends.impala.client.ImpalaTable.refresh" class="level4">
<h4 class="anchored" data-anchor-id="ibis.backends.impala.client.ImpalaTable.refresh">refresh</h4>
<p><code>refresh(self)</code></p>
<p>You can invalidate the cached metadata for a single table or for all tables using <code>invalidate_metadata</code>, and similarly invoke <code>REFRESH db_name.table_name</code> using the <code>refresh</code> method.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>client.invalidate_metadata()</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> db.table(table_name)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>table.invalidate_metadata()</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>table.refresh()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>These methods are often used in conjunction with the <code>LOAD DATA</code> commands and <code>COMPUTE STATS</code>. See the Impala documentation for full details.</p>
</section>
</section>
</section>
<section id="parquet-and-other-session-options" class="level2">
<h2 class="anchored" data-anchor-id="parquet-and-other-session-options">Parquet and other session options</h2>
<p>Ibis gives you access to Impala session-level variables that affect query execution:</p>
<section id="ibis.backends.impala.Backend.get_options" class="level4">
<h4 class="anchored" data-anchor-id="ibis.backends.impala.Backend.get_options">get_options</h4>
<p><code>get_options(self)</code></p>
<p>Return current query options for the Impala session.</p>
</section>
<section id="ibis.backends.impala.Backend.set_options" class="level4">
<h4 class="anchored" data-anchor-id="ibis.backends.impala.Backend.set_options">set_options</h4>
<p><code>set_options(self, options)</code></p>
</section>
<section id="ibis.backends.impala.Backend.set_compression_codec" class="level4">
<h4 class="anchored" data-anchor-id="ibis.backends.impala.Backend.set_compression_codec">set_compression_codec</h4>
<p><code>set_compression_codec(self, codec)</code></p>
<p>For example:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> client.get_options()</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>{<span class="st">'ABORT_ON_ERROR'</span>: <span class="st">'0'</span>,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a> <span class="st">'APPX_COUNT_DISTINCT'</span>: <span class="st">'0'</span>,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'BUFFER_POOL_LIMIT'</span>: <span class="st">''</span>,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a> <span class="st">'COMPRESSION_CODEC'</span>: <span class="st">''</span>,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a> <span class="st">'COMPUTE_STATS_MIN_SAMPLE_SIZE'</span>: <span class="st">'1073741824'</span>,</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a> <span class="st">'DEFAULT_JOIN_DISTRIBUTION_MODE'</span>: <span class="st">'0'</span>,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'DEFAULT_SPILLABLE_BUFFER_SIZE'</span>: <span class="st">'2097152'</span>,</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a> <span class="st">'DISABLE_ROW_RUNTIME_FILTERING'</span>: <span class="st">'0'</span>,</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a> <span class="st">'DISABLE_STREAMING_PREAGGREGATIONS'</span>: <span class="st">'0'</span>,</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a> <span class="st">'DISABLE_UNSAFE_SPILLS'</span>: <span class="st">'0'</span>,</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a> <span class="st">'ENABLE_EXPR_REWRITES'</span>: <span class="st">'1'</span>,</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a> <span class="st">'EXEC_SINGLE_NODE_ROWS_THRESHOLD'</span>: <span class="st">'100'</span>,</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a> <span class="st">'EXEC_TIME_LIMIT_S'</span>: <span class="st">'0'</span>,</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a> <span class="st">'EXPLAIN_LEVEL'</span>: <span class="st">'1'</span>,</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a> <span class="st">'HBASE_CACHE_BLOCKS'</span>: <span class="st">'0'</span>,</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a> <span class="st">'HBASE_CACHING'</span>: <span class="st">'0'</span>,</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a> <span class="st">'IDLE_SESSION_TIMEOUT'</span>: <span class="st">'0'</span>,</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a> <span class="st">'MAX_ERRORS'</span>: <span class="st">'100'</span>,</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a> <span class="st">'MAX_NUM_RUNTIME_FILTERS'</span>: <span class="st">'10'</span>,</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a> <span class="st">'MAX_ROW_SIZE'</span>: <span class="st">'524288'</span>,</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a> <span class="st">'MEM_LIMIT'</span>: <span class="st">'0'</span>,</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a> <span class="st">'MIN_SPILLABLE_BUFFER_SIZE'</span>: <span class="st">'65536'</span>,</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a> <span class="st">'MT_DOP'</span>: <span class="st">''</span>,</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a> <span class="st">'NUM_SCANNER_THREADS'</span>: <span class="st">'0'</span>,</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a> <span class="st">'OPTIMIZE_PARTITION_KEY_SCANS'</span>: <span class="st">'0'</span>,</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a> <span class="st">'PARQUET_ANNOTATE_STRINGS_UTF8'</span>: <span class="st">'0'</span>,</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a> <span class="st">'PARQUET_ARRAY_RESOLUTION'</span>: <span class="st">'2'</span>,</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a> <span class="st">'PARQUET_DICTIONARY_FILTERING'</span>: <span class="st">'1'</span>,</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a> <span class="st">'PARQUET_FALLBACK_SCHEMA_RESOLUTION'</span>: <span class="st">'0'</span>,</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a> <span class="st">'PARQUET_FILE_SIZE'</span>: <span class="st">'0'</span>,</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a> <span class="st">'PARQUET_READ_STATISTICS'</span>: <span class="st">'1'</span>,</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a> <span class="st">'PREFETCH_MODE'</span>: <span class="st">'1'</span>,</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a> <span class="st">'QUERY_TIMEOUT_S'</span>: <span class="st">'0'</span>,</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a> <span class="st">'REPLICA_PREFERENCE'</span>: <span class="st">'0'</span>,</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a> <span class="st">'REQUEST_POOL'</span>: <span class="st">''</span>,</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a> <span class="st">'RUNTIME_BLOOM_FILTER_SIZE'</span>: <span class="st">'1048576'</span>,</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a> <span class="st">'RUNTIME_FILTER_MAX_SIZE'</span>: <span class="st">'16777216'</span>,</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a> <span class="st">'RUNTIME_FILTER_MIN_SIZE'</span>: <span class="st">'1048576'</span>,</span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a> <span class="st">'RUNTIME_FILTER_MODE'</span>: <span class="st">'2'</span>,</span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a> <span class="st">'RUNTIME_FILTER_WAIT_TIME_MS'</span>: <span class="st">'0'</span>,</span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a> <span class="st">'S3_SKIP_INSERT_STAGING'</span>: <span class="st">'1'</span>,</span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a> <span class="st">'SCHEDULE_RANDOM_REPLICA'</span>: <span class="st">'0'</span>,</span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a> <span class="st">'SCRATCH_LIMIT'</span>: <span class="st">'-1'</span>,</span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a> <span class="st">'SEQ_COMPRESSION_MODE'</span>: <span class="st">''</span>,</span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a> <span class="st">'SYNC_DDL'</span>: <span class="st">'0'</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To enable Snappy compression for Parquet files, you could do either of:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> client.set_options({<span class="st">'COMPRESSION_CODEC'</span>: <span class="st">'snappy'</span>})</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> client.set_compression_codec(<span class="st">'snappy'</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> client.get_options()[<span class="st">'COMPRESSION_CODEC'</span>]</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co">'SNAPPY'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="ingesting-data-from-pandas" class="level2">
<h2 class="anchored" data-anchor-id="ingesting-data-from-pandas">Ingesting data from pandas</h2>
<p>Overall interoperability between the Hadoop / Spark ecosystems and pandas / the PyData stack is poor, but it will improve in time (this is a major part of the Ibis roadmap).</p>
<p>Ibis’s Impala tools currently interoperate with pandas in these ways:</p>
<ul>
<li>Ibis expressions return pandas objects (i.e.&nbsp;DataFrame or Series) for non-scalar expressions when calling their <code>to_pandas</code> method</li>
<li>The <code>create_table</code> and <code>insert</code> methods can accept pandas objects. This includes inserting into partitioned tables. It currently uses CSV as the ingest route.</li>
</ul>
<p>For example:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> data <span class="op">=</span> pd.DataFrame({<span class="st">'foo'</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>], <span class="st">'bar'</span>: [<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>]})</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> db.create_table(<span class="st">'pandas_table'</span>, data)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> t <span class="op">=</span> db.pandas_table</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> t.to_pandas()</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  bar  foo</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>   a    <span class="dv">1</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   b    <span class="dv">2</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   c    <span class="dv">3</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>   d    <span class="dv">4</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> t.drop()</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> db.create_table(<span class="st">'empty_for_insert'</span>, schema<span class="op">=</span>t.schema())</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> to_insert <span class="op">=</span> db.empty_for_insert</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> to_insert.insert(data)</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> to_insert.to_pandas()</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>  bar  foo</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>   a    <span class="dv">1</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   b    <span class="dv">2</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   c    <span class="dv">3</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>   d    <span class="dv">4</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> to_insert.drop()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> data <span class="op">=</span> pd.DataFrame({<span class="st">'foo'</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>], <span class="st">'bar'</span>: [<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>]})</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> db.create_table(<span class="st">'pandas_table'</span>, data)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> t <span class="op">=</span> db.pandas_table</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> t.to_pandas()</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>   foo bar</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="dv">1</span>   a</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="dv">2</span>   b</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="dv">3</span>   c</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    <span class="dv">4</span>   d</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> t.drop()</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> db.create_table(<span class="st">'empty_for_insert'</span>, schema<span class="op">=</span>t.schema())</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> to_insert <span class="op">=</span> db.empty_for_insert</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> to_insert.insert(data)</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> to_insert.to_pandas()</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>   foo bar</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="dv">1</span>   a</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="dv">2</span>   b</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="dv">3</span>   c</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    <span class="dv">4</span>   d</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> to_insert.drop()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="queries-on-parquet-avro-and-delimited-files" class="level2">
<h2 class="anchored" data-anchor-id="queries-on-parquet-avro-and-delimited-files">Queries on Parquet, Avro, and Delimited files</h2>
<p>Ibis can easily create temporary or persistent Impala tables that reference data in the following formats:</p>
<ul>
<li>Parquet (<code>parquet_file</code>)</li>
<li>Avro (<code>avro_file</code>)</li>
<li>Delimited text formats (CSV, TSV, etc.) (<code>delimited_file</code>)</li>
</ul>
<p>Parquet is the easiest because the schema can be read from the data files:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> path <span class="op">=</span> <span class="st">'/__ibis/ibis-testing-data/parquet/tpch_lineitem'</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> lineitem <span class="op">=</span> con.parquet_file(path)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> lineitem.limit(<span class="dv">2</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>   l_orderkey  l_partkey  l_suppkey  l_linenumber l_quantity l_extendedprice  <span class="op">\</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>           <span class="dv">1</span>     <span class="dv">155190</span>       <span class="dv">7706</span>             <span class="dv">1</span>      <span class="fl">17.00</span>        <span class="fl">21168.23</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>           <span class="dv">1</span>      <span class="dv">67310</span>       <span class="dv">7311</span>             <span class="dv">2</span>      <span class="fl">36.00</span>        <span class="fl">45983.16</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  l_discount l_tax l_returnflag l_linestatus  l_shipdate l_commitdate  <span class="op">\</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>       <span class="fl">0.04</span>  <span class="fl">0.02</span>            N            O  <span class="dv">1996</span><span class="op">-</span><span class="dv">0</span><span class="er">3</span><span class="op">-</span><span class="dv">13</span>   <span class="dv">1996</span><span class="op">-</span><span class="dv">0</span><span class="er">2</span><span class="op">-</span><span class="dv">12</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>       <span class="fl">0.09</span>  <span class="fl">0.06</span>            N            O  <span class="dv">1996</span><span class="op">-</span><span class="dv">0</span><span class="er">4</span><span class="op">-</span><span class="dv">12</span>   <span class="dv">1996</span><span class="op">-</span><span class="dv">0</span><span class="er">2</span><span class="op">-</span><span class="dv">28</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  l_receiptdate     l_shipinstruct l_shipmode  <span class="op">\</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="dv">1996</span><span class="op">-</span><span class="dv">0</span><span class="er">3</span><span class="op">-</span><span class="dv">22</span>  DELIVER IN PERSON      TRUCK</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="dv">1996</span><span class="op">-</span><span class="dv">0</span><span class="er">4</span><span class="op">-</span><span class="dv">20</span>   TAKE BACK RETURN       MAIL</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>                            l_comment</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>             egular courts above the</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  ly final dependencies: slyly bold</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> lineitem.l_extendedprice.<span class="bu">sum</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>Decimal(<span class="st">'229577310901.20'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you want to query a Parquet file and also create a table in Impala that remains after your session, you can pass more information to <code>parquet_file</code>:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> table <span class="op">=</span> con.parquet_file(path, name<span class="op">=</span><span class="st">'my_parquet_table'</span>,</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>...                          database<span class="op">=</span><span class="st">'ibis_testing'</span>,</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>...                          persist<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> table.l_extendedprice.<span class="bu">sum</span>()</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>Decimal(<span class="st">'229577310901.20'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> con.table(<span class="st">'my_parquet_table'</span>).l_extendedprice.<span class="bu">sum</span>()</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>Decimal(<span class="st">'229577310901.20'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> con.drop_table(<span class="st">'my_parquet_table'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To query delimited files, you need to write down an Ibis schema.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> schema <span class="op">=</span> ibis.schema(<span class="bu">dict</span>(foo<span class="op">=</span><span class="st">'string'</span>, bar<span class="op">=</span><span class="st">'double'</span>, baz<span class="op">=</span><span class="st">'int32'</span>))</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> table <span class="op">=</span> con.delimited_file(<span class="st">'/__ibis/ibis-testing-data/csv'</span>, schema)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> table.limit(<span class="dv">10</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>          foo       bar  baz</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="dv">63</span><span class="er">IEbRheTh</span>  <span class="fl">0.679389</span>    <span class="dv">6</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  mG4hlqnjeG  <span class="fl">2.807106</span>   <span class="dv">15</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  JTPdX9SZH5 <span class="op">-</span><span class="fl">0.155126</span>   <span class="dv">55</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="ot">2j</span><span class="er">cl6FypOl</span>  <span class="fl">1.037878</span>   <span class="dv">21</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  k3TbJLaadQ <span class="op">-</span><span class="fl">1.401908</span>   <span class="dv">23</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  rP5J4xvinM <span class="op">-</span><span class="fl">0.442093</span>   <span class="dv">22</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>  WniUylixYt <span class="op">-</span><span class="fl">0.863748</span>   <span class="dv">27</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>  znsDuKOB1n <span class="op">-</span><span class="fl">0.566030</span>   <span class="dv">47</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>  <span class="dv">4</span><span class="er">SRP9jlo1M</span>  <span class="fl">0.331460</span>   <span class="dv">88</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>  KsfjPyDf5e <span class="op">-</span><span class="fl">0.578931</span>   <span class="dv">70</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> table.bar.summary()</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>   count  nulls       <span class="bu">min</span>       <span class="bu">max</span>       <span class="bu">sum</span>    mean  approx_nunique</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="dv">100</span>      <span class="dv">0</span> <span class="op">-</span><span class="fl">1.401908</span>  <span class="fl">2.807106</span>  <span class="fl">8.479978</span>  <span class="fl">0.0848</span>              <span class="dv">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>For functions like <code>parquet_file</code> and <code>delimited_file</code>, a directory must be passed and the directory must contain files all having the same schema.</p>
</section>
<section id="other-helper-functions-for-interacting-with-the-database" class="level2">
<h2 class="anchored" data-anchor-id="other-helper-functions-for-interacting-with-the-database">Other helper functions for interacting with the database</h2>
<p>We’re adding a growing list of useful utility functions for interacting with an Impala cluster on the client object. The idea is that you should be able to do any database-admin-type work with Ibis and not have to switch over to the Impala SQL shell. Any ways we can make this more pleasant, please let us know.</p>
<p>Here’s some of the features, which we’ll give examples for:</p>
<ul>
<li>Listing and searching for available databases and tables</li>
<li>Creating and dropping databases</li>
<li>Getting table schemas</li>
</ul>
<div class="sourceCode" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> con.list_databases(like<span class="op">=</span><span class="st">'ibis*'</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>[<span class="st">'ibis_testing'</span>, <span class="st">'ibis_testing_tmp_db'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> con.list_tables(database<span class="op">=</span><span class="st">'ibis_testing'</span>, like<span class="op">=</span><span class="st">'tpch*'</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>[<span class="st">'tpch_customer'</span>,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a> <span class="st">'tpch_lineitem'</span>,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'tpch_nation'</span>,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a> <span class="st">'tpch_orders'</span>,</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a> <span class="st">'tpch_part'</span>,</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a> <span class="st">'tpch_partsupp'</span>,</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'tpch_region'</span>,</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a> <span class="st">'tpch_region_avro'</span>,</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a> <span class="st">'tpch_supplier'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> schema <span class="op">=</span> con.get_schema(<span class="st">'functional_alltypes'</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> schema</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>ibis.Schema {</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">id</span>               int32</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  bool_col         boolean</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  tinyint_col      int8</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  smallint_col     int16</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  int_col          int32</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  bigint_col       int64</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  float_col        float32</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>  double_col       float64</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>  date_string_col  string</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>  string_col       string</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>  timestamp_col    timestamp</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>  year             int32</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>  month            int32</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Databases can be created, too, and you can set the storage path in HDFS you want for the data files</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> db <span class="op">=</span> <span class="st">'ibis_testing2'</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> con.create_database(db, force<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> con.create_table(<span class="st">'example_table'</span>, con.table(<span class="st">'functional_alltypes'</span>),</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>...                  database<span class="op">=</span>db, force<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To drop a database, including all tables in it, you can use <code>drop_database</code> with <code>force=True</code>:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> con.drop_database(db, force<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="user-defined-functions-udf" class="level2">
<h2 class="anchored" data-anchor-id="user-defined-functions-udf">User Defined functions (UDF)</h2>
<p>Impala currently supports user-defined scalar functions (known henceforth as <em>UDFs</em>) and aggregate functions (respectively <em>UDAs</em>) via a C++ extension API.</p>
<p>Initial support for using C++ UDFs in Ibis came in version 0.4.0.</p>
<section id="using-scalar-functions-udfs" class="level3">
<h3 class="anchored" data-anchor-id="using-scalar-functions-udfs">Using scalar functions (UDFs)</h3>
<p>Let’s take an example to illustrate how to make a C++ UDF available to Ibis. Here is a function that computes an approximate equality between floating point values:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"impala_udf/udf.h"</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cctype&gt;</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cmath&gt;</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>BooleanVal FuzzyEquals<span class="op">(</span>FunctionContext<span class="op">*</span> ctx<span class="op">,</span> <span class="at">const</span> DoubleVal<span class="op">&amp;</span> x<span class="op">,</span> <span class="at">const</span> DoubleVal<span class="op">&amp;</span> y<span class="op">)</span> <span class="op">{</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="dt">double</span> EPSILON <span class="op">=</span> <span class="fl">0.000001</span><span class="bu">f</span><span class="op">;</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>is_null <span class="op">||</span> y<span class="op">.</span>is_null<span class="op">)</span> <span class="cf">return</span> BooleanVal<span class="op">::</span>null<span class="op">();</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> delta <span class="op">=</span> fabs<span class="op">(</span>x<span class="op">.</span>val <span class="op">-</span> y<span class="op">.</span>val<span class="op">);</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> BooleanVal<span class="op">(</span>delta <span class="op">&lt;</span> EPSILON<span class="op">);</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can compile this to either a shared library (a <code>.so</code> file) or to LLVM bitcode with clang (a <code>.ll</code> file). Skipping that step for now (will add some more detailed instructions here later, promise).</p>
<p>To make this function callable, we use <code>ibis.impala.wrap_udf</code>:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>library <span class="op">=</span> <span class="st">'/ibis/udfs/udftest.ll'</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>inputs <span class="op">=</span> [<span class="st">'double'</span>, <span class="st">'double'</span>]</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>output <span class="op">=</span> <span class="st">'boolean'</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>symbol <span class="op">=</span> <span class="st">'FuzzyEquals'</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>udf_db <span class="op">=</span> <span class="st">'ibis_testing'</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>udf_name <span class="op">=</span> <span class="st">'fuzzy_equals'</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>fuzzy_equals <span class="op">=</span> ibis.impala.wrap_udf(</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>    library, inputs, output, symbol, name<span class="op">=</span>udf_name</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In typical workflows, you will set up a UDF in Impala once then use it thenceforth. So the <em>first time</em> you do this, you need to create the UDF in Impala:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>client.create_function(fuzzy_equals, database<span class="op">=</span>udf_db)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now, we must register this function as a new Impala operation in Ibis. This must take place each time you load your Ibis session.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>func.register(fuzzy_equals.name, udf_db)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The object <code>fuzzy_equals</code> is callable and works with Ibis expressions:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> t <span class="op">=</span> con.tables.functional_alltypes</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> expr <span class="op">=</span> fuzzy_equals(t.float_col, t.double_col <span class="op">/</span> <span class="dv">10</span>)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> expr.to_pandas()[:<span class="dv">10</span>]</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>     <span class="va">True</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="va">False</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="va">False</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    <span class="va">False</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    <span class="va">False</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    <span class="va">False</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>    <span class="va">False</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>    <span class="va">False</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>    <span class="va">False</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>    <span class="va">False</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>Name: tmp, dtype: <span class="bu">bool</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that the call to <code>register</code> on the UDF object must happen each time you use Ibis. If you have a lot of UDFs, I suggest you create a file with all of your wrapper declarations and user APIs that you load with your Ibis session to plug in all your own functions.</p>
</section>
</section>
<section id="working-with-secure-clusters-kerberos" class="level2">
<h2 class="anchored" data-anchor-id="working-with-secure-clusters-kerberos">Working with secure clusters (Kerberos)</h2>
<p>Ibis is compatible with Hadoop clusters that are secured with Kerberos (as well as SSL and LDAP). Note that to enable this support, you’ll also need to install the <code>kerberos</code> package.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> pip install kerberos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Just like the Impala shell and ODBC/JDBC connectors, Ibis connects to Impala through the HiveServer2 interface (using the impyla client). Therefore, the connection semantics are similar to the other access methods for working with secure clusters.</p>
<p>Specifically, after authenticating yourself against Kerberos (e.g., by issuing the appropriate <code>kinit</code> command), pass <code>auth_mechanism='GSSAPI'</code> or <code>auth_mechanism='LDAP'</code> (and set <code>kerberos_service_name</code> if necessary along with <code>user</code> and <code>password</code> if necessary) to the <code>ibis.impala_connect(...)</code> method. This method also takes arguments to configure SSL (<code>use_ssl</code>, <code>ca_cert</code>). See the documentation for the Impala shell for more details.</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        for (let i = 0; i < 2; i++) {
          container.appendChild(note.children[i].cloneNode(true));
        }
        return container.innerHTML
      } else {
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        console.log("RESIZE");
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ibis-project">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://ibis-project.zulipchat.com">
      <i class="bi bi-zulip" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://ibis-project.org/posts.xml">
      <i class="bi bi-rss" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>