<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.339">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nick Crews">
<meta name="dcterms.date" content="2023-03-24">

<title>Ibis - Exploring campaign finance data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../logo.svg" rel="icon" type="image/svg+xml">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "keyboard-shortcut": [
    null
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
<meta name="twitter:title" content="Ibis - Exploring campaign finance data">
<meta name="twitter:description" content="the portable Python dataframe library">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Ibis</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-getting-started" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Getting started</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-getting-started">    
        <li>
    <a class="dropdown-item" href="../../install.html">
 <span class="dropdown-text">Installation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../tutorials/getting_started.html">
 <span class="dropdown-text">Tutorial: getting started</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../tutorials/ibis-for-dplyr-users.html">
 <span class="dropdown-text">Tutorial: Ibis for dplyr users</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../tutorials/ibis-for-pandas-users.html">
 <span class="dropdown-text">Tutorial: Ibis for pandas users</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../tutorials/ibis-for-sql-users.html">
 <span class="dropdown-text">Tutorial: Ibis for SQL users</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Data Platforms</li>
        <li>
    <a class="dropdown-item" href="../../tutorials/data-platforms/starburst-galaxy/0_setup.html">
 <span class="dropdown-text">Starburst Galaxy</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-concepts" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Concepts</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-concepts">    
        <li>
    <a class="dropdown-item" href="../../why.html">
 <span class="dropdown-text">Why Ibis?</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../concepts/internals.html">
 <span class="dropdown-text">Internals</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../concepts/versioning.html">
 <span class="dropdown-text">Versioning policy</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-backends" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Backends</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-backends">    
        <li>
    <a class="dropdown-item" href="../../backends/bigquery.html">
 <span class="dropdown-text">BigQuery</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/clickhouse.html">
 <span class="dropdown-text">ClickHouse</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/dask.html">
 <span class="dropdown-text">Dask</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/datafusion.html">
 <span class="dropdown-text">DataFusion</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/druid.html">
 <span class="dropdown-text">Druid</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/duckdb.html">
 <span class="dropdown-text">DuckDB</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/exasol.html">
 <span class="dropdown-text">Exasol</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/impala.html">
 <span class="dropdown-text">Impala</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/mssql.html">
 <span class="dropdown-text">MSSQL</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/mysql.html">
 <span class="dropdown-text">MySQL</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/oracle.html">
 <span class="dropdown-text">Oracle</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/pandas.html">
 <span class="dropdown-text">pandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/polars.html">
 <span class="dropdown-text">Polars</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/postgresql.html">
 <span class="dropdown-text">PostgreSQL</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/pyspark.html">
 <span class="dropdown-text">PySpark</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/snowflake.html">
 <span class="dropdown-text">Snowflake</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/sqlite.html">
 <span class="dropdown-text">SQLite</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/trino.html">
 <span class="dropdown-text">Trino</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../support_matrix.html">
 <span class="dropdown-text">Operation support matrix</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-how-to" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">How-to</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-how-to">    
        <li class="dropdown-header">Configure</li>
        <li>
    <a class="dropdown-item" href="../../how-to/configure/basics.html">
 <span class="dropdown-text">Basic configuration</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Input Output</li>
        <li>
    <a class="dropdown-item" href="../../how-to/input-output/basics.html">
 <span class="dropdown-text">Basic input/output</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/input-output/multiple-backends.html">
 <span class="dropdown-text">Work with multiple backends</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Analytics</li>
        <li>
    <a class="dropdown-item" href="../../how-to/analytics/basics.html">
 <span class="dropdown-text">Basic analytics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/analytics/chain_expressions.html">
 <span class="dropdown-text">Chaining expressions</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Visualization</li>
        <li>
    <a class="dropdown-item" href="../../how-to/visualization/altair.html">
 <span class="dropdown-text">Altair + Ibis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/visualization/matplotlib.html">
 <span class="dropdown-text">matplotlib + Ibis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/visualization/plotly.html">
 <span class="dropdown-text">Plotly + Ibis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/visualization/plotnine.html">
 <span class="dropdown-text">plotnine + Ibis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/visualization/seaborn.html">
 <span class="dropdown-text">seaborn + Ibis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/visualization/streamlit.html">
 <span class="dropdown-text">Streamlit + Ibis</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Extending</li>
        <li>
    <a class="dropdown-item" href="../../how-to/extending/builtin.html">
 <span class="dropdown-text">Reference built-in functions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/extending/elementwise.html">
 <span class="dropdown-text">Add an elementwise operation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/extending/reduction.html">
 <span class="dropdown-text">Add a reduction operation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/extending/sql.html">
 <span class="dropdown-text">Using SQL strings with Ibis</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-reference" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Reference</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-reference">    
        <li class="dropdown-header">Expression API</li>
        <li>
    <a class="dropdown-item" href="../../reference/expression-tables.html">
 <span class="dropdown-text">Table expressions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/selectors.html">
 <span class="dropdown-text">Column selectors</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/expression-generic.html">
 <span class="dropdown-text">Generic expressions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/expression-numeric.html">
 <span class="dropdown-text">Numeric and Boolean expressions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/expression-strings.html">
 <span class="dropdown-text">String expressions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/expression-temporal.html">
 <span class="dropdown-text">Temporal expressions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/expression-collections.html">
 <span class="dropdown-text">Collection expressions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/expression-geospatial.html">
 <span class="dropdown-text">Geospatial expressions</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Type system</li>
        <li>
    <a class="dropdown-item" href="../../reference/datatypes.html">
 <span class="dropdown-text">Data types</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/schemas.html">
 <span class="dropdown-text">Schemas</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">UDFs</li>
        <li>
    <a class="dropdown-item" href="../../reference/scalar-udfs.html">
 <span class="dropdown-text">Scalar UDFs</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Connection APIs</li>
        <li>
    <a class="dropdown-item" href="../../reference/connection.html">
 <span class="dropdown-text">Top-level connection APIs</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Configuration</li>
        <li>
    <a class="dropdown-item" href="../../reference/ContextAdjustment.html">
 <span class="dropdown-text">ContextAdjustment</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/Interactive.html">
 <span class="dropdown-text">Interactive</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/Options.html">
 <span class="dropdown-text">Options</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/Repr.html">
 <span class="dropdown-text">Repr</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/SQL.html">
 <span class="dropdown-text">SQL</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html"> 
<span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../release_notes.html"> 
<span class="menu-text">Release notes</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-contribute" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Contribute</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-contribute">    
        <li class="dropdown-header">Contribute</li>
        <li>
    <a class="dropdown-item" href="../../contribute/01_environment.html">
 <span class="dropdown-text">Setting up a development environment</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../contribute/02_workflow.html">
 <span class="dropdown-text">Contribute to the Ibis codebase</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../contribute/03_style.html">
 <span class="dropdown-text">Style and formatting</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../contribute/04_maintainers_guide.html">
 <span class="dropdown-text">Maintaining the codebase</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../contribute/05_reference.html">
 <span class="dropdown-text">Test Class Reference</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/ibis-project/ibis">
            Source code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/ibis-project/ibis/issues/new?assignees=&amp;labels=bug&amp;projects=&amp;template=bug-report.yml&amp;title=bug">
            Report a bug
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/ibis-project/ibis/issues/new?assignees=&amp;labels=docs&amp;projects=&amp;template=docs-issue.yml&amp;title=docs">
            Report a documentation issue
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/ibis-project/ibis/issues/new?assignees=&amp;labels=feature&amp;projects=&amp;template=feature-request.yml&amp;title=feat">
            Submit a feature request
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/ibis-project/ibis/discussions/new?category=q-a">
            Ask the community for help
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Exploring campaign finance data</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">blog</div>
                <div class="quarto-category">data engineering</div>
                <div class="quarto-category">case study</div>
                <div class="quarto-category">duckdb</div>
                <div class="quarto-category">performance</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Nick Crews </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">March 24, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#downloading-the-data" id="toc-downloading-the-data" class="nav-link active" data-scroll-target="#downloading-the-data">Downloading The Data</a></li>
  <li><a href="#loading-the-data" id="toc-loading-the-data" class="nav-link" data-scroll-target="#loading-the-data">Loading the data</a>
  <ul class="collapse">
  <li><a href="#committees-data" id="toc-committees-data" class="nav-link" data-scroll-target="#committees-data">Committees Data</a></li>
  </ul></li>
  <li><a href="#cleaning" id="toc-cleaning" class="nav-link" data-scroll-target="#cleaning">Cleaning</a></li>
  <li><a href="#adding-features" id="toc-adding-features" class="nav-link" data-scroll-target="#adding-features">Adding Features</a></li>
  <li><a href="#analysis" id="toc-analysis" class="nav-link" data-scroll-target="#analysis">Analysis</a>
  <ul class="collapse">
  <li><a href="#by-donation-size" id="toc-by-donation-size" class="nav-link" data-scroll-target="#by-donation-size">By donation size</a></li>
  <li><a href="#back-to-analysis" id="toc-back-to-analysis" class="nav-link" data-scroll-target="#back-to-analysis">Back to analysis</a></li>
  <li><a href="#by-election-stage" id="toc-by-election-stage" class="nav-link" data-scroll-target="#by-election-stage">By election stage</a></li>
  <li><a href="#by-recipient" id="toc-by-recipient" class="nav-link" data-scroll-target="#by-recipient">By recipient</a></li>
  <li><a href="#by-location" id="toc-by-location" class="nav-link" data-scroll-target="#by-location">By Location</a></li>
  <li><a href="#by-month" id="toc-by-month" class="nav-link" data-scroll-target="#by-month">By month</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/ibis-project/ibis/edit/master/docs/posts/campaign-finance/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/ibis-project/ibis/issues/new/choose" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>Hi! My name is <a href="https://www.linkedin.com/in/nicholas-b-crews/">Nick Crews</a>, and I’m a data engineer that looks at public campaign finance data.</p>
<p>In this post, I’ll walk through how I use Ibis to explore public campaign contribution data from the Federal Election Commission (FEC). We’ll do some loading, cleaning, featurizing, and visualization. There will be filtering, sorting, grouping, and aggregation.</p>
<section id="downloading-the-data" class="level2">
<h2 class="anchored" data-anchor-id="downloading-the-data">Downloading The Data</h2>
<div id="02d63441" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> zipfile <span class="im">import</span> ZipFile</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> urllib.request <span class="im">import</span> urlretrieve</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Download and unzip the 2018 individual contributions data</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://cg-519a459a-0ea3-42c2-b7bc-fa1143481f74.s3-us-gov-west-1.amazonaws.com/bulk-downloads/2018/indiv18.zip"</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>zip_path <span class="op">=</span> Path(<span class="st">"indiv18.zip"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>csv_path <span class="op">=</span> Path(<span class="st">"indiv18.csv"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> zip_path.exists():</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    urlretrieve(url, zip_path)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> csv_path.exists():</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> ZipFile(zip_path) <span class="im">as</span> zip_file, csv_path.<span class="bu">open</span>(<span class="st">"w"</span>) <span class="im">as</span> csv_file:</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> line <span class="kw">in</span> zip_file.<span class="bu">open</span>(<span class="st">"itcont.txt"</span>):</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>            csv_file.write(line.decode())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="loading-the-data" class="level2">
<h2 class="anchored" data-anchor-id="loading-the-data">Loading the data</h2>
<p>Now that we have our raw data in a .csv format, let’s load it into Ibis, using the duckdb backend.</p>
<p>Note that a 4.3 GB .csv would be near the limit of what pandas could handle on my laptop with 16GB of RAM. In pandas, typically every time you perform a transformation on the data, a copy of the data is made. I could only do a few transformations before I ran out of memory.</p>
<p>With Ibis, this problem is solved in two different ways.</p>
<p>First, because they are designed to work with very large datasets, many (all?) SQL backends support out of core operations. The data lives on disk, and are only loaded in a streaming fashion when needed, and then written back to disk as the operation is performed.</p>
<p>Second, unless you explicitly ask for it, Ibis makes use of lazy evaluation. This means that when you ask for a result, the result is not persisted in memory. Only the original source data is persisted. Everything else is derived from this on the fly.</p>
<div id="83a871f2" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ibis</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ibis <span class="im">import</span> _</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>ibis.options.interactive <span class="op">=</span> <span class="va">True</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># The raw .csv file doesn't have column names, so we will add them in the next step.</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>raw <span class="op">=</span> ibis.read_csv(csv_path)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>raw</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> C00401224 </span>┃<span style="font-weight: bold"> A      </span>┃<span style="font-weight: bold"> M6     </span>┃<span style="font-weight: bold"> P      </span>┃<span style="font-weight: bold"> 201804059101866001 </span>┃<span style="font-weight: bold"> 24T    </span>┃<span style="font-weight: bold"> IND    </span>┃<span style="font-weight: bold"> STOUFFER, LEIGH   </span>┃<span style="font-weight: bold"> AMSTELVEEN   </span>┃<span style="font-weight: bold"> ZZ     </span>┃<span style="font-weight: bold"> 1187RC    </span>┃<span style="font-weight: bold"> MYSELF            </span>┃<span style="font-weight: bold"> SELF EMPLOYED           </span>┃<span style="font-weight: bold"> 05172017 </span>┃<span style="font-weight: bold"> 10    </span>┃<span style="font-weight: bold"> C00458000 </span>┃<span style="font-weight: bold"> SA11AI_81445687 </span>┃<span style="font-weight: bold"> 1217152 </span>┃<span style="font-weight: bold"> column18 </span>┃<span style="font-weight: bold"> EARMARKED FOR PROGRESSIVE CHANGE CAMPAIGN COMMITTEE (C00458000) </span>┃<span style="font-weight: bold"> 4050820181544765358 </span>┃
┡━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>              │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                  │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>   │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                                          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>               │
├───────────┼────────┼────────┼────────┼────────────────────┼────────┼────────┼───────────────────┼──────────────┼────────┼───────────┼───────────────────┼─────────────────────────┼──────────┼───────┼───────────┼─────────────────┼─────────┼──────────┼─────────────────────────────────────────────────────────────────┼─────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">A     </span> │ <span style="color: #008000; text-decoration-color: #008000">M6    </span> │ <span style="color: #008000; text-decoration-color: #008000">P     </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">201804059101867748</span> │ <span style="color: #008000; text-decoration-color: #008000">24T   </span> │ <span style="color: #008000; text-decoration-color: #008000">IND   </span> │ <span style="color: #008000; text-decoration-color: #008000">STRAWS, JOYCE    </span> │ <span style="color: #008000; text-decoration-color: #008000">OCOEE       </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │ <span style="color: #008000; text-decoration-color: #008000">34761    </span> │ <span style="color: #008000; text-decoration-color: #008000">SILVERSEA CRUISES</span> │ <span style="color: #008000; text-decoration-color: #008000">RESERVATIONS SUPERVISOR</span> │ <span style="color: #008000; text-decoration-color: #008000">05182017</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10</span> │ <span style="color: #008000; text-decoration-color: #008000">C00000935</span> │ <span style="color: #008000; text-decoration-color: #008000">SA11AI_81592336</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1217152</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │ <span style="color: #008000; text-decoration-color: #008000">EARMARKED FOR DCCC (C00000935)                                 </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4050820181544770597</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">A     </span> │ <span style="color: #008000; text-decoration-color: #008000">M6    </span> │ <span style="color: #008000; text-decoration-color: #008000">P     </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">201804059101867748</span> │ <span style="color: #008000; text-decoration-color: #008000">24T   </span> │ <span style="color: #008000; text-decoration-color: #008000">IND   </span> │ <span style="color: #008000; text-decoration-color: #008000">STRAWS, JOYCE    </span> │ <span style="color: #008000; text-decoration-color: #008000">OCOEE       </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │ <span style="color: #008000; text-decoration-color: #008000">34761    </span> │ <span style="color: #008000; text-decoration-color: #008000">SILVERSEA CRUISES</span> │ <span style="color: #008000; text-decoration-color: #008000">RESERVATIONS SUPERVISOR</span> │ <span style="color: #008000; text-decoration-color: #008000">05192017</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">15</span> │ <span style="color: #008000; text-decoration-color: #008000">C00000935</span> │ <span style="color: #008000; text-decoration-color: #008000">SA11AI_81627562</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1217152</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │ <span style="color: #008000; text-decoration-color: #008000">EARMARKED FOR DCCC (C00000935)                                 </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4050820181544770598</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">A     </span> │ <span style="color: #008000; text-decoration-color: #008000">M6    </span> │ <span style="color: #008000; text-decoration-color: #008000">P     </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">201804059101865942</span> │ <span style="color: #008000; text-decoration-color: #008000">24T   </span> │ <span style="color: #008000; text-decoration-color: #008000">IND   </span> │ <span style="color: #008000; text-decoration-color: #008000">STOTT, JIM       </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">039020760</span> │ <span style="color: #008000; text-decoration-color: #008000">NONE             </span> │ <span style="color: #008000; text-decoration-color: #008000">NONE                   </span> │ <span style="color: #008000; text-decoration-color: #008000">05132017</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">35</span> │ <span style="color: #008000; text-decoration-color: #008000">C00000935</span> │ <span style="color: #008000; text-decoration-color: #008000">SA11AI_81047921</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1217152</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │ <span style="color: #008000; text-decoration-color: #008000">EARMARKED FOR DCCC (C00000935)                                 </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4050820181544765179</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">A     </span> │ <span style="color: #008000; text-decoration-color: #008000">M6    </span> │ <span style="color: #008000; text-decoration-color: #008000">P     </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">201804059101865942</span> │ <span style="color: #008000; text-decoration-color: #008000">24T   </span> │ <span style="color: #008000; text-decoration-color: #008000">IND   </span> │ <span style="color: #008000; text-decoration-color: #008000">STOTT, JIM       </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">039020760</span> │ <span style="color: #008000; text-decoration-color: #008000">NONE             </span> │ <span style="color: #008000; text-decoration-color: #008000">NONE                   </span> │ <span style="color: #008000; text-decoration-color: #008000">05152017</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">35</span> │ <span style="color: #008000; text-decoration-color: #008000">C00000935</span> │ <span style="color: #008000; text-decoration-color: #008000">SA11AI_81209209</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1217152</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │ <span style="color: #008000; text-decoration-color: #008000">EARMARKED FOR DCCC (C00000935)                                 </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4050820181544765180</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">A     </span> │ <span style="color: #008000; text-decoration-color: #008000">M6    </span> │ <span style="color: #008000; text-decoration-color: #008000">P     </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">201804059101865942</span> │ <span style="color: #008000; text-decoration-color: #008000">24T   </span> │ <span style="color: #008000; text-decoration-color: #008000">IND   </span> │ <span style="color: #008000; text-decoration-color: #008000">STOTT, JIM       </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">039020760</span> │ <span style="color: #008000; text-decoration-color: #008000">NONE             </span> │ <span style="color: #008000; text-decoration-color: #008000">NONE                   </span> │ <span style="color: #008000; text-decoration-color: #008000">05192017</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span> │ <span style="color: #008000; text-decoration-color: #008000">C00000935</span> │ <span style="color: #008000; text-decoration-color: #008000">SA11AI_81605223</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1217152</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │ <span style="color: #008000; text-decoration-color: #008000">EARMARKED FOR DCCC (C00000935)                                 </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4050820181544765181</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">A     </span> │ <span style="color: #008000; text-decoration-color: #008000">M6    </span> │ <span style="color: #008000; text-decoration-color: #008000">P     </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">201804059101865943</span> │ <span style="color: #008000; text-decoration-color: #008000">24T   </span> │ <span style="color: #008000; text-decoration-color: #008000">IND   </span> │ <span style="color: #008000; text-decoration-color: #008000">STOTT, JIM       </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">039020760</span> │ <span style="color: #008000; text-decoration-color: #008000">NONE             </span> │ <span style="color: #008000; text-decoration-color: #008000">NONE                   </span> │ <span style="color: #008000; text-decoration-color: #008000">05242017</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">15</span> │ <span style="color: #008000; text-decoration-color: #008000">C00000935</span> │ <span style="color: #008000; text-decoration-color: #008000">SA11AI_82200022</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1217152</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │ <span style="color: #008000; text-decoration-color: #008000">EARMARKED FOR DCCC (C00000935)                                 </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4050820181544765182</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">A     </span> │ <span style="color: #008000; text-decoration-color: #008000">M6    </span> │ <span style="color: #008000; text-decoration-color: #008000">P     </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">201804059101865943</span> │ <span style="color: #008000; text-decoration-color: #008000">24T   </span> │ <span style="color: #008000; text-decoration-color: #008000">IND   </span> │ <span style="color: #008000; text-decoration-color: #008000">STOTT, JIM       </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">03902    </span> │ <span style="color: #008000; text-decoration-color: #008000">NOT EMPLOYED     </span> │ <span style="color: #008000; text-decoration-color: #008000">NOT EMPLOYED           </span> │ <span style="color: #008000; text-decoration-color: #008000">05292017</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">100</span> │ <span style="color: #008000; text-decoration-color: #008000">C00213512</span> │ <span style="color: #008000; text-decoration-color: #008000">SA11AI_82589834</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1217152</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │ <span style="color: #008000; text-decoration-color: #008000">EARMARKED FOR NANCY PELOSI FOR CONGRESS (C00213512)            </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4050820181544765184</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">A     </span> │ <span style="color: #008000; text-decoration-color: #008000">M6    </span> │ <span style="color: #008000; text-decoration-color: #008000">P     </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">201804059101865944</span> │ <span style="color: #008000; text-decoration-color: #008000">24T   </span> │ <span style="color: #008000; text-decoration-color: #008000">IND   </span> │ <span style="color: #008000; text-decoration-color: #008000">STOTT, JIM       </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">039020760</span> │ <span style="color: #008000; text-decoration-color: #008000">NONE             </span> │ <span style="color: #008000; text-decoration-color: #008000">NONE                   </span> │ <span style="color: #008000; text-decoration-color: #008000">05302017</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">35</span> │ <span style="color: #008000; text-decoration-color: #008000">C00000935</span> │ <span style="color: #008000; text-decoration-color: #008000">SA11AI_82643727</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1217152</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │ <span style="color: #008000; text-decoration-color: #008000">EARMARKED FOR DCCC (C00000935)                                 </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4050820181544765185</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">A     </span> │ <span style="color: #008000; text-decoration-color: #008000">M6    </span> │ <span style="color: #008000; text-decoration-color: #008000">P     </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">201804059101867050</span> │ <span style="color: #008000; text-decoration-color: #008000">24T   </span> │ <span style="color: #008000; text-decoration-color: #008000">IND   </span> │ <span style="color: #008000; text-decoration-color: #008000">STRANGE, WINIFRED</span> │ <span style="color: #008000; text-decoration-color: #008000">ANNA MSRIA  </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │ <span style="color: #008000; text-decoration-color: #008000">34216    </span> │ <span style="color: #008000; text-decoration-color: #008000">NOT EMPLOYED     </span> │ <span style="color: #008000; text-decoration-color: #008000">NOT EMPLOYED           </span> │ <span style="color: #008000; text-decoration-color: #008000">05162017</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">25</span> │ <span style="color: #008000; text-decoration-color: #008000">C00000935</span> │ <span style="color: #008000; text-decoration-color: #008000">SA11AI_81325918</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1217152</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │ <span style="color: #008000; text-decoration-color: #008000">EARMARKED FOR DCCC (C00000935)                                 </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4050820181544768505</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">A     </span> │ <span style="color: #008000; text-decoration-color: #008000">M6    </span> │ <span style="color: #008000; text-decoration-color: #008000">P     </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">201804059101867051</span> │ <span style="color: #008000; text-decoration-color: #008000">24T   </span> │ <span style="color: #008000; text-decoration-color: #008000">IND   </span> │ <span style="color: #008000; text-decoration-color: #008000">STRANGE, WINIFRED</span> │ <span style="color: #008000; text-decoration-color: #008000">ANNA MSRIA  </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │ <span style="color: #008000; text-decoration-color: #008000">34216    </span> │ <span style="color: #008000; text-decoration-color: #008000">NOT EMPLOYED     </span> │ <span style="color: #008000; text-decoration-color: #008000">NOT EMPLOYED           </span> │ <span style="color: #008000; text-decoration-color: #008000">05232017</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">25</span> │ <span style="color: #008000; text-decoration-color: #008000">C00000935</span> │ <span style="color: #008000; text-decoration-color: #008000">SA11AI_81991189</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1217152</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>     │ <span style="color: #008000; text-decoration-color: #008000">EARMARKED FOR DCCC (C00000935)                                 </span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4050820181544768506</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │                  <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>        │     <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>               │       <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                               │                   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└───────────┴────────┴────────┴────────┴────────────────────┴────────┴────────┴───────────────────┴──────────────┴────────┴───────────┴───────────────────┴─────────────────────────┴──────────┴───────┴───────────┴─────────────────┴─────────┴──────────┴─────────────────────────────────────────────────────────────────┴─────────────────────┘
</pre>
</div>
</div>
<div id="d2a81789" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For a more comprehesive description of the columns and their meaning, see</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.fec.gov/campaign-finance-data/contributions-individuals-file-description/</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> {</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CMTE_ID"</span>: <span class="st">"keep"</span>,  <span class="co"># Committee ID</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"AMNDT_IND"</span>: <span class="st">"drop"</span>,  <span class="co"># Amendment indicator. A = amendment, N = new, T = termination</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"RPT_TP"</span>: <span class="st">"drop"</span>,  <span class="co"># Report type (monthly, quarterly, etc)</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"TRANSACTION_PGI"</span>: <span class="st">"keep"</span>,  <span class="co"># Primary/general indicator</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"IMAGE_NUM"</span>: <span class="st">"drop"</span>,  <span class="co"># Image number</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"TRANSACTION_TP"</span>: <span class="st">"drop"</span>,  <span class="co"># Transaction type</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ENTITY_TP"</span>: <span class="st">"keep"</span>,  <span class="co"># Entity type</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"NAME"</span>: <span class="st">"drop"</span>,  <span class="co"># Contributor name</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CITY"</span>: <span class="st">"keep"</span>,  <span class="co"># Contributor city</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"STATE"</span>: <span class="st">"keep"</span>,  <span class="co"># Contributor state</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ZIP_CODE"</span>: <span class="st">"drop"</span>,  <span class="co"># Contributor zip code</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"EMPLOYER"</span>: <span class="st">"drop"</span>,  <span class="co"># Contributor employer</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OCCUPATION"</span>: <span class="st">"drop"</span>,  <span class="co"># Contributor occupation</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"TRANSACTION_DT"</span>: <span class="st">"keep"</span>,  <span class="co"># Transaction date</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"TRANSACTION_AMT"</span>: <span class="st">"keep"</span>,  <span class="co"># Transaction amount</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Other ID. For individual contributions will be null. For contributions from</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># other FEC committees, will be the committee ID of the other committee.</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OTHER_ID"</span>: <span class="st">"drop"</span>,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"TRAN_ID"</span>: <span class="st">"drop"</span>,  <span class="co"># Transaction ID</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"FILE_NUM"</span>: <span class="st">"drop"</span>,  <span class="co"># File number, unique number assigned to each report filed with the FEC</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"MEMO_CD"</span>: <span class="st">"drop"</span>,  <span class="co"># Memo code</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"MEMO_TEXT"</span>: <span class="st">"drop"</span>,  <span class="co"># Memo text</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SUB_ID"</span>: <span class="st">"drop"</span>,  <span class="co"># Submission ID. Unique number assigned to each transaction.</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>renaming <span class="op">=</span> {old: new <span class="cf">for</span> old, new <span class="kw">in</span> <span class="bu">zip</span>(raw.columns, columns.keys())}</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>to_keep <span class="op">=</span> [k <span class="cf">for</span> k, v <span class="kw">in</span> columns.items() <span class="cf">if</span> v <span class="op">==</span> <span class="st">"keep"</span>]</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>kept <span class="op">=</span> raw.relabel(renaming)[to_keep]</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>kept</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> CMTE_ID   </span>┃<span style="font-weight: bold"> TRANSACTION_PGI </span>┃<span style="font-weight: bold"> ENTITY_TP </span>┃<span style="font-weight: bold"> CITY         </span>┃<span style="font-weight: bold"> STATE  </span>┃<span style="font-weight: bold"> TRANSACTION_DT </span>┃<span style="font-weight: bold"> TRANSACTION_AMT </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>           │
├───────────┼─────────────────┼───────────┼──────────────┼────────┼────────────────┼─────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">OCOEE       </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │ <span style="color: #008000; text-decoration-color: #008000">05182017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">OCOEE       </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │ <span style="color: #008000; text-decoration-color: #008000">05192017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">15</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">05132017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">35</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">05152017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">35</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">05192017      </span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">05242017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">15</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">05292017      </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">100</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">05302017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">35</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">ANNA MSRIA  </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │ <span style="color: #008000; text-decoration-color: #008000">05162017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">25</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">ANNA MSRIA  </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │ <span style="color: #008000; text-decoration-color: #008000">05232017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">25</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>              │               <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└───────────┴─────────────────┴───────────┴──────────────┴────────┴────────────────┴─────────────────┘
</pre>
</div>
</div>
<div id="1e6d16fe" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 21 million rows</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>kept.count()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div class="ansi-escaped-output">
<pre><span class="ansi-cyan-fg ansi-bold">21730730</span></pre>
</div>
</div>
</div>
<p>Huh, what’s up with those timings? Previewing the head only took a fraction of a second, but finding the number of rows took 10 seconds.</p>
<p>That’s because duckdb is scanning the .csv file on the fly every time we access it. So we only have to read the first few lines to get that preview, but we have to read the whole file to get the number of rows.</p>
<p>Note that this isn’t a feature of Ibis, but a feature of Duckdb. This what I think is one of the strengths of Ibis: Ibis itself doesn’t have to implement any of the optimimizations or features of the backends. Those backends can focus on what they do best, and Ibis can get those things for free.</p>
<p>So, let’s tell duckdb to actually read in the file to its native format so later accesses will be faster. This will be a ~20 seconds that we’ll only have to pay once.</p>
<div id="185a2d89" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>kept <span class="op">=</span> kept.cache()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>kept</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> CMTE_ID   </span>┃<span style="font-weight: bold"> TRANSACTION_PGI </span>┃<span style="font-weight: bold"> ENTITY_TP </span>┃<span style="font-weight: bold"> CITY         </span>┃<span style="font-weight: bold"> STATE  </span>┃<span style="font-weight: bold"> TRANSACTION_DT </span>┃<span style="font-weight: bold"> TRANSACTION_AMT </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>           │
├───────────┼─────────────────┼───────────┼──────────────┼────────┼────────────────┼─────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">OCOEE       </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │ <span style="color: #008000; text-decoration-color: #008000">05182017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">OCOEE       </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │ <span style="color: #008000; text-decoration-color: #008000">05192017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">15</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">05132017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">35</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">05152017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">35</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">05192017      </span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">05242017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">15</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">05292017      </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">100</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">CAPE NEDDICK</span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">05302017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">35</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">ANNA MSRIA  </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │ <span style="color: #008000; text-decoration-color: #008000">05162017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">25</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00401224</span> │ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">ANNA MSRIA  </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │ <span style="color: #008000; text-decoration-color: #008000">05232017      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">25</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>            │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>              │               <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└───────────┴─────────────────┴───────────┴──────────────┴────────┴────────────────┴─────────────────┘
</pre>
</div>
</div>
<p>Look, now accessing it only takes a fraction of a second!</p>
<div id="9253e73f" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>kept.count()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div class="ansi-escaped-output">
<pre><span class="ansi-cyan-fg ansi-bold">21730730</span></pre>
</div>
</div>
</div>
<section id="committees-data" class="level3">
<h3 class="anchored" data-anchor-id="committees-data">Committees Data</h3>
<p>The contributions only list an opaque <code>CMTE_ID</code> column. We want to know which actual committee this is. Let’s load the committees table so we can lookup from committee ID to committee name.</p>
<div id="30076e2c" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_committees():</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    committees_url <span class="op">=</span> <span class="st">"https://cg-519a459a-0ea3-42c2-b7bc-fa1143481f74.s3-us-gov-west-1.amazonaws.com/bulk-downloads/2018/committee_summary_2018.csv"</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This just creates a view, it doesn't actually fetch the data yet</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    tmp <span class="op">=</span> ibis.read_csv(committees_url)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    tmp <span class="op">=</span> tmp[<span class="st">"CMTE_ID"</span>, <span class="st">"CMTE_NM"</span>]</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The raw table contains multiple rows for each committee id, so lets pick</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># an arbitrary row for each committee id as the representative name.</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    deduped <span class="op">=</span> tmp.group_by(<span class="st">"CMTE_ID"</span>).agg(CMTE_NM<span class="op">=</span>_.CMTE_NM.arbitrary())</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> deduped</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>comms <span class="op">=</span> read_committees().cache()</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>comms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> CMTE_ID   </span>┃<span style="font-weight: bold"> CMTE_NM                                                        </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                                         │
├───────────┼────────────────────────────────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">C00659441</span> │ <span style="color: #008000; text-decoration-color: #008000">JASON ORTITAY FOR CONGRESS                                    </span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00661249</span> │ <span style="color: #008000; text-decoration-color: #008000">SERVICE AFTER SERVICE                                         </span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00457754</span> │ <span style="color: #008000; text-decoration-color: #008000">U.S. TRAVEL ASSOCIATION PAC                                   </span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00577635</span> │ <span style="color: #008000; text-decoration-color: #008000">ISAKSON VICTORY COMMITTEE                                     </span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00297911</span> │ <span style="color: #008000; text-decoration-color: #008000">TEXAS FORESTRY ASSOCIATION FORESTRY POLITICAL ACTION COMMITTEE</span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00551382</span> │ <span style="color: #008000; text-decoration-color: #008000">VOTECLIMATE.US PAC                                            </span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00414318</span> │ <span style="color: #008000; text-decoration-color: #008000">LOEBSACK FOR CONGRESS                                         </span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00610709</span> │ <span style="color: #008000; text-decoration-color: #008000">AUSTIN INNOVATION 2016                                        </span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00131607</span> │ <span style="color: #008000; text-decoration-color: #008000">FLORIDA CITRUS MUTUAL POLITCAL ACTION COMMITTEE               </span> │
│ <span style="color: #008000; text-decoration-color: #008000">C00136531</span> │ <span style="color: #008000; text-decoration-color: #008000">NATIONAL DEMOCRATIC POLICY COMMITTEE                          </span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                              │
└───────────┴────────────────────────────────────────────────────────────────┘
</pre>
</div>
</div>
<p>Now add the committee name to the contributions table:</p>
<div id="0a9f3b35" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>together <span class="op">=</span> kept.left_join(comms, <span class="st">"CMTE_ID"</span>).drop(<span class="st">"CMTE_ID"</span>, <span class="st">"CMTE_ID_right"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>together</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> TRANSACTION_PGI </span>┃<span style="font-weight: bold"> ENTITY_TP </span>┃<span style="font-weight: bold"> CITY             </span>┃<span style="font-weight: bold"> STATE  </span>┃<span style="font-weight: bold"> TRANSACTION_DT </span>┃<span style="font-weight: bold"> TRANSACTION_AMT </span>┃<span style="font-weight: bold"> CMTE_NM                                         </span>┃
┡━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                          │
├─────────────────┼───────────┼──────────────────┼────────┼────────────────┼─────────────────┼─────────────────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">COHASSET        </span> │ <span style="color: #008000; text-decoration-color: #008000">MA    </span> │ <span style="color: #008000; text-decoration-color: #008000">01312017      </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">230</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">KEY LARGO       </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │ <span style="color: #008000; text-decoration-color: #008000">01042017      </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5000</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">LOOKOUT MOUNTAIN</span> │ <span style="color: #008000; text-decoration-color: #008000">GA    </span> │ <span style="color: #008000; text-decoration-color: #008000">01312017      </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">230</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">NORTH YARMOUTH  </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">01312017      </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">ALPHARETTA      </span> │ <span style="color: #008000; text-decoration-color: #008000">GA    </span> │ <span style="color: #008000; text-decoration-color: #008000">01312017      </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">FALMOUTH        </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">01312017      </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">FALMOUTH        </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">01312017      </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">HOLLIS CENTER   </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">01312017      </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">FALMOUTH        </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │ <span style="color: #008000; text-decoration-color: #008000">01312017      </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │ <span style="color: #008000; text-decoration-color: #008000">ALEXANDRIA      </span> │ <span style="color: #008000; text-decoration-color: #008000">VA    </span> │ <span style="color: #008000; text-decoration-color: #008000">01312017      </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>              │               <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                               │
└─────────────────┴───────────┴──────────────────┴────────┴────────────────┴─────────────────┴─────────────────────────────────────────────────┘
</pre>
</div>
</div>
</section>
</section>
<section id="cleaning" class="level2">
<h2 class="anchored" data-anchor-id="cleaning">Cleaning</h2>
<p>First, let’s drop any contributions that don’t have a committee name. There are only 6 of them.</p>
<div id="14ae871f" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We can do this fearlessly, no .copy() needed, because</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># everything in Ibis is immutable. If we did this in pandas,</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># we might start modifying the original DataFrame accidentally!</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>cleaned <span class="op">=</span> together</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>has_name <span class="op">=</span> cleaned.CMTE_NM.notnull()</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>cleaned <span class="op">=</span> cleaned[has_name]</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>has_name.value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> NotNull(CMTE_NM) </span>┃<span style="font-weight: bold"> NotNull(CMTE_NM)_count </span>┃
┡━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">boolean</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>                  │
├──────────────────┼────────────────────────┤
│ True             │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21730724</span> │
│ False            │                      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6</span> │
└──────────────────┴────────────────────────┘
</pre>
</div>
</div>
<p>Let’s look at the <code>ENTITY_TP</code> column. This represents the type of entity that made the contribution:</p>
<div id="72577ed8" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>together.ENTITY_TP.value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> ENTITY_TP </span>┃<span style="font-weight: bold"> ENTITY_TP_count </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>           │
├───────────┼─────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">IND      </span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21687992</span> │
│ <span style="color: #008000; text-decoration-color: #008000">CCM      </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">698</span> │
│ <span style="color: #008000; text-decoration-color: #008000">CAN      </span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">13659</span> │
│ <span style="color: #008000; text-decoration-color: #008000">ORG      </span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18555</span> │
│ <span style="color: #008000; text-decoration-color: #008000">PTY      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">49</span> │
│ <span style="color: #008000; text-decoration-color: #008000">COM      </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">867</span> │
│ <span style="color: #008000; text-decoration-color: #008000">PAC      </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3621</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>      │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5289</span> │
└───────────┴─────────────────┘
</pre>
</div>
</div>
<p>We only care about contributions from individuals.</p>
<p>Once we filter on this column, the contents of it are irrelevant, so let’s drop it.</p>
<div id="f29924a2" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>cleaned <span class="op">=</span> together[_.ENTITY_TP <span class="op">==</span> <span class="st">"IND"</span>].drop(<span class="st">"ENTITY_TP"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It looks like the <code>TRANSACTION_DT</code> column was a raw string like “MMDDYYYY”, so let’s convert that to a proper date type.</p>
<div id="15443483" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ibis.expr.types <span class="im">import</span> StringValue, DateValue</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mmddyyyy_to_date(val: StringValue) <span class="op">-&gt;</span> DateValue:</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> val.cast(<span class="bu">str</span>).lpad(<span class="dv">8</span>, <span class="st">"0"</span>).to_timestamp(<span class="st">"%m</span><span class="sc">%d</span><span class="st">%Y"</span>).date()</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>cleaned <span class="op">=</span> cleaned.mutate(date<span class="op">=</span>mmddyyyy_to_date(_.TRANSACTION_DT)).drop(<span class="st">"TRANSACTION_DT"</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>cleaned</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> TRANSACTION_PGI </span>┃<span style="font-weight: bold"> CITY             </span>┃<span style="font-weight: bold"> STATE  </span>┃<span style="font-weight: bold"> TRANSACTION_AMT </span>┃<span style="font-weight: bold"> CMTE_NM                                         </span>┃<span style="font-weight: bold"> date       </span>┃
┡━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">date</span>       │
├─────────────────┼──────────────────┼────────┼─────────────────┼─────────────────────────────────────────────────┼────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">COHASSET        </span> │ <span style="color: #008000; text-decoration-color: #008000">MA    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">230</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">KEY LARGO       </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5000</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-04</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">LOOKOUT MOUNTAIN</span> │ <span style="color: #008000; text-decoration-color: #008000">GA    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">230</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">NORTH YARMOUTH  </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">ALPHARETTA      </span> │ <span style="color: #008000; text-decoration-color: #008000">GA    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">FALMOUTH        </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">FALMOUTH        </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">HOLLIS CENTER   </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">FALMOUTH        </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │ <span style="color: #008000; text-decoration-color: #008000">ALEXANDRIA      </span> │ <span style="color: #008000; text-decoration-color: #008000">VA    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │               <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>          │
└─────────────────┴──────────────────┴────────┴─────────────────┴─────────────────────────────────────────────────┴────────────┘
</pre>
</div>
</div>
<p>The <code>TRANSACTION_PGI</code> column represents the type (primary, general, etc) of election, and the year. But it seems to be not very consistent:</p>
<div id="fa016097" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>cleaned.TRANSACTION_PGI.topk(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> TRANSACTION_PGI </span>┃<span style="font-weight: bold"> Count(TRANSACTION_PGI) </span>┃
┡━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>                  │
├─────────────────┼────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">P              </span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">17013596</span> │
│ <span style="color: #008000; text-decoration-color: #008000">G2018          </span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2095123</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P2018          </span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1677183</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P2020          </span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">208501</span> │
│ <span style="color: #008000; text-decoration-color: #008000">O2018          </span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">161874</span> │
│ <span style="color: #008000; text-decoration-color: #008000">S2017          </span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">124336</span> │
│ <span style="color: #008000; text-decoration-color: #008000">G2017          </span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">98401</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P2022          </span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">91136</span> │
│ <span style="color: #008000; text-decoration-color: #008000">P2017          </span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">61153</span> │
│ <span style="color: #008000; text-decoration-color: #008000">R2017          </span> │                  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">54281</span> │
└─────────────────┴────────────────────────┘
</pre>
</div>
</div>
<div id="35c8a393" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_election_type(pgi: StringValue) <span class="op">-&gt;</span> StringValue:</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Use the first letter of the TRANSACTION_PGI column to determine the election type</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">    If the first letter is not one of the known election stage, then return null.</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    election_types <span class="op">=</span> {</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"P"</span>: <span class="st">"primary"</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"G"</span>: <span class="st">"general"</span>,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"O"</span>: <span class="st">"other"</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"C"</span>: <span class="st">"convention"</span>,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"R"</span>: <span class="st">"runoff"</span>,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"S"</span>: <span class="st">"special"</span>,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"E"</span>: <span class="st">"recount"</span>,</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    first_letter <span class="op">=</span> pgi[<span class="dv">0</span>]</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> first_letter.substitute(election_types, else_<span class="op">=</span>ibis.NA)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>cleaned <span class="op">=</span> cleaned.mutate(election_type<span class="op">=</span>get_election_type(_.TRANSACTION_PGI)).drop(</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"TRANSACTION_PGI"</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>cleaned</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> CITY             </span>┃<span style="font-weight: bold"> STATE  </span>┃<span style="font-weight: bold"> TRANSACTION_AMT </span>┃<span style="font-weight: bold"> CMTE_NM                                         </span>┃<span style="font-weight: bold"> date       </span>┃<span style="font-weight: bold"> election_type </span>┃
┡━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">date</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>        │
├──────────────────┼────────┼─────────────────┼─────────────────────────────────────────────────┼────────────┼───────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">COHASSET        </span> │ <span style="color: #008000; text-decoration-color: #008000">MA    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">230</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">KEY LARGO       </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5000</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-04</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">LOOKOUT MOUNTAIN</span> │ <span style="color: #008000; text-decoration-color: #008000">GA    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">230</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">NORTH YARMOUTH  </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">ALPHARETTA      </span> │ <span style="color: #008000; text-decoration-color: #008000">GA    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">FALMOUTH        </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">FALMOUTH        </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">HOLLIS CENTER   </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">FALMOUTH        </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">ALEXANDRIA      </span> │ <span style="color: #008000; text-decoration-color: #008000">VA    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │               <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>             │
└──────────────────┴────────┴─────────────────┴─────────────────────────────────────────────────┴────────────┴───────────────┘
</pre>
</div>
</div>
<p>That worked well! There are 0 nulls in the resulting column, so we always were able to determine the election type.</p>
<div id="e7038c36" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>cleaned.election_type.topk(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> election_type </span>┃<span style="font-weight: bold"> Count(election_type) </span>┃
┡━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>                │
├───────────────┼──────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">19061953</span> │
│ <span style="color: #008000; text-decoration-color: #008000">general      </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2216685</span> │
│ <span style="color: #008000; text-decoration-color: #008000">other        </span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">161965</span> │
│ <span style="color: #008000; text-decoration-color: #008000">special      </span> │               <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">149572</span> │
│ <span style="color: #008000; text-decoration-color: #008000">runoff       </span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">69637</span> │
│ <span style="color: #008000; text-decoration-color: #008000">convention   </span> │                <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">22453</span> │
│ <span style="color: #008000; text-decoration-color: #008000">recount      </span> │                 <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5063</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>          │                    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> │
└───────────────┴──────────────────────┘
</pre>
</div>
</div>
<p>About 1/20 of transactions are negative. These could represent refunds, or they could be data entry errors. Let’s drop them to keep it simple.</p>
<div id="ab64b9b2" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>above_zero <span class="op">=</span> cleaned.TRANSACTION_AMT <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>cleaned <span class="op">=</span> cleaned[above_zero]</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>above_zero.value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> Greater(TRANSACTION_AMT, 0) </span>┃<span style="font-weight: bold"> Greater(TRANSACTION_AMT, 0)_count </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">boolean</span>                     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>                             │
├─────────────────────────────┼───────────────────────────────────┤
│ True                        │                          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20669809</span> │
│ False                       │                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1018183</span> │
└─────────────────────────────┴───────────────────────────────────┘
</pre>
</div>
</div>
</section>
<section id="adding-features" class="level2">
<h2 class="anchored" data-anchor-id="adding-features">Adding Features</h2>
<p>Now that the data is cleaned up to a usable format, let’s add some features.</p>
<p>First, it’s useful to categorize donations by size, placing them into buckets of small, medium, large, etc.</p>
<div id="db1e9cbe" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>edges <span class="op">=</span> [</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="dv">10</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">50</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">100</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">500</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1000</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="dv">5000</span>,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> [</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"&lt;10"</span>,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"10-50"</span>,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"50-100"</span>,</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"100-500"</span>,</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"500-1000"</span>,</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"1000-5000"</span>,</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"5000+"</span>,</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> bucketize(vals, edges, str_labels):</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Uses Ibis's .bucket() method to create a categorical column</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    int_labels <span class="op">=</span> vals.bucket(edges, include_under<span class="op">=</span><span class="va">True</span>, include_over<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Map the integer labels to the string labels</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    int_to_str <span class="op">=</span> {<span class="bu">str</span>(i): s <span class="cf">for</span> i, s <span class="kw">in</span> <span class="bu">enumerate</span>(str_labels)}</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> int_labels.cast(<span class="bu">str</span>).substitute(int_to_str)</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>featured <span class="op">=</span> cleaned.mutate(amount_bucket<span class="op">=</span>bucketize(_.TRANSACTION_AMT, edges, labels))</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>featured</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> CITY             </span>┃<span style="font-weight: bold"> STATE  </span>┃<span style="font-weight: bold"> TRANSACTION_AMT </span>┃<span style="font-weight: bold"> CMTE_NM                                         </span>┃<span style="font-weight: bold"> date       </span>┃<span style="font-weight: bold"> election_type </span>┃<span style="font-weight: bold"> amount_bucket </span>┃
┡━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">date</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>        │
├──────────────────┼────────┼─────────────────┼─────────────────────────────────────────────────┼────────────┼───────────────┼───────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">COHASSET        </span> │ <span style="color: #008000; text-decoration-color: #008000">MA    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">230</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">100-500      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">KEY LARGO       </span> │ <span style="color: #008000; text-decoration-color: #008000">FL    </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5000</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-04</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">1000-5000    </span> │
│ <span style="color: #008000; text-decoration-color: #008000">LOOKOUT MOUNTAIN</span> │ <span style="color: #008000; text-decoration-color: #008000">GA    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">230</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">100-500      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">NORTH YARMOUTH  </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">100-500      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">ALPHARETTA      </span> │ <span style="color: #008000; text-decoration-color: #008000">GA    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">100-500      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">FALMOUTH        </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">100-500      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">FALMOUTH        </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">100-500      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">HOLLIS CENTER   </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">100-500      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">FALMOUTH        </span> │ <span style="color: #008000; text-decoration-color: #008000">ME    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">100-500      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">ALEXANDRIA      </span> │ <span style="color: #008000; text-decoration-color: #008000">VA    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">384</span> │ <span style="color: #008000; text-decoration-color: #008000">UNUM GROUP POLITICAL ACTION COMMITTEE (UNUMPAC)</span> │ <span style="color: #800080; text-decoration-color: #800080">2017-01-31</span> │ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">100-500      </span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>      │               <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>             │
└──────────────────┴────────┴─────────────────┴─────────────────────────────────────────────────┴────────────┴───────────────┴───────────────┘
</pre>
</div>
</div>
</section>
<section id="analysis" class="level2">
<h2 class="anchored" data-anchor-id="analysis">Analysis</h2>
<section id="by-donation-size" class="level3">
<h3 class="anchored" data-anchor-id="by-donation-size">By donation size</h3>
<p>One thing we can look at is the donation breakdown by size: - Are most donations small or large? - Where do politicians/committees get most of their money from? Large or small donations?</p>
<p>We also will compare performance of Ibis vs pandas during this groupby.</p>
<div id="2c306d0f" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> summary_by(table, by):</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> table.group_by(by).agg(</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>        n_donations<span class="op">=</span>_.count(),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>        total_amount<span class="op">=</span>_.TRANSACTION_AMT.<span class="bu">sum</span>(),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>        mean_amount<span class="op">=</span>_.TRANSACTION_AMT.mean(),</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>        median_amount<span class="op">=</span>_.TRANSACTION_AMT.approx_median(),</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> summary_by_pandas(df, by):</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df.groupby(by, as_index<span class="op">=</span><span class="va">False</span>).agg(</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>        n_donations<span class="op">=</span>(<span class="st">"election_type"</span>, <span class="st">"count"</span>),</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        total_amount<span class="op">=</span>(<span class="st">"TRANSACTION_AMT"</span>, <span class="st">"sum"</span>),</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>        mean_amount<span class="op">=</span>(<span class="st">"TRANSACTION_AMT"</span>, <span class="st">"mean"</span>),</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>        median_amount<span class="op">=</span>(<span class="st">"TRANSACTION_AMT"</span>, <span class="st">"median"</span>),</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="co"># persist the input data so the following timings of the group_by are accurate.</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>subset <span class="op">=</span> featured[<span class="st">"election_type"</span>, <span class="st">"amount_bucket"</span>, <span class="st">"TRANSACTION_AMT"</span>]</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>subset <span class="op">=</span> subset.cache()</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>pandas_subset <span class="op">=</span> subset.execute()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s take a look at what we are actually computing:</p>
<div id="a621ca5f" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>by_type_and_bucket <span class="op">=</span> summary_by(subset, [<span class="st">"election_type"</span>, <span class="st">"amount_bucket"</span>])</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>by_type_and_bucket</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> election_type </span>┃<span style="font-weight: bold"> amount_bucket </span>┃<span style="font-weight: bold"> n_donations </span>┃<span style="font-weight: bold"> total_amount </span>┃<span style="font-weight: bold"> mean_amount  </span>┃<span style="font-weight: bold"> median_amount </span>┃
┡━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>         │
├───────────────┼───────────────┼─────────────┼──────────────┼──────────────┼───────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">50-100       </span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2663933</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">155426540</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">58.344763</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">50</span> │
│ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">10-50        </span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">8115403</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">187666251</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">23.124699</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">25</span> │
│ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">100-500      </span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3636287</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">637353634</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">175.275943</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">150</span> │
│ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">&lt;10          </span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2423728</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10080721</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.159180</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span> │
│ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">500-1000     </span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">634677</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">334630687</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">527.245649</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">500</span> │
│ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">1000-5000    </span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">684755</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1231394874</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1798.299938</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1008</span> │
│ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">5000+        </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">44085</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1558371116</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">35349.237065</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10000</span> │
│ <span style="color: #008000; text-decoration-color: #008000">general      </span> │ <span style="color: #008000; text-decoration-color: #008000">100-500      </span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">700821</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">123174568</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">175.757530</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">150</span> │
│ <span style="color: #008000; text-decoration-color: #008000">general      </span> │ <span style="color: #008000; text-decoration-color: #008000">50-100       </span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">304363</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">16184312</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">53.174374</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">50</span> │
│ <span style="color: #008000; text-decoration-color: #008000">general      </span> │ <span style="color: #008000; text-decoration-color: #008000">10-50        </span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">660787</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">14411588</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">21.809733</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">25</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>             │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │            <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │            <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└───────────────┴───────────────┴─────────────┴──────────────┴──────────────┴───────────────┘
</pre>
</div>
</div>
<p>OK, now let’s do our timings.</p>
<p>One interesting thing to pay attention to here is the execution time for the following groupby. Before, we could get away with lazy execution: because we only wanted to preview the first few rows, we only had to compute the first few rows, so all our previews were very fast.</p>
<p>But now, as soon as we do a groupby, we have to actually go through the whole dataset in order to compute the aggregate per group. So this is going to be slower. BUT, duckdb is still quite fast. It only takes milliseconds to groupby-agg all 20 million rows!</p>
<div id="fc3694c3" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit summary_by(subset, [<span class="st">"election_type"</span>, <span class="st">"amount_bucket"</span>]).execute()  <span class="co"># .execute() so we actually fetch the data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>679 ms ± 11.6 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)</code></pre>
</div>
</div>
<p>Now let’s try the same thing in pandas:</p>
<div id="ab990661" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit summary_by_pandas(pandas_subset, [<span class="st">"election_type"</span>, <span class="st">"amount_bucket"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>3.59 s ± 31.3 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)</code></pre>
</div>
</div>
<p>It takes about 4 seconds, which is about 10 times slower than duckdb. At this scale, it again doesn’t matter, but you could imagine with a dataset much larger than this, it would matter.</p>
<p>Let’s also think about memory usage:</p>
<div id="03834f0b" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>pandas_subset.memory_usage(deep<span class="op">=</span><span class="va">True</span>).<span class="bu">sum</span>() <span class="op">/</span> <span class="fl">1e9</span>  <span class="co"># GB</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>2.782586663</code></pre>
</div>
</div>
<p>The source dataframe is couple gigabytes, so probably during the groupby, the peak memory usage is going to be a bit higher than this. You could use a profiler such as <a href="https://github.com/pythonspeed/filprofiler">FIL</a> if you wanted an exact number, I was too lazy to use that here.</p>
<p>Again, this works on my laptop at this dataset size, but much larger than this and I’d start having problems. Duckdb on the other hand is designed around working out of core so it should scale to datasets into the hundreds of gigabytes, much larger than your computer’s RAM.</p>
</section>
<section id="back-to-analysis" class="level3">
<h3 class="anchored" data-anchor-id="back-to-analysis">Back to analysis</h3>
<p>OK, let’s plot the result of that groupby.</p>
<p>Surprise! (Or maybe not…) Most donations are small. But most of the money comes from donations larger than $1000.</p>
<p>Well if that’s the case, why do politicians spend so much time soliciting small donations? One explanation is that they can use the number of donations as a marketing pitch, to show how popular they are, and thus how viable of a candidate they are.</p>
<p>This also might explain whose interests are being served by our politicians.</p>
<div id="cf2c035e" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> altair <span class="im">as</span> alt</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Do some bookkeeping so the buckets are displayed smallest to largest on the charts</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>bucket_col <span class="op">=</span> alt.Column(<span class="st">"amount_bucket:N"</span>, sort<span class="op">=</span>labels)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>n_by_bucket <span class="op">=</span> (</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    alt.Chart(by_type_and_bucket.execute())</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    .mark_bar()</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    .encode(</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>bucket_col,</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">"n_donations:Q"</span>,</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">"election_type:N"</span>,</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>total_by_bucket <span class="op">=</span> (</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    alt.Chart(by_type_and_bucket.execute())</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>    .mark_bar()</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    .encode(</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>bucket_col,</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">"total_amount:Q"</span>,</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">"election_type:N"</span>,</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>n_by_bucket <span class="op">|</span> total_by_bucket</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">

<style>
  #altair-viz-86646cc3a2964613b7509f2dcc47f742.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-86646cc3a2964613b7509f2dcc47f742.vega-embed details,
  #altair-viz-86646cc3a2964613b7509f2dcc47f742.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-86646cc3a2964613b7509f2dcc47f742"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-86646cc3a2964613b7509f2dcc47f742") {
      outputDiv = document.getElementById("altair-viz-86646cc3a2964613b7509f2dcc47f742");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.8.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "hconcat": [{"data": {"name": "data-7df486c18103705f447413da2d200c84"}, "mark": {"type": "bar"}, "encoding": {"color": {"field": "election_type", "type": "nominal"}, "x": {"field": "amount_bucket", "sort": ["<10", "10-50", "50-100", "100-500", "500-1000", "1000-5000", "5000+"], "type": "nominal"}, "y": {"field": "n_donations", "type": "quantitative"}}}, {"data": {"name": "data-334b351fcf36268adfd9e34181060327"}, "mark": {"type": "bar"}, "encoding": {"color": {"field": "election_type", "type": "nominal"}, "x": {"field": "amount_bucket", "sort": ["<10", "10-50", "50-100", "100-500", "500-1000", "1000-5000", "5000+"], "type": "nominal"}, "y": {"field": "total_amount", "type": "quantitative"}}}], "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json", "datasets": {"data-7df486c18103705f447413da2d200c84": [{"election_type": "primary", "amount_bucket": "<10", "n_donations": 2423728, "total_amount": 10080721, "mean_amount": 4.159179990493983, "median_amount": 5}, {"election_type": "primary", "amount_bucket": "10-50", "n_donations": 8115403, "total_amount": 187666251, "mean_amount": 23.12469892129818, "median_amount": 25}, {"election_type": "primary", "amount_bucket": "100-500", "n_donations": 3636287, "total_amount": 637353634, "mean_amount": 175.27594329050484, "median_amount": 150}, {"election_type": "primary", "amount_bucket": "50-100", "n_donations": 2663933, "total_amount": 155426540, "mean_amount": 58.34476317535013, "median_amount": 50}, {"election_type": "primary", "amount_bucket": "5000+", "n_donations": 44085, "total_amount": 1558371116, "mean_amount": 35349.237064761255, "median_amount": 10000}, {"election_type": "primary", "amount_bucket": "1000-5000", "n_donations": 684755, "total_amount": 1231394874, "mean_amount": 1798.2999379340056, "median_amount": 1008}, {"election_type": "general", "amount_bucket": "100-500", "n_donations": 700821, "total_amount": 123174568, "mean_amount": 175.75753009684357, "median_amount": 149}, {"election_type": "primary", "amount_bucket": "500-1000", "n_donations": 634677, "total_amount": 334630687, "mean_amount": 527.2456493618014, "median_amount": 500}, {"election_type": "general", "amount_bucket": "1000-5000", "n_donations": 246101, "total_amount": 460025242, "mean_amount": 1869.2538510611496, "median_amount": 1959}, {"election_type": "general", "amount_bucket": "10-50", "n_donations": 660787, "total_amount": 14411588, "mean_amount": 21.809732939661345, "median_amount": 25}, {"election_type": "general", "amount_bucket": "50-100", "n_donations": 304363, "total_amount": 16184312, "mean_amount": 53.174374020495264, "median_amount": 50}, {"election_type": "general", "amount_bucket": "500-1000", "n_donations": 174182, "total_amount": 91015697, "mean_amount": 522.5321617618354, "median_amount": 500}, {"election_type": "general", "amount_bucket": "<10", "n_donations": 115873, "total_amount": 536742, "mean_amount": 4.632157620843509, "median_amount": 5}, {"election_type": "runoff", "amount_bucket": "10-50", "n_donations": 20166, "total_amount": 461107, "mean_amount": 22.865565803828225, "median_amount": 25}, {"election_type": "runoff", "amount_bucket": "50-100", "n_donations": 11578, "total_amount": 585827, "mean_amount": 50.59828986007946, "median_amount": 50}, {"election_type": "runoff", "amount_bucket": "100-500", "n_donations": 18193, "total_amount": 3088289, "mean_amount": 169.75149782883526, "median_amount": 100}, {"election_type": "runoff", "amount_bucket": "500-1000", "n_donations": 4117, "total_amount": 2110393, "mean_amount": 512.6045664318679, "median_amount": 500}, {"election_type": "runoff", "amount_bucket": "1000-5000", "n_donations": 5196, "total_amount": 9601993, "mean_amount": 1847.958622016936, "median_amount": 1894}, {"election_type": "runoff", "amount_bucket": "<10", "n_donations": 10191, "total_amount": 49621, "mean_amount": 4.869100186439015, "median_amount": 5}, {"election_type": "special", "amount_bucket": "100-500", "n_donations": 34497, "total_amount": 5943498, "mean_amount": 172.29028611183583, "median_amount": 117}, {"election_type": "general", "amount_bucket": "5000+", "n_donations": 3125, "total_amount": 44496373, "mean_amount": 14238.83936, "median_amount": 7541}, {"election_type": "special", "amount_bucket": "5000+", "n_donations": 129, "total_amount": 788712, "mean_amount": 6114.046511627907, "median_amount": 5400}, {"election_type": "other", "amount_bucket": "500-1000", "n_donations": 119, "total_amount": 62535, "mean_amount": 525.5042016806723, "median_amount": 500}, {"election_type": "other", "amount_bucket": "100-500", "n_donations": 630, "total_amount": 117988, "mean_amount": 187.2825396825397, "median_amount": 192}, {"election_type": "other", "amount_bucket": "1000-5000", "n_donations": 235, "total_amount": 548212, "mean_amount": 2332.817021276596, "median_amount": 2633}, {"election_type": "other", "amount_bucket": "50-100", "n_donations": 451, "total_amount": 27149, "mean_amount": 60.19733924611973, "median_amount": 50}, {"election_type": "other", "amount_bucket": "10-50", "n_donations": 2644, "total_amount": 64297, "mean_amount": 24.318078668683814, "median_amount": 23}, {"election_type": "convention", "amount_bucket": "100-500", "n_donations": 6350, "total_amount": 1097843, "mean_amount": 172.88866141732282, "median_amount": 138}, {"election_type": "convention", "amount_bucket": "1000-5000", "n_donations": 2822, "total_amount": 4977314, "mean_amount": 1763.7540751240256, "median_amount": 1434}, {"election_type": "convention", "amount_bucket": "10-50", "n_donations": 6848, "total_amount": 141604, "mean_amount": 20.678154205607477, "median_amount": 25}, {"election_type": "convention", "amount_bucket": "500-1000", "n_donations": 1824, "total_amount": 945321, "mean_amount": 518.2680921052631, "median_amount": 500}, {"election_type": "convention", "amount_bucket": "50-100", "n_donations": 2966, "total_amount": 153281, "mean_amount": 51.67936614969656, "median_amount": 50}, {"election_type": "convention", "amount_bucket": "<10", "n_donations": 945, "total_amount": 4660, "mean_amount": 4.931216931216931, "median_amount": 5}, {"election_type": "other", "amount_bucket": "<10", "n_donations": 10993, "total_amount": 25816, "mean_amount": 2.3484035295187846, "median_amount": 1}, {"election_type": "special", "amount_bucket": "1000-5000", "n_donations": 7935, "total_amount": 13493154, "mean_amount": 1700.4604914933836, "median_amount": 1001}, {"election_type": "special", "amount_bucket": "50-100", "n_donations": 22859, "total_amount": 1177660, "mean_amount": 51.518439126820944, "median_amount": 50}, {"election_type": "special", "amount_bucket": "<10", "n_donations": 25115, "total_amount": 122898, "mean_amount": 4.893410312562214, "median_amount": 5}, {"election_type": "special", "amount_bucket": "10-50", "n_donations": 51066, "total_amount": 1134616, "mean_amount": 22.21861904202405, "median_amount": 25}, {"election_type": "special", "amount_bucket": "500-1000", "n_donations": 7811, "total_amount": 4003293, "mean_amount": 512.5199078223019, "median_amount": 500}, {"election_type": "runoff", "amount_bucket": "5000+", "n_donations": 37, "total_amount": 211400, "mean_amount": 5713.513513513513, "median_amount": 5400}, {"election_type": null, "amount_bucket": "1000-5000", "n_donations": 116, "total_amount": 228657, "mean_amount": 1971.1810344827586, "median_amount": 1300}, {"election_type": "recount", "amount_bucket": "5000+", "n_donations": 26, "total_amount": 1888024, "mean_amount": 72616.30769230769, "median_amount": 101450}, {"election_type": null, "amount_bucket": "5000+", "n_donations": 48, "total_amount": 1622455, "mean_amount": 33801.145833333336, "median_amount": 21731}, {"election_type": "recount", "amount_bucket": "100-500", "n_donations": 2232, "total_amount": 413753, "mean_amount": 185.37320788530465, "median_amount": 200}, {"election_type": "recount", "amount_bucket": "10-50", "n_donations": 883, "total_amount": 20860, "mean_amount": 23.62400906002265, "median_amount": 25}, {"election_type": "recount", "amount_bucket": "1000-5000", "n_donations": 589, "total_amount": 1113150, "mean_amount": 1889.8981324278438, "median_amount": 1965}, {"election_type": "recount", "amount_bucket": "500-1000", "n_donations": 494, "total_amount": 250960, "mean_amount": 508.0161943319838, "median_amount": 500}, {"election_type": "recount", "amount_bucket": "50-100", "n_donations": 712, "total_amount": 38450, "mean_amount": 54.002808988764045, "median_amount": 50}, {"election_type": "convention", "amount_bucket": "5000+", "n_donations": 219, "total_amount": 1590300, "mean_amount": 7261.643835616438, "median_amount": 8100}, {"election_type": null, "amount_bucket": "100-500", "n_donations": 195, "total_amount": 46746, "mean_amount": 239.72307692307692, "median_amount": 250}, {"election_type": null, "amount_bucket": "500-1000", "n_donations": 89, "total_amount": 48290, "mean_amount": 542.5842696629213, "median_amount": 500}, {"election_type": null, "amount_bucket": "50-100", "n_donations": 36, "total_amount": 1880, "mean_amount": 52.22222222222222, "median_amount": 50}, {"election_type": "recount", "amount_bucket": "<10", "n_donations": 110, "total_amount": 569, "mean_amount": 5.172727272727273, "median_amount": 5}, {"election_type": null, "amount_bucket": "10-50", "n_donations": 151, "total_amount": 3167, "mean_amount": 20.973509933774835, "median_amount": 25}, {"election_type": null, "amount_bucket": "<10", "n_donations": 24, "total_amount": 108, "mean_amount": 4.5, "median_amount": 5}, {"election_type": "other", "amount_bucket": "5000+", "n_donations": 48, "total_amount": 1901300, "mean_amount": 39610.416666666664, "median_amount": 16950}], "data-334b351fcf36268adfd9e34181060327": [{"election_type": "primary", "amount_bucket": "<10", "n_donations": 2423728, "total_amount": 10080721, "mean_amount": 4.159179990493983, "median_amount": 5}, {"election_type": "primary", "amount_bucket": "10-50", "n_donations": 8115403, "total_amount": 187666251, "mean_amount": 23.12469892129818, "median_amount": 25}, {"election_type": "primary", "amount_bucket": "100-500", "n_donations": 3636287, "total_amount": 637353634, "mean_amount": 175.27594329050484, "median_amount": 150}, {"election_type": "primary", "amount_bucket": "50-100", "n_donations": 2663933, "total_amount": 155426540, "mean_amount": 58.34476317535013, "median_amount": 50}, {"election_type": "primary", "amount_bucket": "5000+", "n_donations": 44085, "total_amount": 1558371116, "mean_amount": 35349.237064761255, "median_amount": 10000}, {"election_type": "primary", "amount_bucket": "1000-5000", "n_donations": 684755, "total_amount": 1231394874, "mean_amount": 1798.2999379340056, "median_amount": 1005}, {"election_type": "general", "amount_bucket": "100-500", "n_donations": 700821, "total_amount": 123174568, "mean_amount": 175.75753009684357, "median_amount": 150}, {"election_type": "primary", "amount_bucket": "500-1000", "n_donations": 634677, "total_amount": 334630687, "mean_amount": 527.2456493618014, "median_amount": 500}, {"election_type": "general", "amount_bucket": "1000-5000", "n_donations": 246101, "total_amount": 460025242, "mean_amount": 1869.2538510611496, "median_amount": 1946}, {"election_type": "general", "amount_bucket": "10-50", "n_donations": 660787, "total_amount": 14411588, "mean_amount": 21.809732939661345, "median_amount": 25}, {"election_type": "general", "amount_bucket": "50-100", "n_donations": 304363, "total_amount": 16184312, "mean_amount": 53.174374020495264, "median_amount": 50}, {"election_type": "general", "amount_bucket": "500-1000", "n_donations": 174182, "total_amount": 91015697, "mean_amount": 522.5321617618354, "median_amount": 500}, {"election_type": "general", "amount_bucket": "<10", "n_donations": 115873, "total_amount": 536742, "mean_amount": 4.632157620843509, "median_amount": 5}, {"election_type": "runoff", "amount_bucket": "10-50", "n_donations": 20166, "total_amount": 461107, "mean_amount": 22.865565803828225, "median_amount": 25}, {"election_type": "runoff", "amount_bucket": "50-100", "n_donations": 11578, "total_amount": 585827, "mean_amount": 50.59828986007946, "median_amount": 50}, {"election_type": "runoff", "amount_bucket": "100-500", "n_donations": 18193, "total_amount": 3088289, "mean_amount": 169.75149782883526, "median_amount": 100}, {"election_type": "runoff", "amount_bucket": "500-1000", "n_donations": 4117, "total_amount": 2110393, "mean_amount": 512.6045664318679, "median_amount": 500}, {"election_type": "runoff", "amount_bucket": "1000-5000", "n_donations": 5196, "total_amount": 9601993, "mean_amount": 1847.958622016936, "median_amount": 1901}, {"election_type": "runoff", "amount_bucket": "<10", "n_donations": 10191, "total_amount": 49621, "mean_amount": 4.869100186439015, "median_amount": 5}, {"election_type": "special", "amount_bucket": "100-500", "n_donations": 34497, "total_amount": 5943498, "mean_amount": 172.29028611183583, "median_amount": 118}, {"election_type": "general", "amount_bucket": "5000+", "n_donations": 3125, "total_amount": 44496373, "mean_amount": 14238.83936, "median_amount": 7528}, {"election_type": "special", "amount_bucket": "5000+", "n_donations": 129, "total_amount": 788712, "mean_amount": 6114.046511627907, "median_amount": 5400}, {"election_type": "special", "amount_bucket": "1000-5000", "n_donations": 7935, "total_amount": 13493154, "mean_amount": 1700.4604914933836, "median_amount": 1000}, {"election_type": "convention", "amount_bucket": "1000-5000", "n_donations": 2822, "total_amount": 4977314, "mean_amount": 1763.7540751240256, "median_amount": 1437}, {"election_type": "convention", "amount_bucket": "100-500", "n_donations": 6350, "total_amount": 1097843, "mean_amount": 172.88866141732282, "median_amount": 139}, {"election_type": "convention", "amount_bucket": "500-1000", "n_donations": 1824, "total_amount": 945321, "mean_amount": 518.2680921052631, "median_amount": 500}, {"election_type": "special", "amount_bucket": "10-50", "n_donations": 51066, "total_amount": 1134616, "mean_amount": 22.21861904202405, "median_amount": 25}, {"election_type": "special", "amount_bucket": "50-100", "n_donations": 22859, "total_amount": 1177660, "mean_amount": 51.518439126820944, "median_amount": 50}, {"election_type": "special", "amount_bucket": "500-1000", "n_donations": 7811, "total_amount": 4003293, "mean_amount": 512.5199078223019, "median_amount": 500}, {"election_type": "special", "amount_bucket": "<10", "n_donations": 25115, "total_amount": 122898, "mean_amount": 4.893410312562214, "median_amount": 5}, {"election_type": null, "amount_bucket": "1000-5000", "n_donations": 116, "total_amount": 228657, "mean_amount": 1971.1810344827586, "median_amount": 1300}, {"election_type": null, "amount_bucket": "5000+", "n_donations": 48, "total_amount": 1622455, "mean_amount": 33801.145833333336, "median_amount": 21731}, {"election_type": "convention", "amount_bucket": "10-50", "n_donations": 6848, "total_amount": 141604, "mean_amount": 20.678154205607477, "median_amount": 25}, {"election_type": "convention", "amount_bucket": "<10", "n_donations": 945, "total_amount": 4660, "mean_amount": 4.931216931216931, "median_amount": 5}, {"election_type": "convention", "amount_bucket": "50-100", "n_donations": 2966, "total_amount": 153281, "mean_amount": 51.67936614969656, "median_amount": 50}, {"election_type": "convention", "amount_bucket": "5000+", "n_donations": 219, "total_amount": 1590300, "mean_amount": 7261.643835616438, "median_amount": 8100}, {"election_type": "recount", "amount_bucket": "100-500", "n_donations": 2232, "total_amount": 413753, "mean_amount": 185.37320788530465, "median_amount": 200}, {"election_type": "recount", "amount_bucket": "10-50", "n_donations": 883, "total_amount": 20860, "mean_amount": 23.62400906002265, "median_amount": 25}, {"election_type": "recount", "amount_bucket": "1000-5000", "n_donations": 589, "total_amount": 1113150, "mean_amount": 1889.8981324278438, "median_amount": 1965}, {"election_type": "recount", "amount_bucket": "500-1000", "n_donations": 494, "total_amount": 250960, "mean_amount": 508.0161943319838, "median_amount": 500}, {"election_type": "recount", "amount_bucket": "50-100", "n_donations": 712, "total_amount": 38450, "mean_amount": 54.002808988764045, "median_amount": 50}, {"election_type": "recount", "amount_bucket": "<10", "n_donations": 110, "total_amount": 569, "mean_amount": 5.172727272727273, "median_amount": 5}, {"election_type": null, "amount_bucket": "100-500", "n_donations": 195, "total_amount": 46746, "mean_amount": 239.72307692307692, "median_amount": 250}, {"election_type": null, "amount_bucket": "500-1000", "n_donations": 89, "total_amount": 48290, "mean_amount": 542.5842696629213, "median_amount": 500}, {"election_type": "other", "amount_bucket": "10-50", "n_donations": 2644, "total_amount": 64297, "mean_amount": 24.318078668683814, "median_amount": 23}, {"election_type": "other", "amount_bucket": "50-100", "n_donations": 451, "total_amount": 27149, "mean_amount": 60.19733924611973, "median_amount": 50}, {"election_type": "other", "amount_bucket": "100-500", "n_donations": 630, "total_amount": 117988, "mean_amount": 187.2825396825397, "median_amount": 192}, {"election_type": "other", "amount_bucket": "<10", "n_donations": 10993, "total_amount": 25816, "mean_amount": 2.3484035295187846, "median_amount": 1}, {"election_type": "other", "amount_bucket": "1000-5000", "n_donations": 235, "total_amount": 548212, "mean_amount": 2332.817021276596, "median_amount": 2633}, {"election_type": "recount", "amount_bucket": "5000+", "n_donations": 26, "total_amount": 1888024, "mean_amount": 72616.30769230769, "median_amount": 101450}, {"election_type": null, "amount_bucket": "<10", "n_donations": 24, "total_amount": 108, "mean_amount": 4.5, "median_amount": 5}, {"election_type": null, "amount_bucket": "10-50", "n_donations": 151, "total_amount": 3167, "mean_amount": 20.973509933774835, "median_amount": 25}, {"election_type": "other", "amount_bucket": "500-1000", "n_donations": 119, "total_amount": 62535, "mean_amount": 525.5042016806723, "median_amount": 500}, {"election_type": "runoff", "amount_bucket": "5000+", "n_donations": 37, "total_amount": 211400, "mean_amount": 5713.513513513513, "median_amount": 5400}, {"election_type": null, "amount_bucket": "50-100", "n_donations": 36, "total_amount": 1880, "mean_amount": 52.22222222222222, "median_amount": 50}, {"election_type": "other", "amount_bucket": "5000+", "n_donations": 48, "total_amount": 1901300, "mean_amount": 39610.416666666664, "median_amount": 16950}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
</section>
<section id="by-election-stage" class="level3">
<h3 class="anchored" data-anchor-id="by-election-stage">By election stage</h3>
<p>Let’s look at how donations break down by election stage. Do people donate differently for primary elections vs general elections?</p>
<p>Let’s ignore everything but primary and general elections, since they are the most common, and arguably the most important.</p>
<div id="92651642" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>gb2 <span class="op">=</span> by_type_and_bucket[_.election_type.isin((<span class="st">"primary"</span>, <span class="st">"general"</span>))]</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>n_donations_per_election_type <span class="op">=</span> _.n_donations.<span class="bu">sum</span>().over(group_by<span class="op">=</span><span class="st">"election_type"</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>frac <span class="op">=</span> _.n_donations <span class="op">/</span> n_donations_per_election_type</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>gb2 <span class="op">=</span> gb2.mutate(frac_n_donations_per_election_type<span class="op">=</span>frac)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>gb2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> election_type </span>┃<span style="font-weight: bold"> amount_bucket </span>┃<span style="font-weight: bold"> n_donations </span>┃<span style="font-weight: bold"> total_amount </span>┃<span style="font-weight: bold"> mean_amount  </span>┃<span style="font-weight: bold"> median_amount </span>┃<span style="font-weight: bold"> frac_n_donations_per_election_type </span>┃
┡━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>                            │
├───────────────┼───────────────┼─────────────┼──────────────┼──────────────┼───────────────┼────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">10-50        </span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">8115403</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">187666251</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">23.124699</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">25</span> │                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.445831</span> │
│ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">&lt;10          </span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2423728</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10080721</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.159180</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span> │                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.133151</span> │
│ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">100-500      </span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3636287</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">637353634</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">175.275943</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">150</span> │                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.199765</span> │
│ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">50-100       </span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2663933</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">155426540</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">58.344763</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">50</span> │                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.146347</span> │
│ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">500-1000     </span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">634677</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">334630687</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">527.245649</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">500</span> │                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.034867</span> │
│ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">1000-5000    </span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">684755</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1231394874</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1798.299938</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1008</span> │                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.037618</span> │
│ <span style="color: #008000; text-decoration-color: #008000">primary      </span> │ <span style="color: #008000; text-decoration-color: #008000">5000+        </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">44085</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1558371116</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">35349.237065</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10000</span> │                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.002422</span> │
│ <span style="color: #008000; text-decoration-color: #008000">general      </span> │ <span style="color: #008000; text-decoration-color: #008000">50-100       </span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">304363</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">16184312</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">53.174374</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">50</span> │                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.138017</span> │
│ <span style="color: #008000; text-decoration-color: #008000">general      </span> │ <span style="color: #008000; text-decoration-color: #008000">100-500      </span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">700821</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">123174568</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">175.757530</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">150</span> │                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.317796</span> │
│ <span style="color: #008000; text-decoration-color: #008000">general      </span> │ <span style="color: #008000; text-decoration-color: #008000">500-1000     </span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">174182</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">91015697</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">522.532162</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">500</span> │                           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.078985</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>             │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>             │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │            <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │            <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │                                  <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└───────────────┴───────────────┴─────────────┴──────────────┴──────────────┴───────────────┴────────────────────────────────────┘
</pre>
</div>
</div>
<p>It looks like primary elections get a larger proportion of small donations.</p>
<div id="fd42d9bf" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>alt.Chart(gb2.execute()).mark_bar().encode(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"election_type:O"</span>,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"frac_n_donations_per_election_type:Q"</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span>bucket_col,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">

<style>
  #altair-viz-d70f3d08fb7d48c3b9c5b7d4e4e4b735.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-d70f3d08fb7d48c3b9c5b7d4e4e4b735.vega-embed details,
  #altair-viz-d70f3d08fb7d48c3b9c5b7d4e4e4b735.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-d70f3d08fb7d48c3b9c5b7d4e4e4b735"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-d70f3d08fb7d48c3b9c5b7d4e4e4b735") {
      outputDiv = document.getElementById("altair-viz-d70f3d08fb7d48c3b9c5b7d4e4e4b735");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.8.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-a720be181ccb86f83b23a767dba558e0"}, "mark": {"type": "bar"}, "encoding": {"color": {"field": "amount_bucket", "sort": ["<10", "10-50", "50-100", "100-500", "500-1000", "1000-5000", "5000+"], "type": "nominal"}, "x": {"field": "election_type", "type": "ordinal"}, "y": {"field": "frac_n_donations_per_election_type", "type": "quantitative"}}, "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json", "datasets": {"data-a720be181ccb86f83b23a767dba558e0": [{"election_type": "primary", "amount_bucket": "<10", "n_donations": 2423728, "total_amount": 10080721, "mean_amount": 4.159179990493983, "median_amount": 5, "frac_n_donations_per_election_type": 0.13315088589336582}, {"election_type": "primary", "amount_bucket": "10-50", "n_donations": 8115403, "total_amount": 187666251, "mean_amount": 23.12469892129818, "median_amount": 25, "frac_n_donations_per_election_type": 0.44583100860809405}, {"election_type": "primary", "amount_bucket": "50-100", "n_donations": 2663933, "total_amount": 155426540, "mean_amount": 58.34476317535013, "median_amount": 50, "frac_n_donations_per_election_type": 0.14634688335925966}, {"election_type": "primary", "amount_bucket": "100-500", "n_donations": 3636287, "total_amount": 637353634, "mean_amount": 175.27594329050484, "median_amount": 150, "frac_n_donations_per_election_type": 0.1997645096366133}, {"election_type": "primary", "amount_bucket": "500-1000", "n_donations": 634677, "total_amount": 334630687, "mean_amount": 527.2456493618014, "median_amount": 500, "frac_n_donations_per_election_type": 0.03486686823197312}, {"election_type": "primary", "amount_bucket": "1000-5000", "n_donations": 684755, "total_amount": 1231394874, "mean_amount": 1798.2999379340056, "median_amount": 1008, "frac_n_donations_per_election_type": 0.037617973167744775}, {"election_type": "primary", "amount_bucket": "5000+", "n_donations": 44085, "total_amount": 1558371116, "mean_amount": 35349.237064761255, "median_amount": 10000, "frac_n_donations_per_election_type": 0.0024218711029492714}, {"election_type": "general", "amount_bucket": "1000-5000", "n_donations": 246101, "total_amount": 460025242, "mean_amount": 1869.2538510611496, "median_amount": 1956, "frac_n_donations_per_election_type": 0.1115976768187944}, {"election_type": "general", "amount_bucket": "100-500", "n_donations": 700821, "total_amount": 123174568, "mean_amount": 175.75753009684357, "median_amount": 150, "frac_n_donations_per_election_type": 0.3177963334802553}, {"election_type": "general", "amount_bucket": "50-100", "n_donations": 304363, "total_amount": 16184312, "mean_amount": 53.174374020495264, "median_amount": 50, "frac_n_donations_per_election_type": 0.13801733316645898}, {"election_type": "general", "amount_bucket": "<10", "n_donations": 115873, "total_amount": 536742, "mean_amount": 4.632157620843509, "median_amount": 5, "frac_n_donations_per_election_type": 0.052544108337731925}, {"election_type": "general", "amount_bucket": "500-1000", "n_donations": 174182, "total_amount": 91015697, "mean_amount": 522.5321617618354, "median_amount": 500, "frac_n_donations_per_election_type": 0.0789850774423966}, {"election_type": "general", "amount_bucket": "10-50", "n_donations": 660787, "total_amount": 14411588, "mean_amount": 21.809732939661345, "median_amount": 25, "frac_n_donations_per_election_type": 0.2996423991453131}, {"election_type": "general", "amount_bucket": "5000+", "n_donations": 3125, "total_amount": 44496373, "mean_amount": 14238.83936, "median_amount": 7525, "frac_n_donations_per_election_type": 0.0014170716090496688}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
</section>
<section id="by-recipient" class="level3">
<h3 class="anchored" data-anchor-id="by-recipient">By recipient</h3>
<p>Let’s look at the top players. Who gets the most donations?</p>
<p>Far and away it is ActBlue, which acts as a conduit for donations to Democratic interests.</p>
<p>Beto O’Rourke is the top individual politician, hats off to him!</p>
<div id="e844f42e" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>by_recip <span class="op">=</span> summary_by(featured, <span class="st">"CMTE_NM"</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>by_recip</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> CMTE_NM                                                                          </span>┃<span style="font-weight: bold"> n_donations </span>┃<span style="font-weight: bold"> total_amount </span>┃<span style="font-weight: bold"> mean_amount </span>┃<span style="font-weight: bold"> median_amount </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                                                           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>         │
├──────────────────────────────────────────────────────────────────────────────────┼─────────────┼──────────────┼─────────────┼───────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">EXELON CORPORATION POLITICAL ACTION COMMITTEE (EXELON PAC)                      </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">13250</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1939503</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">146.377585</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">118</span> │
│ <span style="color: #008000; text-decoration-color: #008000">ARCHER DANIELS MIDLAND COMPANY-ADM PAC                                          </span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4460</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">275807</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">61.840135</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">25</span> │
│ <span style="color: #008000; text-decoration-color: #008000">PFIZER INC. PAC                                                                 </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">46900</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1948689</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">41.549872</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20</span> │
│ <span style="color: #008000; text-decoration-color: #008000">SUEZ WATER INC. FEDERAL PAC                                                     </span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">108</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">16873</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">156.231481</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">120</span> │
│ <span style="color: #008000; text-decoration-color: #008000">INTERNATIONAL WAREHOUSE LOGISTICS ASSOCIATION PAC                               </span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">90</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">132200</span> │ <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1468.888889</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1000</span> │
│ <span style="color: #008000; text-decoration-color: #008000">BAKERY, CONFECTIONERY, TOBACCO WORKERS AND GRAIN MILLERS INTERNATIONAL UNION PAC</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">387</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">19091</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">49.330749</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">30</span> │
│ <span style="color: #008000; text-decoration-color: #008000">UNION PACIFIC CORP. FUND FOR EFFECTIVE GOVERNMENT                               </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">16118</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2436963</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">151.195123</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">114</span> │
│ <span style="color: #008000; text-decoration-color: #008000">NATIONAL ASSOCIATION OF REALTORS POLITICAL ACTION COMMITTEE                     </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">24277</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5492063</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">226.224945</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">154</span> │
│ <span style="color: #008000; text-decoration-color: #008000">AMERICAN FINANCIAL SERVICES ASSOCIATION PAC                                     </span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">690</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">685839</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">993.969565</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">65</span> │
│ <span style="color: #008000; text-decoration-color: #008000">WEYERHAEUSER COMPANY POLITICAL ACTION COMMITTEE                                 </span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5512</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">343244</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">62.272134</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">30</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                                                │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │            <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└──────────────────────────────────────────────────────────────────────────────────┴─────────────┴──────────────┴─────────────┴───────────────┘
</pre>
</div>
</div>
<div id="a0c1efd8" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>top_recip <span class="op">=</span> by_recip.order_by(ibis.desc(<span class="st">"n_donations"</span>)).head(<span class="dv">10</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>alt.Chart(top_recip.execute()).mark_bar().encode(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>alt.X(<span class="st">"CMTE_NM:O"</span>, sort<span class="op">=</span><span class="st">"-y"</span>),</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"n_donations:Q"</span>,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">

<style>
  #altair-viz-59298bf7a2fb45ba8365f4fc9ef956b9.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-59298bf7a2fb45ba8365f4fc9ef956b9.vega-embed details,
  #altair-viz-59298bf7a2fb45ba8365f4fc9ef956b9.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-59298bf7a2fb45ba8365f4fc9ef956b9"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-59298bf7a2fb45ba8365f4fc9ef956b9") {
      outputDiv = document.getElementById("altair-viz-59298bf7a2fb45ba8365f4fc9ef956b9");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.8.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-ce10b3f5b7c7e35451245a008d469163"}, "mark": {"type": "bar"}, "encoding": {"x": {"field": "CMTE_NM", "sort": "-y", "type": "ordinal"}, "y": {"field": "n_donations", "type": "quantitative"}}, "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json", "datasets": {"data-ce10b3f5b7c7e35451245a008d469163": [{"CMTE_NM": "ACTBLUE", "n_donations": 5820888, "total_amount": 693057213, "mean_amount": 119.06382892094814, "median_amount": 25}, {"CMTE_NM": "DCCC", "n_donations": 1315476, "total_amount": 124802082, "mean_amount": 94.87218466927561, "median_amount": 25}, {"CMTE_NM": "REPUBLICAN NATIONAL COMMITTEE", "n_donations": 570561, "total_amount": 131525422, "mean_amount": 230.5194746924518, "median_amount": 50}, {"CMTE_NM": "END CITIZENS UNITED", "n_donations": 489710, "total_amount": 13654987, "mean_amount": 27.8838230789651, "median_amount": 15}, {"CMTE_NM": "DSCC", "n_donations": 347493, "total_amount": 67844824, "mean_amount": 195.2408365060591, "median_amount": 35}, {"CMTE_NM": "PROGRESSIVE TURNOUT PROJECT", "n_donations": 313433, "total_amount": 9251647, "mean_amount": 29.517144014829327, "median_amount": 15}, {"CMTE_NM": "DNC SERVICES CORP./DEM. NAT'L COMMITTEE", "n_donations": 280264, "total_amount": 70156788, "mean_amount": 250.32393743042275, "median_amount": 50}, {"CMTE_NM": "BETO FOR TEXAS", "n_donations": 280027, "total_amount": 44914966, "mean_amount": 160.39512618426082, "median_amount": 50}, {"CMTE_NM": "NRSC", "n_donations": 203124, "total_amount": 55384644, "mean_amount": 272.66420511608675, "median_amount": 50}, {"CMTE_NM": "NRCC", "n_donations": 178176, "total_amount": 38646560, "mean_amount": 216.90104166666666, "median_amount": 50}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
</section>
<section id="by-location" class="level3">
<h3 class="anchored" data-anchor-id="by-location">By Location</h3>
<p>Where are the largest donations coming from?</p>
<div id="3348eca1" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>f2 <span class="op">=</span> featured.mutate(loc<span class="op">=</span>_.CITY <span class="op">+</span> <span class="st">", "</span> <span class="op">+</span> _.STATE).drop(<span class="st">"CITY"</span>, <span class="st">"STATE"</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>by_loc <span class="op">=</span> summary_by(f2, <span class="st">"loc"</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop the places with a small number of donations so we're</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># resistant to outliers for the mean</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>by_loc <span class="op">=</span> by_loc[_.n_donations <span class="op">&gt;</span> <span class="dv">1000</span>]</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>by_loc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> loc              </span>┃<span style="font-weight: bold"> n_donations </span>┃<span style="font-weight: bold"> total_amount </span>┃<span style="font-weight: bold"> mean_amount </span>┃<span style="font-weight: bold"> median_amount </span>┃
┡━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>         │
├──────────────────┼─────────────┼──────────────┼─────────────┼───────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">DALLAS, TX      </span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">154038</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">66558403</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">432.090802</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">58</span> │
│ <span style="color: #008000; text-decoration-color: #008000">PHILADELPHIA, PA</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">222938</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">36054977</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">161.726476</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">62</span> │
│ <span style="color: #008000; text-decoration-color: #008000">MALIBU, CA      </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">11699</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4934763</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">421.810668</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">50</span> │
│ <span style="color: #008000; text-decoration-color: #008000">SANTEE, CA      </span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2454</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">201274</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">82.018745</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">26</span> │
│ <span style="color: #008000; text-decoration-color: #008000">WINNETKA, IL    </span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">8589</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5621809</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">654.535918</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">172</span> │
│ <span style="color: #008000; text-decoration-color: #008000">OREM, UT        </span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2110</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">837475</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">396.907583</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">50</span> │
│ <span style="color: #008000; text-decoration-color: #008000">MESA, AZ        </span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">22128</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1856636</span> │   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">83.904375</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">20</span> │
│ <span style="color: #008000; text-decoration-color: #008000">WAYZATA, MN     </span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6488</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3326275</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">512.681104</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">117</span> │
│ <span style="color: #008000; text-decoration-color: #008000">MINNETONKA, MN  </span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5709</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1187881</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">208.071641</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">50</span> │
│ <span style="color: #008000; text-decoration-color: #008000">OJAI, CA        </span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4496</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">926422</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">206.054715</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">25</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │            <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │
└──────────────────┴─────────────┴──────────────┴─────────────┴───────────────┘
</pre>
</div>
</div>
<div id="95c93760" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> top_by(col):</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    top <span class="op">=</span> by_loc.order_by(ibis.desc(col)).head(<span class="dv">10</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>        alt.Chart(top.execute())</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>        .mark_bar()</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>        .encode(</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span>alt.X(<span class="st">'loc:O'</span>, sort<span class="op">=</span><span class="st">"-y"</span>),</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span>col,</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>top_by(<span class="st">"n_donations"</span>) <span class="op">|</span> top_by(<span class="st">"total_amount"</span>) <span class="op">|</span> top_by(<span class="st">"mean_amount"</span>) <span class="op">|</span> top_by(</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"median_amount"</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">

<style>
  #altair-viz-0d2671a035be4c5e8b9b39040d382bd3.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-0d2671a035be4c5e8b9b39040d382bd3.vega-embed details,
  #altair-viz-0d2671a035be4c5e8b9b39040d382bd3.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-0d2671a035be4c5e8b9b39040d382bd3"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-0d2671a035be4c5e8b9b39040d382bd3") {
      outputDiv = document.getElementById("altair-viz-0d2671a035be4c5e8b9b39040d382bd3");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.8.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "hconcat": [{"data": {"name": "data-88a0fd8958c48a49df7689732aa79f72"}, "mark": {"type": "bar"}, "encoding": {"x": {"field": "loc", "sort": "-y", "type": "ordinal"}, "y": {"field": "n_donations", "type": "quantitative"}}}, {"data": {"name": "data-3702e7b9b7a3360d0314740591d3849d"}, "mark": {"type": "bar"}, "encoding": {"x": {"field": "loc", "sort": "-y", "type": "ordinal"}, "y": {"field": "total_amount", "type": "quantitative"}}}, {"data": {"name": "data-290a9847dd1ffd50031c2439e64328e3"}, "mark": {"type": "bar"}, "encoding": {"x": {"field": "loc", "sort": "-y", "type": "ordinal"}, "y": {"field": "mean_amount", "type": "quantitative"}}}, {"data": {"name": "data-5b715f99a3cfcd002ab9d2ec64e81179"}, "mark": {"type": "bar"}, "encoding": {"x": {"field": "loc", "sort": "-y", "type": "ordinal"}, "y": {"field": "median_amount", "type": "quantitative"}}}], "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json", "datasets": {"data-88a0fd8958c48a49df7689732aa79f72": [{"loc": "NEW YORK, NY", "n_donations": 695091, "total_amount": 444600108, "mean_amount": 639.6286356750411, "median_amount": 50}, {"loc": "WASHINGTON, DC", "n_donations": 401498, "total_amount": 124456508, "mean_amount": 309.9803934266173, "median_amount": 57}, {"loc": "HOUSTON, TX", "n_donations": 251960, "total_amount": 83026989, "mean_amount": 329.5244840450865, "median_amount": 50}, {"loc": "LOS ANGELES, CA", "n_donations": 245263, "total_amount": 89881980, "mean_amount": 366.4718282007478, "median_amount": 50}, {"loc": "SAN FRANCISCO, CA", "n_donations": 238117, "total_amount": 189799961, "mean_amount": 797.086982449804, "median_amount": 50}, {"loc": "PHILADELPHIA, PA", "n_donations": 222938, "total_amount": 36054977, "mean_amount": 161.72647552234253, "median_amount": 62}, {"loc": "CHICAGO, IL", "n_donations": 212527, "total_amount": 108119674, "mean_amount": 508.7338267608351, "median_amount": 40}, {"loc": "SEATTLE, WA", "n_donations": 197671, "total_amount": 52867387, "mean_amount": 267.4514066302088, "median_amount": 36}, {"loc": "AUSTIN, TX", "n_donations": 189865, "total_amount": 33315922, "mean_amount": 175.4716351091565, "median_amount": 38}, {"loc": "ARLINGTON, VA", "n_donations": 163168, "total_amount": 23382868, "mean_amount": 143.30547656403218, "median_amount": 50}], "data-3702e7b9b7a3360d0314740591d3849d": [{"loc": "NEW YORK, NY", "n_donations": 695091, "total_amount": 444600108, "mean_amount": 639.6286356750411, "median_amount": 50}, {"loc": "SAN FRANCISCO, CA", "n_donations": 238117, "total_amount": 189799961, "mean_amount": 797.086982449804, "median_amount": 50}, {"loc": "LAS VEGAS, NV", "n_donations": 65940, "total_amount": 153467387, "mean_amount": 2327.37923870185, "median_amount": 46}, {"loc": "WASHINGTON, DC", "n_donations": 401498, "total_amount": 124456508, "mean_amount": 309.9803934266173, "median_amount": 57}, {"loc": "CHICAGO, IL", "n_donations": 212527, "total_amount": 108119674, "mean_amount": 508.7338267608351, "median_amount": 40}, {"loc": "LOS ANGELES, CA", "n_donations": 245263, "total_amount": 89881980, "mean_amount": 366.4718282007478, "median_amount": 50}, {"loc": "HOUSTON, TX", "n_donations": 251960, "total_amount": 83026989, "mean_amount": 329.5244840450865, "median_amount": 50}, {"loc": "DALLAS, TX", "n_donations": 154038, "total_amount": 66558403, "mean_amount": 432.09080226956985, "median_amount": 57}, {"loc": "SEATTLE, WA", "n_donations": 197671, "total_amount": 52867387, "mean_amount": 267.4514066302088, "median_amount": 36}, {"loc": "BOSTON, MA", "n_donations": 82925, "total_amount": 47592049, "mean_amount": 573.9167802230932, "median_amount": 57}], "data-290a9847dd1ffd50031c2439e64328e3": [{"loc": "LAKE FOREST, IL", "n_donations": 5636, "total_amount": 37486362, "mean_amount": 6651.235273243435, "median_amount": 100}, {"loc": "MOUNT VERNON, OH", "n_donations": 1431, "total_amount": 5605857, "mean_amount": 3917.4402515723273, "median_amount": 47}, {"loc": "LOS ALTOS HILLS, CA", "n_donations": 4098, "total_amount": 10367629, "mean_amount": 2529.92410932162, "median_amount": 318}, {"loc": "PALM BEACH, FL", "n_donations": 7140, "total_amount": 17212425, "mean_amount": 2410.703781512605, "median_amount": 260}, {"loc": "LAS VEGAS, NV", "n_donations": 65940, "total_amount": 153467387, "mean_amount": 2327.37923870185, "median_amount": 45}, {"loc": "RHINEBECK, NY", "n_donations": 3014, "total_amount": 5942571, "mean_amount": 1971.6559389515594, "median_amount": 47}, {"loc": "JOPLIN, MO", "n_donations": 1839, "total_amount": 3617186, "mean_amount": 1966.9309407286569, "median_amount": 50}, {"loc": "BALA CYNWYD, PA", "n_donations": 3668, "total_amount": 6949933, "mean_amount": 1894.7472737186479, "median_amount": 100}, {"loc": "CARMEL, IN", "n_donations": 10932, "total_amount": 20383688, "mean_amount": 1864.5890962312478, "median_amount": 53}, {"loc": "WAYLAND, MA", "n_donations": 5283, "total_amount": 9704279, "mean_amount": 1836.8879424569373, "median_amount": 50}], "data-5b715f99a3cfcd002ab9d2ec64e81179": [{"loc": "GLADWYNE, PA", "n_donations": 1727, "total_amount": 1333243, "mean_amount": 771.9994209612044, "median_amount": 335}, {"loc": "LOS ALTOS HILLS, CA", "n_donations": 4098, "total_amount": 10367629, "mean_amount": 2529.92410932162, "median_amount": 326}, {"loc": "MC LEAN, VA", "n_donations": 4692, "total_amount": 3656109, "mean_amount": 779.2218670076726, "median_amount": 305}, {"loc": "PALM BEACH, FL", "n_donations": 7140, "total_amount": 17212425, "mean_amount": 2410.703781512605, "median_amount": 262}, {"loc": "PARADISE VALLEY, AZ", "n_donations": 8197, "total_amount": 7035291, "mean_amount": 858.2763206050994, "median_amount": 250}, {"loc": "MISSION HILLS, KS", "n_donations": 2258, "total_amount": 1642339, "mean_amount": 727.3423383525244, "median_amount": 250}, {"loc": "DOVER, MA", "n_donations": 1040, "total_amount": 976757, "mean_amount": 939.189423076923, "median_amount": 250}, {"loc": "ATHERTON, CA", "n_donations": 8780, "total_amount": 11595391, "mean_amount": 1320.6595671981777, "median_amount": 250}, {"loc": "KENILWORTH, IL", "n_donations": 1500, "total_amount": 855723, "mean_amount": 570.482, "median_amount": 250}, {"loc": "WOODSIDE, CA", "n_donations": 5626, "total_amount": 6110007, "mean_amount": 1086.030394596516, "median_amount": 249}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
</section>
<section id="by-month" class="level3">
<h3 class="anchored" data-anchor-id="by-month">By month</h3>
<p>When do the donations come in?</p>
<div id="6d0776d2" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>by_month <span class="op">=</span> summary_by(featured, _.date.month().name(<span class="st">"month_int"</span>))</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Sorta hacky, .substritute doesn't work to change dtypes (yet?)</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co"># so we cast to string and then do our mapping</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>month_map <span class="op">=</span> {</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"1"</span>: <span class="st">"Jan"</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"2"</span>: <span class="st">"Feb"</span>,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"3"</span>: <span class="st">"Mar"</span>,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"4"</span>: <span class="st">"Apr"</span>,</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"5"</span>: <span class="st">"May"</span>,</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"6"</span>: <span class="st">"Jun"</span>,</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"7"</span>: <span class="st">"Jul"</span>,</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"8"</span>: <span class="st">"Aug"</span>,</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"9"</span>: <span class="st">"Sep"</span>,</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"10"</span>: <span class="st">"Oct"</span>,</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"11"</span>: <span class="st">"Nov"</span>,</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"12"</span>: <span class="st">"Dec"</span>,</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>by_month <span class="op">=</span> by_month.mutate(month_str<span class="op">=</span>_.month_int.cast(<span class="bu">str</span>).substitute(month_map))</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>by_month</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━┓
┃<span style="font-weight: bold"> month_int </span>┃<span style="font-weight: bold"> n_donations </span>┃<span style="font-weight: bold"> total_amount </span>┃<span style="font-weight: bold"> mean_amount </span>┃<span style="font-weight: bold"> median_amount </span>┃<span style="font-weight: bold"> month_str </span>┃
┡━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int32</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>         │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>    │
├───────────┼─────────────┼──────────────┼─────────────┼───────────────┼───────────┤
│      <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span> │        <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1514</span> │       <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">250297</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">165.321664</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">99</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>      │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">348979</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">174837854</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">500.998209</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">122</span> │ <span style="color: #008000; text-decoration-color: #008000">Jan      </span> │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span> │      <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">581646</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">255997655</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">440.126219</span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">100</span> │ <span style="color: #008000; text-decoration-color: #008000">Feb      </span> │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1042577</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">430906797</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">413.309326</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">81</span> │ <span style="color: #008000; text-decoration-color: #008000">Mar      </span> │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1088244</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">299252692</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">274.986760</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">50</span> │ <span style="color: #008000; text-decoration-color: #008000">Apr      </span> │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1374247</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">387317192</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">281.839576</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">48</span> │ <span style="color: #008000; text-decoration-color: #008000">May      </span> │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1667285</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">465305247</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">279.079610</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">44</span> │ <span style="color: #008000; text-decoration-color: #008000">Jun      </span> │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">7</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1607053</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">320528605</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">199.451172</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">35</span> │ <span style="color: #008000; text-decoration-color: #008000">Jul      </span> │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">8</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2023466</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">473544182</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">234.026261</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">35</span> │ <span style="color: #008000; text-decoration-color: #008000">Aug      </span> │
│         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">9</span> │     <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2583847</span> │    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">697888624</span> │  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">270.096729</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">38</span> │ <span style="color: #008000; text-decoration-color: #008000">Sep      </span> │
│         <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │            <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │           <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>         │
└───────────┴─────────────┴──────────────┴─────────────┴───────────────┴───────────┘
</pre>
</div>
</div>
<div id="a2b27c61" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>months_in_order <span class="op">=</span> <span class="bu">list</span>(month_map.values())</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>alt.Chart(by_month.execute()).mark_bar().encode(</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>alt.X(<span class="st">"month_str:O"</span>, sort<span class="op">=</span>months_in_order),</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"n_donations:Q"</span>,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">

<style>
  #altair-viz-8f3242609f02454fa698b7480db40ce3.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-8f3242609f02454fa698b7480db40ce3.vega-embed details,
  #altair-viz-8f3242609f02454fa698b7480db40ce3.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-8f3242609f02454fa698b7480db40ce3"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-8f3242609f02454fa698b7480db40ce3") {
      outputDiv = document.getElementById("altair-viz-8f3242609f02454fa698b7480db40ce3");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.8.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.8.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-60ff3524db1ce5308db1f55005eff874"}, "mark": {"type": "bar"}, "encoding": {"x": {"field": "month_str", "sort": ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"], "type": "ordinal"}, "y": {"field": "n_donations", "type": "quantitative"}}, "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json", "datasets": {"data-60ff3524db1ce5308db1f55005eff874": [{"month_int": null, "n_donations": 1514, "total_amount": 250297, "mean_amount": 165.3216644649934, "median_amount": 100, "month_str": null}, {"month_int": 1.0, "n_donations": 348979, "total_amount": 174837854, "mean_amount": 500.9982090612902, "median_amount": 120, "month_str": "Jan"}, {"month_int": 2.0, "n_donations": 581646, "total_amount": 255997655, "mean_amount": 440.126219384299, "median_amount": 100, "month_str": "Feb"}, {"month_int": 3.0, "n_donations": 1042577, "total_amount": 430906797, "mean_amount": 413.3093258339672, "median_amount": 81, "month_str": "Mar"}, {"month_int": 4.0, "n_donations": 1088244, "total_amount": 299252692, "mean_amount": 274.98676032213365, "median_amount": 50, "month_str": "Apr"}, {"month_int": 5.0, "n_donations": 1374247, "total_amount": 387317192, "mean_amount": 281.83957614606396, "median_amount": 48, "month_str": "May"}, {"month_int": 6.0, "n_donations": 1667285, "total_amount": 465305247, "mean_amount": 279.07960966481437, "median_amount": 44, "month_str": "Jun"}, {"month_int": 7.0, "n_donations": 1607053, "total_amount": 320528605, "mean_amount": 199.45117242555162, "median_amount": 35, "month_str": "Jul"}, {"month_int": 8.0, "n_donations": 2023466, "total_amount": 473544182, "mean_amount": 234.02626088108227, "median_amount": 35, "month_str": "Aug"}, {"month_int": 9.0, "n_donations": 2583847, "total_amount": 697888624, "mean_amount": 270.0967294116099, "median_amount": 38, "month_str": "Sep"}, {"month_int": 10.0, "n_donations": 3686024, "total_amount": 850820707, "mean_amount": 230.82343115508743, "median_amount": 29, "month_str": "Oct"}, {"month_int": 11.0, "n_donations": 2545616, "total_amount": 285143995, "mean_amount": 112.01375030640914, "median_amount": 25, "month_str": "Nov"}, {"month_int": 12.0, "n_donations": 2119311, "total_amount": 283081648, "mean_amount": 133.57249030463203, "median_amount": 25, "month_str": "Dec"}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Thanks for following along! I hope you’ve learned something about Ibis, and maybe even about campaign finance.</p>
<p>Ibis is a great tool for exploring data. I now find myself reaching for it when in the past I would have reached for pandas.</p>
<p>Some of the highlights for me:</p>
<ul>
<li>Fast, lazy execution, a great display format, and good type hinting/editor support for a great REPL experience.</li>
<li>Very well thought-out API and semantics (e.g.&nbsp;<code>isinstance(val, NumericValue)</code>?? That’s beautiful!)</li>
<li>Fast and fairly complete string support, since I work with a lot of text data.</li>
<li>Extremely responsive maintainers. Sometimes I’ve submitted multiple feature requests and bug reports in a single day, and a PR has been merged by the next day.</li>
<li>Escape hatch to SQL. I didn’t have to use that here, but if something isn’t supported, you can always fall back to SQL.</li>
</ul>
<p>Check out <a href="https://ibis-project.org/">The Ibis Website</a> for more information.</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        for (let i = 0; i < 2; i++) {
          container.appendChild(note.children[i].cloneNode(true));
        }
        return container.innerHTML
      } else {
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        console.log("RESIZE");
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="ibis-project/ibis" data-repo-id="MDEwOlJlcG9zaXRvcnkzNDEzOTIzMA==" data-category="Q&amp;A" data-category-id="DIC_kwDOAgjsXs4CASeT" data-mapping="title" data-reactions-enabled="0" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ibis-project">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://ibis-project.zulipchat.com">
      <i class="bi bi-zulip" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://ibis-project.org/posts.xml">
      <i class="bi bi-rss" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>