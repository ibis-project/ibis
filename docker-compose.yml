version: '3'
services:

  postgres:
    image: postgres
    # hostname: postgres
    networks:
      - ibis-nw
    ports:
      - 5432:5432
    environment:
      POSTGRES_PASSWORD: postgres

  impala:
    image: kszucs/impala
    hostname: impala
    # hostname: impala
    networks:
      - ibis-nw
    external_links:
      - postgres
    environment:
      PGPASSWORD: postgres
    expose:
      - 21050
    ports:
      # HDFS
      - 9020:9020
      - 50070:50070
      - 50075:50075
      - 8020:8020
      - 8042:8042
      # Hive
      - 9083:9083
      # Impala
      - 21000:21000
      - 21050:21050
      - 25000:25000
      - 25010:25010
      - 25020:25020

  clickhouse:
    image: yandex/clickhouse-server:latest
    # hostname: clickhouse
    networks:
      - ibis-nw
    ports:
      - 8123:8123
      - 9000:9000

  ibis:
    image: ibis
    # hostname: ibis
    networks:
      - ibis-nw
    external_links:
      - impala
      - postgres
      - clickhouse
    environment:
      - IBIS_TEST_NN_HOST=impala
      - IBIS_TEST_IMPALA_HOST=impala
      - IBIS_TEST_POSTGRES_HOST=postgres
      - IBIS_TEST_POSTGRES_PASSWORD=postgres
      - IBIS_TEST_CLICKHOUSE_HOST=clickhouse
    volumes:
      - /tmp/ibis:/tmp
    build:
      context: .
      dockerfile: ci/Dockerfile.test
      args:
        python: 3.6

networks:
  default:
    external:
      name: ibis-nw
  ibis-nw:
    driver: bridge
