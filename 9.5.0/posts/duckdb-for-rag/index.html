<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.9">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Cody Peterson">
<meta name="dcterms.date" content="2024-02-22">

<title>Using DuckDB + Ibis for RAG – Ibis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<script src="../../site_libs/quarto-search/autocomplete-preset-algolia.umd.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../logo.svg" rel="icon" type="image/svg+xml">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e67ff5f79a98c6389aa7c0b9e6712459.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-14475e581903c9a7e5ed069634c08d5c.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-12c8c4cf821d2fd1848e951be45237d8.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "algolia": {
    "application-id": "TNU9HG3L41",
    "search-only-api-key": "26350948d1961209df16d9717a7e01d6",
    "index-name": "prod_ibis",
    "analytics-events": true,
    "show-logo": true,
    "libDir": "site_libs"
  },
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/algoliasearch@4.5.1/dist/algoliasearch-lite.umd.js"></script>


<script type="text/javascript">
var ALGOLIA_INSIGHTS_SRC = "https://cdn.jsdelivr.net/npm/search-insights/dist/search-insights.iife.min.js";
!function(e,a,t,n,s,i,c){e.AlgoliaAnalyticsObject=s,e[s]=e[s]||function(){
(e[s].queue=e[s].queue||[]).push(arguments)},i=a.createElement(t),c=a.getElementsByTagName(t)[0],
i.async=1,i.src=n,c.parentNode.insertBefore(i,c)
}(window,document,"script",ALGOLIA_INSIGHTS_SRC,"aa");
</script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@algolia/autocomplete-plugin-algolia-insights">

</script>
<script src="../../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>
<script data-goatcounter="https://ibis.goatcounter.com/count" async="" src="//gc.zgo.at/count.js"></script>


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Using DuckDB + Ibis for RAG – Ibis">
<meta property="og:description" content="the portable Python dataframe library">
<meta property="og:image" content="https://ibis-project.org/posts/duckdb-for-rag/thumbnail.png">
<meta property="og:site_name" content="Ibis">
<meta property="og:image:height" content="512">
<meta property="og:image:width" content="512">
<meta name="twitter:title" content="Using DuckDB + Ibis for RAG – Ibis">
<meta name="twitter:description" content="the portable Python dataframe library">
<meta name="twitter:image" content="https://ibis-project.org/posts/duckdb-for-rag/thumbnail.png">
<meta name="twitter:image-height" content="512">
<meta name="twitter:image-width" content="512">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Ibis</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-getting-started" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Getting started</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-getting-started">    
        <li>
    <a class="dropdown-item" href="../../install.html">
 <span class="dropdown-text">Installation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../tutorials/getting_started.html">
 <span class="dropdown-text">Tutorial: getting started</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../tutorials/ibis-for-dplyr-users.html">
 <span class="dropdown-text">Tutorial: Ibis for dplyr users</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../tutorials/ibis-for-pandas-users.html">
 <span class="dropdown-text">Tutorial: Ibis for pandas users</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../tutorials/ibis-for-sql-users.html">
 <span class="dropdown-text">Tutorial: Ibis for SQL users</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Browser</li>
        <li>
    <a class="dropdown-item" href="../../tutorials/browser/repl.html">
 <span class="dropdown-text">JupyterLite console</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Cloud Data Platforms</li>
        <li>
    <a class="dropdown-item" href="../../tutorials/cloud-data-platforms/clickhouse.html">
 <span class="dropdown-text">ClickHouse</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../tutorials/cloud-data-platforms/starburst-galaxy/0_setup.html">
 <span class="dropdown-text">Starburst Galaxy</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Open Source Software</li>
        <li>
    <a class="dropdown-item" href="../../tutorials/open-source-software/apache-flink/0_setup.html">
 <span class="dropdown-text">Apache Flink</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-concepts" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Concepts</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-concepts">    
        <li>
    <a class="dropdown-item" href="../../why.html">
 <span class="dropdown-text">Why Ibis?</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../concepts/composable-ecosystem.html">
 <span class="dropdown-text">Composable data ecosystem</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../concepts/datatypes.html">
 <span class="dropdown-text">Datatypes and Datashapes</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../concepts/internals.html">
 <span class="dropdown-text">Internals</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../concepts/user-testimonials.html">
 <span class="dropdown-text">User testimonials</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../concepts/versioning.html">
 <span class="dropdown-text">Versioning policy</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../concepts/who.html">
 <span class="dropdown-text">Who supports Ibis?</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-backends" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Backends</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-backends">    
        <li>
    <a class="dropdown-item" href="../../backends/bigquery.html">
 <span class="dropdown-text">BigQuery</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/clickhouse.html">
 <span class="dropdown-text">ClickHouse</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/dask.html">
 <span class="dropdown-text">Dask</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/datafusion.html">
 <span class="dropdown-text">DataFusion</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/druid.html">
 <span class="dropdown-text">Druid</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/duckdb.html">
 <span class="dropdown-text">DuckDB</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/exasol.html">
 <span class="dropdown-text">Exasol</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/flink.html">
 <span class="dropdown-text">Flink</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/impala.html">
 <span class="dropdown-text">Impala</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/mssql.html">
 <span class="dropdown-text">MSSQL</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/mysql.html">
 <span class="dropdown-text">MySQL</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/oracle.html">
 <span class="dropdown-text">Oracle</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/pandas.html">
 <span class="dropdown-text">pandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/polars.html">
 <span class="dropdown-text">Polars</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/postgresql.html">
 <span class="dropdown-text">PostgreSQL</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/pyspark.html">
 <span class="dropdown-text">PySpark</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/risingwave.html">
 <span class="dropdown-text">RisingWave</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/snowflake.html">
 <span class="dropdown-text">Snowflake</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/sqlite.html">
 <span class="dropdown-text">SQLite</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/trino.html">
 <span class="dropdown-text">Trino</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Support</li>
        <li>
    <a class="dropdown-item" href="../../backends/support/matrix.html">
 <span class="dropdown-text">Operation support matrix</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/support/operations.html">
 <span class="dropdown-text">Operations</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-how-to" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">How-to</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-how-to">    
        <li class="dropdown-header">Configure</li>
        <li>
    <a class="dropdown-item" href="../../how-to/configure/basics.html">
 <span class="dropdown-text">Basic configuration</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Input Output</li>
        <li>
    <a class="dropdown-item" href="../../how-to/input-output/basics.html">
 <span class="dropdown-text">Basic input/output</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/input-output/duckdb-parquet.html">
 <span class="dropdown-text">Read parquet files with Ibis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/input-output/gcs_duckdb.html">
 <span class="dropdown-text">Loading Google Cloud Storage files with DuckDB</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/input-output/multiple-backends.html">
 <span class="dropdown-text">Work with multiple backends</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Analytics</li>
        <li>
    <a class="dropdown-item" href="../../how-to/analytics/basics.html">
 <span class="dropdown-text">Basic analytics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/analytics/chain_expressions.html">
 <span class="dropdown-text">Chaining expressions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/analytics/imdb.html">
 <span class="dropdown-text">Analyze IMDB data using Ibis</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Visualization</li>
        <li>
    <a class="dropdown-item" href="../../how-to/visualization/altair.html">
 <span class="dropdown-text">Altair + Ibis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/visualization/graphs.html">
 <span class="dropdown-text">GraphViz + Ibis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/visualization/matplotlib.html">
 <span class="dropdown-text">matplotlib + Ibis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/visualization/plotly.html">
 <span class="dropdown-text">Plotly + Ibis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/visualization/plotnine.html">
 <span class="dropdown-text">plotnine + Ibis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/visualization/seaborn.html">
 <span class="dropdown-text">seaborn + Ibis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/visualization/streamlit.html">
 <span class="dropdown-text">Streamlit + Ibis</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Extending</li>
        <li>
    <a class="dropdown-item" href="../../how-to/extending/builtin.html">
 <span class="dropdown-text">Reference built-in functions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/extending/sql.html">
 <span class="dropdown-text">Using SQL strings with Ibis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/extending/streaming.html">
 <span class="dropdown-text">Ibis for streaming</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/extending/unbound_expression.html">
 <span class="dropdown-text">Write and execute unbound expressions</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-reference" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Reference</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-reference">    
        <li class="dropdown-header">Expression API</li>
        <li>
    <a class="dropdown-item" href="../../reference/expression-tables.html">
 <span class="dropdown-text">Table expressions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/selectors.html">
 <span class="dropdown-text">Column selectors</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/expression-generic.html">
 <span class="dropdown-text">Generic expressions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/expression-numeric.html">
 <span class="dropdown-text">Numeric and Boolean expressions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/expression-strings.html">
 <span class="dropdown-text">String expressions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/expression-temporal.html">
 <span class="dropdown-text">Temporal expressions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/expression-collections.html">
 <span class="dropdown-text">Collection expressions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/expression-geospatial.html">
 <span class="dropdown-text">Geospatial expressions</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Type system</li>
        <li>
    <a class="dropdown-item" href="../../reference/datatypes.html">
 <span class="dropdown-text">Data types</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/schemas.html">
 <span class="dropdown-text">Schemas</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">UDFs</li>
        <li>
    <a class="dropdown-item" href="../../reference/scalar-udfs.html">
 <span class="dropdown-text">Scalar UDFs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/aggregate-udfs.html">
 <span class="dropdown-text">Aggregate UDFs (experimental)</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Connection APIs</li>
        <li>
    <a class="dropdown-item" href="../../reference/connection.html">
 <span class="dropdown-text">Top-level connection APIs</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Configuration</li>
        <li>
    <a class="dropdown-item" href="../../reference/Interactive.html">
 <span class="dropdown-text">Interactive</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/Options.html">
 <span class="dropdown-text">Options</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/Repr.html">
 <span class="dropdown-text">Repr</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/SQL.html">
 <span class="dropdown-text">SQL</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Cursed Knowledge</li>
        <li>
    <a class="dropdown-item" href="../../reference/cursed_knowledge.html">
 <span class="dropdown-text">Cursed Knowledge</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html"> 
<span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../presentations.html"> 
<span class="menu-text">Presentations</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../release_notes.html"> 
<span class="menu-text">Release notes</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-contribute" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Contribute</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-contribute">    
        <li class="dropdown-header">Contribute</li>
        <li>
    <a class="dropdown-item" href="../../contribute/01_environment.html">
 <span class="dropdown-text">Setting up a development environment</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../contribute/02_workflow.html">
 <span class="dropdown-text">Contribute to the Ibis codebase</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../contribute/03_style.html">
 <span class="dropdown-text">Style and formatting</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../contribute/04_maintainers_guide.html">
 <span class="dropdown-text">Maintaining the codebase</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../contribute/05_reference.html">
 <span class="dropdown-text">Test class reference</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/ibis-project/ibis">
            Source code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/ibis-project/ibis/issues/new?assignees=&amp;labels=bug&amp;projects=&amp;template=bug-report.yml&amp;title=bug">
            Report a bug
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/ibis-project/ibis/issues/new?assignees=&amp;labels=docs&amp;projects=&amp;template=docs-issue.yml&amp;title=docs">
            Report a documentation issue
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/ibis-project/ibis/issues/new?assignees=&amp;labels=feature&amp;projects=&amp;template=feature-request.yml&amp;title=feat">
            Submit a feature request
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/ibis-project/ibis/discussions/new?category=q-a">
            Ask the community for help
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Using DuckDB + Ibis for RAG</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">blog</div>
                <div class="quarto-category">llms</div>
                <div class="quarto-category">duckdb</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Cody Peterson </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 22, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#what-is-rag" id="toc-what-is-rag" class="nav-link" data-scroll-target="#what-is-rag">What is RAG?</a></li>
  <li><a href="#rag-over-ibis-documentation" id="toc-rag-over-ibis-documentation" class="nav-link" data-scroll-target="#rag-over-ibis-documentation">RAG over Ibis documentation</a>
  <ul class="collapse">
  <li><a href="#setup-code" id="toc-setup-code" class="nav-link" data-scroll-target="#setup-code">Setup code</a></li>
  <li><a href="#getting-the-data-into-duckdb" id="toc-getting-the-data-into-duckdb" class="nav-link" data-scroll-target="#getting-the-data-into-duckdb">Getting the data into DuckDB</a></li>
  <li><a href="#embedding-text-to-vectors" id="toc-embedding-text-to-vectors" class="nav-link" data-scroll-target="#embedding-text-to-vectors">Embedding text to vectors</a></li>
  <li><a href="#searching-with-cosine-similarity" id="toc-searching-with-cosine-similarity" class="nav-link" data-scroll-target="#searching-with-cosine-similarity">Searching with cosine similarity</a></li>
  </ul></li>
  <li><a href="#rag-pitfalls" id="toc-rag-pitfalls" class="nav-link" data-scroll-target="#rag-pitfalls">RAG pitfalls</a></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a>
  <ul class="collapse">
  <li><a href="#system-architecture" id="toc-system-architecture" class="nav-link" data-scroll-target="#system-architecture">System architecture</a></li>
  <li><a href="#cost-and-speed" id="toc-cost-and-speed" class="nav-link" data-scroll-target="#cost-and-speed">Cost and speed</a></li>
  <li><a href="#alternatives-to-vector-search-rag" id="toc-alternatives-to-vector-search-rag" class="nav-link" data-scroll-target="#alternatives-to-vector-search-rag">Alternatives to vector search RAG</a></li>
  </ul></li>
  <li><a href="#next-steps" id="toc-next-steps" class="nav-link" data-scroll-target="#next-steps">Next steps</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/ibis-project/ibis/edit/main/docs/posts/duckdb-for-rag/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/ibis-project/ibis/issues/new/choose" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>In this post, we’ll demonstrate traditional retrieval-augmented generation (RAG) with DuckDB and OpenAI via Ibis and discuss the pros and cons. Notice that because Ibis is portable, you can use (almost) any database Ibis supports for RAG!</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Which databases can I use?">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Which databases can I use?
</div>
</div>
<div class="callout-body-container callout-body">
<p>The database must support array types and have some form of similarity metric between arrays of numbers. Alternatively, a custom user-defined function (UDF) can be used for the similarity metric.</p>
<p>The performance of calculating similarity will also be much faster if the database supports <a href="https://duckdb.org/docs/sql/data_types/array">fixed-sized arrays</a> as DuckDB recently launched in version 0.10.0. We’re still using 0.9.2 in this post, but it’ll be easy to upgrade.</p>
</div>
</div>
<p><a href="../../posts/why-duckdb/index.html">DuckDB is the default backend for Ibis</a> and makes rapid prototyping locally very easy. You can deploy it to <a href="https://motherduck.com">MotherDuck</a> just by changing the connection string, or swap out DuckDB for another Ibis backend.</p>
</section>
<section id="what-is-rag" class="level2">
<h2 class="anchored" data-anchor-id="what-is-rag">What is RAG?</h2>
<p>Retrieval-augmented generation (RAG) is a technique for language model systems to retrieve relevant information from a knowledge base, augment the model’s input with that knowledge, and then generate a response. It serves to provide useful context given language models’ context length limitations and increase the quality of the response.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Is RAG dead?">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Is RAG dead?
</div>
</div>
<div class="callout-body-container callout-body">
<p>With increasing language model context lengths, is RAG dead?</p>
<p><strong>No</strong>. Though as we’ll discuss later, it’s unclear if traditional vector similarity search RAG is the best approach. Regardless, just because a language model can use the entire content of a textbook doesn’t mean you’ll get better performance (accuracy or efficiency) than first retrieving the relevant subsets of the textbook.</p>
</div>
</div>
<p>Traditional RAG embeds text into vectors of numbers and then computes a similarity metric between input text and the knowledge base to determine the most relevant context.</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">graph LR
    style T fill:#1E90FF,stroke:#1E90FF,color:#ffffff
    style N fill:#1E90FF,stroke:#1E90FF,color:#ffffff
    style C fill:#1E90FF,stroke:#1E90FF,color:#ffffff

    T("text") --&gt; N("numbers (embedding vector)")
    N --&gt; C("compute similarity metric")
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>Let’s jump into the code!</p>
</section>
<section id="rag-over-ibis-documentation" class="level2">
<h2 class="anchored" data-anchor-id="rag-over-ibis-documentation">RAG over Ibis documentation</h2>
<p>We’ll use the Ibis documentation as our knowledge base.</p>
<section id="setup-code" class="level3">
<h3 class="anchored" data-anchor-id="setup-code">Setup code</h3>
<p>First we need to install and import the necessary packages:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install <span class="st">'ibis-framework[duckdb]'</span> openai python-dotenv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="c22a6ef3" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="annotated-cell-2"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><button class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="1">1</button><span id="annotated-cell-2-1" class="code-annotation-target"><a href="#annotated-cell-2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="annotated-cell-2-2"><a href="#annotated-cell-2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ibis</span>
<span id="annotated-cell-2-3"><a href="#annotated-cell-2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-2-4"><a href="#annotated-cell-2-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="annotated-cell-2-5"><a href="#annotated-cell-2-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="annotated-cell-2-6"><a href="#annotated-cell-2-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-2" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="1,6" data-code-annotation="1">Import the libraries we’ll use.</span>
</dd>
</dl>
</div>
</div>
<p>We need to set the <code>OPENAI_API_KEY</code> environment variable to our OpenAI API key. Do this by creating a <code>.env</code> file in the same directory as the code and adding the following line:</p>
<div class="sourceCode" id="annotated-cell-3"><pre class="sourceCode txt code-annotation-code code-with-copy code-annotated"><code class="sourceCode default"><button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="1">1</button><span id="annotated-cell-3-1" class="code-annotation-target"><a href="#annotated-cell-3-1" aria-hidden="true" tabindex="-1"></a>OPENAI_API_KEY=&lt;your-api-key&gt;</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-3" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="1" data-code-annotation="1">Replace with your OpenAI API key.</span>
</dd>
</dl>
<p>Then load the environment variables:</p>
<div id="81edc5fc" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="annotated-cell-4"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="1">1</button><span id="annotated-cell-4-1" class="code-annotation-target"><a href="#annotated-cell-4-1" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-4" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="1" data-code-annotation="1">Load environment variables from the <code>.env</code> file.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>True</code></pre>
</div>
</div>
<p>Now we’re ready to make OpenAI calls.</p>
<p>Let’s also setup Ibis for interactive use:</p>
<div id="8eb1e5aa" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="annotated-cell-5"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="1">1</button><span id="annotated-cell-5-1" class="code-annotation-target"><a href="#annotated-cell-5-1" aria-hidden="true" tabindex="-1"></a>ibis.options.interactive <span class="op">=</span> <span class="va">True</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-5" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="1" data-code-annotation="1">Turn on Ibis interactive mode.</span>
</dd>
</dl>
</div>
</div>
</section>
<section id="getting-the-data-into-duckdb" class="level3">
<h3 class="anchored" data-anchor-id="getting-the-data-into-duckdb">Getting the data into DuckDB</h3>
<p>Let’s prepare to ingest all the Quarto markdown files into a DuckDB database called <code>rag.ddb</code>:</p>
<div id="4e9b28a6" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="annotated-cell-6"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="1">1</button><span id="annotated-cell-6-1" class="code-annotation-target"><a href="#annotated-cell-6-1" aria-hidden="true" tabindex="-1"></a>rag_con <span class="op">=</span> ibis.<span class="ex">connect</span>(<span class="st">"duckdb://rag.ddb"</span>)</span>
<span id="annotated-cell-6-2"><a href="#annotated-cell-6-2" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="2">2</button><span id="annotated-cell-6-3" class="code-annotation-target"><a href="#annotated-cell-6-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> table <span class="kw">in</span> rag_con.list_tables():</span>
<span id="annotated-cell-6-4"><a href="#annotated-cell-6-4" aria-hidden="true" tabindex="-1"></a>    rag_con.drop_table(table)</span>
<span id="annotated-cell-6-5"><a href="#annotated-cell-6-5" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="3">3</button><span id="annotated-cell-6-6" class="code-annotation-target"><a href="#annotated-cell-6-6" aria-hidden="true" tabindex="-1"></a>rag_con.list_tables()</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-6" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="1" data-code-annotation="1">Create the Ibis connection to the DuckDB database.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="3,4" data-code-annotation="2">Drop any existing tables from previous runs.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="6" data-code-annotation="3">List the tables in the database to show that there are none.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>[]</code></pre>
</div>
</div>
<p>We’ll walk through the Ibis <code>docs/</code> directory. For <code>.qmd</code> files, read the contents and insert them into the <code>ibis</code> table:</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>We are running this blog within the Ibis repository. To run this on your own data, adjust the code accordingly!</p>
</div>
</div>
<div id="c3e282a3" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="annotated-cell-7"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="1">1</button><span id="annotated-cell-7-1" class="code-annotation-target"><a href="#annotated-cell-7-1" aria-hidden="true" tabindex="-1"></a>table_name <span class="op">=</span> <span class="st">"ibis"</span></span>
<span id="annotated-cell-7-2"><a href="#annotated-cell-7-2" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="2">2</button><span id="annotated-cell-7-3" class="code-annotation-target"><a href="#annotated-cell-7-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> filepath <span class="kw">in</span> Path(ibis.<span class="va">__file__</span>).parents[<span class="dv">1</span>].joinpath(<span class="st">"docs"</span>).rglob(<span class="st">"*.qmd"</span>):</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="3">3</button><span id="annotated-cell-7-4" class="code-annotation-target"><a href="#annotated-cell-7-4" aria-hidden="true" tabindex="-1"></a>    contents <span class="op">=</span> filepath.read_text()</span>
<span id="annotated-cell-7-5"><a href="#annotated-cell-7-5" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="4">4</button><span id="annotated-cell-7-6" class="code-annotation-target"><a href="#annotated-cell-7-6" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {</span>
<span id="annotated-cell-7-7"><a href="#annotated-cell-7-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"filepath"</span>: [<span class="bu">str</span>(filepath).split(<span class="st">"ibis/"</span>)[<span class="dv">1</span>]],</span>
<span id="annotated-cell-7-8"><a href="#annotated-cell-7-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"contents"</span>: [contents],</span>
<span id="annotated-cell-7-9"><a href="#annotated-cell-7-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="annotated-cell-7-10"><a href="#annotated-cell-7-10" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="5">5</button><span id="annotated-cell-7-11" class="code-annotation-target"><a href="#annotated-cell-7-11" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> ibis.memtable(data)</span>
<span id="annotated-cell-7-12"><a href="#annotated-cell-7-12" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="6">6</button><span id="annotated-cell-7-13" class="code-annotation-target"><a href="#annotated-cell-7-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">"ibis"</span> <span class="kw">not</span> <span class="kw">in</span> rag_con.list_tables():</span>
<span id="annotated-cell-7-14"><a href="#annotated-cell-7-14" aria-hidden="true" tabindex="-1"></a>        rag_con.create_table(<span class="st">"ibis"</span>, t)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="7">7</button><span id="annotated-cell-7-15" class="code-annotation-target"><a href="#annotated-cell-7-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="annotated-cell-7-16"><a href="#annotated-cell-7-16" aria-hidden="true" tabindex="-1"></a>        rag_con.insert(<span class="st">"ibis"</span>, t)</span>
<span id="annotated-cell-7-17"><a href="#annotated-cell-7-17" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="8">8</button><span id="annotated-cell-7-18" class="code-annotation-target"><a href="#annotated-cell-7-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> table <span class="kw">in</span> rag_con.list_tables():</span>
<span id="annotated-cell-7-19"><a href="#annotated-cell-7-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">"memtable"</span> <span class="kw">in</span> table:</span>
<span id="annotated-cell-7-20"><a href="#annotated-cell-7-20" aria-hidden="true" tabindex="-1"></a>        rag_con.drop_view(table)</span>
<span id="annotated-cell-7-21"><a href="#annotated-cell-7-21" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="9">9</button><span id="annotated-cell-7-22" class="code-annotation-target"><a href="#annotated-cell-7-22" aria-hidden="true" tabindex="-1"></a>rag_con.list_tables()</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-7" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="1" data-code-annotation="1">Define the table name.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="3" data-code-annotation="2">Walk through the <code>docs/</code> directory and find all <code>.qmd</code> files.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="4" data-code-annotation="3">Read the contents of each file.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="6,9" data-code-annotation="4">Create a dictionary with the file path and contents.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="11" data-code-annotation="5">Create an Ibis memtable from the dictionary.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="13,14" data-code-annotation="6">If the table doesn’t exist, create it and insert the data.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="15,16" data-code-annotation="7">Otherwise, insert the data into the existing table.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="8">8</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="18,19,20" data-code-annotation="8">Drop any memtables that were created.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="9">9</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="22" data-code-annotation="9">List the tables in the database to show that the <code>ibis</code> table was created.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>['ibis']</code></pre>
</div>
</div>
<p>Let’s inspect the table:</p>
<div id="67710c75" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="annotated-cell-8"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><button class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="1">1</button><span id="annotated-cell-8-1" class="code-annotation-target"><a href="#annotated-cell-8-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> rag_con.table(table_name)</span>
<span id="annotated-cell-8-2"><a href="#annotated-cell-8-2" aria-hidden="true" tabindex="-1"></a>t</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-8" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="1" data-code-annotation="1">Get the <code>ibis</code> table from the DuckDB database.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> filepath                               </span>┃<span style="font-weight: bold"> contents                                                                                  </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                                                                    │
├────────────────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">docs/why.qmd                          </span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Why Ibis?"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">Ibis is the portable Python dataframe library.</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">If …   </span> │
│ <span style="color: #008000; text-decoration-color: #008000">docs/404.qmd                          </span> │ <span style="color: #008000; text-decoration-color: #008000"># Page not found</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">The page you requested cannot be found (perhaps it was moved …       </span> │
│ <span style="color: #008000; text-decoration-color: #008000">docs/support_matrix.qmd               </span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Operation support matrix"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">format: dashboard</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">hide:</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">  - toc</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">## {…  </span> │
│ <span style="color: #008000; text-decoration-color: #008000">docs/index.qmd                        </span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Ibis"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">description: "the portable Python dataframe library"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">repo-act…      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">docs/install.qmd                      </span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">hide:</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">  - toc</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">  - navigation</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">  - footer</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000"># Installation</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">{{&lt; include ./…</span> │
│ <span style="color: #008000; text-decoration-color: #008000">docs/getting-started.qmd              </span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Getting started"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">sidebar: getting-started</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">Welcome to the Ibis …    </span> │
│ <span style="color: #008000; text-decoration-color: #008000">docs/posts.qmd                        </span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Posts"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">listing:</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">  contents: posts</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">  sort: "date desc"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">  image-place…    </span> │
│ <span style="color: #008000; text-decoration-color: #008000">docs/presentations.qmd                </span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Presentations"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">sidebar: presentations</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">Ibis presentations are l…    </span> │
│ <span style="color: #008000; text-decoration-color: #008000">docs/posts/bigquery-arrays/index.qmd  </span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: Working with arrays in Google BigQuery</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: "Phillip Cloud"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">date:…      </span> │
│ <span style="color: #008000; text-decoration-color: #008000">docs/posts/website-to-quarto/index.qmd</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Migrating Ibis documentation to Quarto"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: "Cody"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">date: "2023-…      </span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                                                         │
└────────────────────────────────────────┴───────────────────────────────────────────────────────────────────────────────────────────┘
</pre>
</div>
</div>
<p>Now we have a DuckDB database with the <code>ibis</code> table containing all the file paths and contents of the Quarto markdown files in the <code>ibis</code> repository. You can adjust this code to work with any repository and any file type(s)! For instance, we may also want to ingest all the <code>.py</code> files in the Ibis repsoitory.</p>
</section>
<section id="embedding-text-to-vectors" class="level3">
<h3 class="anchored" data-anchor-id="embedding-text-to-vectors">Embedding text to vectors</h3>
<p>To search for similar text in traditional RAG fashion, we need to <strong>embed</strong> the text into vectors. We can use <a href="https://platform.openai.com/docs/guides/embeddings/embedding-models">OpenAI’s embedding models</a> to perform this step.</p>
<p>Note that the maximum length of input <strong>tokens</strong> is 8,191. A word typically consists of 1-3 tokens. To estimate the number of tokens of a string in Python, we can divide the length of that string by 4. This isn’t perfect, but will work for now. Let’s augmented our data with the estimated number of tokens and sort from largest to smallest:</p>
<div id="1783de45" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="annotated-cell-9"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-9-1"><a href="#annotated-cell-9-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> (</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="1">1</button><span id="annotated-cell-9-2" class="code-annotation-target"><a href="#annotated-cell-9-2" aria-hidden="true" tabindex="-1"></a>    t.mutate(tokens_estimate<span class="op">=</span>t[<span class="st">"contents"</span>].length() <span class="op">//</span> <span class="dv">4</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="2">2</button><span id="annotated-cell-9-3" class="code-annotation-target"><a href="#annotated-cell-9-3" aria-hidden="true" tabindex="-1"></a>    .order_by(ibis._[<span class="st">"tokens_estimate"</span>].desc())</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="3">3</button><span id="annotated-cell-9-4" class="code-annotation-target"><a href="#annotated-cell-9-4" aria-hidden="true" tabindex="-1"></a>    .relocate(<span class="st">"filepath"</span>, <span class="st">"tokens_estimate"</span>)</span>
<span id="annotated-cell-9-5"><a href="#annotated-cell-9-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="annotated-cell-9-6"><a href="#annotated-cell-9-6" aria-hidden="true" tabindex="-1"></a>t</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-9" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="2" data-code-annotation="1">Augment the table with the estimated number of tokens.</span>
</dd>
<dt data-target-cell="annotated-cell-9" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="3" data-code-annotation="2">Sort the table by the estimated number of tokens in descending order.</span>
</dd>
<dt data-target-cell="annotated-cell-9" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="4" data-code-annotation="3">Relocate the <code>filepath</code> and <code>tokens_estimate</code> columns to the front of the table.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> filepath                                      </span>┃<span style="font-weight: bold"> tokens_estimate </span>┃<span style="font-weight: bold"> contents                                                                             </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                                                               │
├───────────────────────────────────────────────┼─────────────────┼──────────────────────────────────────────────────────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">docs/posts/ibis-analytics/index.qmd          </span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">14401</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: Modern, hybrid, open analytics</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: "Cody"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">date: "2024-01-25"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">ima…</span> │
│ <span style="color: #008000; text-decoration-color: #008000">docs/backends/impala.qmd                     </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">7677</span> │ <span style="color: #008000; text-decoration-color: #008000"># Impala</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">[https://impala.apache.org](https://impala.apache.org)</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">![](https://i…</span> │
│ <span style="color: #008000; text-decoration-color: #008000">docs/tutorials/ibis-for-sql-users.qmd        </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6777</span> │ <span style="color: #008000; text-decoration-color: #008000"># Tutorial: Ibis for SQL users</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">## Prerequisites</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">{{&lt; include ../_tabsets/insta…</span> │
│ <span style="color: #008000; text-decoration-color: #008000">docs/posts/lms-for-data/index.qmd            </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5508</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Using language models for data"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: "Cody Peterson"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">date: "2024… </span> │
│ <span style="color: #008000; text-decoration-color: #008000">docs/posts/pydata-performance/index.qmd      </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4801</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Ibis versus X: Performance across the ecosystem part 1"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: "Ph…  </span> │
│ <span style="color: #008000; text-decoration-color: #008000">docs/tutorials/ibis-for-pandas-users.qmd     </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4455</span> │ <span style="color: #008000; text-decoration-color: #008000"># Tutorial: Ibis for pandas users</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">## Prerequisites</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">{{&lt; include ../_tabsets/in…</span> │
│ <span style="color: #008000; text-decoration-color: #008000">docs/posts/campaign-finance/index.qmd        </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4241</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Exploring campaign finance data"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: "Nick Crews"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">date: "2023-0… </span> │
│ <span style="color: #008000; text-decoration-color: #008000">docs/posts/duckdb-for-rag/index.qmd          </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3951</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Using DuckDB + Ibis for RAG"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: "Cody Peterson"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">date: "2024-02… </span> │
│ <span style="color: #008000; text-decoration-color: #008000">docs/posts/backend-agnostic-arrays/index.qmd </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3471</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: Backend agnostic arrays</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: "Phillip Cloud"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">date: 2024-01-19</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">cat…</span> │
│ <span style="color: #008000; text-decoration-color: #008000">docs/posts/ibis_substrait_to_duckdb/index.qmd</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3323</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Ibis + Substrait + DuckDB"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: Gil Forsyth</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">date: 2023-02-01</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">cat…</span> │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                             │               <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                                                    │
└───────────────────────────────────────────────┴─────────────────┴──────────────────────────────────────────────────────────────────────────────────────┘
</pre>
</div>
</div>
<p>The longest text is certainly over our embedding model’s token limit, and the second longest might be as well. In practice, we’d want to chunk our text into smaller pieces. This is its own challenge, but for the purposes of this demonstration we’ll just ignore text that is too long.</p>
<p>Let’s define our embedding functions:</p>
<div id="9e935b47" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="annotated-cell-10"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="1">1</button><span id="annotated-cell-10-1" class="code-annotation-target"><a href="#annotated-cell-10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _embed(text: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">list</span>[<span class="bu">float</span>]:</span>
<span id="annotated-cell-10-2"><a href="#annotated-cell-10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Text to fixed-length array embedding."""</span></span>
<span id="annotated-cell-10-3"><a href="#annotated-cell-10-3" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="2">2</button><span id="annotated-cell-10-4" class="code-annotation-target"><a href="#annotated-cell-10-4" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> <span class="st">"text-embedding-3-small"</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="3">3</button><span id="annotated-cell-10-5" class="code-annotation-target"><a href="#annotated-cell-10-5" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> text.replace(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>, <span class="st">" "</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="4">4</button><span id="annotated-cell-10-6" class="code-annotation-target"><a href="#annotated-cell-10-6" aria-hidden="true" tabindex="-1"></a>    client <span class="op">=</span> OpenAI()</span>
<span id="annotated-cell-10-7"><a href="#annotated-cell-10-7" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="5">5</button><span id="annotated-cell-10-8" class="code-annotation-target"><a href="#annotated-cell-10-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="6">6</button><span id="annotated-cell-10-9" class="code-annotation-target"><a href="#annotated-cell-10-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (</span>
<span id="annotated-cell-10-10"><a href="#annotated-cell-10-10" aria-hidden="true" tabindex="-1"></a>            client.embeddings.create(<span class="bu">input</span><span class="op">=</span>[text], model<span class="op">=</span>model).data[<span class="dv">0</span>].embedding</span>
<span id="annotated-cell-10-11"><a href="#annotated-cell-10-11" aria-hidden="true" tabindex="-1"></a>        )</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="7">7</button><span id="annotated-cell-10-12" class="code-annotation-target"><a href="#annotated-cell-10-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="annotated-cell-10-13"><a href="#annotated-cell-10-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(e)</span>
<span id="annotated-cell-10-14"><a href="#annotated-cell-10-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span>
<span id="annotated-cell-10-15"><a href="#annotated-cell-10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-10-16"><a href="#annotated-cell-10-16" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="8">8</button><span id="annotated-cell-10-17" class="code-annotation-target"><a href="#annotated-cell-10-17" aria-hidden="true" tabindex="-1"></a><span class="at">@ibis.udf.scalar.python</span></span>
<span id="annotated-cell-10-18"><a href="#annotated-cell-10-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> embed(text: <span class="bu">str</span>, tokens_estimate: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="bu">list</span>[<span class="bu">float</span>]:</span>
<span id="annotated-cell-10-19"><a href="#annotated-cell-10-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Text to fixed-length array embedding."""</span></span>
<span id="annotated-cell-10-20"><a href="#annotated-cell-10-20" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="9">9</button><span id="annotated-cell-10-21" class="code-annotation-target"><a href="#annotated-cell-10-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="dv">0</span> <span class="op">&lt;</span> tokens_estimate <span class="op">&lt;</span> <span class="dv">8191</span>:</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="10">10</button><span id="annotated-cell-10-22" class="code-annotation-target"><a href="#annotated-cell-10-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> _embed(text)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="11">11</button><span id="annotated-cell-10-23" class="code-annotation-target"><a href="#annotated-cell-10-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-10" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="1,2" data-code-annotation="1">Define a regular Python function to embed text.</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="4" data-code-annotation="2">Define the embedding model to use.</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="5" data-code-annotation="3">Replace newlines with spaces.</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="6" data-code-annotation="4">Create an OpenAI client.</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="8" data-code-annotation="5">Since it’s an external API call, we need to handle exceptions.</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="9,11" data-code-annotation="6">Call the OpenAI API to embed the text.</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="12,13,14" data-code-annotation="7">Handle exceptions and return <code>None</code> if an error occurs.</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="8">8</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="17,18,19" data-code-annotation="8">Define an Ibis UDF using the Python function.</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="9">9</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="21" data-code-annotation="9">If the estimated number of tokens is within the limit…</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="10">10</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="22" data-code-annotation="10">…call the Python function to embed the text.</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="11">11</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="23" data-code-annotation="11">Otherwise, return <code>None</code>.</span>
</dd>
</dl>
</div>
</div>
<p>Let’s embed the text:</p>
<div id="eaa47383" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="annotated-cell-11"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><button class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="1">1</button><span id="annotated-cell-11-1" class="code-annotation-target"><a href="#annotated-cell-11-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> t.mutate(</span>
<span id="annotated-cell-11-2"><a href="#annotated-cell-11-2" aria-hidden="true" tabindex="-1"></a>    embedding<span class="op">=</span>embed(t[<span class="st">"contents"</span>], t[<span class="st">"tokens_estimate"</span>])</span>
<span id="annotated-cell-11-3"><a href="#annotated-cell-11-3" aria-hidden="true" tabindex="-1"></a>).cache()</span>
<span id="annotated-cell-11-4"><a href="#annotated-cell-11-4" aria-hidden="true" tabindex="-1"></a>t</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-11" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="1,2,3" data-code-annotation="1">Augment the table with the embedded text and cache the result.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Error code: 400 - {'error': {'message': "This model's maximum context length is 8192 tokens, however you requested 8413 tokens (8413 in your prompt; 0 for the completion). Please reduce your prompt; or completion length.", 'type': 'invalid_request_error', 'param': None, 'code': None}}</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b6f82069965c447980822b582e732f47","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> filepath                                      </span>┃<span style="font-weight: bold"> tokens_estimate </span>┃<span style="font-weight: bold"> contents                                                                             </span>┃<span style="font-weight: bold"> embedding                                                   </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                        │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                                                               │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;float64&gt;</span>                                              │
├───────────────────────────────────────────────┼─────────────────┼──────────────────────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┤
│ <span style="color: #008000; text-decoration-color: #008000">docs/posts/ibis-analytics/index.qmd          </span> │           <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">14401</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: Modern, hybrid, open analytics</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: "Cody"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">date: "2024-01-25"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">ima…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>                                                        │
│ <span style="color: #008000; text-decoration-color: #008000">docs/backends/impala.qmd                     </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">7677</span> │ <span style="color: #008000; text-decoration-color: #008000"># Impala</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">[https://impala.apache.org](https://impala.apache.org)</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">![](https://i…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">NULL</span>                                                        │
│ <span style="color: #008000; text-decoration-color: #008000">docs/tutorials/ibis-for-sql-users.qmd        </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">6777</span> │ <span style="color: #008000; text-decoration-color: #008000"># Tutorial: Ibis for SQL users</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">## Prerequisites</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">{{&lt; include ../_tabsets/insta…</span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.032762881368398666</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.03934009373188019</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>     │
│ <span style="color: #008000; text-decoration-color: #008000">docs/posts/lms-for-data/index.qmd            </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5508</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Using language models for data"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: "Cody Peterson"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">date: "2024… </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.019190069288015366</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.041595082730054855</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>    │
│ <span style="color: #008000; text-decoration-color: #008000">docs/posts/pydata-performance/index.qmd      </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4801</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Ibis versus X: Performance across the ecosystem part 1"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: "Ph…  </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.00992082990705967</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.00490616587921977</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>       │
│ <span style="color: #008000; text-decoration-color: #008000">docs/tutorials/ibis-for-pandas-users.qmd     </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4455</span> │ <span style="color: #008000; text-decoration-color: #008000"># Tutorial: Ibis for pandas users</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">## Prerequisites</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">{{&lt; include ../_tabsets/in…</span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.007494321092963219</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.028004156425595284</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>    │
│ <span style="color: #008000; text-decoration-color: #008000">docs/posts/campaign-finance/index.qmd        </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4241</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Exploring campaign finance data"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: "Nick Crews"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">date: "2023-0… </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.01551054883748293</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.01505258958786726</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>      │
│ <span style="color: #008000; text-decoration-color: #008000">docs/posts/duckdb-for-rag/index.qmd          </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3951</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Using DuckDB + Ibis for RAG"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: "Cody Peterson"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">date: "2024-02… </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.018623681738972664</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.05166473984718323</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>     │
│ <span style="color: #008000; text-decoration-color: #008000">docs/posts/backend-agnostic-arrays/index.qmd </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3471</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: Backend agnostic arrays</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: "Phillip Cloud"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">date: 2024-01-19</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">cat…</span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.0014422409003600478</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.0041314102709293365</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span> │
│ <span style="color: #008000; text-decoration-color: #008000">docs/posts/ibis_substrait_to_duckdb/index.qmd</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3323</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Ibis + Substrait + DuckDB"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: Gil Forsyth</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">date: 2023-02-01</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">cat…</span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.02641780860722065</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.06054646894335747</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>      │
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                             │               <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                                                    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                           │
└───────────────────────────────────────────────┴─────────────────┴──────────────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────────┘
</pre>
</div>
</div>
<p>Notice there was one error – that second row’s content was indeed too long! Our token estimate is a bit off, but overall useful. We accounted for this possibility in our Python UDF above, returning <code>None</code> (mapped to <code>NULL</code> in DuckDB) when the text is too long or an error occurs.</p>
</section>
<section id="searching-with-cosine-similarity" class="level3">
<h3 class="anchored" data-anchor-id="searching-with-cosine-similarity">Searching with cosine similarity</h3>
<p>Cosine similarity over vectors is a common way to measure similarity for RAG applications. We’ll explore its downsides later. We need to make Ibis aware of DuckDB’s built-in <code>list_cosine_similarity</code> function:</p>
<div id="866b828a" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="annotated-cell-12"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="1">1</button><span id="annotated-cell-12-1" class="code-annotation-target"><a href="#annotated-cell-12-1" aria-hidden="true" tabindex="-1"></a><span class="at">@ibis.udf.scalar.builtin</span></span>
<span id="annotated-cell-12-2"><a href="#annotated-cell-12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> list_cosine_similarity(x, y) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="annotated-cell-12-3"><a href="#annotated-cell-12-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Compute cosine similarity between two vectors."""</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-12" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="1,2,3" data-code-annotation="1">Use an Ibis builtin UDF to define a cosine similarity function.</span>
</dd>
</dl>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>If using a different backend, you’ll need to use its corresponding cosine similarity function or define your own.</p>
</div>
</div>
<p>Now we can search for similar text in the documentation:</p>
<div id="87066e2b" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="annotated-cell-13"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><button class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="1">1</button><span id="annotated-cell-13-1" class="code-annotation-target"><a href="#annotated-cell-13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> search_docs(text):</span>
<span id="annotated-cell-13-2"><a href="#annotated-cell-13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Search documentation for similar text, returning a sorted table"""</span></span>
<span id="annotated-cell-13-3"><a href="#annotated-cell-13-3" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="2">2</button><span id="annotated-cell-13-4" class="code-annotation-target"><a href="#annotated-cell-13-4" aria-hidden="true" tabindex="-1"></a>    embedding <span class="op">=</span> _embed(text)</span>
<span id="annotated-cell-13-5"><a href="#annotated-cell-13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-13-6"><a href="#annotated-cell-13-6" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> (</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="3">3</button><span id="annotated-cell-13-7" class="code-annotation-target"><a href="#annotated-cell-13-7" aria-hidden="true" tabindex="-1"></a>        t.mutate(similarity<span class="op">=</span>list_cosine_similarity(t[<span class="st">"embedding"</span>], embedding))</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="4">4</button><span id="annotated-cell-13-8" class="code-annotation-target"><a href="#annotated-cell-13-8" aria-hidden="true" tabindex="-1"></a>        .relocate(<span class="st">"similarity"</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="5">5</button><span id="annotated-cell-13-9" class="code-annotation-target"><a href="#annotated-cell-13-9" aria-hidden="true" tabindex="-1"></a>        .order_by(ibis._[<span class="st">"similarity"</span>].desc())</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="6">6</button><span id="annotated-cell-13-10" class="code-annotation-target"><a href="#annotated-cell-13-10" aria-hidden="true" tabindex="-1"></a>        .cache()</span>
<span id="annotated-cell-13-11"><a href="#annotated-cell-13-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="annotated-cell-13-12"><a href="#annotated-cell-13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-13-13"><a href="#annotated-cell-13-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> s</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-13" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="1,2" data-code-annotation="1">Define a function to search the documentation.</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="4" data-code-annotation="2">Embed the input text.</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="7" data-code-annotation="3">Augment the table with the cosine similarity between the embedded text and the input text.</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="8" data-code-annotation="4">Relocate the <code>similarity</code> column to the front of the table.</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="9" data-code-annotation="5">Sort the table by the cosine similarity in descending order.</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="10" data-code-annotation="6">Cache the result.</span>
</dd>
</dl>
</div>
</div>
<div id="e6cdf0cc" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> <span class="st">"where can I chat with the community about Ibis?"</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>search_docs(text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> similarity </span>┃<span style="font-weight: bold"> filepath                                                     </span>┃<span style="font-weight: bold"> tokens_estimate </span>┃<span style="font-weight: bold"> contents                                                                               </span>┃<span style="font-weight: bold"> embedding                                                 </span>┃
┡━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                                       │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                                                                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;float64&gt;</span>                                            │
├────────────┼──────────────────────────────────────────────────────────────┼─────────────────┼────────────────────────────────────────────────────────────────────────────────────────┼───────────────────────────────────────────────────────────┤
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.661852</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/posts/zulip/index.qmd                                  </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">440</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Announcing Zulip for Ibis community chat"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: "Ibis team"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">date:…   </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.00033197790617123246</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.05603647977113724</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>  │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.578235</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/concepts/who.qmd                                       </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">800</span> │ <span style="color: #008000; text-decoration-color: #008000"># Who supports Ibis?</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">Ibis is an open-source project that welcomes contribution…    </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.006300679408013821</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.05288177356123924</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>   │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.569246</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/why.qmd                                                </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">731</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Why Ibis?"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">Ibis is the portable Python dataframe library.</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">If …</span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.00048549860366620123</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.05761361122131348</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span> │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.560286</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/concepts/user-testimonials.qmd                         </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1079</span> │ <span style="color: #008000; text-decoration-color: #008000"># User testimonials</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">This page collects user testimonials about Ibis from the c…    </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.013335400260984898</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.034098923206329346</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>  │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.551246</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/getting-started.qmd                                    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">157</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Getting started"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">sidebar: getting-started</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">Welcome to the Ibis … </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.035996999591588974</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.03943954035639763</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>   │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.527626</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/contribute/02_workflow.qmd                             </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">574</span> │ <span style="color: #008000; text-decoration-color: #008000"># Contribute to the Ibis codebase</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">## Getting started</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">First, set up a [develop…  </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.01897418312728405</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.05570495128631592</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>    │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.522431</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/posts/ibis-version-4.0.0-release/index.qmd             </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">743</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: Ibis v4.0.0</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: Patrick Clarke</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">date: 2023-01-09</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">categories:</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">    … </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.017321649938821793</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.05772090330719948</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>   │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.519414</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/posts/Ibis-version-3.0.0-release/index.qmd             </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2038</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: Ibis v3.0.0</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: Marlene Mhangami</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">date: 2022-04-25</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">categories:</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">  … </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.02136301063001156</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.03890605643391609</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>    │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.517491</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/tutorials/open-source-software/apache-flink/0_setup.qmd</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">425</span> │ <span style="color: #008000; text-decoration-color: #008000"># Getting started</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">In this tutorial, you will learn how to set up and use Flink…    </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.049202971160411835</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.037027861922979355</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>  │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.510845</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/_code/setup_penguins.qmd                               </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">85</span> │ <span style="color: #008000; text-decoration-color: #008000">```{python}</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">import ibis  # &lt;1&gt;</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">import ibis.selectors as s  # &lt;1&gt;</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">ibis.options.…  </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.009995625354349613</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.014497287571430206</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>  │
│          <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                            │               <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                                                      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                         │
└────────────┴──────────────────────────────────────────────────────────────┴─────────────────┴────────────────────────────────────────────────────────────────────────────────────────┴───────────────────────────────────────────────────────────┘
</pre>
</div>
</div>
<p>Now that we have retrieved the most similar documentation, we can augment our language model’s input with that context prior to generating a response! In practice, we’d probably want to set a similarity threshold and take the top <code>N</code> results. Chunking our text into smaller pieces and selecting from those results would also be a good idea.</p>
<p>Let’s try a few more queries:</p>
<div id="530385fa" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> <span class="st">"what do users say about Ibis?"</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>search_docs(text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> similarity </span>┃<span style="font-weight: bold"> filepath                                        </span>┃<span style="font-weight: bold"> tokens_estimate </span>┃<span style="font-weight: bold"> contents                                                                               </span>┃<span style="font-weight: bold"> embedding                                                 </span>┃
┡━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                                                                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;float64&gt;</span>                                            │
├────────────┼─────────────────────────────────────────────────┼─────────────────┼────────────────────────────────────────────────────────────────────────────────────────┼───────────────────────────────────────────────────────────┤
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.574682</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/concepts/user-testimonials.qmd            </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1079</span> │ <span style="color: #008000; text-decoration-color: #008000"># User testimonials</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">This page collects user testimonials about Ibis from the c…    </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.013335400260984898</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.034098923206329346</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>  │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.562258</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/why.qmd                                   </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">731</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Why Ibis?"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">Ibis is the portable Python dataframe library.</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">If …</span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.00048549860366620123</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.05761361122131348</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span> │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.544948</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/concepts/who.qmd                          </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">800</span> │ <span style="color: #008000; text-decoration-color: #008000"># Who supports Ibis?</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">Ibis is an open-source project that welcomes contribution…    </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.006300679408013821</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.05288177356123924</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>   │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.528427</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/posts/zulip/index.qmd                     </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">440</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Announcing Zulip for Ibis community chat"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: "Ibis team"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">date:…   </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.00033197790617123246</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.05603647977113724</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>  │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.523075</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/getting-started.qmd                       </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">157</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Getting started"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">sidebar: getting-started</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">Welcome to the Ibis … </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.035996999591588974</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.03943954035639763</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>   │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.516679</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/posts/ibis-version-4.0.0-release/index.qmd</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">743</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: Ibis v4.0.0</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: Patrick Clarke</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">date: 2023-01-09</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">categories:</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">    … </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.017321649938821793</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.05772090330719948</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>   │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.500733</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/_tabsets/install_default.qmd              </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">127</span> │ <span style="color: #008000; text-decoration-color: #008000">We recommend starting with the default (DuckDB) backend for a performant, fully…      </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.004252271726727486</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.025945203378796577</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>  │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.497463</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/how-to/configure/basics.qmd               </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">611</span> │ <span style="color: #008000; text-decoration-color: #008000"># Basic configuration</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">If you don't have your own data, you can load example da…    </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.02095085009932518</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.04434989020228386</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>    │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.491889</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/posts/ibis-to-file/index.qmd              </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">700</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Ibis sneak peek: writing to files"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: Kae Suarez</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">date: 2023-03…   </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.02339361608028412</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.07014117389917374</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>     │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.484358</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/_code/setup_penguins.qmd                  </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">85</span> │ <span style="color: #008000; text-decoration-color: #008000">```{python}</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">import ibis  # &lt;1&gt;</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">import ibis.selectors as s  # &lt;1&gt;</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">ibis.options.…  </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.009995625354349613</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.014497287571430206</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>  │
│          <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                               │               <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                                                      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                         │
└────────────┴─────────────────────────────────────────────────┴─────────────────┴────────────────────────────────────────────────────────────────────────────────────────┴───────────────────────────────────────────────────────────┘
</pre>
</div>
</div>
<div id="340a7110" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> <span class="st">"can Ibis complete the one billion row challenge?"</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>search_docs(text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> similarity </span>┃<span style="font-weight: bold"> filepath                                        </span>┃<span style="font-weight: bold"> tokens_estimate </span>┃<span style="font-weight: bold"> contents                                                                               </span>┃<span style="font-weight: bold"> embedding                                                 </span>┃
┡━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                                                                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;float64&gt;</span>                                            │
├────────────┼─────────────────────────────────────────────────┼─────────────────┼────────────────────────────────────────────────────────────────────────────────────────┼───────────────────────────────────────────────────────────┤
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.608117</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/posts/1brc/index.qmd                      </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2129</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Using one Python dataframe API to take the billion row challenge wi…     </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.013509240001440048</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.0003828565531875938</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span> │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.504276</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/concepts/who.qmd                          </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">800</span> │ <span style="color: #008000; text-decoration-color: #008000"># Who supports Ibis?</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">Ibis is an open-source project that welcomes contribution…    </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.006300679408013821</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.05288177356123924</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>   │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.482052</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/presentations/overview.qmd                </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1697</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Ibis overview"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">format:</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">  revealjs:</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">    footer: &lt;https://ibis-projec…  </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.0015606271335855126</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.019388146698474884</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span> │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.473564</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/why.qmd                                   </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">731</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Why Ibis?"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">Ibis is the portable Python dataframe library.</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">If …</span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.00048549860366620123</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.05761361122131348</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span> │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.468842</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/posts/Ibis-version-3.0.0-release/index.qmd</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2038</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: Ibis v3.0.0</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: Marlene Mhangami</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">date: 2022-04-25</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">categories:</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">  … </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.02136301063001156</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.03890605643391609</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>    │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.465956</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/tutorials/data-platforms/clickhouse.qmd   </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">826</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: ClickHouse</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">freeze: auto</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">[Ibis](https://ibis-project.com) suppor… </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.027811484411358833</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.02419976517558098</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>   │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.465920</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/concepts/user-testimonials.qmd            </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1079</span> │ <span style="color: #008000; text-decoration-color: #008000"># User testimonials</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">This page collects user testimonials about Ibis from the c…    </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.013335400260984898</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.034098923206329346</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>  │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.456237</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/_code/setup_penguins.qmd                  </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">85</span> │ <span style="color: #008000; text-decoration-color: #008000">```{python}</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">import ibis  # &lt;1&gt;</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">import ibis.selectors as s  # &lt;1&gt;</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">ibis.options.…  </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.009995625354349613</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.014497287571430206</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>  │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.455206</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/how-to/visualization/seaborn.qmd          </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">159</span> │ <span style="color: #008000; text-decoration-color: #008000"># seaborn + Ibis</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">If you don't have data to visualize, you can load an example …    </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.012414666824042797</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.012007818557322025</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>  │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.453313</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/how-to/input-output/duckdb-parquet.qmd    </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">651</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: Read parquet files with Ibis</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">In this example, we will use Ibis'…  </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.01082119531929493</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.04467007517814636</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>     │
│          <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                               │               <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                                                      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                         │
└────────────┴─────────────────────────────────────────────────┴─────────────────┴────────────────────────────────────────────────────────────────────────────────────────┴───────────────────────────────────────────────────────────┘
</pre>
</div>
</div>
<div id="e11c996a" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> <span class="st">"teach me about the Polars backend"</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>search_docs(text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> similarity </span>┃<span style="font-weight: bold"> filepath                                        </span>┃<span style="font-weight: bold"> tokens_estimate </span>┃<span style="font-weight: bold"> contents                                                                               </span>┃<span style="font-weight: bold"> embedding                                                 </span>┃
┡━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                                                                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;float64&gt;</span>                                            │
├────────────┼─────────────────────────────────────────────────┼─────────────────┼────────────────────────────────────────────────────────────────────────────────────────┼───────────────────────────────────────────────────────────┤
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.597506</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/backends/polars.qmd                       </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">402</span> │ <span style="color: #008000; text-decoration-color: #008000"># Polars</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">[https://www.pola.rs](https://www.pola.rs)</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">{{&lt; include /_callouts/ex…  </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.04319469630718231</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.030947020277380943</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>   │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.396795</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/posts/pydata-performance-part2/index.qmd  </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1567</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Ibis versus X: Performance across the ecosystem part 2"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: "Ph…    </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.0013977460330352187</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.028734903782606125</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span> │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.364785</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/posts/ibis-version-4.0.0-release/index.qmd</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">743</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: Ibis v4.0.0</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: Patrick Clarke</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">date: 2023-01-09</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">categories:</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">    … </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.017321649938821793</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.05772090330719948</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>   │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.356085</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/_callouts/experimental_backend.qmd        </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">26</span> │ <span style="color: #008000; text-decoration-color: #008000">::: {.callout-warning}</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">This backend is experimental and is subject to backwards…     </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.017363416031003</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.03505472466349602</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>       │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.326378</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/how-to/input-output/multiple-backends.qmd </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">331</span> │ <span style="color: #008000; text-decoration-color: #008000"># Work with multiple backends</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">You can work with multiple backends by creating …    </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.014367456547915936</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.01823212020099163</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>   │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.324941</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/presentations/overview.qmd                </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1697</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Ibis overview"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">format:</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">  revealjs:</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">    footer: &lt;https://ibis-projec…  </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.0015606271335855126</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.019388146698474884</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span> │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.315046</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/backends/_templates/api.qmd               </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">121</span> │ <span style="color: #008000; text-decoration-color: #008000">```{python}</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">#| echo: false</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">#| output: asis</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">from _utils import get_backend, ren…  </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.013808815740048885</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.03160477802157402</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>   │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.311201</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/backends/postgresql.qmd                   </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">493</span> │ <span style="color: #008000; text-decoration-color: #008000"># PostgreSQL</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">[https://www.postgresql.org](https://www.postgresql.org)</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">![](htt…  </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.046312808990478516</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.031841542571783066</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>  │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.300936</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/posts/ibis-version-8.0.0-release/index.qmd</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2062</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Ibis 8.0: streaming and more!"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: "Ibis team"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">date: "2024-02-1…   </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.005049674306064844</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.03530928120017052</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>    │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.298417</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/why.qmd                                   </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">731</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Why Ibis?"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">Ibis is the portable Python dataframe library.</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">If …</span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.00048549860366620123</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.05761361122131348</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span> │
│          <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                               │               <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                                                      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                         │
└────────────┴─────────────────────────────────────────────────┴─────────────────┴────────────────────────────────────────────────────────────────────────────────────────┴───────────────────────────────────────────────────────────┘
</pre>
</div>
</div>
<div id="d64f362a" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> <span class="st">"why does Voltron Data support Ibis?"</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>search_docs(text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> similarity </span>┃<span style="font-weight: bold"> filepath                                        </span>┃<span style="font-weight: bold"> tokens_estimate </span>┃<span style="font-weight: bold"> contents                                                                               </span>┃<span style="font-weight: bold"> embedding                                                 </span>┃
┡━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                                                                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;float64&gt;</span>                                            │
├────────────┼─────────────────────────────────────────────────┼─────────────────┼────────────────────────────────────────────────────────────────────────────────────────┼───────────────────────────────────────────────────────────┤
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.679104</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/concepts/who.qmd                          </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">800</span> │ <span style="color: #008000; text-decoration-color: #008000"># Who supports Ibis?</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">Ibis is an open-source project that welcomes contribution…    </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.006300679408013821</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.05288177356123924</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>   │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.616018</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/posts/why-voda-supports-                  </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3056</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Why Voltron Data supports Ibis"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: "Cody Peterson + Ian Cook"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">…   </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.0027232086285948753</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.0460839718580246</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>   │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.582328</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/why.qmd                                   </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">731</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Why Ibis?"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">Ibis is the portable Python dataframe library.</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">If …</span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.00048549860366620123</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.05761361122131348</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span> │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.536979</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/_code/input_output_penguins.qmd           </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">947</span> │ <span style="color: #008000; text-decoration-color: #008000">## Data platforms</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">You can connect Ibis to any supported backend to read and wr…    </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.009215430356562138</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.020675163716077805</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>  │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.528810</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/concepts/user-testimonials.qmd            </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1079</span> │ <span style="color: #008000; text-decoration-color: #008000"># User testimonials</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">This page collects user testimonials about Ibis from the c…    </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.013335400260984898</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.034098923206329346</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>  │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.523802</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/presentations/overview.qmd                </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1697</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Ibis overview"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">format:</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">  revealjs:</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">    footer: &lt;https://ibis-projec…  </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.0015606271335855126</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.019388146698474884</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span> │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.516846</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/posts/ibis-version-4.0.0-release/index.qmd</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">743</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: Ibis v4.0.0</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: Patrick Clarke</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">date: 2023-01-09</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">categories:</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">    … </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.017321649938821793</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.05772090330719948</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>   │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.515140</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/concepts/composable-ecosystem.qmd         </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1490</span> │ <span style="color: #008000; text-decoration-color: #008000"># Composable data ecosystem</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">Ibis exists in a broader composable data ecosystem…    </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.0018551592947915196</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.0542871318757534</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>   │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.513805</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/backends/trino.qmd                        </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">743</span> │ <span style="color: #008000; text-decoration-color: #008000"># Trino</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">[https://trino.io](https://trino.io)</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">{{&lt; include /_callouts/experimen…  </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.04838176444172859</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.04063660651445389</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>    │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.500496</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/how-to/input-output/basics.qmd            </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">105</span> │ <span style="color: #008000; text-decoration-color: #008000"># Basic input/output</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">If you don't have your own data, you can load example dat…    </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.00725388852879405</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.047017041593790054</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>   │
│          <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                               │               <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                                                      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                         │
└────────────┴─────────────────────────────────────────────────┴─────────────────┴────────────────────────────────────────────────────────────────────────────────────────┴───────────────────────────────────────────────────────────┘
</pre>
</div>
</div>
<div id="9a238648" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> <span class="st">"why should I use Ibis?"</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>search_docs(text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> similarity </span>┃<span style="font-weight: bold"> filepath                                        </span>┃<span style="font-weight: bold"> tokens_estimate </span>┃<span style="font-weight: bold"> contents                                                                               </span>┃<span style="font-weight: bold"> embedding                                                 </span>┃
┡━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                                                                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;float64&gt;</span>                                            │
├────────────┼─────────────────────────────────────────────────┼─────────────────┼────────────────────────────────────────────────────────────────────────────────────────┼───────────────────────────────────────────────────────────┤
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.621761</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/why.qmd                                   </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">731</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Why Ibis?"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">Ibis is the portable Python dataframe library.</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">If …</span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.00048549860366620123</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.05761361122131348</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span> │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.589931</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/concepts/who.qmd                          </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">800</span> │ <span style="color: #008000; text-decoration-color: #008000"># Who supports Ibis?</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">Ibis is an open-source project that welcomes contribution…    </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.006300679408013821</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.05288177356123924</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>   │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.580506</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/_tabsets/install_default.qmd              </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">127</span> │ <span style="color: #008000; text-decoration-color: #008000">We recommend starting with the default (DuckDB) backend for a performant, fully…      </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.004252271726727486</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.025945203378796577</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>  │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.564820</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/concepts/user-testimonials.qmd            </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1079</span> │ <span style="color: #008000; text-decoration-color: #008000"># User testimonials</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">This page collects user testimonials about Ibis from the c…    </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.013335400260984898</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.034098923206329346</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>  │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.563156</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/getting-started.qmd                       </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">157</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Getting started"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">sidebar: getting-started</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">Welcome to the Ibis … </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.035996999591588974</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.03943954035639763</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>   │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.549894</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/_code/setup_penguins.qmd                  </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">85</span> │ <span style="color: #008000; text-decoration-color: #008000">```{python}</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">import ibis  # &lt;1&gt;</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">import ibis.selectors as s  # &lt;1&gt;</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">ibis.options.…  </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.009995625354349613</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.014497287571430206</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>  │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.545518</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/how-to/configure/basics.qmd               </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">611</span> │ <span style="color: #008000; text-decoration-color: #008000"># Basic configuration</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">If you don't have your own data, you can load example da…    </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.02095085009932518</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.04434989020228386</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>    │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.542379</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/posts/ibis-version-4.0.0-release/index.qmd</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">743</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: Ibis v4.0.0</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: Patrick Clarke</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">date: 2023-01-09</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">categories:</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">    … </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.017321649938821793</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.05772090330719948</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>   │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.539636</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/posts/ibis-to-file/index.qmd              </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">700</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Ibis sneak peek: writing to files"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: Kae Suarez</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">date: 2023-03…   </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.02339361608028412</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.07014117389917374</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>     │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.534821</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/_callouts/pypi_warning.qmd                </span> │              <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">59</span> │ <span style="color: #008000; text-decoration-color: #008000">::: {.callout-warning}</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">Note that the `ibis-framework` package is _not_ the same…     </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.0019332439405843616</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.01002512127161026</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>   │
│          <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                               │               <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                                                      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                         │
└────────────┴─────────────────────────────────────────────────┴─────────────────┴────────────────────────────────────────────────────────────────────────────────────────┴───────────────────────────────────────────────────────────┘
</pre>
</div>
</div>
<div id="3d02dbb7" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> <span class="st">"what is the Ibis roadmap?"</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>search_docs(text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> similarity </span>┃<span style="font-weight: bold"> filepath                                        </span>┃<span style="font-weight: bold"> tokens_estimate </span>┃<span style="font-weight: bold"> contents                                                                               </span>┃<span style="font-weight: bold"> embedding                                                 </span>┃
┡━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>    │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                          │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">int64</span>           │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>                                                                                 │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">array&lt;float64&gt;</span>                                            │
├────────────┼─────────────────────────────────────────────────┼─────────────────┼────────────────────────────────────────────────────────────────────────────────────────┼───────────────────────────────────────────────────────────┤
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.569501</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/posts/roadmap-2024-H1/index.qmd           </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2958</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Ibis project 2024 roadmap"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: "Cody Peterson"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">date: "2024-02-1…   </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.011533920653164387</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.07820627093315125</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>   │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.563448</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/why.qmd                                   </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">731</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Why Ibis?"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">Ibis is the portable Python dataframe library.</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">If …</span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.00048549860366620123</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.05761361122131348</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span> │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.555909</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/concepts/who.qmd                          </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">800</span> │ <span style="color: #008000; text-decoration-color: #008000"># Who supports Ibis?</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">Ibis is an open-source project that welcomes contribution…    </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.006300679408013821</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.05288177356123924</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>   │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.544127</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/posts/ibis-version-4.0.0-release/index.qmd</span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">743</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: Ibis v4.0.0</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: Patrick Clarke</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">date: 2023-01-09</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">categories:</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">    … </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.017321649938821793</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.05772090330719948</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>   │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.524721</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/posts/zulip/index.qmd                     </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">440</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Announcing Zulip for Ibis community chat"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: "Ibis team"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">date:…   </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.00033197790617123246</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.05603647977113724</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>  │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.514110</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/concepts/user-testimonials.qmd            </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1079</span> │ <span style="color: #008000; text-decoration-color: #008000"># User testimonials</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">This page collects user testimonials about Ibis from the c…    </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.013335400260984898</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.034098923206329346</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>  │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.510652</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/posts/Ibis-version-3.0.0-release/index.qmd</span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2038</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: Ibis v3.0.0</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: Marlene Mhangami</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">date: 2022-04-25</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">categories:</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">  … </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.02136301063001156</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.03890605643391609</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>    │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.507567</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/posts/ibis-to-file/index.qmd              </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">700</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Ibis sneak peek: writing to files"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: Kae Suarez</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">date: 2023-03…   </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.02339361608028412</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.07014117389917374</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>     │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.505812</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/posts/why-voda-supports-                  </span> │            <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3056</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Why Voltron Data supports Ibis"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">author: "Cody Peterson + Ian Cook"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">…   </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.0027232086285948753</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.0460839718580246</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>   │
│   <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.501638</span> │ <span style="color: #008000; text-decoration-color: #008000">docs/getting-started.qmd                       </span> │             <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">157</span> │ <span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">title: "Getting started"</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">sidebar: getting-started</span><span style="color: #d78700; text-decoration-color: #d78700">\n</span><span style="color: #008000; text-decoration-color: #008000">---</span><span style="color: #d78700; text-decoration-color: #d78700">\n\n</span><span style="color: #008000; text-decoration-color: #008000">Welcome to the Ibis … </span> │ <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.035996999591588974</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.03943954035639763</span>, <span style="color: #808000; text-decoration-color: #808000">...</span> +<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1534</span><span style="font-weight: bold">]</span>   │
│          <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                               │               <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span> │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                                                      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">…</span>                                                         │
└────────────┴─────────────────────────────────────────────────┴─────────────────┴────────────────────────────────────────────────────────────────────────────────────────┴───────────────────────────────────────────────────────────┘
</pre>
</div>
</div>
</section>
</section>
<section id="rag-pitfalls" class="level2">
<h2 class="anchored" data-anchor-id="rag-pitfalls">RAG pitfalls</h2>
<p>As in traditional software engineering and machine learning, the architecture when building systems around language models is not a universal. The best depends on the application of the system. Using cosine (or otherwise) similarity search over text transformed to numbers may not always perform best.</p>
<p>We can demonstrate this with the following scenario: let’s assume we’re building a chatbot that writes and runs SQL on the user’s behalf based on their questions posed in English (or any language the language model understand sufficiently). We might store past queries, the SQL generated, and some evaluation criteria (upvote/downvote on the generated SQL from the user) in a database. Then we can use the same RAG approach above to augment our queries with the user’s past queries and the generated SQL.</p>
<p>Take the following English query:</p>
<div id="cc91ed9c" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="st">"""the first 10 rows of the penguins, ordered by body_mass_g from</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="st">lightest to heaviest"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can compute the cosine similarity of this query against itself, resulting in 1.0 or close to it:</p>
<div id="9ec65ea2" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>list_cosine_similarity(_embed(a), _embed(a))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div class="ansi-escaped-output">
<pre><span class="ansi-cyan-fg ansi-bold">0.9999994546885027</span></pre>
</div>
</div>
</div>
<p>Now, let’s flip the ordering. This would result in an entirely different SQL query and result set:</p>
<div id="feb65948" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> <span class="st">"""the first 10 rows of the penguins, ordered by body_mass_g from</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="st">heaviest to lightest"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And compute the cosine similarity of <code>a</code> and <code>b</code>:</p>
<div id="f6e638b2" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>list_cosine_similarity(_embed(a), _embed(b))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div class="ansi-escaped-output">
<pre><span class="ansi-cyan-fg ansi-bold">0.9934337761234602</span></pre>
</div>
</div>
</div>
<p>Similarly, we can construct a semantically equivalent query that would result in the same SQL as example <code>a</code>:</p>
<div id="5b7538bd" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> <span class="st">"""of the birds retrieve the initial ten opposite-of-columns,</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="st">sorted from biggest to smallest by weight"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That has a much lower cosine similarity in the embedding space:</p>
<div id="e0b9ca7b" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>list_cosine_similarity(_embed(a), _embed(c))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div class="ansi-escaped-output">
<pre><span class="ansi-cyan-fg ansi-bold">0.5682471739636249</span></pre>
</div>
</div>
</div>
<p>Despite semantic equivalence, these two queries would not be considered similar. You need to be careful and understand what the system is doing.</p>
</section>
<section id="discussion" class="level2">
<h2 class="anchored" data-anchor-id="discussion">Discussion</h2>
<p>Is traditional RAG the best approach? It’s unclear, and <strong>it depends</strong>.</p>
<section id="system-architecture" class="level3">
<h3 class="anchored" data-anchor-id="system-architecture">System architecture</h3>
<p>Often RAG-based systems introduce yet-another-database to store the embeddings. Hopefully this post has demonstrated that traditional database options can work just fine. While we’re only demonstrating this on a few rows here, DuckDB can scale up to many millions with ease.</p>
</section>
<section id="cost-and-speed" class="level3">
<h3 class="anchored" data-anchor-id="cost-and-speed">Cost and speed</h3>
<p>The cost of running this demo from OpenAI is less than $0.01 USD. It also runs in about a minute, but with many rows this would be much slower. You need to consider your architecture here. One option would be using an open source embedding model that can run locally. Swap out the OpenAI calls with that and see how it goes!</p>
</section>
<section id="alternatives-to-vector-search-rag" class="level3">
<h3 class="anchored" data-anchor-id="alternatives-to-vector-search-rag">Alternatives to vector search RAG</h3>
<p>It’s clear that we should always be augmenting our language model calls with the most relevant context, even if traditional vector search RAG is not the best solution. The problem then becomes the best way to retrieve that context for a given system’s desired behavior.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Abolish RAG as terminology?">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Abolish RAG as terminology?
</div>
</div>
<div class="callout-body-container callout-body">
<p>“I would like to abolish the term RAG and instead just agree that we should always try to provide models with the appropriate context to provide high quality answers.” - <a href="https://twitter.com/HamelHusain/status/1709740984643596768">Hamel Husain</a></p>
</div>
</div>
<p>Some alternatives to vector search RAG include:</p>
<ul>
<li>traditional search methods</li>
<li>using an external web search engine</li>
<li>using a language model for search</li>
</ul>
<p>The last point is particularly interesting – in the above examples with <code>a</code> and <code>c</code> strings, cosine similarity in the embedding space could not tell the queries are semantically equivalent. However, a sufficiently good language model certainly could. As we demonstrated in <a href="../../posts/lms-for-data/index.html">language models for data</a>, we could even setup a classifier and use <a href="https://www.askmarvin.ai/docs/text/classification/#classifying-text">the logit bias trick</a> to compute similarity with a single output token.</p>
<p>This trick makes the language model faster, but for practical applications the cost and speed of language models for search is still a concern. We can expect this concern to be mitigated over time as language models become faster and cheaper to run.</p>
<p>With larger context lengths, we could also use an initial call to a language model to extract out relevant sections of text and then make a second call with that augmented context.</p>
</section>
</section>
<section id="next-steps" class="level2">
<h2 class="anchored" data-anchor-id="next-steps">Next steps</h2>
<p>Try this out yourself! All you need is an OpenAI account and the code above.</p>
<p>It’s never been a better time to get involved with Ibis. <a href="https://ibis-project.zulipchat.com/">Join us on Zulip and introduce yourself!</a> More Ibis + language model content coming soon.</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script type="application/vnd.jupyter.widget-state+json">
{"state":{"334610f7538b489e848fd4ada571fb77":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":"auto"}},"b6f82069965c447980822b582e732f47":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"ProgressView","bar_style":"","description":"","description_allow_html":false,"layout":"IPY_MODEL_334610f7538b489e848fd4ada571fb77","max":100,"min":0,"orientation":"horizontal","style":"IPY_MODEL_bc77ba6d8398430aad23c7dd8678070e","tabbable":null,"tooltip":null,"value":100}},"bc77ba6d8398430aad23c7dd8678070e":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","bar_color":"black","description_width":""}}},"version_major":2,"version_minor":0}
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/ibis-project\.org");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="ibis-project/ibis" data-repo-id="MDEwOlJlcG9zaXRvcnkzNDEzOTIzMA==" data-category="Q&amp;A" data-category-id="DIC_kwDOAgjsXs4CASeT" data-mapping="title" data-reactions-enabled="0" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ibis-project/ibis/edit/main/docs/posts/duckdb-for-rag/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/ibis-project/ibis/issues/new/choose" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ibis-project">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://ibis-project.zulipchat.com">
      <i class="bi bi-zulip" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://ibis-project.org/posts.xml">
      <i class="bi bi-rss" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>