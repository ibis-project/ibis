<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.9">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Chloe He">
<meta name="dcterms.date" content="2024-02-26">

<title>Stream-batch unification through Ibis – Ibis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<script src="../../site_libs/quarto-search/autocomplete-preset-algolia.umd.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../logo.svg" rel="icon" type="image/svg+xml">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e67ff5f79a98c6389aa7c0b9e6712459.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-14475e581903c9a7e5ed069634c08d5c.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-12c8c4cf821d2fd1848e951be45237d8.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "algolia": {
    "application-id": "TNU9HG3L41",
    "search-only-api-key": "26350948d1961209df16d9717a7e01d6",
    "index-name": "prod_ibis",
    "analytics-events": true,
    "show-logo": true,
    "libDir": "site_libs"
  },
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/algoliasearch@4.5.1/dist/algoliasearch-lite.umd.js"></script>


<script type="text/javascript">
var ALGOLIA_INSIGHTS_SRC = "https://cdn.jsdelivr.net/npm/search-insights/dist/search-insights.iife.min.js";
!function(e,a,t,n,s,i,c){e.AlgoliaAnalyticsObject=s,e[s]=e[s]||function(){
(e[s].queue=e[s].queue||[]).push(arguments)},i=a.createElement(t),c=a.getElementsByTagName(t)[0],
i.async=1,i.src=n,c.parentNode.insertBefore(i,c)
}(window,document,"script",ALGOLIA_INSIGHTS_SRC,"aa");
</script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@algolia/autocomplete-plugin-algolia-insights">

</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script data-goatcounter="https://ibis.goatcounter.com/count" async="" src="//gc.zgo.at/count.js"></script>


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Stream-batch unification through Ibis – Ibis">
<meta property="og:description" content="the portable Python dataframe library">
<meta property="og:image" content="https://ibis-project.org/posts/unified-stream-batch/logo.png">
<meta property="og:site_name" content="Ibis">
<meta name="twitter:title" content="Stream-batch unification through Ibis – Ibis">
<meta name="twitter:description" content="the portable Python dataframe library">
<meta name="twitter:image" content="https://ibis-project.org/posts/unified-stream-batch/logo.png">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Ibis</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-getting-started" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Getting started</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-getting-started">    
        <li>
    <a class="dropdown-item" href="../../install.html">
 <span class="dropdown-text">Installation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../tutorials/getting_started.html">
 <span class="dropdown-text">Tutorial: getting started</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../tutorials/ibis-for-dplyr-users.html">
 <span class="dropdown-text">Tutorial: Ibis for dplyr users</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../tutorials/ibis-for-pandas-users.html">
 <span class="dropdown-text">Tutorial: Ibis for pandas users</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../tutorials/ibis-for-sql-users.html">
 <span class="dropdown-text">Tutorial: Ibis for SQL users</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Browser</li>
        <li>
    <a class="dropdown-item" href="../../tutorials/browser/repl.html">
 <span class="dropdown-text">JupyterLite console</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Cloud Data Platforms</li>
        <li>
    <a class="dropdown-item" href="../../tutorials/cloud-data-platforms/clickhouse.html">
 <span class="dropdown-text">ClickHouse</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../tutorials/cloud-data-platforms/starburst-galaxy/0_setup.html">
 <span class="dropdown-text">Starburst Galaxy</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Open Source Software</li>
        <li>
    <a class="dropdown-item" href="../../tutorials/open-source-software/apache-flink/0_setup.html">
 <span class="dropdown-text">Apache Flink</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-concepts" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Concepts</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-concepts">    
        <li>
    <a class="dropdown-item" href="../../why.html">
 <span class="dropdown-text">Why Ibis?</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../concepts/composable-ecosystem.html">
 <span class="dropdown-text">Composable data ecosystem</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../concepts/datatypes.html">
 <span class="dropdown-text">Datatypes and Datashapes</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../concepts/internals.html">
 <span class="dropdown-text">Internals</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../concepts/user-testimonials.html">
 <span class="dropdown-text">User testimonials</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../concepts/versioning.html">
 <span class="dropdown-text">Versioning policy</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../concepts/who.html">
 <span class="dropdown-text">Who supports Ibis?</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-backends" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Backends</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-backends">    
        <li>
    <a class="dropdown-item" href="../../backends/bigquery.html">
 <span class="dropdown-text">BigQuery</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/clickhouse.html">
 <span class="dropdown-text">ClickHouse</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/dask.html">
 <span class="dropdown-text">Dask</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/datafusion.html">
 <span class="dropdown-text">DataFusion</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/druid.html">
 <span class="dropdown-text">Druid</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/duckdb.html">
 <span class="dropdown-text">DuckDB</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/exasol.html">
 <span class="dropdown-text">Exasol</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/flink.html">
 <span class="dropdown-text">Flink</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/impala.html">
 <span class="dropdown-text">Impala</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/mssql.html">
 <span class="dropdown-text">MSSQL</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/mysql.html">
 <span class="dropdown-text">MySQL</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/oracle.html">
 <span class="dropdown-text">Oracle</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/pandas.html">
 <span class="dropdown-text">pandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/polars.html">
 <span class="dropdown-text">Polars</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/postgresql.html">
 <span class="dropdown-text">PostgreSQL</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/pyspark.html">
 <span class="dropdown-text">PySpark</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/risingwave.html">
 <span class="dropdown-text">RisingWave</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/snowflake.html">
 <span class="dropdown-text">Snowflake</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/sqlite.html">
 <span class="dropdown-text">SQLite</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/trino.html">
 <span class="dropdown-text">Trino</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Support</li>
        <li>
    <a class="dropdown-item" href="../../backends/support/matrix.html">
 <span class="dropdown-text">Operation support matrix</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../backends/support/operations.html">
 <span class="dropdown-text">Operations</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-how-to" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">How-to</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-how-to">    
        <li class="dropdown-header">Configure</li>
        <li>
    <a class="dropdown-item" href="../../how-to/configure/basics.html">
 <span class="dropdown-text">Basic configuration</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Input Output</li>
        <li>
    <a class="dropdown-item" href="../../how-to/input-output/basics.html">
 <span class="dropdown-text">Basic input/output</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/input-output/duckdb-parquet.html">
 <span class="dropdown-text">Read parquet files with Ibis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/input-output/gcs_duckdb.html">
 <span class="dropdown-text">Loading Google Cloud Storage files with DuckDB</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/input-output/multiple-backends.html">
 <span class="dropdown-text">Work with multiple backends</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Analytics</li>
        <li>
    <a class="dropdown-item" href="../../how-to/analytics/basics.html">
 <span class="dropdown-text">Basic analytics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/analytics/chain_expressions.html">
 <span class="dropdown-text">Chaining expressions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/analytics/imdb.html">
 <span class="dropdown-text">Analyze IMDB data using Ibis</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Visualization</li>
        <li>
    <a class="dropdown-item" href="../../how-to/visualization/altair.html">
 <span class="dropdown-text">Altair + Ibis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/visualization/graphs.html">
 <span class="dropdown-text">GraphViz + Ibis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/visualization/matplotlib.html">
 <span class="dropdown-text">matplotlib + Ibis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/visualization/plotly.html">
 <span class="dropdown-text">Plotly + Ibis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/visualization/plotnine.html">
 <span class="dropdown-text">plotnine + Ibis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/visualization/seaborn.html">
 <span class="dropdown-text">seaborn + Ibis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/visualization/streamlit.html">
 <span class="dropdown-text">Streamlit + Ibis</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Extending</li>
        <li>
    <a class="dropdown-item" href="../../how-to/extending/builtin.html">
 <span class="dropdown-text">Reference built-in functions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/extending/sql.html">
 <span class="dropdown-text">Using SQL strings with Ibis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/extending/streaming.html">
 <span class="dropdown-text">Ibis for streaming</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../how-to/extending/unbound_expression.html">
 <span class="dropdown-text">Write and execute unbound expressions</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-reference" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Reference</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-reference">    
        <li class="dropdown-header">Expression API</li>
        <li>
    <a class="dropdown-item" href="../../reference/expression-tables.html">
 <span class="dropdown-text">Table expressions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/selectors.html">
 <span class="dropdown-text">Column selectors</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/expression-generic.html">
 <span class="dropdown-text">Generic expressions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/expression-numeric.html">
 <span class="dropdown-text">Numeric and Boolean expressions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/expression-strings.html">
 <span class="dropdown-text">String expressions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/expression-temporal.html">
 <span class="dropdown-text">Temporal expressions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/expression-collections.html">
 <span class="dropdown-text">Collection expressions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/expression-geospatial.html">
 <span class="dropdown-text">Geospatial expressions</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Type system</li>
        <li>
    <a class="dropdown-item" href="../../reference/datatypes.html">
 <span class="dropdown-text">Data types</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/schemas.html">
 <span class="dropdown-text">Schemas</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">UDFs</li>
        <li>
    <a class="dropdown-item" href="../../reference/scalar-udfs.html">
 <span class="dropdown-text">Scalar UDFs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/aggregate-udfs.html">
 <span class="dropdown-text">Aggregate UDFs (experimental)</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Connection APIs</li>
        <li>
    <a class="dropdown-item" href="../../reference/connection.html">
 <span class="dropdown-text">Top-level connection APIs</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Configuration</li>
        <li>
    <a class="dropdown-item" href="../../reference/Interactive.html">
 <span class="dropdown-text">Interactive</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/Options.html">
 <span class="dropdown-text">Options</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/Repr.html">
 <span class="dropdown-text">Repr</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/SQL.html">
 <span class="dropdown-text">SQL</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Cursed Knowledge</li>
        <li>
    <a class="dropdown-item" href="../../reference/cursed_knowledge.html">
 <span class="dropdown-text">Cursed Knowledge</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html"> 
<span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../presentations.html"> 
<span class="menu-text">Presentations</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../release_notes.html"> 
<span class="menu-text">Release notes</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-contribute" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Contribute</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-contribute">    
        <li class="dropdown-header">Contribute</li>
        <li>
    <a class="dropdown-item" href="../../contribute/01_environment.html">
 <span class="dropdown-text">Setting up a development environment</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../contribute/02_workflow.html">
 <span class="dropdown-text">Contribute to the Ibis codebase</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../contribute/03_style.html">
 <span class="dropdown-text">Style and formatting</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../contribute/04_maintainers_guide.html">
 <span class="dropdown-text">Maintaining the codebase</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../contribute/05_reference.html">
 <span class="dropdown-text">Test class reference</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/ibis-project/ibis">
            Source code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/ibis-project/ibis/issues/new?assignees=&amp;labels=bug&amp;projects=&amp;template=bug-report.yml&amp;title=bug">
            Report a bug
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/ibis-project/ibis/issues/new?assignees=&amp;labels=docs&amp;projects=&amp;template=docs-issue.yml&amp;title=docs">
            Report a documentation issue
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/ibis-project/ibis/issues/new?assignees=&amp;labels=feature&amp;projects=&amp;template=feature-request.yml&amp;title=feat">
            Submit a feature request
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/ibis-project/ibis/discussions/new?category=q-a">
            Ask the community for help
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Stream-batch unification through Ibis</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">blog</div>
                <div class="quarto-category">flink</div>
                <div class="quarto-category">risingwave</div>
                <div class="quarto-category">streaming</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Chloe He </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 26, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#ibis-combines-stream-and-batch-into-a-single-framework-beyond-version-8.0" id="toc-ibis-combines-stream-and-batch-into-a-single-framework-beyond-version-8.0" class="nav-link active" data-scroll-target="#ibis-combines-stream-and-batch-into-a-single-framework-beyond-version-8.0">Ibis combines stream and batch into a single framework beyond version 8.0</a></li>
  <li><a href="#why-is-batch-stream-unification-significant" id="toc-why-is-batch-stream-unification-significant" class="nav-link" data-scroll-target="#why-is-batch-stream-unification-significant">Why is batch-stream unification significant?</a></li>
  <li><a href="#ibis-unifies-batch-and-streaming" id="toc-ibis-unifies-batch-and-streaming" class="nav-link" data-scroll-target="#ibis-unifies-batch-and-streaming">Ibis unifies batch and streaming</a></li>
  <li><a href="#see-it-in-action" id="toc-see-it-in-action" class="nav-link" data-scroll-target="#see-it-in-action">See it in action</a></li>
  <li><a href="#concluding-thoughts" id="toc-concluding-thoughts" class="nav-link" data-scroll-target="#concluding-thoughts">Concluding thoughts</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/ibis-project/ibis/edit/main/docs/posts/unified-stream-batch/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/ibis-project/ibis/issues/new/choose" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>One of my focuses in the past 10 months has been to implement the Flink backend for Ibis. I was working with Apache Flink and building a feature engineering tool, and we stumbled upon Ibis as we attempted to build our own translation layer that could turn user declarations into relation trees, then optimize and deploy the query plan, all while maintaining the underlying infrastructure for the user. We considered and prototyped with a number of tools and eventually chose Ibis. It had already established a position in the batch world and had support for 10+ of the most popular batch engines (at the time). We loved the idea of decoupling the user-facing interface from the execution engine, so that users can swap out the execution engine depending on their needs, without having to rewrite code. And, of course, it was open-source. It was everything we dreamed of.</p>
<p>A few months later, <a href="https://github.com/ibis-project/ibis/pull/6408">we started introducing Apache Flink as the first streaming backend into Ibis</a>. We saw so much more that Ibis can do when it steps outside of batch.</p>
<p>Ibis 8.0 marks the official launch of the first streaming backends in Ibis (<a href="https://ibis-project.org/backends/flink">Apache Flink</a> and <a href="https://ibis-project.org/backends/risingwave">RisingWave</a>). This is a very significant milestone in Ibis development.</p>
<p>You may be wondering: what does this mean? Why is this such a big deal? I will be answering these questions in this blog post.</p>
<section id="ibis-combines-stream-and-batch-into-a-single-framework-beyond-version-8.0" class="level2">
<h2 class="anchored" data-anchor-id="ibis-combines-stream-and-batch-into-a-single-framework-beyond-version-8.0">Ibis combines stream and batch into a single framework beyond version 8.0</h2>
<p>Today, Ibis provides support for 20+ backends including Dask, DuckDB, PostgreSQL, PySpark, Snowflake, and others. However - before the introduction of Flink and RisingWave backends - all of the supported backends derive from a batch paradigm (aside from Spark, which does offer support for stream processing, albeit using micro-batches underneath the hood).</p>
<p>This means that Ibis is an extremely valuable tool, but it was limited to batch workloads. In the case of streaming workloads, where systems are <a href="https://www.oreilly.com/radar/the-world-beyond-batch-streaming-101/">designed with unbounded data in mind</a>, the batch-oriented Ibis fell short. To deal with an infinite data stream, streaming data systems operate with unique concepts such as “event time”, “processing time”, “watermark”, etc. All of these were missing from Ibis.</p>
<p>At the same time, streaming systems (Spark Streaming, Apache Flink, RisingWave, etc) have been gaining popularity. It drove the development of more mature technologies as well as new approaches to close the gap between batch and streaming worlds. <a href="https://www.ververica.com/blog/apache-flink-sql-past-present-and-future">Flink SQL, for example, was born as a part of such effort and, through allowing users to write streaming engines in a SQL-like manner, have been vastly successful in that regard.</a> The success of Flink SQL both validates the potential of stream and batch unification and inspires the community to push for better standards, a vision that Ibis is at a unique and valuable position to help build.</p>
</section>
<section id="why-is-batch-stream-unification-significant" class="level2">
<h2 class="anchored" data-anchor-id="why-is-batch-stream-unification-significant">Why is batch-stream unification significant?</h2>
<p>Firstly, large companies that have both batch and streaming workloads often deploy <a href="https://en.wikipedia.org/wiki/Lambda_architecture">Lambda architecture</a>. In a Lambda infrastructure, batch and streaming pipelines are separate, which requires two codebases to be set up and maintained. If you’re a platform engineer, you have probably found yourself trying to duplicate batch workloads “in streaming code” and vice versa. If you have backfilled a streaming pipeline due to a bug and needed to reimplement the logic on a batch pipeline, you know how painful that all is :(</p>
<p><a href="https://www.linkedin.com/blog/engineering/data-streaming-processing/unified-streaming-and-batch-pipelines-at-linkedin-reducing-proc">LinkedIn successfully reduced processing time by 94% and resource utilization by 50% after switching from a Lambda architecture to unified batch and streaming pipelines.</a> A unified system also massively increased engineer productivity because they no longer needed to develop and maintain separate codebases for different environments. <a href="https://www.uber.com/blog/kappa-architecture-data-stream-processing/">Uber</a>, <a href="https://www.ververica.com/blog/apache-flinks-stream-batch-unification-powers-alibabas-11.11-in-2020">Alibaba</a>, and <a href="https://beam.apache.org/case-studies/lyft/">Lyft</a> have also adopted similar solutions.</p>
<p>Secondly, in the world of machine learning, it’s common for data scientists to develop locally and experiment with a sampled, batch dataset in Python. If the results look promising, the features and models would then be deployed into production. Oftentimes, there is a code handover in this process, and a dedicated team of developers would be responsible for rewriting the logic for production, as a streaming workload.</p>
<p>In both cases, there is a huge amount of technical overhead. If there is a streamlined architecture, using a unified API, much of this overhead can be avoided. As a platform engineer, you no longer need to worry about maintaining two separate architectures and codebases. As a data scientist or a machine learning engineer, you can write one single workload that can execute both on batch and streaming backends. Wouldn’t that be amazing?</p>
</section>
<section id="ibis-unifies-batch-and-streaming" class="level2">
<h2 class="anchored" data-anchor-id="ibis-unifies-batch-and-streaming">Ibis unifies batch and streaming</h2>
<p>Enter Ibis. Ibis unifies batch and streaming with a single API. It decouples the dataframe API from backend execution, so that the logic for defining data transformations is unaffected by implementation discrepancies across backend engines. There is also an ongoing effort to further increase interoperability across different languages and systems via a standard query plan intermediate representation (IR), using a library called <a href="https://substrait.io/"><code>Substrait</code></a>.</p>
<p>What does this actually look like? For example, Ibis allows users to define window aggregations using the <a href="../../reference/expression-tables.html#ibis.expr.types.groupby.GroupedTable.over"><code>over()</code> method</a>. When executed on the Flink backend, this translates into <a href="https://nightlies.apache.org/flink/flink-docs-release-1.18/docs/dev/table/sql/queries/over-agg/">Flink’s over aggregation query</a> and outputs an aggregated value for every input row over a range of ordered rows. On streaming data, aggregation results are continuously computed and written into data sinks (e.g., Kafka, Redis) as records are received at and consumed from the upstream data source (e.g., Kafka, Change Data Capture). In pandas, the conceptual analog is <a href="https://pandas.pydata.org/docs/user_guide/window.html">windowing operation</a>. Results are computed by looking back the length of the window from the current observation, but can be computed all at once because batch data is static.</p>
<p>Another great example is deduplication. In Flink SQL, this looks something like this:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> [column_list]</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> (</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>   <span class="kw">SELECT</span> [column_list],</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span> ([<span class="kw">PARTITION</span> <span class="kw">BY</span> col1[, col2<span class="op">..</span>.]]</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>       <span class="kw">ORDER</span> <span class="kw">BY</span> time_attr [<span class="kw">asc</span>|<span class="kw">desc</span>]) <span class="kw">AS</span> <span class="kw">rownum</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>   <span class="kw">FROM</span> table_name)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> <span class="kw">rownum</span> <span class="op">=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In a database like Postgres, this could be as simple as</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> t0.`string_col`, t0.`int_col`</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> functional_alltypes t0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And in <code>pandas</code>, you would use the method <code>drop_duplicates()</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df.drop_duplicates()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>We’re working on supporting deduplication via <code>distinct()</code> in Flink backend and this feature should be available soon!</p>
</div>
</div>
<p>These underlying discrepancies are abstracted in such a way that you, as an Ibis user, will no longer find yourself struggling with bugs that are the result of subtleties across different engines and dialects. Need to rewrite your batch workload as a streaming one or vice versa? Rest assured, Ibis has you covered!</p>
</section>
<section id="see-it-in-action" class="level2">
<h2 class="anchored" data-anchor-id="see-it-in-action">See it in action</h2>
<p>Now, let’s walk through a code example together to see how simple this experience is!</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Prerequisites for running this example:</p>
<ul>
<li>Docker Compose: This tutorial uses Docker Compose to manage an Apache Kafka environment (including sample data generation) and a Flink cluster (for remote execution). You can <a href="https://docs.docker.com/compose/install/">download and install Docker Compose from the official website</a>.</li>
<li>JDK 11 release: Flink requires Java 11.</li>
<li>Python 3.9 or 3.10.</li>
<li>Follow <a href="../../tutorials/open-source-software/apache-flink/0_setup.html">the setup tutorial</a> to install the Flink backend for Ibis.</li>
<li>Clone the <a href="https://github.com/ibis-project/realtime-fraud-detection">example repository</a>.</li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This example is a hypothetical scenario and we will be using simulated data.</p>
</div>
</div>
<p>First, spin up the Docker containers by running <code>docker compose up kafka init-kafka data-generator</code>. This will set up a mocked Kafka source that contains records that look like the following:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"createTime"</span><span class="fu">:</span> <span class="st">"2023-09-20 22:19:02.224"</span><span class="fu">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"orderId"</span><span class="fu">:</span> <span class="dv">1695248388</span><span class="fu">,</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"payAmount"</span><span class="fu">:</span> <span class="fl">88694.71922270155</span><span class="fu">,</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"payPlatform"</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"provinceId"</span><span class="fu">:</span> <span class="dv">6</span><span class="fu">,</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This is a streaming data source. Commonly, to experiment with the data, we would extract a chunk of the data and load it in batch:</p>
<div id="ec406332" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> kafka <span class="im">import</span> KafkaConsumer</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>consumer <span class="op">=</span> KafkaConsumer(<span class="st">"payment_msg"</span>, auto_offset_reset<span class="op">=</span><span class="st">"earliest"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> []</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, msg <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="dv">100</span>), consumer):</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    rows.append(msg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is a tabular dataset and we can convert it into a <code>pandas</code> DataFrame:</p>
<div id="af03d88e" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame([json.loads(row.value) <span class="cf">for</span> row <span class="kw">in</span> rows])</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"createTime"</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">"createTime"</span>])</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">createTime</th>
<th data-quarto-table-cell-role="th">orderId</th>
<th data-quarto-table-cell-role="th">payAmount</th>
<th data-quarto-table-cell-role="th">payPlatform</th>
<th data-quarto-table-cell-role="th">provinceId</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2024-07-11 18:55:59.385</td>
<td>1720724160</td>
<td>16364.037210</td>
<td>0</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2024-07-11 18:55:59.889</td>
<td>1720724161</td>
<td>85325.378255</td>
<td>0</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2024-07-11 18:56:00.392</td>
<td>1720724162</td>
<td>32552.151228</td>
<td>0</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2024-07-11 18:56:00.897</td>
<td>1720724163</td>
<td>31583.771681</td>
<td>0</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2024-07-11 18:56:01.401</td>
<td>1720724164</td>
<td>34294.354640</td>
<td>0</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">95</td>
<td>2024-07-11 18:56:47.230</td>
<td>1720724255</td>
<td>37487.568775</td>
<td>0</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">96</td>
<td>2024-07-11 18:56:47.732</td>
<td>1720724256</td>
<td>37477.569665</td>
<td>0</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">97</td>
<td>2024-07-11 18:56:48.234</td>
<td>1720724257</td>
<td>32410.841238</td>
<td>1</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">98</td>
<td>2024-07-11 18:56:48.737</td>
<td>1720724258</td>
<td>58236.337548</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">99</td>
<td>2024-07-11 18:56:49.239</td>
<td>1720724259</td>
<td>78873.701022</td>
<td>0</td>
<td>2</td>
</tr>
</tbody>
</table>

<p>100 rows × 5 columns</p>
</div>
</div>
</div>
<p>We can connect to this DataFrame in Ibis in a local execution backend:</p>
<div id="4bc51a21" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ibis</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>con <span class="op">=</span> ibis.get_backend()</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>con.create_table(<span class="st">"payments"</span>, df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">DatabaseTable: memory.main.payments
  createTime  timestamp(6)
  orderId     int64
  payAmount   float64
  payPlatform int64
  provinceId  int64
</pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The default execution engine for Ibis is DuckDB.</p>
</div>
</div>
<p>This is a series of records of order transactions. At Company Potclay, we have just deployed a new ad campaign, which is A/B tested by province, and we’re interested in the effectiveness of this ad campaign by monitoring data distribution shift over time. A crucial feature is the total transaction amount over the past minute, stratified by province. We would like to first experiment writing this feature on a smaller set of batch data. After we make sure that the logic looks correct and handles all edge cases appropriately, we want to deploy this as a streaming workload.</p>
<p>Ibis allows us to write transformations on top of so-called abstract or unbound tables (i.e., tables that are not bound to an actual data source). This separation between transformation logic and the underlying data and execution is one of the things that makes Ibis so powerful. It’s similar to dependency injection, but in this case the data is the dependency and is injected at runtime.</p>
<p>To write transformations on top of an unbound table, we need to first define an <code>ibis.table()</code> with a schema. Here is how we would write all of this in Ibis code:</p>
<div id="462a51d3" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ibis.expr.schema <span class="im">as</span> sch</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ibis.expr.datatypes <span class="im">as</span> dt</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ibis <span class="im">import</span> _</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>schema <span class="op">=</span> sch.Schema(</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"createTime"</span>: dt.timestamp(scale<span class="op">=</span><span class="dv">3</span>),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"orderId"</span>: dt.int64,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"payAmount"</span>: dt.float64,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"payPlatform"</span>: dt.int32,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"provinceId"</span>: dt.int32,</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>unbound_table <span class="op">=</span> ibis.table(schema, name<span class="op">=</span><span class="st">"payments"</span>)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>unbound_agged <span class="op">=</span> unbound_table[</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"provinceId"</span>,</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    _.payAmount.<span class="bu">sum</span>()</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    .over(<span class="bu">range</span><span class="op">=</span>(<span class="op">-</span>ibis.interval(seconds<span class="op">=</span><span class="dv">10</span>), <span class="dv">0</span>), order_by<span class="op">=</span>_.createTime)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    .name(<span class="st">"pay_amount"</span>),</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>unbound_agged</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">r0 := UnboundTable: payments
  createTime  timestamp(3)
  orderId     int64
  payAmount   float64
  payPlatform int32
  provinceId  int32

Project[r0]
  provinceId: r0.provinceId
  pay_amount: WindowFunction(func=Sum(r0.payAmount), how='range', start=WindowBoundary(value=10 s, preceding=True), end=WindowBoundary(Cast(0, to=interval('s'))), order_by=[asc r0.createTime])
</pre>
</div>
</div>
<p>Carrying out the computations using the local execution backend that we connected to above is as simple as:</p>
<div id="f3cd6db6" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>con.to_pandas(unbound_agged)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">provinceId</th>
<th data-quarto-table-cell-role="th">pay_amount</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2</td>
<td>1.636404e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>1.016894e+05</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>5</td>
<td>1.342416e+05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>5</td>
<td>1.658253e+05</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>3</td>
<td>2.001197e+05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">95</td>
<td>5</td>
<td>1.127313e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">96</td>
<td>2</td>
<td>1.111165e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">97</td>
<td>2</td>
<td>1.122423e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">98</td>
<td>0</td>
<td>1.088848e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">99</td>
<td>2</td>
<td>1.082766e+06</td>
</tr>
</tbody>
</table>

<p>100 rows × 2 columns</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>DuckDB is much faster than <code>pandas</code>, and using Ibis you don’t need to write SQL for it!</p>
</div>
</div>
<p>For local experimentation purposes, this DataFrame only consists of 100 rows, so doing this in memory is easy.</p>
<p>The outputs look correct and we didn’t run into any errors. We are now ready to deploy this as a streaming job in Flink!</p>
<p>First, let’s set up the Flink environment and connect to this Kafka source:</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Kafka connector is not part of the binary distribution, so we need to download and link it for cluster execution explicitly:</p>
<div id="07b088d9" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>wget <span class="op">-</span>N https:<span class="op">//</span>repo.maven.apache.org<span class="op">/</span>maven2<span class="op">/</span>org<span class="op">/</span>apache<span class="op">/</span>flink<span class="op">/</span>flink<span class="op">-</span>sql<span class="op">-</span>connector<span class="op">-</span>kafka<span class="op">/</span><span class="fl">1.17.1</span><span class="op">/</span>flink<span class="op">-</span>sql<span class="op">-</span>connector<span class="op">-</span>kafka<span class="op">-</span><span class="fl">1.17.1</span>.jar</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div id="e92fdc1e" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyflink.table <span class="im">import</span> EnvironmentSettings, TableEnvironment</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyflink.common <span class="im">import</span> Configuration</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>source_schema <span class="op">=</span> sch.Schema(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"createTime"</span>: dt.timestamp(scale<span class="op">=</span><span class="dv">3</span>),</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"orderId"</span>: dt.int64,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"payAmount"</span>: dt.float64,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"payPlatform"</span>: dt.int32,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"provinceId"</span>: dt.int32,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>env_settings <span class="op">=</span> EnvironmentSettings.in_streaming_mode()</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>table_env <span class="op">=</span> TableEnvironment.create(env_settings)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>table_config <span class="op">=</span> table_env.get_config()</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>config <span class="op">=</span> Configuration()</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>config.set_string(<span class="st">"parallelism.default"</span>, <span class="st">"1"</span>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>table_config.add_configuration(config)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>connection <span class="op">=</span> ibis.flink.<span class="ex">connect</span>(table_env)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co"># add the JAR downloaded above</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>connection.raw_sql(<span class="st">"ADD JAR 'flink-sql-connector-kafka-1.17.1.jar'"</span>)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>source_configs <span class="op">=</span> {</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"connector"</span>: <span class="st">"kafka"</span>,</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"topic"</span>: <span class="st">"payment_msg"</span>,</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"properties.bootstrap.servers"</span>: <span class="st">"localhost:9092"</span>,</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"properties.group.id"</span>: <span class="st">"test_3"</span>,</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">"scan.startup.mode"</span>: <span class="st">"earliest-offset"</span>,</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"format"</span>: <span class="st">"json"</span>,</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>connection.create_table(</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">"payments"</span>,</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>    schema<span class="op">=</span>source_schema,</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>    tbl_properties<span class="op">=</span>source_configs,</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>    watermark<span class="op">=</span>ibis.watermark(</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>        time_col<span class="op">=</span><span class="st">"createTime"</span>, allowed_delay<span class="op">=</span>ibis.interval(seconds<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">DatabaseTable: payments
  createTime  timestamp(3)
  orderId     int64
  payAmount   float64
  payPlatform int32
  provinceId  int32
</pre>
</div>
</div>
<p>How would we write this in Flink SQL? Ibis makes this extremely easy by exposing a <code>compile()</code> API:</p>
<div id="87e9bfd5" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>sql <span class="op">=</span> connection.<span class="bu">compile</span>(unbound_agged)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sql)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>SELECT `t0`.`provinceId`, SUM(`t0`.`payAmount`) OVER (ORDER BY `t0`.`createTime` ASC NULLS LAST RANGE BETWEEN INTERVAL '10' SECOND(2) preceding AND CURRENT ROW) AS `pay_amount` FROM `payments` AS `t0`</code></pre>
</div>
</div>
<p>Before we can execute this query, we need to first define a data sink where the results can be written:</p>
<div id="9edeed42" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>sink_schema <span class="op">=</span> sch.Schema(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"province_id"</span>: dt.int32,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"pay_amount"</span>: dt.float64,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>kafka_sink_configs <span class="op">=</span> {</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"connector"</span>: <span class="st">"kafka"</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"topic"</span>: <span class="st">"sink"</span>,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"properties.bootstrap.servers"</span>: <span class="st">"localhost:9092"</span>,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"format"</span>: <span class="st">"json"</span>,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>connection.create_table(</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"kafka_sink"</span>, schema<span class="op">=</span>sink_schema, tbl_properties<span class="op">=</span>kafka_sink_configs</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">DatabaseTable: kafka_sink
  province_id int32
  pay_amount  float64
</pre>
</div>
</div>
<p>Now, let’s write the results into this sink. Note that we can directly reuse the transformation logic that we wrote above for the local execution backend!!</p>
<div id="65df8e0e" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>connection.insert(<span class="st">"kafka_sink"</span>, unbound_agged)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>&lt;pyflink.table.table_result.TableResult at 0x30e7dbac0&gt;</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can examine the results either using the Kafka console consumer CLI or the <code>kafka-python</code> library.</p>
</div>
</div>
<p>How easy was it to define both batch and streaming workloads using Ibis? Without Ibis, you would have needed to write a <code>pandas</code>/DuckDB workload and then convert it into Flink SQL manually.</p>
</section>
<section id="concluding-thoughts" class="level2">
<h2 class="anchored" data-anchor-id="concluding-thoughts">Concluding thoughts</h2>
<p>With the introduction of the first streaming backends, Ibis is now both a batch and a streaming Python DataFrame API and we’re excited about what’s to come next. We hope that Ibis can close the gap between batch and streaming in such a way that we no longer talk about the two separately, but, rather, as two parts of the same paradigm. Streaming naturally lends itself to batch: batch is technically just a special case of streaming, where the unbounded data flow stops at some point.</p>
<p>Of course, this is only the beginning. There are still technical challenges to be solved (e.g., backfill, window computations over large windows, GPU acceleration), and we’ll definitely have more exciting updates to share with the community soon!</p>
<p>Check out the new <a href="https://ibis-project.org/backends/flink">Apache Flink</a> and <a href="https://ibis-project.org/backends/risingwave">RisingWave</a> backends and let us know what you think!</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/ibis-project\.org");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="ibis-project/ibis" data-repo-id="MDEwOlJlcG9zaXRvcnkzNDEzOTIzMA==" data-category="Q&amp;A" data-category-id="DIC_kwDOAgjsXs4CASeT" data-mapping="title" data-reactions-enabled="0" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ibis-project/ibis/edit/main/docs/posts/unified-stream-batch/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/ibis-project/ibis/issues/new/choose" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ibis-project">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://ibis-project.zulipchat.com">
      <i class="bi bi-zulip" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://ibis-project.org/posts.xml">
      <i class="bi bi-rss" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>