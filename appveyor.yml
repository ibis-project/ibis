build: off

platform:
  - x64

environment:
  PGUSER: "postgres"
  PGPASSWORD: "Password12!"
  IBIS_POSTGRES_USER: "%PGUSER%"
  IBIS_POSTGRES_PASS: "%PGPASSWORD%"
  DATA_DIR: "%USERPROFILE%\\ibis-testing-data"
  DATA_URL: "https://storage.googleapis.com/ibis-ci-data"
  IBIS_TEST_POSTGRES_DB: "ibis_testing"
  IBIS_TEST_CRUNCHBASE_DB: "%USERPROFILE%\\crunchbase.db"
  IBIS_TEST_SQLITE_DB_PATH: "%USERPROFILE%\\ibis_testing.db"

  matrix:
    - PYTHON: "C:\\Python27-x64\\python.exe"
    - PYTHON: "C:\\Python34-x64\\python.exe"
    - PYTHON: "C:\\Python35-x64\\python.exe"
    - PYTHON: "C:\\Python36-x64\\python.exe"

services:
  - postgresql93

test_script:
  - "%PYTHON% -m pip install -U pip"
  - "%PYTHON% -m pip install -U setuptools"
  - "%PYTHON% -m pip install -e .\"[sqlite, postgres, visualization, pandas]\""
  - "%PYTHON% -m pip install flake8 mock pytest click \"pbs==0.110\""
  - "%PYTHON% -m flake8"
  - "%PYTHON% ci\\datamgr.py download --directory \"%USERPROFILE%\""
  - "%PYTHON% ci\\datamgr.py sqlite --database \"%IBIS_TEST_SQLITE_DB_PATH%\" --data-directory \"%DATA_DIR%\" --script ci\\sqlite_load.sql functional_alltypes batting awards_players diamonds"
  - "%PYTHON% ci\\datamgr.py postgres --database \"%IBIS_TEST_POSTGRES_DB%\" --data-directory \"%DATA_DIR%\" --script ci\\postgresql_load.sql functional_alltypes batting awards_players diamonds"
  - "%PYTHON% -m pytest --tb=short -m \"not impala and not hdfs\" ibis"
